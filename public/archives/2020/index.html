<!DOCTYPE html>
<html>

<head>
  
  <title>Archive：2020 - Hexo</title>
  <meta charset="UTF-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  

  <link rel="shortcut icon" href="/favicon.ico" type="image/png" />
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/archives/2020/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/css/mdui.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.15.8/styles/atom-one-dark.css">
   
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  
  
    <link rel="stylesheet" href="//at.alicdn.com/t/font_1592904_ebmtvlhjw4d.css">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1038733_0xvrvpg9c0r.css">
  <link rel="stylesheet" href="/css/style.css?v=1578289441329">
<meta name="generator" content="Hexo 4.2.0"></head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url(https://i.loli.net/2019/01/13/5c3aec85a4343.jpg)"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">menu</i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="John Doe" class="mdui-btn mdui-btn-icon"><img src="/images/avatar.png"></a>
       </div>
    </div>
  </div>
  <div id="nexmoe-header">
      <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="John Doe">
            <img src="/images/avatar.png" alt="John Doe">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>Articles</span>11</div>
        <div><span>Tags</span>4</div>
        <div><span>Categories</span>4</div>
    </div>
    <ul class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about.html" title="关于博客">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                关于博客
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/PY.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
    </ul>
    <aside id="nexmoe-sidebar">
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Social</h3>
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://space.bilibili.com/20238211" target="_blank" mdui-tooltip="{content: '哔哩哔哩'}" style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a><a class="mdui-ripple" href="https://github.com/daizc311/" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a>
    </div>
</div>
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Categories</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Study/HEXO/">HEXO</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Study/Java/">Java</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Study/OperationAndMaintenance/">OperationAndMaintenance</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Study/">Study</a>
          <span class="category-list-count">5</span>
        </li>

        
      </ul>

    </div>
  </div>


  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Tag Cloud</h3>
    <div id="randomtagcloud" class="nexmoe-widget tagcloud">
      <a href="/tags/blog/" style="font-size: 10px;">blog</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/linux/" style="font-size: 20px;">linux</a> <a href="/tags/zookeeper/" style="font-size: 20px;">zookeeper</a>
    </div>
    
  </div>

  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Archive</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li></ul>
    </div>
  </div>


  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2020 John Doe
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://nexmoe.com/hexo-theme-nexmoe.html" target="_blank">Nexmoe</a>
    </div>
</div><!-- .nexmoe-drawer -->
  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
        <section class="nexmoe-posts" id="brand-waterfall">
    
    <div class="nexmoe-post">
        <a href="/2020/01/06/hello-world/">
            <div class="nexmoe-post-cover mdui-ripple"> 
                
                    <img src="https://i.loli.net/2019/01/13/5c3aec85a4343.jpg" alt="Hello World">
                
                <h1>Hello World</h1>
            </div>
        </a>
        <div class="nexmoe-post-meta">
            <a><i class="nexmoefont icon-calendar-fill"></i>2020年01月06日</a>
            <a><i class="nexmoefont icon-areachart"></i>80 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
            
            
        </div>
        <article>
            
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">More info: [Server](https://hexo.io/docs/server.html)</span><br><span class="line"></span><br><span class="line"><span class="comment">### Generate static files</span></span><br><span class="line"></span><br><span class="line">``` bash</span><br><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>

            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2020/01/06/SpringBoot%E4%B8%AD%E7%9A%84redis%E5%AF%86%E7%A0%81%E9%97%AE%E9%A2%98/">
            <div class="nexmoe-post-cover mdui-ripple"> 
                
                    <img src="https://i.loli.net/2019/01/13/5c3aec85a4343.jpg" alt="SpringBoot中的redis密码问题">
                
                <h1>SpringBoot中的redis密码问题</h1>
            </div>
        </a>
        <div class="nexmoe-post-meta">
            <a><i class="nexmoefont icon-calendar-fill"></i>2020年01月06日</a>
            <a><i class="nexmoefont icon-areachart"></i>2.5k 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 13 分钟</a>
            
            
        </div>
        <article>
            
            <h2 id="出现问题"><a href="#出现问题" class="headerlink" title="出现问题"></a>出现问题</h2><p>出问题的配置如下</p>
<hr>
<p>application.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="comment"># REDIS_URL</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">redis://192.168.1.233:6379</span></span><br><span class="line">    <span class="comment"># 如果有密码</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">testpassword123</span></span><br><span class="line">    <span class="comment"># 存储到分区1</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">1</span></span><br><span class="line">    <span class="comment"># 默认超时2000</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure>

<p>报错的日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">[20190827 20:42:53] ERROR 7900 --- [nio-8086-exec-2] c.z.v.d.a.c.mvc.GlobalExceptionHandler   : Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.</span><br><span class="line"></span><br><span class="line">org.springframework.data.redis.RedisConnectionFailureException: Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.</span><br><span class="line">	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getNativeConnection(LettuceConnectionFactory.java:1092)</span><br><span class="line">	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getConnection(LettuceConnectionFactory.java:1065)</span><br><span class="line">	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getSharedConnection(LettuceConnectionFactory.java:865)</span><br><span class="line">	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getConnection(LettuceConnectionFactory.java:340)</span><br><span class="line">	at org.springframework.data.redis.cache.DefaultRedisCacheWriter.execute(DefaultRedisCacheWriter.java:238)</span><br><span class="line">	at org.springframework.data.redis.cache.DefaultRedisCacheWriter.get(DefaultRedisCacheWriter.java:109)</span><br><span class="line">	at org.springframework.data.redis.cache.RedisCache.lookup(RedisCache.java:82)</span><br><span class="line">	at org.springframework.cache.support.AbstractValueAdaptingCache.get(AbstractValueAdaptingCache.java:58)</span><br><span class="line">	at org.springframework.cache.interceptor.AbstractCacheInvoker.doGet(AbstractCacheInvoker.java:73)</span><br><span class="line">	at org.springframework.cache.interceptor.CacheAspectSupport.findInCaches(CacheAspectSupport.java:554)</span><br><span class="line">	at org.springframework.cache.interceptor.CacheAspectSupport.findCachedItem(CacheAspectSupport.java:519)</span><br><span class="line">	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:401)</span><br><span class="line">	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:345)</span><br><span class="line">	at org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:61)</span><br><span class="line">	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)</span><br><span class="line">	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)</span><br><span class="line">	at com.zunchen.video.dmp.service.impl.onvif.OnvifDeviceCacheServiceImpl$EnhancerBySpringCGLIB$913f47a3.connectOnvifDevice(&lt;generated&gt;)</span><br><span class="line">	at com.zunchen.video.dmp.admin.api.ConnectDeviceApiController.connect(ConnectDeviceApiController.java:36)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">	at java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class="line">	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:215)</span><br><span class="line">	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:142)</span><br><span class="line">	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)</span><br><span class="line">	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)</span><br><span class="line">	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)</span><br><span class="line">	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)</span><br><span class="line">	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)</span><br><span class="line">	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)</span><br><span class="line">	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:998)</span><br><span class="line">	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:890)</span><br><span class="line">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:634)</span><br><span class="line">	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:875)</span><br><span class="line">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at org.springframework.boot.actuate.web.trace.servlet.HttpTraceFilter.doFilterInternal(HttpTraceFilter.java:90)</span><br><span class="line">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:154)</span><br><span class="line">	at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:122)</span><br><span class="line">	at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.doFilterInternal(WebMvcMetricsFilter.java:107)</span><br><span class="line">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)</span><br><span class="line">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)</span><br><span class="line">	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)</span><br><span class="line">	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)</span><br><span class="line">	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)</span><br><span class="line">	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)</span><br><span class="line">	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)</span><br><span class="line">	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)</span><br><span class="line">	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)</span><br><span class="line">	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)</span><br><span class="line">	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:770)</span><br><span class="line">	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1415)</span><br><span class="line">	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class="line">	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:748)</span><br><span class="line">Caused by: io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.</span><br><span class="line">	at io.lettuce.core.ExceptionFactory.createExecutionException(ExceptionFactory.java:135)</span><br><span class="line">	at io.lettuce.core.LettuceFutures.awaitOrCancel(LettuceFutures.java:122)</span><br><span class="line">	at io.lettuce.core.AbstractRedisAsyncCommands.select(AbstractRedisAsyncCommands.java:1194)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">	at java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class="line">	at io.lettuce.core.FutureSyncInvocationHandler.handleInvocation(FutureSyncInvocationHandler.java:57)</span><br><span class="line">	at io.lettuce.core.internal.AbstractInvocationHandler.invoke(AbstractInvocationHandler.java:80)</span><br><span class="line">	at com.sun.proxy.$Proxy206.select(Unknown Source)</span><br><span class="line">	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getNativeConnection(LettuceConnectionFactory.java:1087)</span><br><span class="line">	... 69 common frames omitted</span><br></pre></td></tr></table></figure>

<h2 id="查询资料"><a href="#查询资料" class="headerlink" title="查询资料"></a>查询资料</h2><ul>
<li><a href="https://bbs.csdn.net/topics/392009425" target="_blank" rel="noopener">spring boot 配置redis 报错 NOAUTH Authentication required</a></li>
<li><a href="https://www.twblogs.net/a/5b7e13012b717768385523f9/zh-cn" target="_blank" rel="noopener">springboot整合redis报错NOAUTH Authentication required.解决方案</a></li>
</ul>
<h3 id="归纳"><a href="#归纳" class="headerlink" title="归纳"></a>归纳</h3><p>  大多解决方案都是通过配置注入的RedisConfig来setPassword解决的，SpringBoot未注入密码的原因仍然不明。</p>
<h2 id="原因探究"><a href="#原因探究" class="headerlink" title="原因探究"></a>原因探究</h2><h3 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h3><p>  由报错信息可以看出，最终抛出的异常是io.lettuce.core.RedisCommandExecutionException，其中lettuce不知道是什么。</p>
<p>  通过查阅资料 <a href="https://toutiao.io/posts/pknpcs/preview" target="_blank" rel="noopener">高级的 Redis Java 客户端 Lettuce</a> 得知lettuce是springboot2.0中用来代替jedis的新的redis客户端。</p>
<p>  那为何lettuce为何会报错呢？这是我最大的疑惑，我决定去spring.redis的自动配置类中看看到底发生了什么</p>
<h3 id="源码跟踪"><a href="#源码跟踪" class="headerlink" title="源码跟踪"></a>源码跟踪</h3><p>&gt; spring.redis的自动配置包：org.springframework.boot.autoconfigure.data.redis</p>
<p><img src="leanote://file/getImage?fileId=5d847766e1488a763c000011" alt=""></p>
<p>看着这个目录结构，第一反应直奔LettuceConnectionConfiguration中去看源码。</p>
<p><img src="leanote://file/getImage?fileId=5d84778be1488a763c000012" alt=""></p>
<p>在其构造方法处打断点发现是拿到了密码的，发现同类下有一方法createLettuceConnectionFactory();明显是创建连接工厂的方法，断点套上去。</p>
<p><img src="leanote://file/getImage?fileId=5d8477a7e1488a763c000013" alt=""></p>
<p>这个方法中干了啥，它看了看配置文件中有没有包含${spring.redis.sentinel}和${spring.redis.cluster}的配置，如果有就拿对应的配置去创建连接工厂。但是yml中既没有配置哨兵模式也没有配置集群模式，所以进入独立模式getStandaloneConfig();</p>
<p><img src="leanote://file/getImage?fileId=5d8478d0e1488a763c000014" alt=""></p>
<p>顺手计算一下，看看standaloneConfig长什么样子…..嗯???!!!……密码呢？……发生了啥？</p>
<p><img src="leanote://file/getImage?fileId=5d8478e8e1488a763c000015" alt=""></p>
<p>问题找到了，感觉自己好蠢。</p>
<h2 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h2><h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="comment"># REDIS_URL 中自己带上密码</span></span><br><span class="line">    <span class="comment"># Connection URL. Overrides host, port, and password. User is ignored. Example:</span></span><br><span class="line">    <span class="comment"># redis://user:password@example.com:6379</span></span><br><span class="line">    <span class="comment"># url: redis://UserIsIgnored:testpassword123@192.168.1.233:6379</span></span><br><span class="line">    <span class="comment"># HOST 和 PASSWORD 是一套配置</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.233</span></span><br><span class="line">    <span class="comment"># 如果有密码 （用于RedisTemplate ，Lettuce不会拿这个password）</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">testpassword123</span></span><br><span class="line">    <span class="comment"># 存储到分区1</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">1</span></span><br><span class="line">    <span class="comment"># 默认超时2000</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure>

<p>修改后启动：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">[20190828 03:15:04] ERROR 8564 --- [nio-8086-exec-2] c.z.v.d.a.c.mvc.GlobalExceptionHandler   : Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.</span><br><span class="line"></span><br><span class="line">org.springframework.data.redis.RedisConnectionFailureException: Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.</span><br><span class="line">	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getNativeConnection(LettuceConnectionFactory.java:1092)</span><br><span class="line">	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getConnection(LettuceConnectionFactory.java:1065)</span><br><span class="line">	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getSharedConnection(LettuceConnectionFactory.java:865)</span><br><span class="line">	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getConnection(LettuceConnectionFactory.java:340)</span><br><span class="line">	at org.springframework.data.redis.cache.DefaultRedisCacheWriter.execute(DefaultRedisCacheWriter.java:238)</span><br><span class="line">	at org.springframework.data.redis.cache.DefaultRedisCacheWriter.get(DefaultRedisCacheWriter.java:109)</span><br><span class="line">	at org.springframework.data.redis.cache.RedisCache.lookup(RedisCache.java:82)</span><br><span class="line">	at org.springframework.cache.support.AbstractValueAdaptingCache.get(AbstractValueAdaptingCache.java:58)</span><br><span class="line">	at org.springframework.cache.interceptor.AbstractCacheInvoker.doGet(AbstractCacheInvoker.java:73)</span><br><span class="line">	at org.springframework.cache.interceptor.CacheAspectSupport.findInCaches(CacheAspectSupport.java:554)</span><br><span class="line">	at org.springframework.cache.interceptor.CacheAspectSupport.findCachedItem(CacheAspectSupport.java:519)</span><br><span class="line">	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:401)</span><br><span class="line">	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:345)</span><br><span class="line">	at org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:61)</span><br><span class="line">	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)</span><br><span class="line">	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)</span><br><span class="line">	at com.zunchen.video.dmp.service.impl.onvif.OnvifDeviceCacheServiceImpl$EnhancerBySpringCGLIB$b001f767.connectOnvifDevice(&lt;generated&gt;)</span><br><span class="line">	at com.zunchen.video.dmp.admin.api.ConnectDeviceApiController.connect(ConnectDeviceApiController.java:36)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">	at java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class="line">	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:215)</span><br><span class="line">	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:142)</span><br><span class="line">	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)</span><br><span class="line">	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)</span><br><span class="line">	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)</span><br><span class="line">	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)</span><br><span class="line">	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)</span><br><span class="line">	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)</span><br><span class="line">	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:998)</span><br><span class="line">	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:890)</span><br><span class="line">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:634)</span><br><span class="line">	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:875)</span><br><span class="line">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at org.springframework.boot.actuate.web.trace.servlet.HttpTraceFilter.doFilterInternal(HttpTraceFilter.java:90)</span><br><span class="line">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:154)</span><br><span class="line">	at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:122)</span><br><span class="line">	at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.doFilterInternal(WebMvcMetricsFilter.java:107)</span><br><span class="line">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)</span><br><span class="line">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)</span><br><span class="line">	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)</span><br><span class="line">	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)</span><br><span class="line">	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)</span><br><span class="line">	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)</span><br><span class="line">	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)</span><br><span class="line">	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)</span><br><span class="line">	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)</span><br><span class="line">	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)</span><br><span class="line">	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:770)</span><br><span class="line">	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1415)</span><br><span class="line">	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class="line">	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:748)</span><br></pre></td></tr></table></figure>

<p>仍然在报错，这下尴尬了。</p>
<h3 id="再次解决问题"><a href="#再次解决问题" class="headerlink" title="再次解决问题"></a>再次解决问题</h3><p><img src="leanote://file/getImage?fileId=5d847965e1488a763c000016" alt=""></p>
<p>径直来到报错信息提示的地方，估计是红框出出现了异常。此处调用的是接口方法，不知道进了那个方法，没关系，打个断点强制步入。</p>
<p><img src="leanote://file/getImage?fileId=5d847984e1488a763c000017" alt=""></p>
<p>有点懒，不想解释了，直接画图，发现是redisURISupplier中的password仍然是空的。不想知道为什么了，我只想解决问题。源码点过去看下。</p>
<p><img src="leanote://file/getImage?fileId=5d847996e1488a763c000018" alt=""></p>
<p> 查看该类的构造方法，这个东西正在解析RedisURI，那RedisURI哪儿来的呢？配置里配的呗。
 </p>
<h2 id="成功解决问题"><a href="#成功解决问题" class="headerlink" title="成功解决问题"></a>成功解决问题</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="comment"># REDIS_URL 中自己带上密码</span></span><br><span class="line">    <span class="comment"># Connection URL. Overrides host, port, and password. User is ignored. Example:</span></span><br><span class="line">    <span class="comment"># redis://user:password@example.com:6379</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">redis://UserIsIgnored:testpassword123@192.168.1.233:6379</span></span><br><span class="line">    <span class="comment"># HOST 和 PASSWORD 是一套配置</span></span><br><span class="line">    <span class="comment"># host: 192.168.1.233</span></span><br><span class="line">    <span class="comment"># 如果有密码 （用于RedisTemplate ，Lettuce不会拿这个password）</span></span><br><span class="line">    <span class="comment"># password: testpassword123</span></span><br><span class="line">    <span class="comment"># 存储到分区1</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">1</span></span><br><span class="line">    <span class="comment"># 默认超时2000</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure>

<p>这次好了，redis成功连接。大功告成。</p>

            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2020/01/06/%E6%B3%9B%E5%9E%8B%E4%B8%8A%E4%B8%8B%E7%95%8C/">
            <div class="nexmoe-post-cover mdui-ripple"> 
                
                    <img src="https://i.loli.net/2019/01/13/5c3aec85a4343.jpg" alt="泛型上下界">
                
                <h1>泛型上下界</h1>
            </div>
        </a>
        <div class="nexmoe-post-meta">
            <a><i class="nexmoefont icon-calendar-fill"></i>2020年01月06日</a>
            <a><i class="nexmoefont icon-areachart"></i>343 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
            
            
        </div>
        <article>
            
            <h3 id="super-类型下界通配符"><a href="#super-类型下界通配符" class="headerlink" title="super 类型下界通配符"></a>super 类型下界通配符</h3><ul>
<li><p>List中只能存储一种元素，此处声明的<code>&lt;!--? super BaseDemoEntity--&gt;</code>,表明这个List中存放的元素属于 BaseDemoEntity <strong>其中一种</strong> 父类类型</p>
</li>
<li><p>BaseDemoEntity的父类可能有复数个，比如 Object，BaseEntity。取出时不知道到底List里到底装的啥，但一定是继承于Object，所以统一强转为Object类型</p>
</li>
<li><p>存入时只能放入 BaseDemoEntity 和它的子类，因为声明的<code>&lt;!--? super BaseDemoEntity--&gt;</code>，BaseDemoEntity 可以被安全的强转为<code>&lt;!--? super BaseDemoEntity--&gt;</code>此处如果传入BaseDemoEntity的父类，那么运行时jvm将传入的类型转为<code>&lt;!--? super BaseDemoEntity--&gt;</code>时可能会因为类型不一致报错</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/superBaseDemoEntity"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">superBaseDemoEntity</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    List&lt;!--? <span class="keyword">super</span> BaseDemoEntity--&gt; appList = <span class="keyword">new</span> ArrayList&amp;lt;&amp;gt;();</span><br><span class="line">    appList.add(<span class="keyword">new</span> Music());</span><br><span class="line">    appList.add(<span class="keyword">new</span> BaseDemoEntity());</span><br><span class="line">    Object object1 = appList.get(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="extends-类型上界通配符"><a href="#extends-类型上界通配符" class="headerlink" title="extends 类型上界通配符"></a>extends 类型上界通配符</h3><ul>
<li><p><code>&lt;!--? extends BaseDemoEntity--&gt;</code> =&gt; BaseDemoEntity的任意一种子类</p>
</li>
<li><p>List中只能存储一种元素，此处声明的<code>&lt;!--? extends BaseDemoEntity--&gt;</code>表明这个List中存放的元素可能是继承与 BaseDemoEntity 的 <strong>其中一种</strong> 元素</p>
</li>
<li><p>取出时可以被安全的强转为 BaseDemoEntity</p>
</li>
<li><p>存入时由于不知道你存入的类型是否跟<code>&lt;!--? extends BaseDemoEntity--&gt;</code>类型是一个类型，因此不能存入</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@RequestMapping</span>(<span class="string">"/extendsBaseDemoEntity"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">extendsBaseDemoEntity</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    List&lt;!--? extends BaseDemoEntity--&gt; appList2 = <span class="keyword">new</span> ArrayList&amp;lt;&amp;gt;();</span><br><span class="line">    BaseDemoEntity baseDemoEntity = appList2.get(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2020/01/06/%E5%A5%BD%E7%94%A8%E5%B8%B8%E7%94%A8%E4%BA%BA%E4%BA%BA%E9%83%BD%E8%A6%81%E4%BC%9A%E7%9A%84%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84Maven%E6%8F%92%E4%BB%B6%E6%94%B6%E9%9B%86/">
            <div class="nexmoe-post-cover mdui-ripple"> 
                
                    <img src="https://i.loli.net/2019/01/13/5c3aec85a4343.jpg" alt="好用常用人人都要会的最基本的Maven插件收集">
                
                <h1>好用常用人人都要会的最基本的Maven插件收集</h1>
            </div>
        </a>
        <div class="nexmoe-post-meta">
            <a><i class="nexmoefont icon-calendar-fill"></i>2020年01月06日</a>
            <a><i class="nexmoefont icon-areachart"></i>1.3k 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 6 分钟</a>
            
            
        </div>
        <article>
            
            <h1 id="好用常用人人都要会的最基本的Maven插件收集"><a href="#好用常用人人都要会的最基本的Maven插件收集" class="headerlink" title="好用常用人人都要会的最基本的Maven插件收集"></a>好用常用人人都要会的最基本的Maven插件收集</h1><p>大部分的插件其实都可以从<a href="https://maven.apache.org/plugins/index.html" target="_blank" rel="noopener">MAVEN官方的可用插件列表</a>中直接找到<br>在这里取了比较常用并且实用的几个插件做一点说明<br>大多数使用场景无非是：</p>
<ul>
<li>要自定义打包的名称</li>
<li>要将打包后的jar包自动复制到某处</li>
<li>要将外置lib目录和maven依赖一起打进去</li>
<li>要根据环境复制对应的配置文件</li>
</ul>
<p>这里选出的插件足以应对大部分情况了 </p>
<h2 id="Maven依赖管理插件maven-dependency-plugin"><a href="#Maven依赖管理插件maven-dependency-plugin" class="headerlink" title="Maven依赖管理插件maven-dependency-plugin"></a>Maven依赖管理插件<a href="https://maven.apache.org/plugins/maven-dependency-plugin" target="_blank" rel="noopener">maven-dependency-plugin</a></h2><p>主要用于管理依赖，比如引入某个特殊的jar包，或者从某个jar包中提取文件<br><code>tree</code>命令和<code>display-ancestors</code>命令在搭建工程时是比较好用的，可以很方便的找出重复依赖项，保证依赖版本一致</p>
<h3 id="常用功能"><a href="#常用功能" class="headerlink" title="常用功能"></a>常用功能</h3><ul>
<li>list 列出的依赖关系</li>
<li>tree 以树型结构列出的依赖关系</li>
<li>copy-dependencies 拷贝某个依赖项</li>
<li>unpack-dependencies 解包某个依赖项</li>
<li>display-ancestors 显示所有父依赖</li>
</ul>
<h2 id="Maven构建小助手-build-helper-maven-plugin"><a href="#Maven构建小助手-build-helper-maven-plugin" class="headerlink" title="Maven构建小助手 build-helper-maven-plugin"></a>Maven构建小助手 <a href="https://www.mojohaus.org/build-helper-maven-plugin/" target="_blank" rel="noopener">build-helper-maven-plugin</a></h2><p>主要用于为POM生成各种属性,比如打包时间、IP地址之类的，功能比较多就不上代码了。</p>
<h3 id="常用功能-1"><a href="#常用功能-1" class="headerlink" title="常用功能"></a>常用功能</h3><ul>
<li>add-source 将更多<code>source</code>目录添加到POM</li>
<li>add-test-source 将更多<code>test source</code>目录添加到POM</li>
<li>add-resource 将更多<code>resource directories</code>目录添加到POM</li>
<li>add-test-resource 将更多<code>test resource directories</code>目录添加到POM</li>
<li>attach-artifact Attach additional artifacts to be installed and deployed.  不知道???干啥的</li>
<li>maven-version 获取Maven核心版本</li>
<li>regex-property 使用正则生成某个属性</li>
<li>regex-properties使用正则生成属性</li>
<li>released-version Resolve the latest released version of this project.</li>
<li>parse-version Parse the version into different properties.</li>
<li>remove-project-artifact 用于在构建过程中删除某个作为依赖的项目以节省空间</li>
<li>reserve-network-port 保留一个未使用的端口号的随机列表</li>
<li>local-ip 获取当前主机IP</li>
<li>cpu-count 获取当前主机CPU核心数</li>
<li>timestamp-property 生成一个事件放入指定属性中 常用于在包名上附加打包时间</li>
<li>uptodate-property 检查某个属性根据检查结果设置其他属性</li>
<li>uptodate-properties 检查多个属性根据检查结果设置多个其他属性</li>
<li>rootlocation 重定义多模块构建的根目录</li>
</ul>
<h2 id="复制并重命名插件-Copy-Rename-Maven-Plugin"><a href="#复制并重命名插件-Copy-Rename-Maven-Plugin" class="headerlink" title="复制并重命名插件 Copy Rename Maven Plugin"></a>复制并重命名插件 <a href="https://coderplus.github.io/copy-rename-maven-plugin/" target="_blank" rel="noopener">Copy Rename Maven Plugin</a></h2><p>功能字如其名,就是用来复制和重命名的，可以用来复制打包好的jar包，也可以在打包过程中复制文件。</p>
<h3 id="常用功能-2"><a href="#常用功能-2" class="headerlink" title="常用功能"></a>常用功能</h3><ul>
<li>copy 复制</li>
<li>rename 重命名</li>
<li>没了</li>
</ul>
<h3 id="一个小栗子"><a href="#一个小栗子" class="headerlink" title="一个小栗子"></a>一个小栗子</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupid</span>&gt;</span>com.coderplus.maven.plugins<span class="tag">&lt;/<span class="name">groupid</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactid</span>&gt;</span>copy-rename-maven-plugin<span class="tag">&lt;/<span class="name">artifactid</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-file<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">sourcefile</span>&gt;</span>target/$&#123;project.build.finalName&#125;.jar<span class="tag">&lt;/<span class="name">sourcefile</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">destinationfile</span>&gt;</span>/xingyi/$&#123;project.build.finalName&#125;.jar<span class="tag">&lt;/<span class="name">destinationfile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="Maven编译插件-maven-compiler-plugin"><a href="#Maven编译插件-maven-compiler-plugin" class="headerlink" title="Maven编译插件 maven-compiler-plugin"></a>Maven编译插件 <a href="https://maven.apache.org/plugins/maven-compiler-plugin/" target="_blank" rel="noopener">maven-compiler-plugin</a></h2><p>主要用于设定编译环境和编译器的属性,是比较基础的插件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupid</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupid</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactid</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactid</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 一般而言，target与source是保持一致的，但是，有时候为了让程序能在其他版本的jdk中运行(对于低版本目标jdk，源代码中不能使用低版本jdk中不支持的语法 )，会存在target不同于source的情况 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 源代码使用的JDK版本 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8 </span><br><span class="line">        <span class="comment">&lt;!-- 需要生成的目标class文件的编译版本 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span> </span><br><span class="line">        <span class="comment">&lt;!-- 字符集编码 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">verbose</span>&gt;</span>true<span class="tag">&lt;/<span class="name">verbose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">showwarnings</span>&gt;</span>true<span class="tag">&lt;/<span class="name">showwarnings</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 要使compilerVersion标签生效，还需要将fork设为true，用于明确表示编译版本配置的可用 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">fork</span>&gt;</span>true<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定插件将使用的编译器的版本 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">compilerversion</span>&gt;</span>1.5<span class="tag">&lt;/<span class="name">compilerversion</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 编译器使用的初始内存 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meminitial</span>&gt;</span>128m<span class="tag">&lt;/<span class="name">meminitial</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 编译器使用的最大内存 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maxmem</span>&gt;</span>512m<span class="tag">&lt;/<span class="name">maxmem</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--使用指定的javac命令，例如：&lt;executable&gt;$&#123;JAVA_1_4_HOME&#125;/bin/javac&lt;/executable&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executable</span>&gt;</span><span class="comment">&lt;!-- path-to-javac --&gt;</span><span class="tag">&lt;/<span class="name">executable</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 跳过测试 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">skiptests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skiptests</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 这个选项用来传递编译器自身不包含但是却支持的参数选项--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">compilerargument</span>&gt;</span>-verbose -bootclasspath $&#123;java.home&#125;\lib\rt.jar<span class="tag">&lt;/<span class="name">compilerargument</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="SpringBootMaven插件spring-boot-maven-plugin"><a href="#SpringBootMaven插件spring-boot-maven-plugin" class="headerlink" title="SpringBootMaven插件spring-boot-maven-plugin"></a>SpringBootMaven插件<a href="https://www.mojohaus.org/build-helper-maven-plugin/" target="_blank" rel="noopener">spring-boot-maven-plugin</a></h3><h4 id="configuration-layout-ZIP-的用处"><a href="#configuration-layout-ZIP-的用处" class="headerlink" title="configuration.layout=ZIP 的用处"></a>configuration.layout=ZIP 的用处</h4><h6 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h6><ul>
<li><a href=""http://weyprecht.de/2018/05/02/how-to-really-package-and-deploy-a-spring-boot-application/"">How to really package and deploy a Spring Boot application</a></li>
</ul>
<h6 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h6><p>将该工程的布局改为ZIP布局，所有的lib将外置到jar包外，在打包时将com.example:demo下的所有依赖放入外置的lib目录</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupid</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupid</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactid</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactid</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span>&gt;</span>ZIP<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span>&gt;</span></span><br><span class="line">       		<span class="tag">&lt;<span class="name">groupid</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupid</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">artifactid</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">artifactid</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2020/01/06/java8%E5%87%BD%E6%95%B0%E8%AE%BE%E8%AE%A1%5B1%5D-%E5%9C%A8filter%E4%B8%AD%E6%A0%B9%E6%8D%AEKey%E5%8E%BB%E9%87%8D%E7%9A%84%E5%87%BD%E6%95%B0/">
            <div class="nexmoe-post-cover mdui-ripple"> 
                
                    <img src="https://i.loli.net/2019/01/13/5c3aec85a4343.jpg" alt="java8函数设计[1]-在filter中根据Key去重的函数">
                
                <h1>java8函数设计[1]-在filter中根据Key去重的函数</h1>
            </div>
        </a>
        <div class="nexmoe-post-meta">
            <a><i class="nexmoefont icon-calendar-fill"></i>2020年01月06日</a>
            <a><i class="nexmoefont icon-areachart"></i>1.1k 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 5 分钟</a>
            
            
        </div>
        <article>
            
            <h1 id="java8函数设计"><a href="#java8函数设计" class="headerlink" title="java8函数设计"></a>java8函数设计</h1><h2 id="在filter中根据Key去重的函数-StreamUtil-distinctByKey"><a href="#在filter中根据Key去重的函数-StreamUtil-distinctByKey" class="headerlink" title="在filter中根据Key去重的函数 StreamUtil.distinctByKey()"></a>在filter中根据Key去重的函数 StreamUtil.distinctByKey()</h2><h3 id="具体使用方法"><a href="#具体使用方法" class="headerlink" title="具体使用方法"></a>具体使用方法</h3><ul>
<li>该函数用于在filter中根据传入参数的某一属性进行过滤，以保证在收集为map的情况下不会出现重复主键</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">List&lt;entry&lt;string, string=<span class="string">""</span>&gt;&amp;gt; simpleList = baseProjects.stream()</span><br><span class="line">                .filter(StreamUtil.distinctByKey(BaseProject::getTypeDic))</span><br><span class="line">                .map(StreamUtil.entry(BaseProject::getTypeDic, BaseProject::getTypeStr))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 接口设计</span><br><span class="line">```java</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;h3&gt;distinctByKey&lt;/h3&gt;</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;可用于在filter中根据属性过滤&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> function 接受一个 接受 类型A 返回 类型B 的函数式接口</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Predicate 返回一个 接受 类型A 返回 Boolean型 的函数式接口</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;t&gt; <span class="function">Predicate&lt;t&gt; <span class="title">distinctByKey</span><span class="params">(Function&lt;!--? <span class="keyword">super</span> T, ?--&gt; function)</span> </span>&#123;</span><br><span class="line">        Map filterMap = Maps.newConcurrentMap();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> t -&amp;gt; filterMap.putIfAbsent(function.apply(t), Boolean.TRUE) == <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h3><ol>
<li>观察Stream.filter()接口</li>
<li>对接Stream.filter()接口</li>
<li>实现去重功能</li>
<li>参数优化</li>
</ol>
<h3 id="开始编写"><a href="#开始编写" class="headerlink" title="开始编写"></a>开始编写</h3><h4 id="观察Stream-filter-接口-amp-amp-对接Stream-filter-接口"><a href="#观察Stream-filter-接口-amp-amp-对接Stream-filter-接口" class="headerlink" title="观察Stream.filter()接口 &amp;&amp; 对接Stream.filter()接口"></a>观察Stream.filter()接口 &amp;&amp; 对接Stream.filter()接口</h4><p> Stream.filter()接口:<code>Stream&lt;t&gt; filter(Predicate&lt;!--? super T--&gt; predicate)</code></p>
<p> 首先可以看到filter接口需要接收一个类型为<code>Predicate&lt;!--? super T--&gt;</code>的函数,这个函数接受一个参数返回一个boolean类型。</p>
<p>根据以上信息先写一个函数出来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;e&gt; <span class="function">Predicate&lt;e&gt; <span class="title">distinctByKey2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Predicate&lt;e&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">test</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这个函数虽然可以被filter正常接收，但是由于没有形参，因此无法传递参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       Lists.newArrayList()</span><br><span class="line">               .stream()</span><br><span class="line">               .filter(StreamUtil.distinctByKey2())</span><br><span class="line">               .collect(Collectors.toList());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>现在与预期的效果比对一下<br>| 对比  | 函数 |<br>| :– | - |<br>| 目前效果 | <code>.filter(StreamUtil.distinctByKey2())</code> |<br>| 预期的效果 | <code>.filter(StreamUtil.distinctByKey2(Xxxxx:getId))</code> |<br>有点不对？！这个函数虽然可以被filter正常接收，但是去无法传入参数。因此要给<code>distinctByKey2()</code>方法加上传入的参数。<br>通过观察预期效果，是需要传入的参数应该是一个函数的，这个函数接收一个<code>T类型</code>参数，返回一个<code>不知道什么类型</code>的参数。<br><code>Function&lt;t, r=&quot;&quot;&gt;</code>函数接收一个T类型，返回一个R类型，可以满足这个需求。<br>继续观察预期效果，这个<code>不知道什么类型的参数</code>实际上就是<code>distinctByKey2方法中new出来Predicate&lt;e&gt;#test(E e)</code>中的那个e，说人话就是<code>Function&lt;t,r&gt;</code>中的R在此处就是<code>Predicate&lt;e&gt;</code>中的E。<br>那么补上我们的形参</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;e,r&gt; <span class="function">Predicate&lt;e&gt; <span class="title">distinctByKey2</span><span class="params">(Function&lt;e,r&gt; function)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Predicate&lt;e&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">test</span><span class="params">(E t)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="实现去重功能"><a href="#实现去重功能" class="headerlink" title="实现去重功能"></a>实现去重功能</h4><p>现在与预期效果一致了，需要实现去重功能 去重功能可以用Set或者ConcurrentMap实现<br>使用ConcurrentMap存储function返回值的状态<br>根据<code>ConcurrentMap.putIfAbsent(xxx)</code>的特性 如果map中已经有同样的key和value就返回null，根据返回值是否为null来判断是否需要被过滤</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;e,r&gt; <span class="function">Predicate&lt;e&gt; <span class="title">distinctByKey2</span><span class="params">(Function&lt;e,r&gt; function)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     Map filterMap = Maps.newConcurrentMap();</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> Predicate&lt;e&gt;() &#123;</span><br><span class="line">         <span class="meta">@Override</span></span><br><span class="line">         <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">test</span><span class="params">(E t)</span> </span>&#123;</span><br><span class="line">             <span class="comment">// 调用方传入函数的结果</span></span><br><span class="line">             R apply = function.apply(t);</span><br><span class="line">             <span class="comment">// putIfAbsent 在首次关联K,V时返回null 非首次的时候不执行put()方法 直接返回之前的值</span></span><br><span class="line">             Boolean isNullIsDuplicate = filterMap.putIfAbsent(apply, Boolean.TRUE);</span><br><span class="line">             <span class="comment">// isNullIsDuplicate==null时 K就没重复 函数返回true</span></span><br><span class="line">             <span class="keyword">return</span> isNullIsDuplicate == <span class="keyword">null</span>;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>


<h4 id="参数优化"><a href="#参数优化" class="headerlink" title="参数优化"></a>参数优化</h4><p>把匿名内部类使用lambda替换掉，在把冗余代码inline，最后调整一下泛型参数</p>
<pre><code>在上面的例子中`Function&lt;e,r&gt;`中
R是调用者函数的返回值类型，仅仅被当做key使用，本身是什么类型不重要，因此可以直接去掉这个R泛型，由?代替
E是调用者函数的形参类型，函数调用方在函数中可能会显式声明参数类型`[注1]`，以达到强转形参类型的目的，因此将E修改为 &lt;!--? super E--&gt;</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;e&gt; <span class="function">Predicate&lt;e&gt; <span class="title">distinctByKey2</span><span class="params">(Function&lt;!--? <span class="keyword">super</span> E, ?--&gt; function)</span> </span>&#123;</span><br><span class="line">       Map filterMap = Maps.newConcurrentMap();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> e -&amp;gt; filterMap.putIfAbsent(function.apply(e), Boolean.TRUE) == <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line"><span class="comment">//[注1] </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       List collect = Lists.newArrayList()</span><br><span class="line">               .stream()</span><br><span class="line">               <span class="comment">// 显式强转形参类型</span></span><br><span class="line">               .filter(StreamUtil.distinctByKey2(baseEntity -&amp;gt; baseEntity))</span><br><span class="line">               .collect(Collectors.toList());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>











            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2020/01/06/%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E7%9A%84Spring%E5%AE%9E%E7%8E%B0%E4%B8%8E%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0/">
            <div class="nexmoe-post-cover mdui-ripple"> 
                
                    <img src="https://i.loli.net/2019/01/13/5c3aec85a4343.jpg" alt="计划任务的Spring实现与手动实现">
                
                <h1>计划任务的Spring实现与手动实现</h1>
            </div>
        </a>
        <div class="nexmoe-post-meta">
            <a><i class="nexmoefont icon-calendar-fill"></i>2020年01月06日</a>
            <a><i class="nexmoefont icon-areachart"></i>368 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
            
            
        </div>
        <article>
            
            <h2 id="使用Spring-Scheduled的计划任务"><a href="#使用Spring-Scheduled的计划任务" class="headerlink" title="使用Spring Scheduled的计划任务"></a>使用Spring Scheduled的计划任务</h2><h3 id="关键方法"><a href="#关键方法" class="headerlink" title="关键方法"></a>关键方法</h3><ul>
<li>计算下一次匹配CRON表达式的时间</li>
<li><code>new CronSequenceGenerator(&quot;1 1 0 1 * ?&quot;).next(new Date());</code></li>
<li>该方法用于计算下一次运行的到现在时间的时间差</li>
<li><code>org.springframework.scheduling.concurrent.ReschedulingRunnable#schedule();</code></li>
</ul>
<h3 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;h2&gt;ScheduleConfig&lt;/h2&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;定时任务配置&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Daizc</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/12/10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduleConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 每月第一天的0分0秒执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CRON_EXPRESSION = <span class="string">"0 0 0 1 * ?"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled</span>(cron = CRON_EXPRESSION, zone = <span class="string">"Asia/Shanghai"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">generateFormJob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> Date().toString() + <span class="string">" &amp;gt;&amp;gt;计划任务执行...."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="自己写的计划任务"><a href="#自己写的计划任务" class="headerlink" title="自己写的计划任务"></a>自己写的计划任务</h2><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><ul>
<li>使用一个阻塞队列</li>
<li>使用一个线程去消费队列</li>
<li>使用一个线程在计算<code>现在到下次执行时间的时间差</code>并睡到下次执行时间将Runable放入队列中消费</li>
</ul>
<h3 id="实现代码-1"><a href="#实现代码-1" class="headerlink" title="实现代码"></a>实现代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自己写的计划任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> LinkedBlockingQueue&lt;runnable&gt; queue = <span class="keyword">new</span> LinkedBlockingQueue&amp;lt;&amp;gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Runnable task = () -&amp;gt; &#123;</span><br><span class="line">    System.out.println(<span class="keyword">new</span> Date().toString() + <span class="string">" &amp;gt;&amp;gt;计划任务执行...."</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"all"</span>, <span class="string">"AlibabaAvoidManuallyCreateThread"</span>&#125;)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ScheduleConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Thread take = <span class="keyword">new</span> Thread(() -&amp;gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                Runnable runnable = runnable = queue.take();</span><br><span class="line">                runnable.run();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException ignored) &#123;&#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    take.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">    take.setName(<span class="string">"schedule-take"</span>);</span><br><span class="line"></span><br><span class="line">    Thread put = <span class="keyword">new</span> Thread(() -&amp;gt; &#123;</span><br><span class="line">        Runnable runnable = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="comment">// 计算下次执行时间</span></span><br><span class="line">                Date next = <span class="keyword">new</span> CronSequenceGenerator(CRON_EXPRESSION).next(<span class="keyword">new</span> Date());</span><br><span class="line">                Thread.sleep(next.getTime() - System.currentTimeMillis());</span><br><span class="line">                queue.put(task);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException ignored) &#123;&#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    put.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">    put.setName(<span class="string">"schedule-put"</span>);</span><br><span class="line"></span><br><span class="line">    take.start();</span><br><span class="line">    put.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

            
        </article>
    </div>
    
</section>

    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/js/mdui.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
 
    <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>


 
    <script src="https://cdn.jsdelivr.net/npm/smoothscroll-for-websites@1.4.9/SmoothScroll.min.js"></script>


<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.8/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="/js/app.js?v=1578289441331"></script>
<script src="https://cdn.jsdelivr.net/npm/lazysizes@5.1.0/lazysizes.min.js"></script>


    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/xtaodada/xtaodada.github.io@0.0.2/copy.js"></script>

  





    <!-- baidu Analytics -->
<script>
    var _hmt = _hmt || [];
    (function() {var hm = document.createElement('script');
    hm.src = 'https://hm.baidu.com/hm.js?2d58a3bbad91b9b1329b309e254176cc';
    var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

</body>

</html>
