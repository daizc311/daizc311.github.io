{"meta":{"version":1,"warehouse":"3.0.2"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":1,"renderable":0},{"_id":"themes/nexmoe/source/images/favicon.ico","path":"images/favicon.ico","modified":1,"renderable":1},{"_id":"themes/nexmoe/source/images/avatar.jpg","path":"images/avatar.jpg","modified":1,"renderable":1},{"_id":"themes/nexmoe/source/css/style.styl","path":"css/style.styl","modified":1,"renderable":1},{"_id":"themes/nexmoe/source/js/app.js","path":"js/app.js","modified":1,"renderable":1}],"Cache":[{"_id":"source/CNAME","hash":"c2792d6adbd155f57f761d8bf88b88ed4cca5497","modified":1596770913723},{"_id":"source/py.md","hash":"1e2836650c2f643b8e773f5b9052ec6ba00d9652","modified":1596770913780},{"_id":"source/about.md","hash":"665be22c4c49ee879f7fc21dc1d56ef8a0c934af","modified":1596770913780},{"_id":"themes/nexmoe/LICENSE","hash":"b314c7ebb7d599944981908b7f3ed33a30e78f3a","modified":1596770913805},{"_id":"themes/nexmoe/_config.yml","hash":"d7ef56f7ef7b80901988aecc193b0259417c80a3","modified":1596780787444},{"_id":"themes/nexmoe/CODE_OF_CONDUCT.md","hash":"71e211684f8840845f3d6491922e43778da8b829","modified":1596770913805},{"_id":"themes/nexmoe/README.md","hash":"37ba06b72b6424ee7f00f024e8bd3a1c144264e1","modified":1596770913805},{"_id":"themes/nexmoe/font.php","hash":"3e2674934094417aa94beac3ddca37e14a8a4e65","modified":1596770913826},{"_id":"themes/nexmoe/_config.example.yml","hash":"5c8d81525eeb96d22ef03533f84aaebcf8955f3e","modified":1596770913824},{"_id":"source/_posts/Death_Standing.md","hash":"937627a669877f8f709832983ec8c92b53ead192","modified":1596770913724},{"_id":"source/_posts/Hexo部署GitMent评论.md","hash":"97316cb4595e875f0b67452c937ffa4bfcdc907a","modified":1596770913739},{"_id":"source/_posts/JobDescription-20210916.md","hash":"4ffb11351bec177dd91daefe5c0a45738837e56f","modified":1631806826260},{"_id":"source/_posts/[Centos]yum仓库配置及常用操作.md","hash":"51d81eeaa76972fb69af731c83f7337e01fcc8bf","modified":1596770913740},{"_id":"source/_posts/[MXCHIP-1]开发板到手.md","hash":"91aff76e1202379234172424301a2289e55786a3","modified":1596770913740},{"_id":"source/_posts/SpringBoot中的redis密码问题.md","hash":"bcf6d633aff54c34dc60d4922b3f6ffe8683c06a","modified":1627441799991},{"_id":"source/_posts/[MXCHIP-2]真机调试.md","hash":"c71081842305d447cd8de68c045180331957f226","modified":1596770913755},{"_id":"source/_posts/[WSL2]子系统ubuntu安装jdk8.md","hash":"a43cbfd56c7b33f4dbb8c0d7881ab0e903fb5bf7","modified":1596770913776},{"_id":"source/_posts/[ESP8266]01_刷写测试AT固件.md","hash":"c04907e4645ae9222f89ce7abfbb5276270d6379","modified":1627441399615},{"_id":"source/_posts/[Zookeeper学习-第一章]zk环境搭建[单机+控制台].md","hash":"067fa1e2e27506d5248c8f46b0d5bbc33be0ffda","modified":1596770913776},{"_id":"source/_posts/PDF疑难杂症以及治疗方法总结.md","hash":"373e75d69ae498cee910505c5e0270de2a20e7cd","modified":1630577168928},{"_id":"source/_posts/[DEBUG日记]Swagger扫不到类-Jdk代理导致的反射类型故障.md","hash":"d1a2c0c2c334fdffcdc47195065b95667aaabbc5","modified":1631806437131},{"_id":"source/_posts/[Zookeeper学习-第二章]用作SpringCloud的注册中心.md","hash":"3c95d20f7fe3885aad4cd60a13f68eacda857c2d","modified":1596770913777},{"_id":"source/_posts/[ESP8266]02_Lua基础.md","hash":"da147bf1b08003c27c8444de55ef25a71732966e","modified":1627441399618},{"_id":"source/_posts/java8函数设计[1]-在filter中根据Key去重的函数.md","hash":"b621590b23406ebb76a11e425ff7a5bdf57e5bc3","modified":1596770913777},{"_id":"source/_posts/发码平台结构设计.md","hash":"965d330d3b9841bc2c72ffcf3c6306aaed90e09c","modified":1631936790751},{"_id":"source/_posts/好用常用人人都要会的最基本的Maven插件收集.md","hash":"ec595deffcccf8f6e76a6a4b6ce70809112d6c4a","modified":1596770913778},{"_id":"source/_posts/泛型上下界.md","hash":"da7a1fb9fd8d576131daa66db5edb35fe5b3daa6","modified":1596770913779},{"_id":"source/_posts/计划任务的Spring实现与手动实现.md","hash":"41e4dc17cf0065a756ecca77583003cadcf72096","modified":1596770913779},{"_id":"source/_posts/书单整理2021-08-30.md","hash":"f53783778c096d2d08fc1f2ca0b4435dfb9fe5b8","modified":1631806826256},{"_id":"source/_posts/改造Spring-data-redis.md","hash":"878394c5c7dcfcef388bea73b2a8469af4480934","modified":1596774172265},{"_id":"source/_posts/解决由https转发导致的SpringCloudGateway转发异常.md","hash":"c7ccc3618db4c898e04e9c8ed241378dd2eed9f1","modified":1627458834924},{"_id":"themes/nexmoe/WIKI/README.md","hash":"82ea9afaa0d1a61eefb4fd9a742a8f1f5f18a49d","modified":1596770913807},{"_id":"themes/nexmoe/WIKI/deploy.sh","hash":"695d79ccf8b459d63b48f583ff517f8bda56c0a2","modified":1596770913814},{"_id":"themes/nexmoe/WIKI/package.json","hash":"12e2e1fcf88928935445c6c65664b58f9b3865e2","modified":1596770913820},{"_id":"themes/nexmoe/font/QQ.svg","hash":"195665f0d13e71bbbea8ecbe2e46c0e4e67341fe","modified":1596770913827},{"_id":"themes/nexmoe/font/appstore-fill.svg","hash":"6ecc527b424afb79bca7d26191c53ebc08091454","modified":1596770913827},{"_id":"themes/nexmoe/font/areachart.svg","hash":"71e8bef524be4ba17ac9918d8598a606b2bb26c9","modified":1596770913827},{"_id":"themes/nexmoe/font/battlenet.svg","hash":"961c2592ed5ea31319bd476e481549d69e8d075d","modified":1596770913827},{"_id":"themes/nexmoe/README/english.md","hash":"44cb225c9abf00c41ffc229ff9407fe3643de351","modified":1596770913806},{"_id":"themes/nexmoe/font/calendar-fill.svg","hash":"05e5b979cf8d150731c0eab66a4394df9498f1d6","modified":1596770913828},{"_id":"themes/nexmoe/font/bilibili.svg","hash":"0f9d92835db855bf581b9858a8fc1e3380be8808","modified":1596770913828},{"_id":"themes/nexmoe/font/container.svg","hash":"851225195cff6589a5247cb383194057190dd842","modified":1596770913828},{"_id":"themes/nexmoe/font/dribbble.svg","hash":"0785c0b322c849b0b4736b88fc5d4fed7fbaf07d","modified":1596770913828},{"_id":"themes/nexmoe/font/ellipsis.svg","hash":"c4074867e95f14d55c3e44145ef6388f60684c5e","modified":1596770913828},{"_id":"themes/nexmoe/font/eye-fill.svg","hash":"158b8b01f5c43219b599799273a0f8d553e91723","modified":1596770913828},{"_id":"themes/nexmoe/font/github.svg","hash":"b10f18d0644d120624c25b8ad5a2bc1ef5cff3a0","modified":1596770913829},{"_id":"themes/nexmoe/font/home.svg","hash":"97ab890dc43804b584ce3bb407bdbbb32030391b","modified":1596770913829},{"_id":"themes/nexmoe/font/left.svg","hash":"3fa57b536daade473b90cd496a39962c90de12ab","modified":1596770913829},{"_id":"themes/nexmoe/font/info-circle.svg","hash":"016e0515fccbd158cd1094376910725f7325acd8","modified":1596770913829},{"_id":"themes/nexmoe/font/mail-fill.svg","hash":"88ef0ea02f5449d7d24ce3f957847219e5205fa0","modified":1596770913829},{"_id":"themes/nexmoe/font/menu.svg","hash":"93c34d0e2156caa8dca37007da3647a6af0fa352","modified":1596770913830},{"_id":"themes/nexmoe/font/steam.svg","hash":"cf35facf841e5be58ac7c35945ae4a576d460b7c","modified":1596770913830},{"_id":"themes/nexmoe/font/right.svg","hash":"640b5fad35d5b1b1052c2f44bb58b1db5446a296","modified":1596770913830},{"_id":"themes/nexmoe/font/tags-fill.svg","hash":"87f59d1b14a5160e726ec3edc6e06fbe953f40f4","modified":1596770913830},{"_id":"themes/nexmoe/font/tag-fill.svg","hash":"f4a7d7cb92e40295a6b4c37b8d06385cf024eb9d","modified":1596770913830},{"_id":"themes/nexmoe/font/telegram.svg","hash":"51d8f5b3fffb40696f5830608ce2abfcebf36e2c","modified":1596770913831},{"_id":"themes/nexmoe/font/time-circle-fill.svg","hash":"ecdacea2e496c505a7d07770e54c503420ef9290","modified":1596770913832},{"_id":"themes/nexmoe/font/unorderedlist.svg","hash":"46722843f0674341bffd8ad7f2da1deabde2ba82","modified":1596770913832},{"_id":"themes/nexmoe/font/twitter.svg","hash":"bfad6767a6cc6058f0e4798225dc8f5898a228ca","modified":1596770913832},{"_id":"themes/nexmoe/font/wechat-fill.svg","hash":"fdb6fa45343307af0d6ebb70a75688afbc4444b3","modified":1596770913832},{"_id":"themes/nexmoe/font/weibo.svg","hash":"277d4076a9d17b8762e66fe81cbf0ec9f99a59cd","modified":1596770913833},{"_id":"themes/nexmoe/font/youtube.svg","hash":"fe59b1fb78e5661feae8775bdafe855f28092f0c","modified":1596770913833},{"_id":"themes/nexmoe/font/zhihu.svg","hash":"78e11c8e8f9ba84ebb2043a8fdbc484b56db3a95","modified":1596770913833},{"_id":"themes/nexmoe/languages/default.yml","hash":"87a7e349b1b6783d843bb404701aa26f60fd6d3d","modified":1596770913833},{"_id":"themes/nexmoe/languages/zh-CN.yml","hash":"08782500dd6492ee6e4ab4b46b45b7739951e0a7","modified":1596770913834},{"_id":"themes/nexmoe/languages/en.yml","hash":"83430833744a430b49adec9298473ad2d32066e1","modified":1596770913833},{"_id":"themes/nexmoe/languages/zh-TW.yml","hash":"ce19cbbeb610e27645b3109414bf546c70629442","modified":1596770913834},{"_id":"themes/nexmoe/languages/zh-HK.yml","hash":"ce19cbbeb610e27645b3109414bf546c70629442","modified":1596770913834},{"_id":"themes/nexmoe/layout/archive.ejs","hash":"0aaa4ef8c51c7733ef5cc8712f4f4ee065bbc115","modified":1596770913841},{"_id":"themes/nexmoe/layout/index.ejs","hash":"1cb9ae0d0638f65973a4cbd31ab51fe890b0e461","modified":1596770913841},{"_id":"themes/nexmoe/layout/layout.ejs","hash":"3bd7c210c32c13cea7b51441d4d734db72e59fd4","modified":1596770913841},{"_id":"themes/nexmoe/layout/py.ejs","hash":"6f398d44fe5b3b9c4ce1542ea3d082a9cf17f3f6","modified":1596770913842},{"_id":"themes/nexmoe/layout/post.ejs","hash":"abb52fb6083c61eeadf69cfea36194507d751567","modified":1596770913842},{"_id":"themes/nexmoe/WIKI/.vuepress/enhanceApp.js","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1596770913806},{"_id":"source/_posts/[MXCHIP-1]开发板到手/3.jpg","hash":"7fd783087561c45e1386c9b372c5fc6e4189bdf5","modified":1596770913744},{"_id":"source/_posts/[MXCHIP-2]真机调试/UART接口定义.jpg","hash":"9d42c6f23baacd79490e0228e77774e26fc2159e","modified":1596770913770},{"_id":"source/_posts/java8函数设计[1]-在filter中根据Key去重的函数/title.jpg","hash":"0e0625cebf1e3efbc5f9249245de6e1c51e34319","modified":1596770913778},{"_id":"source/_posts/好用常用人人都要会的最基本的Maven插件收集/title.jpg","hash":"c68ea1970e094297ce0bdcee9577f3f2c423198f","modified":1596770913778},{"_id":"source/_posts/计划任务的Spring实现与手动实现/title.jpg","hash":"9a168cbe8d76732832d0601903d3f78a15036a23","modified":1596770913780},{"_id":"source/_posts/改造Spring-data-redis/MyRedisCacheManage.java","hash":"efb1f6f09d93812e003092fb431107a5ef150919","modified":1596772324001},{"_id":"source/_posts/改造Spring-data-redis/TTLRedisCache.java","hash":"a7899406c92991be67555064c1701e2545d39065","modified":1596772324001},{"_id":"themes/nexmoe/WIKI/.vuepress/config.js","hash":"f9cfed3718a036fe884d3841d567be0e937691df","modified":1596770913806},{"_id":"themes/nexmoe/WIKI/contribution/README.md","hash":"727c364d849d6210eb692c2f9615b65a9008928f","modified":1596770913808},{"_id":"themes/nexmoe/WIKI/contribution/catalog.md","hash":"618600f2eeb12aaac7c4acaf02f4165c44293f55","modified":1596770913808},{"_id":"themes/nexmoe/WIKI/en/README.md","hash":"1e13b8bdc8328ac5c149e44189bb5e989ecd97ab","modified":1596770913816},{"_id":"themes/nexmoe/WIKI/hexo/README.md","hash":"bdf07131377ca4d85bd363742c6da99bb807438b","modified":1596770913817},{"_id":"themes/nexmoe/WIKI/hexo/math.md","hash":"2c58ff9e49eacf79adb4ad18a679ab0436b12b14","modified":1596770913817},{"_id":"themes/nexmoe/WIKI/hexo/comment.md","hash":"a86c3dc190b08ac9cf9e2bfa90107e6087aab84c","modified":1596770913817},{"_id":"themes/nexmoe/WIKI/hexo/statistics.md","hash":"6cf6ae2060569d813573c00a060ef45cf153b635","modified":1596770913818},{"_id":"themes/nexmoe/WIKI/hexo/notice.md","hash":"b38e3e64f21dad7fa6ffef75e1a4711ef2679b8a","modified":1596770913817},{"_id":"themes/nexmoe/WIKI/hexo/use.md","hash":"b26dbeff0f9eba56d74c2a3ea21373f4c8f22e13","modified":1596770913818},{"_id":"themes/nexmoe/layout/_partial/after-footer.ejs","hash":"3d5e8b821b52d78382a9a8224c1559269dfbd28f","modified":1596770913838},{"_id":"themes/nexmoe/layout/_partial/copyright.ejs","hash":"3df97e05990b73c8d3a73959e2eb3e38da77386e","modified":1596770913839},{"_id":"themes/nexmoe/layout/_partial/analytics.ejs","hash":"e53883f2bb9921cb08437f433d5d4d5cf52ab297","modified":1596770913838},{"_id":"themes/nexmoe/layout/_partial/comment.ejs","hash":"6e48ae4a79ad9e14d00244c15cd6e9ad04b99eb4","modified":1596770913838},{"_id":"themes/nexmoe/layout/_partial/paginator.ejs","hash":"20caf7c8ab390cfd125a12cbc71e51f868899050","modified":1596770913839},{"_id":"themes/nexmoe/layout/_partial/header.ejs","hash":"7d9fd0587d667400295e506ba564609ee178bc38","modified":1596770913839},{"_id":"themes/nexmoe/layout/_partial/sidebar.ejs","hash":"58c53d620cc0695b68c1e18a9f0d97fc888357cc","modified":1596770913839},{"_id":"themes/nexmoe/layout/_partial/site-verification.ejs","hash":"600319729da09e366c05e104fe68a821b087c027","modified":1596770913839},{"_id":"themes/nexmoe/layout/_widget/archive.ejs","hash":"eb9890c7bf2441722af87a9593b82708bdef62db","modified":1596770913840},{"_id":"themes/nexmoe/layout/_widget/category.ejs","hash":"99113b9f2cb4ffefdda3e3a343647ac6a5083091","modified":1596770913840},{"_id":"themes/nexmoe/layout/_widget/search.ejs","hash":"2161a08a12c11ee5bae7655ae7f83c5e2d239d05","modified":1596770913840},{"_id":"themes/nexmoe/layout/_widget/recent_posts.ejs","hash":"7d9eaf8228eda803aa4956e55432f78e056d6a01","modified":1596770913840},{"_id":"themes/nexmoe/layout/_widget/social.ejs","hash":"3ad3fc3cb32cd24adf00e959e4afd26aa55c8522","modified":1596770913840},{"_id":"themes/nexmoe/layout/_widget/tag.ejs","hash":"be2cbf60fe1be5591a53312a36558723816d605b","modified":1596770913841},{"_id":"themes/nexmoe/layout/_widget/tagcloud.ejs","hash":"a7a83acd837276573eacb10e41028e19c355c179","modified":1596770913841},{"_id":"themes/nexmoe/scripts/helper/css_auto_version.js","hash":"1df4e02d36ae52e64f4f4e709e488d6e413d9d0c","modified":1596770913842},{"_id":"themes/nexmoe/scripts/helper/js_auto_version.js","hash":"912dfbe49c51614ef886c967349d3cb054de6f2d","modified":1596770913843},{"_id":"themes/nexmoe/scripts/helper/image_auto_lazyload.js","hash":"7ccb73f9076d3b4e7ee27d10ed13a58ded631461","modified":1596770913843},{"_id":"themes/nexmoe/source/images/favicon.ico","hash":"57716efbf81cb86f1b1066cb6143ce64da694a37","modified":1596770913844},{"_id":"themes/nexmoe/source/images/avatar.jpg","hash":"23370f0f0182b061c23bd8dd0c481875ecbeaabe","modified":1596770913844},{"_id":"themes/nexmoe/source/css/style.styl","hash":"5500eb65f1f18b20f75dc29cfd9b5eb74ece0a0c","modified":1596770913844},{"_id":"themes/nexmoe/source/js/app.js","hash":"26456eca2d325f11ef2c1e7d92d3eefa83f19efa","modified":1596770913845},{"_id":"source/_posts/Death_Standing/IMG_20200319_004053.jpg","hash":"fca29bda4a92bbbcc8494724b10200df836fc842","modified":1596770913725},{"_id":"source/_posts/[MXCHIP-1]开发板到手/4_s.jpg","hash":"19a2c2ba97b36546ab58b3d7a6548ccadfa98044","modified":1596770913746},{"_id":"source/_posts/[DEBUG日记]Swagger扫不到类-Jdk代理导致的反射类型故障/RequestHandlerSelectors#1.png","hash":"bc6170edba18ca6ff13199062405306cae0eb37f","modified":1630641678688},{"_id":"source/_posts/[MXCHIP-1]开发板到手/6.jpg","hash":"dc4adaffa856c9dda6c724a9a0178433b8d7a807","modified":1596770913751},{"_id":"source/_posts/[MXCHIP-1]开发板到手/title_s.jpg","hash":"72be643223f38ae968bb8acdb50a2a9bda802447","modified":1596770913755},{"_id":"source/_posts/[MXCHIP-2]真机调试/SWD接口定义.jpg","hash":"21911f80d7e93f6ce8fabdea7a9c9150272ae167","modified":1596770913769},{"_id":"source/_posts/[DEBUG日记]Swagger扫不到类-Jdk代理导致的反射类型故障/RequestHandlerSelectors#2.png","hash":"be3dc5f1df3c652e5afeb198e959d302d57bd4e9","modified":1630644233308},{"_id":"source/_images/test1.jpg","hash":"60164884ef39f9ef49aa42b1d4d14c0e827c75d5","modified":1619425014490},{"_id":"source/_images/test2.jpg","hash":"73636a54284e0dc5522f8a8e1260831923449536","modified":1625446685593},{"_id":"source/_posts/[DEBUG日记]Swagger扫不到类-Jdk代理导致的反射类型故障/RequestHandlerSelectors#3.png","hash":"3a5ab228e455a017cd9e588e4d7b2983efa4eff8","modified":1630646476021},{"_id":"source/_posts/[ESP8266]01_刷写测试AT固件/title_s.jpg","hash":"5c74617cc6919a04c334bfbb5e87de4d68511cd2","modified":1627441399618},{"_id":"source/_images/发码平台结构设计/发码平台交互图.vsdx","hash":"3baa70a500ad47733a78287f1178b62d86ac08e0","modified":1631934105489},{"_id":"source/_posts/[ESP8266]02_Lua基础/title_s.jpg","hash":"db2274b18306eecd8f96cac9993d3dd259cf9871","modified":1627441399619},{"_id":"source/_posts/发码平台结构设计/发码平台交互图.vsdx","hash":"3baa70a500ad47733a78287f1178b62d86ac08e0","modified":1631934105489},{"_id":"source/_posts/Death_Standing/psc.jpg","hash":"cf6cfde12fcf1bb5d454266b2c1ccd68ebf040b8","modified":1596770913726},{"_id":"source/_posts/[MXCHIP-1]开发板到手/1_s.jpg","hash":"602f4eeb817eeee7b831cc77de9afded105547f9","modified":1596770913743},{"_id":"source/_posts/[MXCHIP-1]开发板到手/5_s.jpg","hash":"435b928be9dd4b97153e17864470c2f1ba83ee5c","modified":1596770913750},{"_id":"source/_posts/[MXCHIP-2]真机调试/SWD接口定义.png","hash":"3a5cfbbd0013a93c7a24e32ea7d2d53fefe8214e","modified":1596770913770},{"_id":"themes/nexmoe/WIKI/.vuepress/styles/palette.styl","hash":"678603df862e062eee3e229839ec0dab3e6b316c","modified":1596770913807},{"_id":"themes/nexmoe/WIKI/component/basic/color.md","hash":"210f6f5952b58b6001f784129681ff59f5cbc9f9","modified":1596770913807},{"_id":"themes/nexmoe/WIKI/en/Hexo/README.md","hash":"55e0dfdc52fa4cb133f8182cf29f5edd16dca34d","modified":1596770913815},{"_id":"themes/nexmoe/WIKI/component/basic/icon.md","hash":"ba90c85053ce4c7f8e35964810fd6bf173ae2adb","modified":1596770913807},{"_id":"themes/nexmoe/cover.png","hash":"56de9278ccf3bca1cae7eb7e15bad8aa593f1a55","modified":1596770913826},{"_id":"themes/nexmoe/WIKI/en/Hexo/comment.md","hash":"445034e0ec92af4c7184f7db65d6c3f7863b4775","modified":1596770913815},{"_id":"themes/nexmoe/layout/_partial/_analytics/baidu.ejs","hash":"cc782e1363c8bbb6277c3825bb9eac83762bc26d","modified":1596770913835},{"_id":"themes/nexmoe/layout/_partial/_analytics/cnzz.ejs","hash":"345ed559b76930bed05e1b393c12f09d42c2312e","modified":1596770913835},{"_id":"themes/nexmoe/layout/_partial/_analytics/google.ejs","hash":"97f3a717495c8cc71d5d3c7ab69ddd589a69a038","modified":1596770913835},{"_id":"themes/nexmoe/WIKI/en/Hexo/notice.md","hash":"9fc526aff1afdcd6d4a74fdd051810101d490f01","modified":1596770913815},{"_id":"themes/nexmoe/layout/_partial/_analytics/gtags.ejs","hash":"2c429eef83e712531a08de370b06f1f00ac7398b","modified":1596770913835},{"_id":"themes/nexmoe/layout/_partial/_analytics/gtm-body.ejs","hash":"1471e3a49ad6c93fd33b18545b43805c48695e23","modified":1596770913835},{"_id":"themes/nexmoe/layout/_partial/_analytics/la.ejs","hash":"e08b1f111068c62e625b6790e66d8a5f625246ba","modified":1596770913836},{"_id":"themes/nexmoe/WIKI/en/Hexo/use.md","hash":"c3e51cb400d61bf02724a7a4577c239c9a301f25","modified":1596770913815},{"_id":"themes/nexmoe/layout/_partial/_analytics/gtm-head.ejs","hash":"5638bed9cfe2e86aeee77adc883b2a3e1ecd76ff","modified":1596770913836},{"_id":"themes/nexmoe/layout/_partial/_analytics/tencent.ejs","hash":"6f7d514f157fbdb505e52dda2dc4f35dcdb2685e","modified":1596770913836},{"_id":"themes/nexmoe/layout/_partial/_comment/DiscussBot.ejs","hash":"92fb25b5204b325eb18eea0c15ddb4f4116e35e2","modified":1596770913836},{"_id":"themes/nexmoe/layout/_partial/_comment/changyan.ejs","hash":"8a520fd9a9704208c23abcb689bae33acd1167db","modified":1596770913836},{"_id":"themes/nexmoe/layout/_partial/_comment/disqus.ejs","hash":"e1e70a619cf3499ef8b054c8fb4b23865a554b6b","modified":1596770913837},{"_id":"themes/nexmoe/layout/_partial/_comment/disqusjs.ejs","hash":"7518e88f2504b9844f71190e079df07f51847472","modified":1596770913837},{"_id":"themes/nexmoe/layout/_partial/_comment/gitalk.ejs","hash":"a3a33112234fee49646a9c11fcbdf2ed1a7777a8","modified":1596770913837},{"_id":"themes/nexmoe/layout/_partial/_comment/gitment.ejs","hash":"d4a99db9f2daf7bcdbcf637f478d925d5d840fe4","modified":1596770913837},{"_id":"themes/nexmoe/layout/_partial/_comment/livere.ejs","hash":"e96e1510ba2a8ccb1edebc378c566fadaed09e50","modified":1596770913838},{"_id":"themes/nexmoe/layout/_partial/_comment/valine.ejs","hash":"97a699da23500cd6b16c857a60d123064d1653f9","modified":1596770913838},{"_id":"themes/nexmoe/WIKI/package-lock.json","hash":"1997109d6b824afbdb21bed498a60417aa3e0356","modified":1596770913820},{"_id":"themes/nexmoe/WIKI/en/component/basic/color.md","hash":"7d7c6a408b7d38a5f7cd608d0e852e4d0ac0bca4","modified":1596770913816},{"_id":"themes/nexmoe/WIKI/en/component/basic/icon.md","hash":"3101ced9978917c9869fd99693a4eb73a29a25b2","modified":1596770913816},{"_id":"themes/nexmoe/WIKI/yarn.lock","hash":"6f5aa2884599f7784d969a601a4ca96b837e4c45","modified":1596770913823},{"_id":"source/_posts/[DEBUG日记]Swagger扫不到类-Jdk代理导致的反射类型故障/ApiListingReferenceScanner.png","hash":"607a9904c30d7bcae1dffc07e96863725a0ba82b","modified":1630641045906},{"_id":"source/_posts/[MXCHIP-1]开发板到手/4.jpg","hash":"1ad544f24f3edeabcd478fe1810bba0c00a59c99","modified":1596770913746},{"_id":"source/_posts/[MXCHIP-1]开发板到手/1.jpg","hash":"7956aa8ecc214e7fd334214ba14e0f17a4af354f","modified":1596770913742},{"_id":"source/_posts/[MXCHIP-1]开发板到手/title.jpg","hash":"98f295a21942c79f60c03603bcf3b2d249780499","modified":1596770913754},{"_id":"source/_images/test3.jpg","hash":"8f2f167d8d87e776cbbbdc0403f4b4d45b9325aa","modified":1619407169199},{"_id":"source/_posts/[MXCHIP-1]开发板到手/5.jpg","hash":"5e693b10c11480483492e631ff577641da9345a2","modified":1596770913749},{"_id":"source/_posts/[MXCHIP-2]真机调试/title.jpg","hash":"83ee04eb43bad55758609dc90f1ed3c199aed35f","modified":1596770913776},{"_id":"themes/nexmoe/WIKI/cover.png","hash":"933112bf55ba0dfff98fd8f3e670f12fe83d3c9f","modified":1596770913814},{"_id":"source/_images/发码平台结构设计/发码平台交互图.jpg","hash":"ccb0c05915fabc9b5a97738a2379284381dec9a8","modified":1631934376931},{"_id":"source/_posts/发码平台结构设计/发码平台交互图.jpg","hash":"ccb0c05915fabc9b5a97738a2379284381dec9a8","modified":1631934376932},{"_id":"source/_posts/Death_Standing/v2-e0a965a2365bdadda41dedcb9fe5ec58_r.jpg","hash":"a57015d7e3909a9eae1a92e87ceb52a19cf051ea","modified":1596770913738},{"_id":"source/_posts/[MXCHIP-2]真机调试/DS0021CN_EMW3031_V1.4.pdf","hash":"9a9494f397a72c3f683556281e91be56e74b19d2","modified":1596770913767},{"_id":"public/PY.html","hash":"9c7142bad0da717146cd93cf04c18b7a6a96c0ca","modified":1631936832826},{"_id":"public/about.html","hash":"0dc1f6326dc3c11ef020941e1a8d059ea0b64ea0","modified":1631936832826},{"_id":"public/2020/11/17/[ESP8266]02_Lua基础/index.html","hash":"b1198c2ed107b5560ed7cb1a863b96bc280047c1","modified":1631936832826},{"_id":"public/2020/11/16/[ESP8266]01_刷写测试AT固件/index.html","hash":"e20b286420def0c5ebb4fb3f96c42b4d52ff5527","modified":1631936832826},{"_id":"public/2020/08/07/改造Spring-data-redis/index.html","hash":"4f239d594d260092d16c593e952d1bcdb587a2ef","modified":1631936832826},{"_id":"public/2019/07/01/[Zookeeper学习-第二章]用作SpringCloud的注册中心/index.html","hash":"614aff68d1651f91e212b47a6d5b3a21a16ed9b3","modified":1631936832826},{"_id":"public/page/3/index.html","hash":"7755e75791ddd2050d2a42b722f900ff401056c9","modified":1631936832826},{"_id":"public/archives/page/3/index.html","hash":"3fc27f7587ea92343302bdcd0fc453029f278eb5","modified":1631936832826},{"_id":"public/archives/2018/index.html","hash":"a93f9a2edf37ef0ee86b8cbfe01fcc6e4eba7b86","modified":1631936832826},{"_id":"public/archives/2018/12/index.html","hash":"2a9a0b5263c14a6f9ff36601d2107e749a65a127","modified":1631936832826},{"_id":"public/archives/2019/page/2/index.html","hash":"16dc495b126ad79371722e78aa2f792515e2afaa","modified":1631936832826},{"_id":"public/archives/2019/03/index.html","hash":"bbb0267accd1c406c366e65eae8f183ee640b849","modified":1631936832826},{"_id":"public/archives/2019/01/index.html","hash":"2f3ac775f9fef5667d020a1d08fab3dbe007d81e","modified":1631936832826},{"_id":"public/archives/2019/04/index.html","hash":"b8db35b0b279bbe7b87151879b63c25c706b3cbe","modified":1631936832826},{"_id":"public/archives/2019/05/index.html","hash":"197012b56d1a9078dbf611d1fb8dd3d9f41ea5ca","modified":1631936832826},{"_id":"public/archives/2019/06/index.html","hash":"123fe2884c759405e553bbfbd01e88a266078e82","modified":1631936832826},{"_id":"public/archives/2019/07/index.html","hash":"45f10f5ef367b185fe9f7fc23bc36f13337dac38","modified":1631936832826},{"_id":"public/archives/2019/12/index.html","hash":"f90838bc57d464ed0cc4dda062d7756f7d6bdf5e","modified":1631936832826},{"_id":"public/archives/2020/03/index.html","hash":"7dfc6d1c686278fcd736af9ea2497cdd54799ef1","modified":1631936832826},{"_id":"public/archives/2020/08/index.html","hash":"ac1d07fdbc6e8853dd9d7caaaf77d8d00391ee86","modified":1631936832826},{"_id":"public/archives/2020/11/index.html","hash":"cd6fd58481d4010ae1e050b682f3e4c2148150db","modified":1631936832826},{"_id":"public/archives/2021/07/index.html","hash":"cbfcfc7f2dedf330e8a1fe6e4771e35034064b5b","modified":1631936832826},{"_id":"public/archives/2021/08/index.html","hash":"8e8004118c4b3bfe7f7d2ce70025046b4e287de8","modified":1631936832826},{"_id":"public/archives/2021/09/index.html","hash":"a0824f91ffec42df650027425d8ef5ef0b9eda0f","modified":1631936832826},{"_id":"public/categories/想到啥写啥/index.html","hash":"8ee9fc80506511ada165b1a6fbec7e4fac1bc5c0","modified":1631936832826},{"_id":"public/categories/搞点骚操作/index.html","hash":"609d74415081af4802168728bf6124c97544e250","modified":1631936832826},{"_id":"public/tags/blog/index.html","hash":"4ae1df4b6c42f39bf1bd80fbce519a4d2b48ef66","modified":1631936832826},{"_id":"public/tags/linux/index.html","hash":"7f6e2736b16c1086fa3a725cfb465b6c9dd793a6","modified":1631936832826},{"_id":"public/tags/C/index.html","hash":"be827b92ec3fb9cfe8b62640a87e97bd384f7990","modified":1631936832826},{"_id":"public/tags/Games/index.html","hash":"61c2af772b83d271a50c3564e05f3b51d68cad41","modified":1631936832826},{"_id":"public/tags/pdf/index.html","hash":"d1dfb77981b092f6c4f30c417a6503a247606e50","modified":1631936832826},{"_id":"public/tags/spring/index.html","hash":"598b09b9fc18d291805a2eebfdd9b9f9fd8309d2","modified":1631936832826},{"_id":"public/tags/debug/index.html","hash":"ad929bbcc4802f515e47eca883f6de145ffd60b5","modified":1631936832826},{"_id":"public/tags/zookeeper/index.html","hash":"27177b7207ec7142ae0bdbf48ab6c5e6e893ff04","modified":1631936832826},{"_id":"public/tags/lambda/index.html","hash":"078e4846c7d1ff2abd111f97e779e1de2df0b5a0","modified":1631936832826},{"_id":"public/tags/maven/index.html","hash":"593401912e5157afa1af2dc79a0a7e0d2472f82a","modified":1631936832826},{"_id":"public/tags/Lua/index.html","hash":"517d5521c1b457f32ec925d8a12627e81be14a1c","modified":1631936832826},{"_id":"public/2021/09/16/JobDescription-20210916/index.html","hash":"032a8f2a26b0297b3f7aa85f630c69fdd4253f4d","modified":1631936832826},{"_id":"public/2021/09/09/书单整理2021-08-30/index.html","hash":"31f25c00a46b0d021be58abb68e2530bd5100aa4","modified":1631936832826},{"_id":"public/2021/09/17/发码平台结构设计/index.html","hash":"41a2a61dc183432f0a87c96e8551df459ec59656","modified":1631936832826},{"_id":"public/2021/09/02/[DEBUG日记]Swagger扫不到类-Jdk代理导致的反射类型故障/index.html","hash":"f70c6148e8054c15c08aa58cb6fdad7f18931cca","modified":1631936832826},{"_id":"public/2021/08/26/PDF疑难杂症以及治疗方法总结/index.html","hash":"2890f65d652dd39babda19e3764c4432403cfdb9","modified":1631936832826},{"_id":"public/2021/07/26/解决由https转发导致的SpringCloudGateway转发异常/index.html","hash":"18481c0e7a5ad950556b2775a76103631b99e62e","modified":1631936832826},{"_id":"public/2020/03/12/Death_Standing/index.html","hash":"b1f660e479af7d1de1c996146309d622dcea1405","modified":1631936832826},{"_id":"public/2019/12/19/java8函数设计[1]-在filter中根据Key去重的函数/index.html","hash":"4b8d32a7ece07e60bfda46b63f59a7c08844abd9","modified":1631936832826},{"_id":"public/2019/07/01/[Zookeeper学习-第一章]zk环境搭建[单机+控制台]/index.html","hash":"f6a857338a275a301ae19f8b061c058caecad5fd","modified":1631936832826},{"_id":"public/2019/06/04/计划任务的Spring实现与手动实现/index.html","hash":"ece11d065d59b834da92459a73355585af96c72b","modified":1631936832826},{"_id":"public/2019/05/21/[MXCHIP-2]真机调试/index.html","hash":"cc72963a6d227d7003c7992d897278068668af22","modified":1631936832826},{"_id":"public/2019/05/13/SpringBoot中的redis密码问题/index.html","hash":"fae6cf2dfe103ee7d0515cbf797f8fea0e113cbe","modified":1631936832826},{"_id":"public/2019/04/26/泛型上下界/index.html","hash":"cc03e96ff76277807b112eb98c48fcdfb1a4387f","modified":1631936832826},{"_id":"public/2019/03/11/好用常用人人都要会的最基本的Maven插件收集/index.html","hash":"7d0e9d9047139ceacf641657c245812e69595a89","modified":1631936832826},{"_id":"public/2019/01/04/[WSL2]子系统ubuntu安装jdk8/index.html","hash":"2fab3edf3cfd230950da57c9aa6e2ad68f62ae8c","modified":1631936832826},{"_id":"public/2019/03/10/[MXCHIP-1]开发板到手/index.html","hash":"ba81f71219e3808bfe31036d82b432079861b0b0","modified":1631936832826},{"_id":"public/2019/01/02/[Centos]yum仓库配置及常用操作/index.html","hash":"a62269e9a789e92e20935febf1c3b004fe9732e9","modified":1631936832826},{"_id":"public/2018/12/23/Hexo部署GitMent评论/index.html","hash":"87e0a39451b1829867cc89a7bfe111dc97e7c58e","modified":1631936832826},{"_id":"public/index.html","hash":"21fc327ab3d0f04db54718101014fef87880c09c","modified":1631936832826},{"_id":"public/page/2/index.html","hash":"e0787f432a3a35802a587b03bac024b8db19f77a","modified":1631936832826},{"_id":"public/archives/index.html","hash":"43a59982f8c9343b2329e547c57290d460ef81b6","modified":1631936832826},{"_id":"public/archives/page/2/index.html","hash":"b3738d2eba2e136817286b2e6cd58e62bba13583","modified":1631936832826},{"_id":"public/archives/2019/index.html","hash":"2aa0c26dbf697f4475801f44fcb414a84f37d0d6","modified":1631936832826},{"_id":"public/archives/2020/index.html","hash":"b524789fb9c14dd27d819b1340c59d290f6c785c","modified":1631936832826},{"_id":"public/archives/2021/index.html","hash":"67ace2f771e7dbb601a1696f864f87ccdb07b2f9","modified":1631936832826},{"_id":"public/categories/我永远爱学习/index.html","hash":"3e16aca1cee58ae40c25cc0906e30cadf6a2f4c4","modified":1631936832826},{"_id":"public/categories/我永远爱学习/page/2/index.html","hash":"918631f78103c50fa791cf33d676cb60fb0a177a","modified":1631936832826},{"_id":"public/tags/单片机/index.html","hash":"217594959d8c28248ae2719e6e38aa0d98b92acc","modified":1631936832826},{"_id":"public/tags/IOT/index.html","hash":"ff012fff2c15b34b45fee22daef592f3436c9a6a","modified":1631936832826},{"_id":"public/tags/java/index.html","hash":"114219414b7ebe96f30370f2b02978711464a34d","modified":1631936832826},{"_id":"public/images/favicon.ico","hash":"57716efbf81cb86f1b1066cb6143ce64da694a37","modified":1631936832826},{"_id":"public/CNAME","hash":"c2792d6adbd155f57f761d8bf88b88ed4cca5497","modified":1631936832826},{"_id":"public/images/avatar.jpg","hash":"23370f0f0182b061c23bd8dd0c481875ecbeaabe","modified":1631936832826},{"_id":"public/2019/12/19/java8函数设计[1]-在filter中根据Key去重的函数/title.jpg","hash":"0e0625cebf1e3efbc5f9249245de6e1c51e34319","modified":1631936832826},{"_id":"public/2019/03/11/好用常用人人都要会的最基本的Maven插件收集/title.jpg","hash":"c68ea1970e094297ce0bdcee9577f3f2c423198f","modified":1631936832826},{"_id":"public/2019/06/04/计划任务的Spring实现与手动实现/title.jpg","hash":"9a168cbe8d76732832d0601903d3f78a15036a23","modified":1631936832826},{"_id":"public/2020/08/07/改造Spring-data-redis/TTLRedisCache.java","hash":"a7899406c92991be67555064c1701e2545d39065","modified":1631936832826},{"_id":"public/2020/08/07/改造Spring-data-redis/MyRedisCacheManage.java","hash":"efb1f6f09d93812e003092fb431107a5ef150919","modified":1631936832826},{"_id":"public/2019/05/21/[MXCHIP-2]真机调试/UART接口定义.jpg","hash":"9d42c6f23baacd79490e0228e77774e26fc2159e","modified":1631936832826},{"_id":"public/2019/03/10/[MXCHIP-1]开发板到手/3.jpg","hash":"7fd783087561c45e1386c9b372c5fc6e4189bdf5","modified":1631936832826},{"_id":"public/2020/11/16/[ESP8266]01_刷写测试AT固件/title_s.jpg","hash":"5c74617cc6919a04c334bfbb5e87de4d68511cd2","modified":1631936832826},{"_id":"public/2020/11/17/[ESP8266]02_Lua基础/title_s.jpg","hash":"db2274b18306eecd8f96cac9993d3dd259cf9871","modified":1631936832826},{"_id":"public/2021/09/17/发码平台结构设计/发码平台交互图.vsdx","hash":"3baa70a500ad47733a78287f1178b62d86ac08e0","modified":1631936832826},{"_id":"public/2020/03/12/Death_Standing/IMG_20200319_004053.jpg","hash":"fca29bda4a92bbbcc8494724b10200df836fc842","modified":1631936832826},{"_id":"public/2021/09/02/[DEBUG日记]Swagger扫不到类-Jdk代理导致的反射类型故障/RequestHandlerSelectors#1.png","hash":"bc6170edba18ca6ff13199062405306cae0eb37f","modified":1631936832826},{"_id":"public/2021/09/02/[DEBUG日记]Swagger扫不到类-Jdk代理导致的反射类型故障/RequestHandlerSelectors#3.png","hash":"3a5ab228e455a017cd9e588e4d7b2983efa4eff8","modified":1631936832826},{"_id":"public/2021/09/02/[DEBUG日记]Swagger扫不到类-Jdk代理导致的反射类型故障/RequestHandlerSelectors#2.png","hash":"be3dc5f1df3c652e5afeb198e959d302d57bd4e9","modified":1631936832826},{"_id":"public/2019/05/21/[MXCHIP-2]真机调试/SWD接口定义.jpg","hash":"21911f80d7e93f6ce8fabdea7a9c9150272ae167","modified":1631936832826},{"_id":"public/2019/03/10/[MXCHIP-1]开发板到手/4_s.jpg","hash":"19a2c2ba97b36546ab58b3d7a6548ccadfa98044","modified":1631936832826},{"_id":"public/2019/03/10/[MXCHIP-1]开发板到手/6.jpg","hash":"dc4adaffa856c9dda6c724a9a0178433b8d7a807","modified":1631936832826},{"_id":"public/2019/03/10/[MXCHIP-1]开发板到手/title_s.jpg","hash":"72be643223f38ae968bb8acdb50a2a9bda802447","modified":1631936832826},{"_id":"public/js/app.js","hash":"ad21a4b329b11cb092d2a9fd82a4925b87b3979d","modified":1631936832826},{"_id":"public/css/style.css","hash":"845e890df964b27e105b97287c89803e8fda4177","modified":1631936832826},{"_id":"public/2019/03/10/[MXCHIP-1]开发板到手/1_s.jpg","hash":"602f4eeb817eeee7b831cc77de9afded105547f9","modified":1631936832826},{"_id":"public/2019/03/10/[MXCHIP-1]开发板到手/5_s.jpg","hash":"435b928be9dd4b97153e17864470c2f1ba83ee5c","modified":1631936832826},{"_id":"public/2019/05/21/[MXCHIP-2]真机调试/SWD接口定义.png","hash":"3a5cfbbd0013a93c7a24e32ea7d2d53fefe8214e","modified":1631936832826},{"_id":"public/2020/03/12/Death_Standing/psc.jpg","hash":"cf6cfde12fcf1bb5d454266b2c1ccd68ebf040b8","modified":1631936832826},{"_id":"public/2021/09/02/[DEBUG日记]Swagger扫不到类-Jdk代理导致的反射类型故障/ApiListingReferenceScanner.png","hash":"607a9904c30d7bcae1dffc07e96863725a0ba82b","modified":1631936832826},{"_id":"public/2019/03/10/[MXCHIP-1]开发板到手/title.jpg","hash":"98f295a21942c79f60c03603bcf3b2d249780499","modified":1631936832826},{"_id":"public/2019/03/10/[MXCHIP-1]开发板到手/1.jpg","hash":"7956aa8ecc214e7fd334214ba14e0f17a4af354f","modified":1631936832826},{"_id":"public/2019/03/10/[MXCHIP-1]开发板到手/4.jpg","hash":"1ad544f24f3edeabcd478fe1810bba0c00a59c99","modified":1631936832826},{"_id":"public/2019/03/10/[MXCHIP-1]开发板到手/5.jpg","hash":"5e693b10c11480483492e631ff577641da9345a2","modified":1631936832826},{"_id":"public/2019/05/21/[MXCHIP-2]真机调试/title.jpg","hash":"83ee04eb43bad55758609dc90f1ed3c199aed35f","modified":1631936832826},{"_id":"public/2021/09/17/发码平台结构设计/发码平台交互图.jpg","hash":"ccb0c05915fabc9b5a97738a2379284381dec9a8","modified":1631936832826},{"_id":"public/2020/03/12/Death_Standing/v2-e0a965a2365bdadda41dedcb9fe5ec58_r.jpg","hash":"a57015d7e3909a9eae1a92e87ceb52a19cf051ea","modified":1631936832826},{"_id":"public/2019/05/21/[MXCHIP-2]真机调试/DS0021CN_EMW3031_V1.4.pdf","hash":"9a9494f397a72c3f683556281e91be56e74b19d2","modified":1631936832826}],"Category":[{"name":"想到啥写啥","_id":"cktp91zke00064cow76nkdl01"},{"name":"搞点骚操作","_id":"cktp91zkl000a4cow7sk573il"},{"name":"我永远爱学习","_id":"cktp91zku000m4cow3cgqb3fx"}],"Data":[],"Page":[{"title":"友情链接","date":"2020-01-21T08:46:25.000Z","type":"py","layout":"py","comments":0,"_content":"\n- [![baidu](https://www.baidu.com/img/baidu_resultlogo@2.png)](https://www.baidu.com/ \"有问题找百度\")","source":"py.md","raw":"---\ntitle: 友情链接\ndate: 2020/01/21 16:46:25\ntype: \"py\"\nlayout: py\npermalink: PY.html\ncomments: false\n---\n\n- [![baidu](https://www.baidu.com/img/baidu_resultlogo@2.png)](https://www.baidu.com/ \"有问题找百度\")","updated":"2020-08-07T03:28:33.780Z","path":"PY.html","_id":"cktp91zja00004cow5ecu02eh","content":"<ul>\n<li><a href=\"https://www.baidu.com/\" target=\"_blank\" rel=\"noopener\" title=\"有问题找百度\"><img src=\"https://www.baidu.com/img/baidu_resultlogo@2.png\" alt=\"baidu\"></a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<ul>\n<li><a href=\"https://www.baidu.com/\" target=\"_blank\" rel=\"noopener\" title=\"有问题找百度\"><img src=\"https://www.baidu.com/img/baidu_resultlogo@2.png\" alt=\"baidu\"></a></li>\n</ul>\n"},{"title":"关于","date":"2020-01-21T08:46:25.000Z","type":"about","layout":"about","comments":0,"_content":"\n关于","source":"about.md","raw":"---\ntitle: 关于\ndate: 2020/01/21 16:46:25\ntype: \"about\"\nlayout: about\npermalink: about.html\ncomments: false\n---\n\n关于","updated":"2020-08-07T03:28:33.780Z","path":"about.html","_id":"cktp91zjd00014cowaln77mgb","content":"<p>关于</p>\n","site":{"data":{}},"excerpt":"","more":"<p>关于</p>\n"}],"Post":[{"title":"JobDescription-20210916","date":"2021-09-16T15:27:38.000Z","_content":"写了两个JD，随手记录一下。\n<!--more-->\n\n## JobDescription-A\n\n招个人只接流程引擎\n\n- 岗位要求: 加分项任选其一即可\n\n  1. 3年以上IT互联网行业或软件行业后端开发工作经验，优秀者可适当放宽年限。\n  2. 良好的Java基本功，理解OOP、DDD等编程方式。\n  3. 熟悉BPMN2.0规范，熟悉开源流程引擎（不限于flowable）工作原理。\n  4. 熟悉常用的设计模式，具备一定源码阅读能力。\n  5. 熟悉Linux系统，能熟练的使用Linux的常用命令。\n  6. [加分项] 能合理抽离业务代码和可复用的组件，具有封装内部工具的经验。\n  7. [加分项] 能着手优化结构不合理的sql语句，并能根据业务场景提出优化方案。\n  8. [加分项] 能根据实际业务场景合理应用缓存(包括但不限于Redis、Memcached)、消息(包括但不限于RabbitMq、Kafka)、搜索引擎(Elasticsearch、solr)等中间件。\n\n- 工作职责:\n\n  1. 负责应用系统设计、编码、优化工作，并为团队中其他成员提供技术支持。\n  2. 进行需求分析，拆分业务任务，编写技术文档。\n\n## JobDescription-B\n\n招个人整个中台一起接\n\n- 岗位要求: 加分项任选其一即可\n\n  0. 3年以上IT互联网行业或软件行业后端开发工作经验，优秀者可适当放宽年限。\n  1. 良好的Java基本功，理解OOP、DDD等编程方式。\n  2. 熟悉常用的设计模式，具备一定源码阅读能力。\n  3. 具备优秀的接口设计能力，能在合适的位置适当地预留扩展的空间。\n  4. 具备良好的抽象能力，能合理抽离业务代码和可复用的组件，具有封装内部工具的经验。\n  5. 熟悉微服务框架（不限于SpringCloud）,分布式设计和应用。\n  6. 熟悉Linux系统，能熟练的使用Linux的常用命令。具备git分支管理能力。\n  7. [加分项] 熟悉BPMN2.0规范，熟悉开源流程引擎（不限于flowable）工作原理。\n  8. [加分项] 能着手优化结构不合理的sql语句，并能根据业务场景提出优化方案。\n  9. [加分项] 能根据实际业务场景合理应用缓存(包括但不限于Redis、Memcached)、消息(包括但不限于RabbitMq、Kafka)、搜索引擎(Elasticsearch、solr)等中间件。\n\n- 工作职责:\n\n  1. 负责应用系统设计、编码、优化工作，并为团队中其他成员提供技术支持。\n  2. 进行需求分析，拆分业务任务，编写技术文档。\n","source":"_posts/JobDescription-20210916.md","raw":"---\ntitle: JobDescription-20210916\ndate: 2021-09-16 23:27:38\ncategories:\n- [想到啥写啥]\ntags:\n- blog\n---\n写了两个JD，随手记录一下。\n<!--more-->\n\n## JobDescription-A\n\n招个人只接流程引擎\n\n- 岗位要求: 加分项任选其一即可\n\n  1. 3年以上IT互联网行业或软件行业后端开发工作经验，优秀者可适当放宽年限。\n  2. 良好的Java基本功，理解OOP、DDD等编程方式。\n  3. 熟悉BPMN2.0规范，熟悉开源流程引擎（不限于flowable）工作原理。\n  4. 熟悉常用的设计模式，具备一定源码阅读能力。\n  5. 熟悉Linux系统，能熟练的使用Linux的常用命令。\n  6. [加分项] 能合理抽离业务代码和可复用的组件，具有封装内部工具的经验。\n  7. [加分项] 能着手优化结构不合理的sql语句，并能根据业务场景提出优化方案。\n  8. [加分项] 能根据实际业务场景合理应用缓存(包括但不限于Redis、Memcached)、消息(包括但不限于RabbitMq、Kafka)、搜索引擎(Elasticsearch、solr)等中间件。\n\n- 工作职责:\n\n  1. 负责应用系统设计、编码、优化工作，并为团队中其他成员提供技术支持。\n  2. 进行需求分析，拆分业务任务，编写技术文档。\n\n## JobDescription-B\n\n招个人整个中台一起接\n\n- 岗位要求: 加分项任选其一即可\n\n  0. 3年以上IT互联网行业或软件行业后端开发工作经验，优秀者可适当放宽年限。\n  1. 良好的Java基本功，理解OOP、DDD等编程方式。\n  2. 熟悉常用的设计模式，具备一定源码阅读能力。\n  3. 具备优秀的接口设计能力，能在合适的位置适当地预留扩展的空间。\n  4. 具备良好的抽象能力，能合理抽离业务代码和可复用的组件，具有封装内部工具的经验。\n  5. 熟悉微服务框架（不限于SpringCloud）,分布式设计和应用。\n  6. 熟悉Linux系统，能熟练的使用Linux的常用命令。具备git分支管理能力。\n  7. [加分项] 熟悉BPMN2.0规范，熟悉开源流程引擎（不限于flowable）工作原理。\n  8. [加分项] 能着手优化结构不合理的sql语句，并能根据业务场景提出优化方案。\n  9. [加分项] 能根据实际业务场景合理应用缓存(包括但不限于Redis、Memcached)、消息(包括但不限于RabbitMq、Kafka)、搜索引擎(Elasticsearch、solr)等中间件。\n\n- 工作职责:\n\n  1. 负责应用系统设计、编码、优化工作，并为团队中其他成员提供技术支持。\n  2. 进行需求分析，拆分业务任务，编写技术文档。\n","slug":"JobDescription-20210916","published":1,"updated":"2021-09-16T15:40:26.260Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cktp91zk800024cowevf39arf","content":"<p>写了两个JD，随手记录一下。</p>\n<a id=\"more\"></a>\n\n<h2 id=\"JobDescription-A\"><a href=\"#JobDescription-A\" class=\"headerlink\" title=\"JobDescription-A\"></a>JobDescription-A</h2><p>招个人只接流程引擎</p>\n<ul>\n<li><p>岗位要求: 加分项任选其一即可</p>\n<ol>\n<li>3年以上IT互联网行业或软件行业后端开发工作经验，优秀者可适当放宽年限。</li>\n<li>良好的Java基本功，理解OOP、DDD等编程方式。</li>\n<li>熟悉BPMN2.0规范，熟悉开源流程引擎（不限于flowable）工作原理。</li>\n<li>熟悉常用的设计模式，具备一定源码阅读能力。</li>\n<li>熟悉Linux系统，能熟练的使用Linux的常用命令。</li>\n<li>[加分项] 能合理抽离业务代码和可复用的组件，具有封装内部工具的经验。</li>\n<li>[加分项] 能着手优化结构不合理的sql语句，并能根据业务场景提出优化方案。</li>\n<li>[加分项] 能根据实际业务场景合理应用缓存(包括但不限于Redis、Memcached)、消息(包括但不限于RabbitMq、Kafka)、搜索引擎(Elasticsearch、solr)等中间件。</li>\n</ol>\n</li>\n<li><p>工作职责:</p>\n<ol>\n<li>负责应用系统设计、编码、优化工作，并为团队中其他成员提供技术支持。</li>\n<li>进行需求分析，拆分业务任务，编写技术文档。</li>\n</ol>\n</li>\n</ul>\n<h2 id=\"JobDescription-B\"><a href=\"#JobDescription-B\" class=\"headerlink\" title=\"JobDescription-B\"></a>JobDescription-B</h2><p>招个人整个中台一起接</p>\n<ul>\n<li><p>岗位要求: 加分项任选其一即可</p>\n<ol start=\"0\">\n<li>3年以上IT互联网行业或软件行业后端开发工作经验，优秀者可适当放宽年限。</li>\n<li>良好的Java基本功，理解OOP、DDD等编程方式。</li>\n<li>熟悉常用的设计模式，具备一定源码阅读能力。</li>\n<li>具备优秀的接口设计能力，能在合适的位置适当地预留扩展的空间。</li>\n<li>具备良好的抽象能力，能合理抽离业务代码和可复用的组件，具有封装内部工具的经验。</li>\n<li>熟悉微服务框架（不限于SpringCloud）,分布式设计和应用。</li>\n<li>熟悉Linux系统，能熟练的使用Linux的常用命令。具备git分支管理能力。</li>\n<li>[加分项] 熟悉BPMN2.0规范，熟悉开源流程引擎（不限于flowable）工作原理。</li>\n<li>[加分项] 能着手优化结构不合理的sql语句，并能根据业务场景提出优化方案。</li>\n<li>[加分项] 能根据实际业务场景合理应用缓存(包括但不限于Redis、Memcached)、消息(包括但不限于RabbitMq、Kafka)、搜索引擎(Elasticsearch、solr)等中间件。</li>\n</ol>\n</li>\n<li><p>工作职责:</p>\n<ol>\n<li>负责应用系统设计、编码、优化工作，并为团队中其他成员提供技术支持。</li>\n<li>进行需求分析，拆分业务任务，编写技术文档。</li>\n</ol>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>写了两个JD，随手记录一下。</p>","more":"<h2 id=\"JobDescription-A\"><a href=\"#JobDescription-A\" class=\"headerlink\" title=\"JobDescription-A\"></a>JobDescription-A</h2><p>招个人只接流程引擎</p>\n<ul>\n<li><p>岗位要求: 加分项任选其一即可</p>\n<ol>\n<li>3年以上IT互联网行业或软件行业后端开发工作经验，优秀者可适当放宽年限。</li>\n<li>良好的Java基本功，理解OOP、DDD等编程方式。</li>\n<li>熟悉BPMN2.0规范，熟悉开源流程引擎（不限于flowable）工作原理。</li>\n<li>熟悉常用的设计模式，具备一定源码阅读能力。</li>\n<li>熟悉Linux系统，能熟练的使用Linux的常用命令。</li>\n<li>[加分项] 能合理抽离业务代码和可复用的组件，具有封装内部工具的经验。</li>\n<li>[加分项] 能着手优化结构不合理的sql语句，并能根据业务场景提出优化方案。</li>\n<li>[加分项] 能根据实际业务场景合理应用缓存(包括但不限于Redis、Memcached)、消息(包括但不限于RabbitMq、Kafka)、搜索引擎(Elasticsearch、solr)等中间件。</li>\n</ol>\n</li>\n<li><p>工作职责:</p>\n<ol>\n<li>负责应用系统设计、编码、优化工作，并为团队中其他成员提供技术支持。</li>\n<li>进行需求分析，拆分业务任务，编写技术文档。</li>\n</ol>\n</li>\n</ul>\n<h2 id=\"JobDescription-B\"><a href=\"#JobDescription-B\" class=\"headerlink\" title=\"JobDescription-B\"></a>JobDescription-B</h2><p>招个人整个中台一起接</p>\n<ul>\n<li><p>岗位要求: 加分项任选其一即可</p>\n<ol start=\"0\">\n<li>3年以上IT互联网行业或软件行业后端开发工作经验，优秀者可适当放宽年限。</li>\n<li>良好的Java基本功，理解OOP、DDD等编程方式。</li>\n<li>熟悉常用的设计模式，具备一定源码阅读能力。</li>\n<li>具备优秀的接口设计能力，能在合适的位置适当地预留扩展的空间。</li>\n<li>具备良好的抽象能力，能合理抽离业务代码和可复用的组件，具有封装内部工具的经验。</li>\n<li>熟悉微服务框架（不限于SpringCloud）,分布式设计和应用。</li>\n<li>熟悉Linux系统，能熟练的使用Linux的常用命令。具备git分支管理能力。</li>\n<li>[加分项] 熟悉BPMN2.0规范，熟悉开源流程引擎（不限于flowable）工作原理。</li>\n<li>[加分项] 能着手优化结构不合理的sql语句，并能根据业务场景提出优化方案。</li>\n<li>[加分项] 能根据实际业务场景合理应用缓存(包括但不限于Redis、Memcached)、消息(包括但不限于RabbitMq、Kafka)、搜索引擎(Elasticsearch、solr)等中间件。</li>\n</ol>\n</li>\n<li><p>工作职责:</p>\n<ol>\n<li>负责应用系统设计、编码、优化工作，并为团队中其他成员提供技术支持。</li>\n<li>进行需求分析，拆分业务任务，编写技术文档。</li>\n</ol>\n</li>\n</ul>"},{"title":"[Centos]yum仓库配置及常用操作","date":"2019-01-02T12:46:25.000Z","updated":"2020-02-20T07:41:36.000Z","comments":1,"_content":"\nyum时不时抽风？仓库获取不到最新资源？先理解yum是怎么工作的吧！\n<!--more-->\n## 常用的储存库\n\n \n\n## 要注意的坑\n\n- 储存库要启用了才有效\n- `yum repo` 只能显示已启用的储存库 显示全部需要`yum repolist all`\n- 如果使用`yum-config-manager`配置仓库一定要记得保存\n- 配置完后记得要`yum makecache`建立缓存，如果不放心可以先`yum clean all `清除所有缓存\n\n&gt; 上面的坑我全部踩了\n\n## 命令 yum repolist all\n\n```text\nLoaded plugins: fastestmirror\nLoading mirror speeds from cached hostfile\n * base: mirror.scalabledns.com\n * elrepo: repos.lax-noc.com\n * elrepo-extras: repos.lax-noc.com\n * elrepo-kernel: repos.lax-noc.com\n * extras: repos-lax.psychz.net\n * updates: repos-lax.psychz.net\nrepo id                       repo name                        status\n// 这些仓库应该是系统升级时留下来的\nC7.0.1406-base/x86_64         CentOS-7.0.1406 - Base           disabled\nC7.0.1406-centosplus/x86_64   CentOS-7.0.1406 - CentOSPlus     disabled\nC7.0.1406-extras/x86_64       CentOS-7.0.1406 - Extras         disabled\nC7.0.1406-fasttrack/x86_64    CentOS-7.0.1406 - Fasttrack      disabled\nC7.0.1406-updates/x86_64      CentOS-7.0.1406 - Updates        disabled\nC7.1.1503-base/x86_64         CentOS-7.1.1503 - Base           disabled\nC7.1.1503-centosplus/x86_64   CentOS-7.1.1503 - CentOSPlus     disabled\nC7.1.1503-extras/x86_64       CentOS-7.1.1503 - Extras         disabled\nC7.1.1503-fasttrack/x86_64    CentOS-7.1.1503 - Fasttrack      disabled\nC7.1.1503-updates/x86_64      CentOS-7.1.1503 - Updates        disabled\nC7.2.1511-base/x86_64         CentOS-7.2.1511 - Base           disabled\nC7.2.1511-centosplus/x86_64   CentOS-7.2.1511 - CentOSPlus     disabled\nC7.2.1511-extras/x86_64       CentOS-7.2.1511 - Extras         disabled\nC7.2.1511-fasttrack/x86_64    CentOS-7.2.1511 - Fasttrack      disabled\nC7.2.1511-updates/x86_64      CentOS-7.2.1511 - Updates        disabled\nC7.3.1611-base/x86_64         CentOS-7.3.1611 - Base           disabled\nC7.3.1611-centosplus/x86_64   CentOS-7.3.1611 - CentOSPlus     disabled\nC7.3.1611-extras/x86_64       CentOS-7.3.1611 - Extras         disabled\nC7.3.1611-fasttrack/x86_64    CentOS-7.3.1611 - Fasttrack      disabled\nC7.3.1611-updates/x86_64      CentOS-7.3.1611 - Updates        disabled\nC7.4.1708-base/x86_64         CentOS-7.4.1708 - Base           disabled\nC7.4.1708-centosplus/x86_64   CentOS-7.4.1708 - CentOSPlus     disabled\nC7.4.1708-extras/x86_64       CentOS-7.4.1708 - Extras         disabled\nC7.4.1708-fasttrack/x86_64    CentOS-7.4.1708 - Fasttrack      disabled\nC7.4.1708-updates/x86_64      CentOS-7.4.1708 - Updates        disabled\nC7.5.1804-base/x86_64         CentOS-7.5.1804 - Base           disabled\nC7.5.1804-centosplus/x86_64   CentOS-7.5.1804 - CentOSPlus     disabled\nC7.5.1804-extras/x86_64       CentOS-7.5.1804 - Extras         disabled\nC7.5.1804-fasttrack/x86_64    CentOS-7.5.1804 - Fasttrack      disabled\nC7.5.1804-updates/x86_64      CentOS-7.5.1804 - Updates        disabled\nC7.6.1810-base/x86_64         CentOS-7.6.1810 - Base           disabled\nC7.6.1810-centosplus/x86_64   CentOS-7.6.1810 - CentOSPlus     disabled\nC7.6.1810-extras/x86_64       CentOS-7.6.1810 - Extras         disabled\nC7.6.1810-fasttrack/x86_64    CentOS-7.6.1810 - Fasttrack      disabled\nC7.6.1810-updates/x86_64      CentOS-7.6.1810 - Updates        disabled\n// centos7核心库 源码库和开发库的源就不开了\nbase/7/x86_64                 CentOS-7 - Base                  enabled: 10,096+1\nbase-debuginfo/x86_64         CentOS-7 - Debuginfo             disabled\nbase-source/7                 CentOS-7 - Base Sources          disabled\n// 看上去是多媒体相关的库 没桌面环境应该是用不上了\nc7-media                      CentOS-7 - Media                 disabled\n// 这个源主要是用来替换base源的，其中有不少包是base源的增强版\n// 但是如果开启这个源部分包可能会于base冲突 \n// 需要在base源中exclude 或者使用yum-plugin-priorities插件来保证兼容性\n// 引用WIKI: https://wiki.centos.org/zh/AdditionalResources/Repositories/CentOSPlus\ncentosplus/7/x86_64           CentOS-7 - Plus                  disabled\ncentosplus-source/7           CentOS-7 - Plus Sources          disabled\n// cr = Continuous Release 下次发布内容 相当于beta版了\ncr/7/x86_64                   CentOS-7 - cr                    disabled\n// elrepo = The Community Enterprise Linux Repository\n// http://elrepo.org 从描述中可以看出是驱动包 如果有UI可能要开\nelrepo                        ELRepo.org Community Enterprise  enabled:      147\nelrepo-extras                 ELRepo.org Community Enterprise  enabled:       19\nelrepo-kernel                 ELRepo.org Community Enterprise  enabled:       37\nelrepo-testing                ELRepo.org Community Enterprise  disabled\n// 这个源要开啊 EPEL仓库 相当多常用的软件都在里面\n// https://fedoraproject.org/\nepel/x86_64                   Extra Packages for Enterprise Li disabled\nepel-debuginfo/x86_64         Extra Packages for Enterprise Li disabled\nepel-source/x86_64            Extra Packages for Enterprise Li disabled\nepel-testing/x86_64           Extra Packages for Enterprise Li disabled\nepel-testing-debuginfo/x86_64 Extra Packages for Enterprise Li disabled\nepel-testing-source/x86_64    Extra Packages for Enterprise Li disabled\nextras/7/x86_64               CentOS-7 - Extras                enabled:      305\nextras-source/7               CentOS-7 - Extras Sources        disabled\nfasttrack/7/x86_64            CentOS-7 - fasttrack             disabled\nupdates/7/x86_64              CentOS-7 - Updates               enabled:    733+5\nupdates-source/7              CentOS-7 - Updates Sources       disabled\nrepolist: 11,337\n```\n\n## 命令 yum-config-manager [yum配置管理器]\n```text\nLoaded plugins: fastestmirror\nUsage: yum-config-manager [options] [section ...]\n\nOptions:\n  Plugin Options:\n\n  Yum Base Options:\n    -h, --help          show this help message and exit\n    -t, --tolerant      be tolerant of errors\n    // 完全从系统缓存运行，不更新缓存\n    -C, --cacheonly     run entirely from system cache, don't update cache\n    -c [config file], --config=[config file]\n                        config file location\n    -R [minutes], --randomwait=[minutes]\n                        maximum command wait time\n    -d [debug level], --debuglevel=[debug level]\n                        debugging output level\n    --showduplicates    show duplicates, in repos, in list/search commands\n    -e [error level], --errorlevel=[error level]\n                        error output level\n    --rpmverbosity=[debug level name]\n                        debugging output level for rpm\n    -q, --quiet         quiet operation\n    -v, --verbose       verbose operation\n    -y, --assumeyes     answer yes for all questions\n    --assumeno          answer no for all questions\n    --version           show Yum version and exit\n    --installroot=[path]\n                        set install root\n    --enablerepo=[repo]\n                        // 启用储存库\n                        enable one or more repositories (wildcards allowed)\n    --disablerepo=[repo]\n                        disable one or more repositories (wildcards allowed)\n    -x [package], --exclude=[package]\n                        exclude package(s) by name or glob\n    --disableexcludes=[repo]\n                        disable exclude from main, for a repo or for\n                        everything\n    --disableincludes=[repo]\n                        disable includepkgs for a repo or for everything\n    --obsoletes         enable obsoletes processing during updates\n    --noplugins         disable Yum plugins\n    --nogpgcheck        disable gpg signature checking\n    --disableplugin=[plugin]\n                        disable plugins by name\n    --enableplugin=[plugin]\n                        enable plugins by name\n    --skip-broken       skip packages with depsolving problems\n    --color=COLOR       control whether color is used\n    --releasever=RELEASEVER\n                        set value of $releasever in yum config and repo files\n    --downloadonly      don't update, just download\n    --downloaddir=DLDIR\n                        specifies an alternate directory to store packages\n    --setopt=SETOPTS    set arbitrary config and repo options\n    --bugfix            Include bugfix relevant packages, in updates\n    --security          Include security relevant packages, in updates\n    --advisory=ADVS, --advisories=ADVS\n                        Include packages needed to fix the given advisory, in\n                        updates\n    --bzs=BZS           Include packages needed to fix the given BZ, in\n                        updates\n    --cves=CVES         Include packages needed to fix the given CVE, in\n                        updates\n    --sec-severity=SEVS, --secseverity=SEVS\n                        Include security relevant packages matching the\n                        severity, in updates\n\n  yum-config-manager options:\n    // 保存当前设置\n    --save              save the current options (useful with --setopt)\n    // 启用仓库 (自动保存)\n    --enable            enable the specified repos (automatically saves)\n    // 禁用仓库 (自动保存)\n    --disable           disable the specified repos (automatically saves)\n    // 从文件或URL添加仓库 (并启用)\n    --add-repo=ADDREPO  add (and enable) the repo from the specified file or\n                        url\n\n```\n\n## 命令 yum\n\n```text\nLoaded plugins: fastestmirror\nUsage: yum [options] COMMAND\n\nList of Commands:\n\ncheck          Check for problems in the rpmdb\ncheck-update   Check for available package updates\nclean          Remove cached data\ndeplist        List a package's dependencies\ndistribution-synchronization Synchronize installed packages to the latest available versions\ndowngrade      downgrade a package\nerase          Remove a package or packages from your system\nfs             Acts on the filesystem data of the host, mainly for removing docs/lanuages for minimal hosts.\nfssnapshot     Creates filesystem snapshots, or lists/deletes current snapshots.\ngroups         Display, or use, the groups information\nhelp           Display a helpful usage message\nhistory        Display, or use, the transaction history\ninfo           Display details about a package or group of packages\ninstall        Install a package or packages on your system\nlist           List a package or groups of packages\nload-transaction load a saved transaction from filename\nmakecache      Generate the metadata cache\nprovides       Find what package provides the given value\nreinstall      reinstall a package\nrepo-pkgs      Treat a repo. as a group of packages, so we can install/remove all of them\nrepolist       Display the configured software repositories\nsearch         Search package details for the given string\nshell          Run an interactive yum shell\nswap           Simple way to swap packages, instead of using shell\nupdate         Update a package or packages on your system\nupdate-minimal Works like upgrade, but goes to the 'newest' package match which fixes a problem that affects your system\nupdateinfo     Acts on repository update information\nupgrade        Update packages taking obsoletes into account\nversion        Display a version for the machine and/or available repos.\n\n\nOptions:\n  -h, --help            show this help message and exit\n  -t, --tolerant        be tolerant of errors\n  -C, --cacheonly       run entirely from system cache, don't update cache\n  -c [config file], --config=[config file]\n                        config file location\n  -R [minutes], --randomwait=[minutes]\n                        maximum command wait time\n  -d [debug level], --debuglevel=[debug level]\n                        debugging output level\n  --showduplicates      show duplicates, in repos, in list/search commands\n  -e [error level], --errorlevel=[error level]\n                        error output level\n  --rpmverbosity=[debug level name]\n                        debugging output level for rpm\n  -q, --quiet           quiet operation\n  -v, --verbose         verbose operation\n  -y, --assumeyes       answer yes for all questions\n  --assumeno            answer no for all questions\n  --version             show Yum version and exit\n  --installroot=[path]  set install root\n  --enablerepo=[repo]   enable one or more repositories (wildcards allowed)\n  --disablerepo=[repo]  disable one or more repositories (wildcards allowed)\n  -x [package], --exclude=[package]\n                        exclude package(s) by name or glob\n  --disableexcludes=[repo]\n                        disable exclude from main, for a repo or for\n                        everything\n  --disableincludes=[repo]\n                        disable includepkgs for a repo or for everything\n  --obsoletes           enable obsoletes processing during updates\n  --noplugins           disable Yum plugins\n  --nogpgcheck          disable gpg signature checking\n  --disableplugin=[plugin]\n                        disable plugins by name\n  --enableplugin=[plugin]\n                        enable plugins by name\n  --skip-broken         skip packages with depsolving problems\n  --color=COLOR         control whether color is used\n  --releasever=RELEASEVER\n                        set value of $releasever in yum config and repo files\n  --downloadonly        don't update, just download\n  --downloaddir=DLDIR   specifies an alternate directory to store packages\n  --setopt=SETOPTS      set arbitrary config and repo options\n  --bugfix              Include bugfix relevant packages, in updates\n  --security            Include security relevant packages, in updates\n  --advisory=ADVS, --advisories=ADVS\n                        Include packages needed to fix the given advisory, in\n                        updates\n  --bzs=BZS             Include packages needed to fix the given BZ, in\n                        updates\n  --cves=CVES           Include packages needed to fix the given CVE, in\n                        updates\n  --sec-severity=SEVS, --secseverity=SEVS\n                        Include security relevant packages matching the\n                        severity, in updates\n\n  Plugin Options:\n\n```\n","source":"_posts/[Centos]yum仓库配置及常用操作.md","raw":"---\ntitle: '[Centos]yum仓库配置及常用操作'\ndate: 2019/1/2 20:46:25\nupdated: 2020/2/20 15:41:36\ncomments: true\ncategories: \n    - [搞点骚操作]\ntags: \n    - linux\n---\n\nyum时不时抽风？仓库获取不到最新资源？先理解yum是怎么工作的吧！\n<!--more-->\n## 常用的储存库\n\n \n\n## 要注意的坑\n\n- 储存库要启用了才有效\n- `yum repo` 只能显示已启用的储存库 显示全部需要`yum repolist all`\n- 如果使用`yum-config-manager`配置仓库一定要记得保存\n- 配置完后记得要`yum makecache`建立缓存，如果不放心可以先`yum clean all `清除所有缓存\n\n&gt; 上面的坑我全部踩了\n\n## 命令 yum repolist all\n\n```text\nLoaded plugins: fastestmirror\nLoading mirror speeds from cached hostfile\n * base: mirror.scalabledns.com\n * elrepo: repos.lax-noc.com\n * elrepo-extras: repos.lax-noc.com\n * elrepo-kernel: repos.lax-noc.com\n * extras: repos-lax.psychz.net\n * updates: repos-lax.psychz.net\nrepo id                       repo name                        status\n// 这些仓库应该是系统升级时留下来的\nC7.0.1406-base/x86_64         CentOS-7.0.1406 - Base           disabled\nC7.0.1406-centosplus/x86_64   CentOS-7.0.1406 - CentOSPlus     disabled\nC7.0.1406-extras/x86_64       CentOS-7.0.1406 - Extras         disabled\nC7.0.1406-fasttrack/x86_64    CentOS-7.0.1406 - Fasttrack      disabled\nC7.0.1406-updates/x86_64      CentOS-7.0.1406 - Updates        disabled\nC7.1.1503-base/x86_64         CentOS-7.1.1503 - Base           disabled\nC7.1.1503-centosplus/x86_64   CentOS-7.1.1503 - CentOSPlus     disabled\nC7.1.1503-extras/x86_64       CentOS-7.1.1503 - Extras         disabled\nC7.1.1503-fasttrack/x86_64    CentOS-7.1.1503 - Fasttrack      disabled\nC7.1.1503-updates/x86_64      CentOS-7.1.1503 - Updates        disabled\nC7.2.1511-base/x86_64         CentOS-7.2.1511 - Base           disabled\nC7.2.1511-centosplus/x86_64   CentOS-7.2.1511 - CentOSPlus     disabled\nC7.2.1511-extras/x86_64       CentOS-7.2.1511 - Extras         disabled\nC7.2.1511-fasttrack/x86_64    CentOS-7.2.1511 - Fasttrack      disabled\nC7.2.1511-updates/x86_64      CentOS-7.2.1511 - Updates        disabled\nC7.3.1611-base/x86_64         CentOS-7.3.1611 - Base           disabled\nC7.3.1611-centosplus/x86_64   CentOS-7.3.1611 - CentOSPlus     disabled\nC7.3.1611-extras/x86_64       CentOS-7.3.1611 - Extras         disabled\nC7.3.1611-fasttrack/x86_64    CentOS-7.3.1611 - Fasttrack      disabled\nC7.3.1611-updates/x86_64      CentOS-7.3.1611 - Updates        disabled\nC7.4.1708-base/x86_64         CentOS-7.4.1708 - Base           disabled\nC7.4.1708-centosplus/x86_64   CentOS-7.4.1708 - CentOSPlus     disabled\nC7.4.1708-extras/x86_64       CentOS-7.4.1708 - Extras         disabled\nC7.4.1708-fasttrack/x86_64    CentOS-7.4.1708 - Fasttrack      disabled\nC7.4.1708-updates/x86_64      CentOS-7.4.1708 - Updates        disabled\nC7.5.1804-base/x86_64         CentOS-7.5.1804 - Base           disabled\nC7.5.1804-centosplus/x86_64   CentOS-7.5.1804 - CentOSPlus     disabled\nC7.5.1804-extras/x86_64       CentOS-7.5.1804 - Extras         disabled\nC7.5.1804-fasttrack/x86_64    CentOS-7.5.1804 - Fasttrack      disabled\nC7.5.1804-updates/x86_64      CentOS-7.5.1804 - Updates        disabled\nC7.6.1810-base/x86_64         CentOS-7.6.1810 - Base           disabled\nC7.6.1810-centosplus/x86_64   CentOS-7.6.1810 - CentOSPlus     disabled\nC7.6.1810-extras/x86_64       CentOS-7.6.1810 - Extras         disabled\nC7.6.1810-fasttrack/x86_64    CentOS-7.6.1810 - Fasttrack      disabled\nC7.6.1810-updates/x86_64      CentOS-7.6.1810 - Updates        disabled\n// centos7核心库 源码库和开发库的源就不开了\nbase/7/x86_64                 CentOS-7 - Base                  enabled: 10,096+1\nbase-debuginfo/x86_64         CentOS-7 - Debuginfo             disabled\nbase-source/7                 CentOS-7 - Base Sources          disabled\n// 看上去是多媒体相关的库 没桌面环境应该是用不上了\nc7-media                      CentOS-7 - Media                 disabled\n// 这个源主要是用来替换base源的，其中有不少包是base源的增强版\n// 但是如果开启这个源部分包可能会于base冲突 \n// 需要在base源中exclude 或者使用yum-plugin-priorities插件来保证兼容性\n// 引用WIKI: https://wiki.centos.org/zh/AdditionalResources/Repositories/CentOSPlus\ncentosplus/7/x86_64           CentOS-7 - Plus                  disabled\ncentosplus-source/7           CentOS-7 - Plus Sources          disabled\n// cr = Continuous Release 下次发布内容 相当于beta版了\ncr/7/x86_64                   CentOS-7 - cr                    disabled\n// elrepo = The Community Enterprise Linux Repository\n// http://elrepo.org 从描述中可以看出是驱动包 如果有UI可能要开\nelrepo                        ELRepo.org Community Enterprise  enabled:      147\nelrepo-extras                 ELRepo.org Community Enterprise  enabled:       19\nelrepo-kernel                 ELRepo.org Community Enterprise  enabled:       37\nelrepo-testing                ELRepo.org Community Enterprise  disabled\n// 这个源要开啊 EPEL仓库 相当多常用的软件都在里面\n// https://fedoraproject.org/\nepel/x86_64                   Extra Packages for Enterprise Li disabled\nepel-debuginfo/x86_64         Extra Packages for Enterprise Li disabled\nepel-source/x86_64            Extra Packages for Enterprise Li disabled\nepel-testing/x86_64           Extra Packages for Enterprise Li disabled\nepel-testing-debuginfo/x86_64 Extra Packages for Enterprise Li disabled\nepel-testing-source/x86_64    Extra Packages for Enterprise Li disabled\nextras/7/x86_64               CentOS-7 - Extras                enabled:      305\nextras-source/7               CentOS-7 - Extras Sources        disabled\nfasttrack/7/x86_64            CentOS-7 - fasttrack             disabled\nupdates/7/x86_64              CentOS-7 - Updates               enabled:    733+5\nupdates-source/7              CentOS-7 - Updates Sources       disabled\nrepolist: 11,337\n```\n\n## 命令 yum-config-manager [yum配置管理器]\n```text\nLoaded plugins: fastestmirror\nUsage: yum-config-manager [options] [section ...]\n\nOptions:\n  Plugin Options:\n\n  Yum Base Options:\n    -h, --help          show this help message and exit\n    -t, --tolerant      be tolerant of errors\n    // 完全从系统缓存运行，不更新缓存\n    -C, --cacheonly     run entirely from system cache, don't update cache\n    -c [config file], --config=[config file]\n                        config file location\n    -R [minutes], --randomwait=[minutes]\n                        maximum command wait time\n    -d [debug level], --debuglevel=[debug level]\n                        debugging output level\n    --showduplicates    show duplicates, in repos, in list/search commands\n    -e [error level], --errorlevel=[error level]\n                        error output level\n    --rpmverbosity=[debug level name]\n                        debugging output level for rpm\n    -q, --quiet         quiet operation\n    -v, --verbose       verbose operation\n    -y, --assumeyes     answer yes for all questions\n    --assumeno          answer no for all questions\n    --version           show Yum version and exit\n    --installroot=[path]\n                        set install root\n    --enablerepo=[repo]\n                        // 启用储存库\n                        enable one or more repositories (wildcards allowed)\n    --disablerepo=[repo]\n                        disable one or more repositories (wildcards allowed)\n    -x [package], --exclude=[package]\n                        exclude package(s) by name or glob\n    --disableexcludes=[repo]\n                        disable exclude from main, for a repo or for\n                        everything\n    --disableincludes=[repo]\n                        disable includepkgs for a repo or for everything\n    --obsoletes         enable obsoletes processing during updates\n    --noplugins         disable Yum plugins\n    --nogpgcheck        disable gpg signature checking\n    --disableplugin=[plugin]\n                        disable plugins by name\n    --enableplugin=[plugin]\n                        enable plugins by name\n    --skip-broken       skip packages with depsolving problems\n    --color=COLOR       control whether color is used\n    --releasever=RELEASEVER\n                        set value of $releasever in yum config and repo files\n    --downloadonly      don't update, just download\n    --downloaddir=DLDIR\n                        specifies an alternate directory to store packages\n    --setopt=SETOPTS    set arbitrary config and repo options\n    --bugfix            Include bugfix relevant packages, in updates\n    --security          Include security relevant packages, in updates\n    --advisory=ADVS, --advisories=ADVS\n                        Include packages needed to fix the given advisory, in\n                        updates\n    --bzs=BZS           Include packages needed to fix the given BZ, in\n                        updates\n    --cves=CVES         Include packages needed to fix the given CVE, in\n                        updates\n    --sec-severity=SEVS, --secseverity=SEVS\n                        Include security relevant packages matching the\n                        severity, in updates\n\n  yum-config-manager options:\n    // 保存当前设置\n    --save              save the current options (useful with --setopt)\n    // 启用仓库 (自动保存)\n    --enable            enable the specified repos (automatically saves)\n    // 禁用仓库 (自动保存)\n    --disable           disable the specified repos (automatically saves)\n    // 从文件或URL添加仓库 (并启用)\n    --add-repo=ADDREPO  add (and enable) the repo from the specified file or\n                        url\n\n```\n\n## 命令 yum\n\n```text\nLoaded plugins: fastestmirror\nUsage: yum [options] COMMAND\n\nList of Commands:\n\ncheck          Check for problems in the rpmdb\ncheck-update   Check for available package updates\nclean          Remove cached data\ndeplist        List a package's dependencies\ndistribution-synchronization Synchronize installed packages to the latest available versions\ndowngrade      downgrade a package\nerase          Remove a package or packages from your system\nfs             Acts on the filesystem data of the host, mainly for removing docs/lanuages for minimal hosts.\nfssnapshot     Creates filesystem snapshots, or lists/deletes current snapshots.\ngroups         Display, or use, the groups information\nhelp           Display a helpful usage message\nhistory        Display, or use, the transaction history\ninfo           Display details about a package or group of packages\ninstall        Install a package or packages on your system\nlist           List a package or groups of packages\nload-transaction load a saved transaction from filename\nmakecache      Generate the metadata cache\nprovides       Find what package provides the given value\nreinstall      reinstall a package\nrepo-pkgs      Treat a repo. as a group of packages, so we can install/remove all of them\nrepolist       Display the configured software repositories\nsearch         Search package details for the given string\nshell          Run an interactive yum shell\nswap           Simple way to swap packages, instead of using shell\nupdate         Update a package or packages on your system\nupdate-minimal Works like upgrade, but goes to the 'newest' package match which fixes a problem that affects your system\nupdateinfo     Acts on repository update information\nupgrade        Update packages taking obsoletes into account\nversion        Display a version for the machine and/or available repos.\n\n\nOptions:\n  -h, --help            show this help message and exit\n  -t, --tolerant        be tolerant of errors\n  -C, --cacheonly       run entirely from system cache, don't update cache\n  -c [config file], --config=[config file]\n                        config file location\n  -R [minutes], --randomwait=[minutes]\n                        maximum command wait time\n  -d [debug level], --debuglevel=[debug level]\n                        debugging output level\n  --showduplicates      show duplicates, in repos, in list/search commands\n  -e [error level], --errorlevel=[error level]\n                        error output level\n  --rpmverbosity=[debug level name]\n                        debugging output level for rpm\n  -q, --quiet           quiet operation\n  -v, --verbose         verbose operation\n  -y, --assumeyes       answer yes for all questions\n  --assumeno            answer no for all questions\n  --version             show Yum version and exit\n  --installroot=[path]  set install root\n  --enablerepo=[repo]   enable one or more repositories (wildcards allowed)\n  --disablerepo=[repo]  disable one or more repositories (wildcards allowed)\n  -x [package], --exclude=[package]\n                        exclude package(s) by name or glob\n  --disableexcludes=[repo]\n                        disable exclude from main, for a repo or for\n                        everything\n  --disableincludes=[repo]\n                        disable includepkgs for a repo or for everything\n  --obsoletes           enable obsoletes processing during updates\n  --noplugins           disable Yum plugins\n  --nogpgcheck          disable gpg signature checking\n  --disableplugin=[plugin]\n                        disable plugins by name\n  --enableplugin=[plugin]\n                        enable plugins by name\n  --skip-broken         skip packages with depsolving problems\n  --color=COLOR         control whether color is used\n  --releasever=RELEASEVER\n                        set value of $releasever in yum config and repo files\n  --downloadonly        don't update, just download\n  --downloaddir=DLDIR   specifies an alternate directory to store packages\n  --setopt=SETOPTS      set arbitrary config and repo options\n  --bugfix              Include bugfix relevant packages, in updates\n  --security            Include security relevant packages, in updates\n  --advisory=ADVS, --advisories=ADVS\n                        Include packages needed to fix the given advisory, in\n                        updates\n  --bzs=BZS             Include packages needed to fix the given BZ, in\n                        updates\n  --cves=CVES           Include packages needed to fix the given CVE, in\n                        updates\n  --sec-severity=SEVS, --secseverity=SEVS\n                        Include security relevant packages matching the\n                        severity, in updates\n\n  Plugin Options:\n\n```\n","slug":"[Centos]yum仓库配置及常用操作","published":1,"layout":"post","photos":[],"link":"","_id":"cktp91zka00034cowh9agbhqf","content":"<p>yum时不时抽风？仓库获取不到最新资源？先理解yum是怎么工作的吧！</p>\n<a id=\"more\"></a>\n<h2 id=\"常用的储存库\"><a href=\"#常用的储存库\" class=\"headerlink\" title=\"常用的储存库\"></a>常用的储存库</h2><h2 id=\"要注意的坑\"><a href=\"#要注意的坑\" class=\"headerlink\" title=\"要注意的坑\"></a>要注意的坑</h2><ul>\n<li>储存库要启用了才有效</li>\n<li><code>yum repo</code> 只能显示已启用的储存库 显示全部需要<code>yum repolist all</code></li>\n<li>如果使用<code>yum-config-manager</code>配置仓库一定要记得保存</li>\n<li>配置完后记得要<code>yum makecache</code>建立缓存，如果不放心可以先<code>yum clean all</code>清除所有缓存</li>\n</ul>\n<p>&gt; 上面的坑我全部踩了</p>\n<h2 id=\"命令-yum-repolist-all\"><a href=\"#命令-yum-repolist-all\" class=\"headerlink\" title=\"命令 yum repolist all\"></a>命令 yum repolist all</h2><pre><code class=\"text\">Loaded plugins: fastestmirror\nLoading mirror speeds from cached hostfile\n * base: mirror.scalabledns.com\n * elrepo: repos.lax-noc.com\n * elrepo-extras: repos.lax-noc.com\n * elrepo-kernel: repos.lax-noc.com\n * extras: repos-lax.psychz.net\n * updates: repos-lax.psychz.net\nrepo id                       repo name                        status\n// 这些仓库应该是系统升级时留下来的\nC7.0.1406-base/x86_64         CentOS-7.0.1406 - Base           disabled\nC7.0.1406-centosplus/x86_64   CentOS-7.0.1406 - CentOSPlus     disabled\nC7.0.1406-extras/x86_64       CentOS-7.0.1406 - Extras         disabled\nC7.0.1406-fasttrack/x86_64    CentOS-7.0.1406 - Fasttrack      disabled\nC7.0.1406-updates/x86_64      CentOS-7.0.1406 - Updates        disabled\nC7.1.1503-base/x86_64         CentOS-7.1.1503 - Base           disabled\nC7.1.1503-centosplus/x86_64   CentOS-7.1.1503 - CentOSPlus     disabled\nC7.1.1503-extras/x86_64       CentOS-7.1.1503 - Extras         disabled\nC7.1.1503-fasttrack/x86_64    CentOS-7.1.1503 - Fasttrack      disabled\nC7.1.1503-updates/x86_64      CentOS-7.1.1503 - Updates        disabled\nC7.2.1511-base/x86_64         CentOS-7.2.1511 - Base           disabled\nC7.2.1511-centosplus/x86_64   CentOS-7.2.1511 - CentOSPlus     disabled\nC7.2.1511-extras/x86_64       CentOS-7.2.1511 - Extras         disabled\nC7.2.1511-fasttrack/x86_64    CentOS-7.2.1511 - Fasttrack      disabled\nC7.2.1511-updates/x86_64      CentOS-7.2.1511 - Updates        disabled\nC7.3.1611-base/x86_64         CentOS-7.3.1611 - Base           disabled\nC7.3.1611-centosplus/x86_64   CentOS-7.3.1611 - CentOSPlus     disabled\nC7.3.1611-extras/x86_64       CentOS-7.3.1611 - Extras         disabled\nC7.3.1611-fasttrack/x86_64    CentOS-7.3.1611 - Fasttrack      disabled\nC7.3.1611-updates/x86_64      CentOS-7.3.1611 - Updates        disabled\nC7.4.1708-base/x86_64         CentOS-7.4.1708 - Base           disabled\nC7.4.1708-centosplus/x86_64   CentOS-7.4.1708 - CentOSPlus     disabled\nC7.4.1708-extras/x86_64       CentOS-7.4.1708 - Extras         disabled\nC7.4.1708-fasttrack/x86_64    CentOS-7.4.1708 - Fasttrack      disabled\nC7.4.1708-updates/x86_64      CentOS-7.4.1708 - Updates        disabled\nC7.5.1804-base/x86_64         CentOS-7.5.1804 - Base           disabled\nC7.5.1804-centosplus/x86_64   CentOS-7.5.1804 - CentOSPlus     disabled\nC7.5.1804-extras/x86_64       CentOS-7.5.1804 - Extras         disabled\nC7.5.1804-fasttrack/x86_64    CentOS-7.5.1804 - Fasttrack      disabled\nC7.5.1804-updates/x86_64      CentOS-7.5.1804 - Updates        disabled\nC7.6.1810-base/x86_64         CentOS-7.6.1810 - Base           disabled\nC7.6.1810-centosplus/x86_64   CentOS-7.6.1810 - CentOSPlus     disabled\nC7.6.1810-extras/x86_64       CentOS-7.6.1810 - Extras         disabled\nC7.6.1810-fasttrack/x86_64    CentOS-7.6.1810 - Fasttrack      disabled\nC7.6.1810-updates/x86_64      CentOS-7.6.1810 - Updates        disabled\n// centos7核心库 源码库和开发库的源就不开了\nbase/7/x86_64                 CentOS-7 - Base                  enabled: 10,096+1\nbase-debuginfo/x86_64         CentOS-7 - Debuginfo             disabled\nbase-source/7                 CentOS-7 - Base Sources          disabled\n// 看上去是多媒体相关的库 没桌面环境应该是用不上了\nc7-media                      CentOS-7 - Media                 disabled\n// 这个源主要是用来替换base源的，其中有不少包是base源的增强版\n// 但是如果开启这个源部分包可能会于base冲突 \n// 需要在base源中exclude 或者使用yum-plugin-priorities插件来保证兼容性\n// 引用WIKI: https://wiki.centos.org/zh/AdditionalResources/Repositories/CentOSPlus\ncentosplus/7/x86_64           CentOS-7 - Plus                  disabled\ncentosplus-source/7           CentOS-7 - Plus Sources          disabled\n// cr = Continuous Release 下次发布内容 相当于beta版了\ncr/7/x86_64                   CentOS-7 - cr                    disabled\n// elrepo = The Community Enterprise Linux Repository\n// http://elrepo.org 从描述中可以看出是驱动包 如果有UI可能要开\nelrepo                        ELRepo.org Community Enterprise  enabled:      147\nelrepo-extras                 ELRepo.org Community Enterprise  enabled:       19\nelrepo-kernel                 ELRepo.org Community Enterprise  enabled:       37\nelrepo-testing                ELRepo.org Community Enterprise  disabled\n// 这个源要开啊 EPEL仓库 相当多常用的软件都在里面\n// https://fedoraproject.org/\nepel/x86_64                   Extra Packages for Enterprise Li disabled\nepel-debuginfo/x86_64         Extra Packages for Enterprise Li disabled\nepel-source/x86_64            Extra Packages for Enterprise Li disabled\nepel-testing/x86_64           Extra Packages for Enterprise Li disabled\nepel-testing-debuginfo/x86_64 Extra Packages for Enterprise Li disabled\nepel-testing-source/x86_64    Extra Packages for Enterprise Li disabled\nextras/7/x86_64               CentOS-7 - Extras                enabled:      305\nextras-source/7               CentOS-7 - Extras Sources        disabled\nfasttrack/7/x86_64            CentOS-7 - fasttrack             disabled\nupdates/7/x86_64              CentOS-7 - Updates               enabled:    733+5\nupdates-source/7              CentOS-7 - Updates Sources       disabled\nrepolist: 11,337</code></pre>\n<h2 id=\"命令-yum-config-manager-yum配置管理器\"><a href=\"#命令-yum-config-manager-yum配置管理器\" class=\"headerlink\" title=\"命令 yum-config-manager [yum配置管理器]\"></a>命令 yum-config-manager [yum配置管理器]</h2><pre><code class=\"text\">Loaded plugins: fastestmirror\nUsage: yum-config-manager [options] [section ...]\n\nOptions:\n  Plugin Options:\n\n  Yum Base Options:\n    -h, --help          show this help message and exit\n    -t, --tolerant      be tolerant of errors\n    // 完全从系统缓存运行，不更新缓存\n    -C, --cacheonly     run entirely from system cache, don&#39;t update cache\n    -c [config file], --config=[config file]\n                        config file location\n    -R [minutes], --randomwait=[minutes]\n                        maximum command wait time\n    -d [debug level], --debuglevel=[debug level]\n                        debugging output level\n    --showduplicates    show duplicates, in repos, in list/search commands\n    -e [error level], --errorlevel=[error level]\n                        error output level\n    --rpmverbosity=[debug level name]\n                        debugging output level for rpm\n    -q, --quiet         quiet operation\n    -v, --verbose       verbose operation\n    -y, --assumeyes     answer yes for all questions\n    --assumeno          answer no for all questions\n    --version           show Yum version and exit\n    --installroot=[path]\n                        set install root\n    --enablerepo=[repo]\n                        // 启用储存库\n                        enable one or more repositories (wildcards allowed)\n    --disablerepo=[repo]\n                        disable one or more repositories (wildcards allowed)\n    -x [package], --exclude=[package]\n                        exclude package(s) by name or glob\n    --disableexcludes=[repo]\n                        disable exclude from main, for a repo or for\n                        everything\n    --disableincludes=[repo]\n                        disable includepkgs for a repo or for everything\n    --obsoletes         enable obsoletes processing during updates\n    --noplugins         disable Yum plugins\n    --nogpgcheck        disable gpg signature checking\n    --disableplugin=[plugin]\n                        disable plugins by name\n    --enableplugin=[plugin]\n                        enable plugins by name\n    --skip-broken       skip packages with depsolving problems\n    --color=COLOR       control whether color is used\n    --releasever=RELEASEVER\n                        set value of $releasever in yum config and repo files\n    --downloadonly      don&#39;t update, just download\n    --downloaddir=DLDIR\n                        specifies an alternate directory to store packages\n    --setopt=SETOPTS    set arbitrary config and repo options\n    --bugfix            Include bugfix relevant packages, in updates\n    --security          Include security relevant packages, in updates\n    --advisory=ADVS, --advisories=ADVS\n                        Include packages needed to fix the given advisory, in\n                        updates\n    --bzs=BZS           Include packages needed to fix the given BZ, in\n                        updates\n    --cves=CVES         Include packages needed to fix the given CVE, in\n                        updates\n    --sec-severity=SEVS, --secseverity=SEVS\n                        Include security relevant packages matching the\n                        severity, in updates\n\n  yum-config-manager options:\n    // 保存当前设置\n    --save              save the current options (useful with --setopt)\n    // 启用仓库 (自动保存)\n    --enable            enable the specified repos (automatically saves)\n    // 禁用仓库 (自动保存)\n    --disable           disable the specified repos (automatically saves)\n    // 从文件或URL添加仓库 (并启用)\n    --add-repo=ADDREPO  add (and enable) the repo from the specified file or\n                        url\n</code></pre>\n<h2 id=\"命令-yum\"><a href=\"#命令-yum\" class=\"headerlink\" title=\"命令 yum\"></a>命令 yum</h2><pre><code class=\"text\">Loaded plugins: fastestmirror\nUsage: yum [options] COMMAND\n\nList of Commands:\n\ncheck          Check for problems in the rpmdb\ncheck-update   Check for available package updates\nclean          Remove cached data\ndeplist        List a package&#39;s dependencies\ndistribution-synchronization Synchronize installed packages to the latest available versions\ndowngrade      downgrade a package\nerase          Remove a package or packages from your system\nfs             Acts on the filesystem data of the host, mainly for removing docs/lanuages for minimal hosts.\nfssnapshot     Creates filesystem snapshots, or lists/deletes current snapshots.\ngroups         Display, or use, the groups information\nhelp           Display a helpful usage message\nhistory        Display, or use, the transaction history\ninfo           Display details about a package or group of packages\ninstall        Install a package or packages on your system\nlist           List a package or groups of packages\nload-transaction load a saved transaction from filename\nmakecache      Generate the metadata cache\nprovides       Find what package provides the given value\nreinstall      reinstall a package\nrepo-pkgs      Treat a repo. as a group of packages, so we can install/remove all of them\nrepolist       Display the configured software repositories\nsearch         Search package details for the given string\nshell          Run an interactive yum shell\nswap           Simple way to swap packages, instead of using shell\nupdate         Update a package or packages on your system\nupdate-minimal Works like upgrade, but goes to the &#39;newest&#39; package match which fixes a problem that affects your system\nupdateinfo     Acts on repository update information\nupgrade        Update packages taking obsoletes into account\nversion        Display a version for the machine and/or available repos.\n\n\nOptions:\n  -h, --help            show this help message and exit\n  -t, --tolerant        be tolerant of errors\n  -C, --cacheonly       run entirely from system cache, don&#39;t update cache\n  -c [config file], --config=[config file]\n                        config file location\n  -R [minutes], --randomwait=[minutes]\n                        maximum command wait time\n  -d [debug level], --debuglevel=[debug level]\n                        debugging output level\n  --showduplicates      show duplicates, in repos, in list/search commands\n  -e [error level], --errorlevel=[error level]\n                        error output level\n  --rpmverbosity=[debug level name]\n                        debugging output level for rpm\n  -q, --quiet           quiet operation\n  -v, --verbose         verbose operation\n  -y, --assumeyes       answer yes for all questions\n  --assumeno            answer no for all questions\n  --version             show Yum version and exit\n  --installroot=[path]  set install root\n  --enablerepo=[repo]   enable one or more repositories (wildcards allowed)\n  --disablerepo=[repo]  disable one or more repositories (wildcards allowed)\n  -x [package], --exclude=[package]\n                        exclude package(s) by name or glob\n  --disableexcludes=[repo]\n                        disable exclude from main, for a repo or for\n                        everything\n  --disableincludes=[repo]\n                        disable includepkgs for a repo or for everything\n  --obsoletes           enable obsoletes processing during updates\n  --noplugins           disable Yum plugins\n  --nogpgcheck          disable gpg signature checking\n  --disableplugin=[plugin]\n                        disable plugins by name\n  --enableplugin=[plugin]\n                        enable plugins by name\n  --skip-broken         skip packages with depsolving problems\n  --color=COLOR         control whether color is used\n  --releasever=RELEASEVER\n                        set value of $releasever in yum config and repo files\n  --downloadonly        don&#39;t update, just download\n  --downloaddir=DLDIR   specifies an alternate directory to store packages\n  --setopt=SETOPTS      set arbitrary config and repo options\n  --bugfix              Include bugfix relevant packages, in updates\n  --security            Include security relevant packages, in updates\n  --advisory=ADVS, --advisories=ADVS\n                        Include packages needed to fix the given advisory, in\n                        updates\n  --bzs=BZS             Include packages needed to fix the given BZ, in\n                        updates\n  --cves=CVES           Include packages needed to fix the given CVE, in\n                        updates\n  --sec-severity=SEVS, --secseverity=SEVS\n                        Include security relevant packages matching the\n                        severity, in updates\n\n  Plugin Options:\n</code></pre>\n","site":{"data":{}},"excerpt":"<p>yum时不时抽风？仓库获取不到最新资源？先理解yum是怎么工作的吧！</p>","more":"<h2 id=\"常用的储存库\"><a href=\"#常用的储存库\" class=\"headerlink\" title=\"常用的储存库\"></a>常用的储存库</h2><h2 id=\"要注意的坑\"><a href=\"#要注意的坑\" class=\"headerlink\" title=\"要注意的坑\"></a>要注意的坑</h2><ul>\n<li>储存库要启用了才有效</li>\n<li><code>yum repo</code> 只能显示已启用的储存库 显示全部需要<code>yum repolist all</code></li>\n<li>如果使用<code>yum-config-manager</code>配置仓库一定要记得保存</li>\n<li>配置完后记得要<code>yum makecache</code>建立缓存，如果不放心可以先<code>yum clean all</code>清除所有缓存</li>\n</ul>\n<p>&gt; 上面的坑我全部踩了</p>\n<h2 id=\"命令-yum-repolist-all\"><a href=\"#命令-yum-repolist-all\" class=\"headerlink\" title=\"命令 yum repolist all\"></a>命令 yum repolist all</h2><pre><code class=\"text\">Loaded plugins: fastestmirror\nLoading mirror speeds from cached hostfile\n * base: mirror.scalabledns.com\n * elrepo: repos.lax-noc.com\n * elrepo-extras: repos.lax-noc.com\n * elrepo-kernel: repos.lax-noc.com\n * extras: repos-lax.psychz.net\n * updates: repos-lax.psychz.net\nrepo id                       repo name                        status\n// 这些仓库应该是系统升级时留下来的\nC7.0.1406-base/x86_64         CentOS-7.0.1406 - Base           disabled\nC7.0.1406-centosplus/x86_64   CentOS-7.0.1406 - CentOSPlus     disabled\nC7.0.1406-extras/x86_64       CentOS-7.0.1406 - Extras         disabled\nC7.0.1406-fasttrack/x86_64    CentOS-7.0.1406 - Fasttrack      disabled\nC7.0.1406-updates/x86_64      CentOS-7.0.1406 - Updates        disabled\nC7.1.1503-base/x86_64         CentOS-7.1.1503 - Base           disabled\nC7.1.1503-centosplus/x86_64   CentOS-7.1.1503 - CentOSPlus     disabled\nC7.1.1503-extras/x86_64       CentOS-7.1.1503 - Extras         disabled\nC7.1.1503-fasttrack/x86_64    CentOS-7.1.1503 - Fasttrack      disabled\nC7.1.1503-updates/x86_64      CentOS-7.1.1503 - Updates        disabled\nC7.2.1511-base/x86_64         CentOS-7.2.1511 - Base           disabled\nC7.2.1511-centosplus/x86_64   CentOS-7.2.1511 - CentOSPlus     disabled\nC7.2.1511-extras/x86_64       CentOS-7.2.1511 - Extras         disabled\nC7.2.1511-fasttrack/x86_64    CentOS-7.2.1511 - Fasttrack      disabled\nC7.2.1511-updates/x86_64      CentOS-7.2.1511 - Updates        disabled\nC7.3.1611-base/x86_64         CentOS-7.3.1611 - Base           disabled\nC7.3.1611-centosplus/x86_64   CentOS-7.3.1611 - CentOSPlus     disabled\nC7.3.1611-extras/x86_64       CentOS-7.3.1611 - Extras         disabled\nC7.3.1611-fasttrack/x86_64    CentOS-7.3.1611 - Fasttrack      disabled\nC7.3.1611-updates/x86_64      CentOS-7.3.1611 - Updates        disabled\nC7.4.1708-base/x86_64         CentOS-7.4.1708 - Base           disabled\nC7.4.1708-centosplus/x86_64   CentOS-7.4.1708 - CentOSPlus     disabled\nC7.4.1708-extras/x86_64       CentOS-7.4.1708 - Extras         disabled\nC7.4.1708-fasttrack/x86_64    CentOS-7.4.1708 - Fasttrack      disabled\nC7.4.1708-updates/x86_64      CentOS-7.4.1708 - Updates        disabled\nC7.5.1804-base/x86_64         CentOS-7.5.1804 - Base           disabled\nC7.5.1804-centosplus/x86_64   CentOS-7.5.1804 - CentOSPlus     disabled\nC7.5.1804-extras/x86_64       CentOS-7.5.1804 - Extras         disabled\nC7.5.1804-fasttrack/x86_64    CentOS-7.5.1804 - Fasttrack      disabled\nC7.5.1804-updates/x86_64      CentOS-7.5.1804 - Updates        disabled\nC7.6.1810-base/x86_64         CentOS-7.6.1810 - Base           disabled\nC7.6.1810-centosplus/x86_64   CentOS-7.6.1810 - CentOSPlus     disabled\nC7.6.1810-extras/x86_64       CentOS-7.6.1810 - Extras         disabled\nC7.6.1810-fasttrack/x86_64    CentOS-7.6.1810 - Fasttrack      disabled\nC7.6.1810-updates/x86_64      CentOS-7.6.1810 - Updates        disabled\n// centos7核心库 源码库和开发库的源就不开了\nbase/7/x86_64                 CentOS-7 - Base                  enabled: 10,096+1\nbase-debuginfo/x86_64         CentOS-7 - Debuginfo             disabled\nbase-source/7                 CentOS-7 - Base Sources          disabled\n// 看上去是多媒体相关的库 没桌面环境应该是用不上了\nc7-media                      CentOS-7 - Media                 disabled\n// 这个源主要是用来替换base源的，其中有不少包是base源的增强版\n// 但是如果开启这个源部分包可能会于base冲突 \n// 需要在base源中exclude 或者使用yum-plugin-priorities插件来保证兼容性\n// 引用WIKI: https://wiki.centos.org/zh/AdditionalResources/Repositories/CentOSPlus\ncentosplus/7/x86_64           CentOS-7 - Plus                  disabled\ncentosplus-source/7           CentOS-7 - Plus Sources          disabled\n// cr = Continuous Release 下次发布内容 相当于beta版了\ncr/7/x86_64                   CentOS-7 - cr                    disabled\n// elrepo = The Community Enterprise Linux Repository\n// http://elrepo.org 从描述中可以看出是驱动包 如果有UI可能要开\nelrepo                        ELRepo.org Community Enterprise  enabled:      147\nelrepo-extras                 ELRepo.org Community Enterprise  enabled:       19\nelrepo-kernel                 ELRepo.org Community Enterprise  enabled:       37\nelrepo-testing                ELRepo.org Community Enterprise  disabled\n// 这个源要开啊 EPEL仓库 相当多常用的软件都在里面\n// https://fedoraproject.org/\nepel/x86_64                   Extra Packages for Enterprise Li disabled\nepel-debuginfo/x86_64         Extra Packages for Enterprise Li disabled\nepel-source/x86_64            Extra Packages for Enterprise Li disabled\nepel-testing/x86_64           Extra Packages for Enterprise Li disabled\nepel-testing-debuginfo/x86_64 Extra Packages for Enterprise Li disabled\nepel-testing-source/x86_64    Extra Packages for Enterprise Li disabled\nextras/7/x86_64               CentOS-7 - Extras                enabled:      305\nextras-source/7               CentOS-7 - Extras Sources        disabled\nfasttrack/7/x86_64            CentOS-7 - fasttrack             disabled\nupdates/7/x86_64              CentOS-7 - Updates               enabled:    733+5\nupdates-source/7              CentOS-7 - Updates Sources       disabled\nrepolist: 11,337</code></pre>\n<h2 id=\"命令-yum-config-manager-yum配置管理器\"><a href=\"#命令-yum-config-manager-yum配置管理器\" class=\"headerlink\" title=\"命令 yum-config-manager [yum配置管理器]\"></a>命令 yum-config-manager [yum配置管理器]</h2><pre><code class=\"text\">Loaded plugins: fastestmirror\nUsage: yum-config-manager [options] [section ...]\n\nOptions:\n  Plugin Options:\n\n  Yum Base Options:\n    -h, --help          show this help message and exit\n    -t, --tolerant      be tolerant of errors\n    // 完全从系统缓存运行，不更新缓存\n    -C, --cacheonly     run entirely from system cache, don&#39;t update cache\n    -c [config file], --config=[config file]\n                        config file location\n    -R [minutes], --randomwait=[minutes]\n                        maximum command wait time\n    -d [debug level], --debuglevel=[debug level]\n                        debugging output level\n    --showduplicates    show duplicates, in repos, in list/search commands\n    -e [error level], --errorlevel=[error level]\n                        error output level\n    --rpmverbosity=[debug level name]\n                        debugging output level for rpm\n    -q, --quiet         quiet operation\n    -v, --verbose       verbose operation\n    -y, --assumeyes     answer yes for all questions\n    --assumeno          answer no for all questions\n    --version           show Yum version and exit\n    --installroot=[path]\n                        set install root\n    --enablerepo=[repo]\n                        // 启用储存库\n                        enable one or more repositories (wildcards allowed)\n    --disablerepo=[repo]\n                        disable one or more repositories (wildcards allowed)\n    -x [package], --exclude=[package]\n                        exclude package(s) by name or glob\n    --disableexcludes=[repo]\n                        disable exclude from main, for a repo or for\n                        everything\n    --disableincludes=[repo]\n                        disable includepkgs for a repo or for everything\n    --obsoletes         enable obsoletes processing during updates\n    --noplugins         disable Yum plugins\n    --nogpgcheck        disable gpg signature checking\n    --disableplugin=[plugin]\n                        disable plugins by name\n    --enableplugin=[plugin]\n                        enable plugins by name\n    --skip-broken       skip packages with depsolving problems\n    --color=COLOR       control whether color is used\n    --releasever=RELEASEVER\n                        set value of $releasever in yum config and repo files\n    --downloadonly      don&#39;t update, just download\n    --downloaddir=DLDIR\n                        specifies an alternate directory to store packages\n    --setopt=SETOPTS    set arbitrary config and repo options\n    --bugfix            Include bugfix relevant packages, in updates\n    --security          Include security relevant packages, in updates\n    --advisory=ADVS, --advisories=ADVS\n                        Include packages needed to fix the given advisory, in\n                        updates\n    --bzs=BZS           Include packages needed to fix the given BZ, in\n                        updates\n    --cves=CVES         Include packages needed to fix the given CVE, in\n                        updates\n    --sec-severity=SEVS, --secseverity=SEVS\n                        Include security relevant packages matching the\n                        severity, in updates\n\n  yum-config-manager options:\n    // 保存当前设置\n    --save              save the current options (useful with --setopt)\n    // 启用仓库 (自动保存)\n    --enable            enable the specified repos (automatically saves)\n    // 禁用仓库 (自动保存)\n    --disable           disable the specified repos (automatically saves)\n    // 从文件或URL添加仓库 (并启用)\n    --add-repo=ADDREPO  add (and enable) the repo from the specified file or\n                        url\n</code></pre>\n<h2 id=\"命令-yum\"><a href=\"#命令-yum\" class=\"headerlink\" title=\"命令 yum\"></a>命令 yum</h2><pre><code class=\"text\">Loaded plugins: fastestmirror\nUsage: yum [options] COMMAND\n\nList of Commands:\n\ncheck          Check for problems in the rpmdb\ncheck-update   Check for available package updates\nclean          Remove cached data\ndeplist        List a package&#39;s dependencies\ndistribution-synchronization Synchronize installed packages to the latest available versions\ndowngrade      downgrade a package\nerase          Remove a package or packages from your system\nfs             Acts on the filesystem data of the host, mainly for removing docs/lanuages for minimal hosts.\nfssnapshot     Creates filesystem snapshots, or lists/deletes current snapshots.\ngroups         Display, or use, the groups information\nhelp           Display a helpful usage message\nhistory        Display, or use, the transaction history\ninfo           Display details about a package or group of packages\ninstall        Install a package or packages on your system\nlist           List a package or groups of packages\nload-transaction load a saved transaction from filename\nmakecache      Generate the metadata cache\nprovides       Find what package provides the given value\nreinstall      reinstall a package\nrepo-pkgs      Treat a repo. as a group of packages, so we can install/remove all of them\nrepolist       Display the configured software repositories\nsearch         Search package details for the given string\nshell          Run an interactive yum shell\nswap           Simple way to swap packages, instead of using shell\nupdate         Update a package or packages on your system\nupdate-minimal Works like upgrade, but goes to the &#39;newest&#39; package match which fixes a problem that affects your system\nupdateinfo     Acts on repository update information\nupgrade        Update packages taking obsoletes into account\nversion        Display a version for the machine and/or available repos.\n\n\nOptions:\n  -h, --help            show this help message and exit\n  -t, --tolerant        be tolerant of errors\n  -C, --cacheonly       run entirely from system cache, don&#39;t update cache\n  -c [config file], --config=[config file]\n                        config file location\n  -R [minutes], --randomwait=[minutes]\n                        maximum command wait time\n  -d [debug level], --debuglevel=[debug level]\n                        debugging output level\n  --showduplicates      show duplicates, in repos, in list/search commands\n  -e [error level], --errorlevel=[error level]\n                        error output level\n  --rpmverbosity=[debug level name]\n                        debugging output level for rpm\n  -q, --quiet           quiet operation\n  -v, --verbose         verbose operation\n  -y, --assumeyes       answer yes for all questions\n  --assumeno            answer no for all questions\n  --version             show Yum version and exit\n  --installroot=[path]  set install root\n  --enablerepo=[repo]   enable one or more repositories (wildcards allowed)\n  --disablerepo=[repo]  disable one or more repositories (wildcards allowed)\n  -x [package], --exclude=[package]\n                        exclude package(s) by name or glob\n  --disableexcludes=[repo]\n                        disable exclude from main, for a repo or for\n                        everything\n  --disableincludes=[repo]\n                        disable includepkgs for a repo or for everything\n  --obsoletes           enable obsoletes processing during updates\n  --noplugins           disable Yum plugins\n  --nogpgcheck          disable gpg signature checking\n  --disableplugin=[plugin]\n                        disable plugins by name\n  --enableplugin=[plugin]\n                        enable plugins by name\n  --skip-broken         skip packages with depsolving problems\n  --color=COLOR         control whether color is used\n  --releasever=RELEASEVER\n                        set value of $releasever in yum config and repo files\n  --downloadonly        don&#39;t update, just download\n  --downloaddir=DLDIR   specifies an alternate directory to store packages\n  --setopt=SETOPTS      set arbitrary config and repo options\n  --bugfix              Include bugfix relevant packages, in updates\n  --security            Include security relevant packages, in updates\n  --advisory=ADVS, --advisories=ADVS\n                        Include packages needed to fix the given advisory, in\n                        updates\n  --bzs=BZS             Include packages needed to fix the given BZ, in\n                        updates\n  --cves=CVES           Include packages needed to fix the given CVE, in\n                        updates\n  --sec-severity=SEVS, --secseverity=SEVS\n                        Include security relevant packages matching the\n                        severity, in updates\n\n  Plugin Options:\n</code></pre>"},{"title":"Hexo部署GitMent评论","date":"2018-12-23T03:02:53.000Z","updated":"2020-02-20T07:41:36.000Z","comments":1,"_content":"\n之前还没换主题的时候就是这样手动配置的，现在gitment都没人用了git-talk比较方便\n<!--more-->\n\n# GitMent简介 #\n  Gitment是一个基于GitHub Issues的评论系统，他使用一个Github Repository的Issues区作为评论的存储区。支持在前端直接引入，不需要任何后端代码。可以在页面进行登录、查看、评论、点赞等操作，同时有完整的 Markdown / GFM 和代码高亮支持。尤为适合各种基于 GitHub Pages 的静态博客或项目页面。<!-- more -->\n\n### Initialize Comments 时提示 Error: Validation Failed ### \n\n\n###### 出现问题 ###### \n\n  部署完成后点击初始化按钮后alert:\"Error: Validation Failed\" \n![图1.Error: Validation Failed](https://www.dreamccc.club/hexo/images/pasted-3.png)\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图1.Error: Validation Failed</span></center>\n\n###### 查询资料 ######\n\n  首先查阅了一下资料,找到了 [GitMent的issues](https://github.com/imsun/gitment/issues/118) ：\n &gt; 地址 https://github.com/imsun/gitment/issues/118\n\n###### 原因分析 ######\n\n  GitHub Issues中新建label时LabelName长度不能超过50，但是在GitMent中是以页面url(window.location.pathname)作为唯一标识来创建Label的，当我们以中文作为文章标题时，中文将被转义，转义后的url超过了50字符长度的限制，引起报错。\n\n![图2.LabelName长度过长](https://www.dreamccc.club/hexo/images/pasted-7.png)\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图2.LabelName长度过长</span></center>\n\n解决方式：\n 1. 缩短标题长度，并尽量少用中文标题\n 2. 寻找较短的具有唯一性的参数作为Issues的LabelName\n \n \n![图3.参数替换前后对比](https://www.dreamccc.club/hexo/images/pasted-4.png)\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图3.参数替换前后对比</span></center>\n \n很明显只能寻找其他参数来代替URL作为ID了，在这里我们使用网页标题（document.title）作为ID。\n\n\n###### 错误修正&nbsp;#######\n\n** hexo-theme-yilia主题 ** <br/>\n  该主题的gitment配置文件位于${hexo_root}/themes/hexo-theme-yilia/layout/_partial/post下\n\n修改gitment.ejs:\n![图4.gitment.ejs](https://www.dreamccc.club/hexo/images/pasted-9.png)\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图4.gitment.ejs</span></center>\n\n** hexo-theme-next主题 ** <br/>\n  该主题的gitment配置文件位于${hexo_root}/themes/hexo-theme-next/layout/_third-party/comments下\n\n修改gitment.swig:\n![图5.gitment.swig](https://www.dreamccc.club/hexo/images/pasted-8.png)\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图5.gitment.swig</span></center>\n\n###### 效果一览 ######\n\n  修改后成功初始化，Issus中出现了对应文章的记录，blog中可以正常的发布评论了。\n\n![图6.GitMent效果](https://www.dreamccc.club/hexo/images/pasted-10.png)\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图6.GitMent效果</span></center>\n\n\n![图7.GitHub效果](https://www.dreamccc.club/hexo/images/pasted-11.png)\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图7.GitHub效果</span></center></pre></en-note>\n","source":"_posts/Hexo部署GitMent评论.md","raw":"---\ntitle: 'Hexo部署GitMent评论'\ndate: 2018/12/23 11:02:53\nupdated: 2020/2/20 15:41:36\ncomments: true\ncategories: \n    - [搞点骚操作]\ntags: \n    - blog\n---\n\n之前还没换主题的时候就是这样手动配置的，现在gitment都没人用了git-talk比较方便\n<!--more-->\n\n# GitMent简介 #\n  Gitment是一个基于GitHub Issues的评论系统，他使用一个Github Repository的Issues区作为评论的存储区。支持在前端直接引入，不需要任何后端代码。可以在页面进行登录、查看、评论、点赞等操作，同时有完整的 Markdown / GFM 和代码高亮支持。尤为适合各种基于 GitHub Pages 的静态博客或项目页面。<!-- more -->\n\n### Initialize Comments 时提示 Error: Validation Failed ### \n\n\n###### 出现问题 ###### \n\n  部署完成后点击初始化按钮后alert:\"Error: Validation Failed\" \n![图1.Error: Validation Failed](https://www.dreamccc.club/hexo/images/pasted-3.png)\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图1.Error: Validation Failed</span></center>\n\n###### 查询资料 ######\n\n  首先查阅了一下资料,找到了 [GitMent的issues](https://github.com/imsun/gitment/issues/118) ：\n &gt; 地址 https://github.com/imsun/gitment/issues/118\n\n###### 原因分析 ######\n\n  GitHub Issues中新建label时LabelName长度不能超过50，但是在GitMent中是以页面url(window.location.pathname)作为唯一标识来创建Label的，当我们以中文作为文章标题时，中文将被转义，转义后的url超过了50字符长度的限制，引起报错。\n\n![图2.LabelName长度过长](https://www.dreamccc.club/hexo/images/pasted-7.png)\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图2.LabelName长度过长</span></center>\n\n解决方式：\n 1. 缩短标题长度，并尽量少用中文标题\n 2. 寻找较短的具有唯一性的参数作为Issues的LabelName\n \n \n![图3.参数替换前后对比](https://www.dreamccc.club/hexo/images/pasted-4.png)\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图3.参数替换前后对比</span></center>\n \n很明显只能寻找其他参数来代替URL作为ID了，在这里我们使用网页标题（document.title）作为ID。\n\n\n###### 错误修正&nbsp;#######\n\n** hexo-theme-yilia主题 ** <br/>\n  该主题的gitment配置文件位于${hexo_root}/themes/hexo-theme-yilia/layout/_partial/post下\n\n修改gitment.ejs:\n![图4.gitment.ejs](https://www.dreamccc.club/hexo/images/pasted-9.png)\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图4.gitment.ejs</span></center>\n\n** hexo-theme-next主题 ** <br/>\n  该主题的gitment配置文件位于${hexo_root}/themes/hexo-theme-next/layout/_third-party/comments下\n\n修改gitment.swig:\n![图5.gitment.swig](https://www.dreamccc.club/hexo/images/pasted-8.png)\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图5.gitment.swig</span></center>\n\n###### 效果一览 ######\n\n  修改后成功初始化，Issus中出现了对应文章的记录，blog中可以正常的发布评论了。\n\n![图6.GitMent效果](https://www.dreamccc.club/hexo/images/pasted-10.png)\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图6.GitMent效果</span></center>\n\n\n![图7.GitHub效果](https://www.dreamccc.club/hexo/images/pasted-11.png)\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图7.GitHub效果</span></center></pre></en-note>\n","slug":"Hexo部署GitMent评论","published":1,"layout":"post","photos":[],"link":"","_id":"cktp91zke00054cow31paan0u","content":"<p>之前还没换主题的时候就是这样手动配置的，现在gitment都没人用了git-talk比较方便</p>\n<a id=\"more\"></a>\n\n<h1 id=\"GitMent简介\"><a href=\"#GitMent简介\" class=\"headerlink\" title=\"GitMent简介\"></a>GitMent简介</h1><p>  Gitment是一个基于GitHub Issues的评论系统，他使用一个Github Repository的Issues区作为评论的存储区。支持在前端直接引入，不需要任何后端代码。可以在页面进行登录、查看、评论、点赞等操作，同时有完整的 Markdown / GFM 和代码高亮支持。尤为适合各种基于 GitHub Pages 的静态博客或项目页面。<!-- more --></p>\n<h3 id=\"Initialize-Comments-时提示-Error-Validation-Failed\"><a href=\"#Initialize-Comments-时提示-Error-Validation-Failed\" class=\"headerlink\" title=\"Initialize Comments 时提示 Error: Validation Failed\"></a>Initialize Comments 时提示 Error: Validation Failed</h3><h6 id=\"出现问题\"><a href=\"#出现问题\" class=\"headerlink\" title=\"出现问题\"></a>出现问题</h6><p>  部署完成后点击初始化按钮后alert:”Error: Validation Failed”<br><img src=\"https://www.dreamccc.club/hexo/images/pasted-3.png\" alt=\"图1.Error: Validation Failed\"></p>\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图1.Error: Validation Failed</span></center>\n\n<h6 id=\"查询资料\"><a href=\"#查询资料\" class=\"headerlink\" title=\"查询资料\"></a>查询资料</h6><p>  首先查阅了一下资料,找到了 <a href=\"https://github.com/imsun/gitment/issues/118\" target=\"_blank\" rel=\"noopener\">GitMent的issues</a> ：<br> &gt; 地址 <a href=\"https://github.com/imsun/gitment/issues/118\" target=\"_blank\" rel=\"noopener\">https://github.com/imsun/gitment/issues/118</a></p>\n<h6 id=\"原因分析\"><a href=\"#原因分析\" class=\"headerlink\" title=\"原因分析\"></a>原因分析</h6><p>  GitHub Issues中新建label时LabelName长度不能超过50，但是在GitMent中是以页面url(window.location.pathname)作为唯一标识来创建Label的，当我们以中文作为文章标题时，中文将被转义，转义后的url超过了50字符长度的限制，引起报错。</p>\n<p><img src=\"https://www.dreamccc.club/hexo/images/pasted-7.png\" alt=\"图2.LabelName长度过长\"></p>\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图2.LabelName长度过长</span></center>\n\n<p>解决方式：</p>\n<ol>\n<li>缩短标题长度，并尽量少用中文标题</li>\n<li>寻找较短的具有唯一性的参数作为Issues的LabelName</li>\n</ol>\n<p><img src=\"https://www.dreamccc.club/hexo/images/pasted-4.png\" alt=\"图3.参数替换前后对比\"></p>\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图3.参数替换前后对比</span></center>\n\n<p>很明显只能寻找其他参数来代替URL作为ID了，在这里我们使用网页标题（document.title）作为ID。</p>\n<h6 id=\"错误修正-nbsp\"><a href=\"#错误修正-nbsp\" class=\"headerlink\" title=\"错误修正&nbsp;#######\"></a>错误修正&nbsp;#######</h6><p>** hexo-theme-yilia主题 ** <br/><br>  该主题的gitment配置文件位于${hexo_root}/themes/hexo-theme-yilia/layout/_partial/post下</p>\n<p>修改gitment.ejs:<br><img src=\"https://www.dreamccc.club/hexo/images/pasted-9.png\" alt=\"图4.gitment.ejs\"></p>\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图4.gitment.ejs</span></center>\n\n<p>** hexo-theme-next主题 ** <br/><br>  该主题的gitment配置文件位于${hexo_root}/themes/hexo-theme-next/layout/_third-party/comments下</p>\n<p>修改gitment.swig:<br><img src=\"https://www.dreamccc.club/hexo/images/pasted-8.png\" alt=\"图5.gitment.swig\"></p>\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图5.gitment.swig</span></center>\n\n<h6 id=\"效果一览\"><a href=\"#效果一览\" class=\"headerlink\" title=\"效果一览\"></a>效果一览</h6><p>  修改后成功初始化，Issus中出现了对应文章的记录，blog中可以正常的发布评论了。</p>\n<p><img src=\"https://www.dreamccc.club/hexo/images/pasted-10.png\" alt=\"图6.GitMent效果\"></p>\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图6.GitMent效果</span></center>\n\n\n<p><img src=\"https://www.dreamccc.club/hexo/images/pasted-11.png\" alt=\"图7.GitHub效果\"></p>\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图7.GitHub效果</span></center></pre></en-note>\n","site":{"data":{}},"excerpt":"<p>之前还没换主题的时候就是这样手动配置的，现在gitment都没人用了git-talk比较方便</p>","more":"<h1 id=\"GitMent简介\"><a href=\"#GitMent简介\" class=\"headerlink\" title=\"GitMent简介\"></a>GitMent简介</h1><p>  Gitment是一个基于GitHub Issues的评论系统，他使用一个Github Repository的Issues区作为评论的存储区。支持在前端直接引入，不需要任何后端代码。可以在页面进行登录、查看、评论、点赞等操作，同时有完整的 Markdown / GFM 和代码高亮支持。尤为适合各种基于 GitHub Pages 的静态博客或项目页面。<!-- more --></p>\n<h3 id=\"Initialize-Comments-时提示-Error-Validation-Failed\"><a href=\"#Initialize-Comments-时提示-Error-Validation-Failed\" class=\"headerlink\" title=\"Initialize Comments 时提示 Error: Validation Failed\"></a>Initialize Comments 时提示 Error: Validation Failed</h3><h6 id=\"出现问题\"><a href=\"#出现问题\" class=\"headerlink\" title=\"出现问题\"></a>出现问题</h6><p>  部署完成后点击初始化按钮后alert:”Error: Validation Failed”<br><img src=\"https://www.dreamccc.club/hexo/images/pasted-3.png\" alt=\"图1.Error: Validation Failed\"></p>\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图1.Error: Validation Failed</span></center>\n\n<h6 id=\"查询资料\"><a href=\"#查询资料\" class=\"headerlink\" title=\"查询资料\"></a>查询资料</h6><p>  首先查阅了一下资料,找到了 <a href=\"https://github.com/imsun/gitment/issues/118\" target=\"_blank\" rel=\"noopener\">GitMent的issues</a> ：<br> &gt; 地址 <a href=\"https://github.com/imsun/gitment/issues/118\" target=\"_blank\" rel=\"noopener\">https://github.com/imsun/gitment/issues/118</a></p>\n<h6 id=\"原因分析\"><a href=\"#原因分析\" class=\"headerlink\" title=\"原因分析\"></a>原因分析</h6><p>  GitHub Issues中新建label时LabelName长度不能超过50，但是在GitMent中是以页面url(window.location.pathname)作为唯一标识来创建Label的，当我们以中文作为文章标题时，中文将被转义，转义后的url超过了50字符长度的限制，引起报错。</p>\n<p><img src=\"https://www.dreamccc.club/hexo/images/pasted-7.png\" alt=\"图2.LabelName长度过长\"></p>\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图2.LabelName长度过长</span></center>\n\n<p>解决方式：</p>\n<ol>\n<li>缩短标题长度，并尽量少用中文标题</li>\n<li>寻找较短的具有唯一性的参数作为Issues的LabelName</li>\n</ol>\n<p><img src=\"https://www.dreamccc.club/hexo/images/pasted-4.png\" alt=\"图3.参数替换前后对比\"></p>\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图3.参数替换前后对比</span></center>\n\n<p>很明显只能寻找其他参数来代替URL作为ID了，在这里我们使用网页标题（document.title）作为ID。</p>\n<h6 id=\"错误修正-nbsp\"><a href=\"#错误修正-nbsp\" class=\"headerlink\" title=\"错误修正&nbsp;#######\"></a>错误修正&nbsp;#######</h6><p>** hexo-theme-yilia主题 ** <br/><br>  该主题的gitment配置文件位于${hexo_root}/themes/hexo-theme-yilia/layout/_partial/post下</p>\n<p>修改gitment.ejs:<br><img src=\"https://www.dreamccc.club/hexo/images/pasted-9.png\" alt=\"图4.gitment.ejs\"></p>\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图4.gitment.ejs</span></center>\n\n<p>** hexo-theme-next主题 ** <br/><br>  该主题的gitment配置文件位于${hexo_root}/themes/hexo-theme-next/layout/_third-party/comments下</p>\n<p>修改gitment.swig:<br><img src=\"https://www.dreamccc.club/hexo/images/pasted-8.png\" alt=\"图5.gitment.swig\"></p>\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图5.gitment.swig</span></center>\n\n<h6 id=\"效果一览\"><a href=\"#效果一览\" class=\"headerlink\" title=\"效果一览\"></a>效果一览</h6><p>  修改后成功初始化，Issus中出现了对应文章的记录，blog中可以正常的发布评论了。</p>\n<p><img src=\"https://www.dreamccc.club/hexo/images/pasted-10.png\" alt=\"图6.GitMent效果\"></p>\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图6.GitMent效果</span></center>\n\n\n<p><img src=\"https://www.dreamccc.club/hexo/images/pasted-11.png\" alt=\"图7.GitHub效果\"></p>\n<center><span style=\"border-bottom: 1px solid #d9d9d9;color: #aaa;\">图7.GitHub效果</span></center></pre></en-note>"},{"title":"[MXCHIP-1]开发板到手","date":"2019-03-10T02:16:56.000Z","cover":"/2019/03/10/%5BMXCHIP-1%5D开发板到手/title_s.jpg","coverWidth":1210,"coverHeight":905,"_content":"\n这是一个从没玩过单片机开发的菜鸡闲暇时间瞎折腾的故事\n\n起因是18年斐讯出事的时候炒了一波底，买回来一堆斐讯的设备，以tc1插线盒居多，但是随着斐讯线上服务的关闭，这些原本的智能插线盒变得不智能了，正好网上有网友开发了一波TC1的固件，正好自己也挺感兴趣，便开始折腾起了这些玩意儿。\n\n<!--more-->\n\n\n #### 作案工具\n\n{% asset_img 1_s.jpg [作案工具] %}\n\n - 庆科EMW3031开发板\n - 庆科EMW3165开发板\n - 庆科MICOKIT-EXT上层扩展板\n - USB转TTL工具\n - JLINK仿真器\n\n PS：3165和扩展板是在闲鱼直接50包邮收的，感觉赚得飞起。usb-ttl一开始不知道需要这个，反复看文档才发现差这玩意儿，5块的东西发了20的顺丰才送到。\n\n #### 开发生态\n\n 以前从来没玩过如此高大上的玩意儿，这次就算拿到手也是一脸蒙蔽，不知从何下手，入手自闲鱼也没有任何资料，只好先翻一翻庆科的官网看看。\n \n ###### 收集的部分有用的链接\n\n - [庆科官网](https://www.mxchip.com/)\n - [开发者中心](http://developer.mxchip.com/) \n - [官方论坛](http://mico.io/)\n - [开发者支持社区](http://bbs.mxchip.com/)\n\n #### 启动到bootloader\n\n ##### 物理接线\n\n{% asset_img 4_s.jpg [物理接线] %}\n\n```\n第一条接线 [用户串口] 对应驱动是USB-TTL的驱动 USB-SERIAL CH340\n  PC USB接口 =======> USB-TTL =======> 开发板UART接口\n                        |—— GND            |——  GND         \n                        |—— RXD            |——  TXD    \n                        |—— TXD            |——  RXD    \n                        |—— 5V0            |——  5V0    \n\n第二条接线 [调试串口] 对应驱动是开发板的驱动 USB Serial Port\n  PC USB接口 =======> 开发板microUsb接口 \n ```\n\nPS：这里也被卡了不少时间，原因就是不知道RXD和TXD需要反着接。官网文档里没有任何说明，我在USB-TTL的淘宝页面里找到的资料才提到这一点\n\n ##### 驱动管理\n\n首先，我完全是个门外汉，我猜测这两驱动的作用可能是一样的，以前的外围设备都是通过COM口和PC相连接的，现在的电脑都没有COM口，于是需要一个将COM口转为USB口的设备。\nUSB-TTL应该就是其中之一，所以才需要安装一个驱动来将USB口映射为虚拟的COM口供软件连接。至于开发板为何可以用microUsb直连电脑我猜测是开发板中内置了芯片来转换，因为我看了新平台`MXKIT`的说明文档，新平台中只需要一根线就可以同时接上两个接口，所以我做出了这个猜测。\n\n{% asset_img 3.jpg [驱动管理] %}\n\n\n ##### 软件连接\n\n[官网教程](http://developer.mxchip.com/handbooks/109)\n\n\n1. 先将开发版上的`MODULE SELECT`拨动到BootLoader启动模式，即BOOT=ON,STATUS=OFF。\n\n{% asset_img 5_s.jpg [软件连接] %}\n\n2. 在其[官网新文档的角落](https://mxchip.yuque.com/books/share/8ac5e519-671d-4444-a93d-20e0aadfc793/ombbz2)翻到了这个表格，根据表格内容在SecureCRT中建立连接\n\n| 型号  | Bootloader</br>MFG产测信息 | AT指令及透传      | 正常工作log</br>CLI调试命令 |\n| ------- | ---------------------- | ---------------------- | ----------------------- |\n| EMW3031 | Pin 9,Pin10,921600bps   | Pin 9,Pin10,115200bps | Pin21,Pin22,115200bps    |\n| EMW3060 | Pin 9,Pin10,921600bps   | Pin 9,Pin10,115200bps | Pin21,Pin22,115200bps    |\n| EMW3080 | Pin 9,Pin10,921600bps   | Pin 9,Pin10,115200bps | Pin21,Pin22,115200bps    |\n| EMW3162 | Pin22,Pin23,921600bps  | Pin22,Pin23,115200bps  | Pin14,Pin4,115200bps     |\n| EMW3165 | Pin29,Pin30,921600bps  | Pin29,Pin30,115200bps  | Pin8,Pin12,115200bps     |\n| EMW3166 | Pin29,Pin30,921600bps  | Pin29,Pin30,115200bps  | Pin8,Pin12,115200bps     |\n| EMW3239 | Pin29,Pin30,921600bps  | Pin29,Pin30,115200bps  | Pin8,Pin12,115200bps     |\n\n3. 建立好连接后点一下开发板上的restart重启一下就能能看到日志了,如下图左边是用户日志，来自于microUsb(COM4)，右边是调试日志，来自于usb-ttl(COM9)，平时的debug时的日志也都输出到这里。\n\n {% asset_img 6.jpg [Bootloader日志] %}\n \n \n \n 未完待续...........","source":"_posts/[MXCHIP-1]开发板到手.md","raw":"---\ntitle: \"[MXCHIP-1]开发板到手\"\ndate: 2019/3/10 10:16:56\ncategories: \n    - [我永远爱学习]\ntags: \n    - 单片机\n    - IOT\n    - C\ncover: /2019/03/10/%5BMXCHIP-1%5D开发板到手/title_s.jpg\ncoverWidth: 1210\ncoverHeight: 905\n---\n\n这是一个从没玩过单片机开发的菜鸡闲暇时间瞎折腾的故事\n\n起因是18年斐讯出事的时候炒了一波底，买回来一堆斐讯的设备，以tc1插线盒居多，但是随着斐讯线上服务的关闭，这些原本的智能插线盒变得不智能了，正好网上有网友开发了一波TC1的固件，正好自己也挺感兴趣，便开始折腾起了这些玩意儿。\n\n<!--more-->\n\n\n #### 作案工具\n\n{% asset_img 1_s.jpg [作案工具] %}\n\n - 庆科EMW3031开发板\n - 庆科EMW3165开发板\n - 庆科MICOKIT-EXT上层扩展板\n - USB转TTL工具\n - JLINK仿真器\n\n PS：3165和扩展板是在闲鱼直接50包邮收的，感觉赚得飞起。usb-ttl一开始不知道需要这个，反复看文档才发现差这玩意儿，5块的东西发了20的顺丰才送到。\n\n #### 开发生态\n\n 以前从来没玩过如此高大上的玩意儿，这次就算拿到手也是一脸蒙蔽，不知从何下手，入手自闲鱼也没有任何资料，只好先翻一翻庆科的官网看看。\n \n ###### 收集的部分有用的链接\n\n - [庆科官网](https://www.mxchip.com/)\n - [开发者中心](http://developer.mxchip.com/) \n - [官方论坛](http://mico.io/)\n - [开发者支持社区](http://bbs.mxchip.com/)\n\n #### 启动到bootloader\n\n ##### 物理接线\n\n{% asset_img 4_s.jpg [物理接线] %}\n\n```\n第一条接线 [用户串口] 对应驱动是USB-TTL的驱动 USB-SERIAL CH340\n  PC USB接口 =======> USB-TTL =======> 开发板UART接口\n                        |—— GND            |——  GND         \n                        |—— RXD            |——  TXD    \n                        |—— TXD            |——  RXD    \n                        |—— 5V0            |——  5V0    \n\n第二条接线 [调试串口] 对应驱动是开发板的驱动 USB Serial Port\n  PC USB接口 =======> 开发板microUsb接口 \n ```\n\nPS：这里也被卡了不少时间，原因就是不知道RXD和TXD需要反着接。官网文档里没有任何说明，我在USB-TTL的淘宝页面里找到的资料才提到这一点\n\n ##### 驱动管理\n\n首先，我完全是个门外汉，我猜测这两驱动的作用可能是一样的，以前的外围设备都是通过COM口和PC相连接的，现在的电脑都没有COM口，于是需要一个将COM口转为USB口的设备。\nUSB-TTL应该就是其中之一，所以才需要安装一个驱动来将USB口映射为虚拟的COM口供软件连接。至于开发板为何可以用microUsb直连电脑我猜测是开发板中内置了芯片来转换，因为我看了新平台`MXKIT`的说明文档，新平台中只需要一根线就可以同时接上两个接口，所以我做出了这个猜测。\n\n{% asset_img 3.jpg [驱动管理] %}\n\n\n ##### 软件连接\n\n[官网教程](http://developer.mxchip.com/handbooks/109)\n\n\n1. 先将开发版上的`MODULE SELECT`拨动到BootLoader启动模式，即BOOT=ON,STATUS=OFF。\n\n{% asset_img 5_s.jpg [软件连接] %}\n\n2. 在其[官网新文档的角落](https://mxchip.yuque.com/books/share/8ac5e519-671d-4444-a93d-20e0aadfc793/ombbz2)翻到了这个表格，根据表格内容在SecureCRT中建立连接\n\n| 型号  | Bootloader</br>MFG产测信息 | AT指令及透传      | 正常工作log</br>CLI调试命令 |\n| ------- | ---------------------- | ---------------------- | ----------------------- |\n| EMW3031 | Pin 9,Pin10,921600bps   | Pin 9,Pin10,115200bps | Pin21,Pin22,115200bps    |\n| EMW3060 | Pin 9,Pin10,921600bps   | Pin 9,Pin10,115200bps | Pin21,Pin22,115200bps    |\n| EMW3080 | Pin 9,Pin10,921600bps   | Pin 9,Pin10,115200bps | Pin21,Pin22,115200bps    |\n| EMW3162 | Pin22,Pin23,921600bps  | Pin22,Pin23,115200bps  | Pin14,Pin4,115200bps     |\n| EMW3165 | Pin29,Pin30,921600bps  | Pin29,Pin30,115200bps  | Pin8,Pin12,115200bps     |\n| EMW3166 | Pin29,Pin30,921600bps  | Pin29,Pin30,115200bps  | Pin8,Pin12,115200bps     |\n| EMW3239 | Pin29,Pin30,921600bps  | Pin29,Pin30,115200bps  | Pin8,Pin12,115200bps     |\n\n3. 建立好连接后点一下开发板上的restart重启一下就能能看到日志了,如下图左边是用户日志，来自于microUsb(COM4)，右边是调试日志，来自于usb-ttl(COM9)，平时的debug时的日志也都输出到这里。\n\n {% asset_img 6.jpg [Bootloader日志] %}\n \n \n \n 未完待续...........","slug":"[MXCHIP-1]开发板到手","published":1,"updated":"2020-08-07T03:28:33.740Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cktp91zkg00074cow5ox9bgp7","content":"<p>这是一个从没玩过单片机开发的菜鸡闲暇时间瞎折腾的故事</p>\n<p>起因是18年斐讯出事的时候炒了一波底，买回来一堆斐讯的设备，以tc1插线盒居多，但是随着斐讯线上服务的关闭，这些原本的智能插线盒变得不智能了，正好网上有网友开发了一波TC1的固件，正好自己也挺感兴趣，便开始折腾起了这些玩意儿。</p>\n<a id=\"more\"></a>\n\n\n<h4 id=\"作案工具\"><a href=\"#作案工具\" class=\"headerlink\" title=\"作案工具\"></a>作案工具</h4><img src=\"/2019/03/10/%5BMXCHIP-1%5D%E5%BC%80%E5%8F%91%E6%9D%BF%E5%88%B0%E6%89%8B/1_s.jpg\" class=\"\" title=\"[作案工具]\">\n\n<ul>\n<li><p>庆科EMW3031开发板</p>\n</li>\n<li><p>庆科EMW3165开发板</p>\n</li>\n<li><p>庆科MICOKIT-EXT上层扩展板</p>\n</li>\n<li><p>USB转TTL工具</p>\n</li>\n<li><p>JLINK仿真器</p>\n<p>PS：3165和扩展板是在闲鱼直接50包邮收的，感觉赚得飞起。usb-ttl一开始不知道需要这个，反复看文档才发现差这玩意儿，5块的东西发了20的顺丰才送到。</p>\n<h4 id=\"开发生态\"><a href=\"#开发生态\" class=\"headerlink\" title=\"开发生态\"></a>开发生态</h4><p>以前从来没玩过如此高大上的玩意儿，这次就算拿到手也是一脸蒙蔽，不知从何下手，入手自闲鱼也没有任何资料，只好先翻一翻庆科的官网看看。</p>\n<h6 id=\"收集的部分有用的链接\"><a href=\"#收集的部分有用的链接\" class=\"headerlink\" title=\"收集的部分有用的链接\"></a>收集的部分有用的链接</h6></li>\n<li><p><a href=\"https://www.mxchip.com/\" target=\"_blank\" rel=\"noopener\">庆科官网</a></p>\n</li>\n<li><p><a href=\"http://developer.mxchip.com/\" target=\"_blank\" rel=\"noopener\">开发者中心</a> </p>\n</li>\n<li><p><a href=\"http://mico.io/\" target=\"_blank\" rel=\"noopener\">官方论坛</a></p>\n</li>\n<li><p><a href=\"http://bbs.mxchip.com/\" target=\"_blank\" rel=\"noopener\">开发者支持社区</a></p>\n<h4 id=\"启动到bootloader\"><a href=\"#启动到bootloader\" class=\"headerlink\" title=\"启动到bootloader\"></a>启动到bootloader</h4><h5 id=\"物理接线\"><a href=\"#物理接线\" class=\"headerlink\" title=\"物理接线\"></a>物理接线</h5></li>\n</ul>\n<img src=\"/2019/03/10/%5BMXCHIP-1%5D%E5%BC%80%E5%8F%91%E6%9D%BF%E5%88%B0%E6%89%8B/4_s.jpg\" class=\"\" title=\"[物理接线]\">\n\n<pre><code>第一条接线 [用户串口] 对应驱动是USB-TTL的驱动 USB-SERIAL CH340\n  PC USB接口 =======&gt; USB-TTL =======&gt; 开发板UART接口\n                        |—— GND            |——  GND         \n                        |—— RXD            |——  TXD    \n                        |—— TXD            |——  RXD    \n                        |—— 5V0            |——  5V0    \n\n第二条接线 [调试串口] 对应驱动是开发板的驱动 USB Serial Port\n  PC USB接口 =======&gt; 开发板microUsb接口 </code></pre><p>PS：这里也被卡了不少时间，原因就是不知道RXD和TXD需要反着接。官网文档里没有任何说明，我在USB-TTL的淘宝页面里找到的资料才提到这一点</p>\n<h5 id=\"驱动管理\"><a href=\"#驱动管理\" class=\"headerlink\" title=\"驱动管理\"></a>驱动管理</h5><p>首先，我完全是个门外汉，我猜测这两驱动的作用可能是一样的，以前的外围设备都是通过COM口和PC相连接的，现在的电脑都没有COM口，于是需要一个将COM口转为USB口的设备。<br>USB-TTL应该就是其中之一，所以才需要安装一个驱动来将USB口映射为虚拟的COM口供软件连接。至于开发板为何可以用microUsb直连电脑我猜测是开发板中内置了芯片来转换，因为我看了新平台<code>MXKIT</code>的说明文档，新平台中只需要一根线就可以同时接上两个接口，所以我做出了这个猜测。</p>\n<img src=\"/2019/03/10/%5BMXCHIP-1%5D%E5%BC%80%E5%8F%91%E6%9D%BF%E5%88%B0%E6%89%8B/3.jpg\" class=\"\" title=\"[驱动管理]\">\n\n\n<h5 id=\"软件连接\"><a href=\"#软件连接\" class=\"headerlink\" title=\"软件连接\"></a>软件连接</h5><p><a href=\"http://developer.mxchip.com/handbooks/109\" target=\"_blank\" rel=\"noopener\">官网教程</a></p>\n<ol>\n<li>先将开发版上的<code>MODULE SELECT</code>拨动到BootLoader启动模式，即BOOT=ON,STATUS=OFF。</li>\n</ol>\n<img src=\"/2019/03/10/%5BMXCHIP-1%5D%E5%BC%80%E5%8F%91%E6%9D%BF%E5%88%B0%E6%89%8B/5_s.jpg\" class=\"\" title=\"[软件连接]\">\n\n<ol start=\"2\">\n<li>在其<a href=\"https://mxchip.yuque.com/books/share/8ac5e519-671d-4444-a93d-20e0aadfc793/ombbz2\" target=\"_blank\" rel=\"noopener\">官网新文档的角落</a>翻到了这个表格，根据表格内容在SecureCRT中建立连接</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>型号</th>\n<th>Bootloader</br>MFG产测信息</th>\n<th>AT指令及透传</th>\n<th>正常工作log</br>CLI调试命令</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>EMW3031</td>\n<td>Pin 9,Pin10,921600bps</td>\n<td>Pin 9,Pin10,115200bps</td>\n<td>Pin21,Pin22,115200bps</td>\n</tr>\n<tr>\n<td>EMW3060</td>\n<td>Pin 9,Pin10,921600bps</td>\n<td>Pin 9,Pin10,115200bps</td>\n<td>Pin21,Pin22,115200bps</td>\n</tr>\n<tr>\n<td>EMW3080</td>\n<td>Pin 9,Pin10,921600bps</td>\n<td>Pin 9,Pin10,115200bps</td>\n<td>Pin21,Pin22,115200bps</td>\n</tr>\n<tr>\n<td>EMW3162</td>\n<td>Pin22,Pin23,921600bps</td>\n<td>Pin22,Pin23,115200bps</td>\n<td>Pin14,Pin4,115200bps</td>\n</tr>\n<tr>\n<td>EMW3165</td>\n<td>Pin29,Pin30,921600bps</td>\n<td>Pin29,Pin30,115200bps</td>\n<td>Pin8,Pin12,115200bps</td>\n</tr>\n<tr>\n<td>EMW3166</td>\n<td>Pin29,Pin30,921600bps</td>\n<td>Pin29,Pin30,115200bps</td>\n<td>Pin8,Pin12,115200bps</td>\n</tr>\n<tr>\n<td>EMW3239</td>\n<td>Pin29,Pin30,921600bps</td>\n<td>Pin29,Pin30,115200bps</td>\n<td>Pin8,Pin12,115200bps</td>\n</tr>\n</tbody></table>\n<ol start=\"3\">\n<li><p>建立好连接后点一下开发板上的restart重启一下就能能看到日志了,如下图左边是用户日志，来自于microUsb(COM4)，右边是调试日志，来自于usb-ttl(COM9)，平时的debug时的日志也都输出到这里。</p>\n<img src=\"/2019/03/10/%5BMXCHIP-1%5D%E5%BC%80%E5%8F%91%E6%9D%BF%E5%88%B0%E6%89%8B/6.jpg\" class=\"\" title=\"[Bootloader日志]\">\n\n\n\n</li>\n</ol>\n<p> 未完待续………..</p>\n","site":{"data":{}},"excerpt":"<p>这是一个从没玩过单片机开发的菜鸡闲暇时间瞎折腾的故事</p>\n<p>起因是18年斐讯出事的时候炒了一波底，买回来一堆斐讯的设备，以tc1插线盒居多，但是随着斐讯线上服务的关闭，这些原本的智能插线盒变得不智能了，正好网上有网友开发了一波TC1的固件，正好自己也挺感兴趣，便开始折腾起了这些玩意儿。</p>","more":"<h4 id=\"作案工具\"><a href=\"#作案工具\" class=\"headerlink\" title=\"作案工具\"></a>作案工具</h4><img src=\"/2019/03/10/%5BMXCHIP-1%5D%E5%BC%80%E5%8F%91%E6%9D%BF%E5%88%B0%E6%89%8B/1_s.jpg\" class=\"\" title=\"[作案工具]\">\n\n<ul>\n<li><p>庆科EMW3031开发板</p>\n</li>\n<li><p>庆科EMW3165开发板</p>\n</li>\n<li><p>庆科MICOKIT-EXT上层扩展板</p>\n</li>\n<li><p>USB转TTL工具</p>\n</li>\n<li><p>JLINK仿真器</p>\n<p>PS：3165和扩展板是在闲鱼直接50包邮收的，感觉赚得飞起。usb-ttl一开始不知道需要这个，反复看文档才发现差这玩意儿，5块的东西发了20的顺丰才送到。</p>\n<h4 id=\"开发生态\"><a href=\"#开发生态\" class=\"headerlink\" title=\"开发生态\"></a>开发生态</h4><p>以前从来没玩过如此高大上的玩意儿，这次就算拿到手也是一脸蒙蔽，不知从何下手，入手自闲鱼也没有任何资料，只好先翻一翻庆科的官网看看。</p>\n<h6 id=\"收集的部分有用的链接\"><a href=\"#收集的部分有用的链接\" class=\"headerlink\" title=\"收集的部分有用的链接\"></a>收集的部分有用的链接</h6></li>\n<li><p><a href=\"https://www.mxchip.com/\" target=\"_blank\" rel=\"noopener\">庆科官网</a></p>\n</li>\n<li><p><a href=\"http://developer.mxchip.com/\" target=\"_blank\" rel=\"noopener\">开发者中心</a> </p>\n</li>\n<li><p><a href=\"http://mico.io/\" target=\"_blank\" rel=\"noopener\">官方论坛</a></p>\n</li>\n<li><p><a href=\"http://bbs.mxchip.com/\" target=\"_blank\" rel=\"noopener\">开发者支持社区</a></p>\n<h4 id=\"启动到bootloader\"><a href=\"#启动到bootloader\" class=\"headerlink\" title=\"启动到bootloader\"></a>启动到bootloader</h4><h5 id=\"物理接线\"><a href=\"#物理接线\" class=\"headerlink\" title=\"物理接线\"></a>物理接线</h5></li>\n</ul>\n<img src=\"/2019/03/10/%5BMXCHIP-1%5D%E5%BC%80%E5%8F%91%E6%9D%BF%E5%88%B0%E6%89%8B/4_s.jpg\" class=\"\" title=\"[物理接线]\">\n\n<pre><code>第一条接线 [用户串口] 对应驱动是USB-TTL的驱动 USB-SERIAL CH340\n  PC USB接口 =======&gt; USB-TTL =======&gt; 开发板UART接口\n                        |—— GND            |——  GND         \n                        |—— RXD            |——  TXD    \n                        |—— TXD            |——  RXD    \n                        |—— 5V0            |——  5V0    \n\n第二条接线 [调试串口] 对应驱动是开发板的驱动 USB Serial Port\n  PC USB接口 =======&gt; 开发板microUsb接口 </code></pre><p>PS：这里也被卡了不少时间，原因就是不知道RXD和TXD需要反着接。官网文档里没有任何说明，我在USB-TTL的淘宝页面里找到的资料才提到这一点</p>\n<h5 id=\"驱动管理\"><a href=\"#驱动管理\" class=\"headerlink\" title=\"驱动管理\"></a>驱动管理</h5><p>首先，我完全是个门外汉，我猜测这两驱动的作用可能是一样的，以前的外围设备都是通过COM口和PC相连接的，现在的电脑都没有COM口，于是需要一个将COM口转为USB口的设备。<br>USB-TTL应该就是其中之一，所以才需要安装一个驱动来将USB口映射为虚拟的COM口供软件连接。至于开发板为何可以用microUsb直连电脑我猜测是开发板中内置了芯片来转换，因为我看了新平台<code>MXKIT</code>的说明文档，新平台中只需要一根线就可以同时接上两个接口，所以我做出了这个猜测。</p>\n<img src=\"/2019/03/10/%5BMXCHIP-1%5D%E5%BC%80%E5%8F%91%E6%9D%BF%E5%88%B0%E6%89%8B/3.jpg\" class=\"\" title=\"[驱动管理]\">\n\n\n<h5 id=\"软件连接\"><a href=\"#软件连接\" class=\"headerlink\" title=\"软件连接\"></a>软件连接</h5><p><a href=\"http://developer.mxchip.com/handbooks/109\" target=\"_blank\" rel=\"noopener\">官网教程</a></p>\n<ol>\n<li>先将开发版上的<code>MODULE SELECT</code>拨动到BootLoader启动模式，即BOOT=ON,STATUS=OFF。</li>\n</ol>\n<img src=\"/2019/03/10/%5BMXCHIP-1%5D%E5%BC%80%E5%8F%91%E6%9D%BF%E5%88%B0%E6%89%8B/5_s.jpg\" class=\"\" title=\"[软件连接]\">\n\n<ol start=\"2\">\n<li>在其<a href=\"https://mxchip.yuque.com/books/share/8ac5e519-671d-4444-a93d-20e0aadfc793/ombbz2\" target=\"_blank\" rel=\"noopener\">官网新文档的角落</a>翻到了这个表格，根据表格内容在SecureCRT中建立连接</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>型号</th>\n<th>Bootloader</br>MFG产测信息</th>\n<th>AT指令及透传</th>\n<th>正常工作log</br>CLI调试命令</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>EMW3031</td>\n<td>Pin 9,Pin10,921600bps</td>\n<td>Pin 9,Pin10,115200bps</td>\n<td>Pin21,Pin22,115200bps</td>\n</tr>\n<tr>\n<td>EMW3060</td>\n<td>Pin 9,Pin10,921600bps</td>\n<td>Pin 9,Pin10,115200bps</td>\n<td>Pin21,Pin22,115200bps</td>\n</tr>\n<tr>\n<td>EMW3080</td>\n<td>Pin 9,Pin10,921600bps</td>\n<td>Pin 9,Pin10,115200bps</td>\n<td>Pin21,Pin22,115200bps</td>\n</tr>\n<tr>\n<td>EMW3162</td>\n<td>Pin22,Pin23,921600bps</td>\n<td>Pin22,Pin23,115200bps</td>\n<td>Pin14,Pin4,115200bps</td>\n</tr>\n<tr>\n<td>EMW3165</td>\n<td>Pin29,Pin30,921600bps</td>\n<td>Pin29,Pin30,115200bps</td>\n<td>Pin8,Pin12,115200bps</td>\n</tr>\n<tr>\n<td>EMW3166</td>\n<td>Pin29,Pin30,921600bps</td>\n<td>Pin29,Pin30,115200bps</td>\n<td>Pin8,Pin12,115200bps</td>\n</tr>\n<tr>\n<td>EMW3239</td>\n<td>Pin29,Pin30,921600bps</td>\n<td>Pin29,Pin30,115200bps</td>\n<td>Pin8,Pin12,115200bps</td>\n</tr>\n</tbody></table>\n<ol start=\"3\">\n<li><p>建立好连接后点一下开发板上的restart重启一下就能能看到日志了,如下图左边是用户日志，来自于microUsb(COM4)，右边是调试日志，来自于usb-ttl(COM9)，平时的debug时的日志也都输出到这里。</p>\n<img src=\"/2019/03/10/%5BMXCHIP-1%5D%E5%BC%80%E5%8F%91%E6%9D%BF%E5%88%B0%E6%89%8B/6.jpg\" class=\"\" title=\"[Bootloader日志]\">\n\n\n\n</li>\n</ol>\n<p> 未完待续………..</p>"},{"title":"[MXCHIP-2]真机调试","date":"2019-05-21T03:11:53.000Z","cover":"/2019/05/21/%5BMXCHIP-2%5D真机调试/title.jpg","coverWidth":1210,"coverHeight":905,"_content":"\n离上一篇文章发布已经时隔很久了，整理了一下最近学习的操作做个记录免得忘掉了。\n\n<!--more-->\n\n### 真机调试\n\n#### 本次的主角 X讯TC1插排\n\n{% asset_img 拆机后的TC1.jpg [拆机后的TC1] %}\n<!-- ![拆机后的TC1]() -->\n\n通过仔细观察可以发现，在PCB上预留了2组(8个)触点，一组上面标有RX/TX字样，那肯定就是UART接口了。\n\n{% asset_img UART接口定义.jpg [UART接口定义] %}\n<!-- ![UART接口定义](./UART接口定义.jpg) -->\n\n另一组标有CLK、BIO字样，应该是用于刷机的SWD接口。\n\n{% asset_img SWD接口定义.jpg [SWD接口定义] %}\n<!-- ![SWD接口定义](./SWD接口定义.jpg) -->\n\n- [引用的资料](https://iot-security.wiki/hardware-security/debug/jtag.html)\n\n#### 模块文档\n\n从官网翻到了模块的参数信息\n[DS0021CN_EMW3031_V1.4]([MXCHIP-2]真机调试/DS0021CN_EMW3031_V1.4.pdf)\n","source":"_posts/[MXCHIP-2]真机调试.md","raw":"---\ntitle: \"[MXCHIP-2]真机调试\"\ndate: 2019/5/21 11:11:53\ncategories: \n    - [我永远爱学习]\ntags: \n    - 单片机\n    - IOT\n    - C\ncover: /2019/05/21/%5BMXCHIP-2%5D真机调试/title.jpg\ncoverWidth: 1210\ncoverHeight: 905\n---\n\n离上一篇文章发布已经时隔很久了，整理了一下最近学习的操作做个记录免得忘掉了。\n\n<!--more-->\n\n### 真机调试\n\n#### 本次的主角 X讯TC1插排\n\n{% asset_img 拆机后的TC1.jpg [拆机后的TC1] %}\n<!-- ![拆机后的TC1]() -->\n\n通过仔细观察可以发现，在PCB上预留了2组(8个)触点，一组上面标有RX/TX字样，那肯定就是UART接口了。\n\n{% asset_img UART接口定义.jpg [UART接口定义] %}\n<!-- ![UART接口定义](./UART接口定义.jpg) -->\n\n另一组标有CLK、BIO字样，应该是用于刷机的SWD接口。\n\n{% asset_img SWD接口定义.jpg [SWD接口定义] %}\n<!-- ![SWD接口定义](./SWD接口定义.jpg) -->\n\n- [引用的资料](https://iot-security.wiki/hardware-security/debug/jtag.html)\n\n#### 模块文档\n\n从官网翻到了模块的参数信息\n[DS0021CN_EMW3031_V1.4]([MXCHIP-2]真机调试/DS0021CN_EMW3031_V1.4.pdf)\n","slug":"[MXCHIP-2]真机调试","published":1,"updated":"2020-08-07T03:28:33.755Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cktp91zkk00084cow6xas615i","content":"<p>离上一篇文章发布已经时隔很久了，整理了一下最近学习的操作做个记录免得忘掉了。</p>\n<a id=\"more\"></a>\n\n<h3 id=\"真机调试\"><a href=\"#真机调试\" class=\"headerlink\" title=\"真机调试\"></a>真机调试</h3><h4 id=\"本次的主角-X讯TC1插排\"><a href=\"#本次的主角-X讯TC1插排\" class=\"headerlink\" title=\"本次的主角 X讯TC1插排\"></a>本次的主角 X讯TC1插排</h4>\n<!-- ![拆机后的TC1]() -->\n\n<p>通过仔细观察可以发现，在PCB上预留了2组(8个)触点，一组上面标有RX/TX字样，那肯定就是UART接口了。</p>\n<img src=\"/2019/05/21/%5BMXCHIP-2%5D%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95/UART%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89.jpg\" class=\"\" title=\"[UART接口定义]\">\n<!-- ![UART接口定义](./UART接口定义.jpg) -->\n\n<p>另一组标有CLK、BIO字样，应该是用于刷机的SWD接口。</p>\n<img src=\"/2019/05/21/%5BMXCHIP-2%5D%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95/SWD%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89.jpg\" class=\"\" title=\"[SWD接口定义]\">\n<!-- ![SWD接口定义](./SWD接口定义.jpg) -->\n\n<ul>\n<li><a href=\"https://iot-security.wiki/hardware-security/debug/jtag.html\" target=\"_blank\" rel=\"noopener\">引用的资料</a></li>\n</ul>\n<h4 id=\"模块文档\"><a href=\"#模块文档\" class=\"headerlink\" title=\"模块文档\"></a>模块文档</h4><p>从官网翻到了模块的参数信息<br><a href=\"[MXCHIP-2]真机调试/DS0021CN_EMW3031_V1.4.pdf\">DS0021CN_EMW3031_V1.4</a></p>\n","site":{"data":{}},"excerpt":"<p>离上一篇文章发布已经时隔很久了，整理了一下最近学习的操作做个记录免得忘掉了。</p>","more":"<h3 id=\"真机调试\"><a href=\"#真机调试\" class=\"headerlink\" title=\"真机调试\"></a>真机调试</h3><h4 id=\"本次的主角-X讯TC1插排\"><a href=\"#本次的主角-X讯TC1插排\" class=\"headerlink\" title=\"本次的主角 X讯TC1插排\"></a>本次的主角 X讯TC1插排</h4>\n<!-- ![拆机后的TC1]() -->\n\n<p>通过仔细观察可以发现，在PCB上预留了2组(8个)触点，一组上面标有RX/TX字样，那肯定就是UART接口了。</p>\n<img src=\"/2019/05/21/%5BMXCHIP-2%5D%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95/UART%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89.jpg\" class=\"\" title=\"[UART接口定义]\">\n<!-- ![UART接口定义](./UART接口定义.jpg) -->\n\n<p>另一组标有CLK、BIO字样，应该是用于刷机的SWD接口。</p>\n<img src=\"/2019/05/21/%5BMXCHIP-2%5D%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95/SWD%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89.jpg\" class=\"\" title=\"[SWD接口定义]\">\n<!-- ![SWD接口定义](./SWD接口定义.jpg) -->\n\n<ul>\n<li><a href=\"https://iot-security.wiki/hardware-security/debug/jtag.html\" target=\"_blank\" rel=\"noopener\">引用的资料</a></li>\n</ul>\n<h4 id=\"模块文档\"><a href=\"#模块文档\" class=\"headerlink\" title=\"模块文档\"></a>模块文档</h4><p>从官网翻到了模块的参数信息<br><a href=\"[MXCHIP-2]真机调试/DS0021CN_EMW3031_V1.4.pdf\">DS0021CN_EMW3031_V1.4</a></p>"},{"title":"Death_Standing","date":"2020-03-12T12:30:53.000Z","cover":"https://pic2.zhimg.com/v2-e0a965a2365bdadda41dedcb9fe5ec58_r.jpg","coverWidth":1284,"coverHeight":722,"_content":"\n\n### 前言\n\n\n> 三个月前《死亡搁浅》发售时，没有人想到里面近未来的世界观，会成为中国当下的现实。\n各地限制交通，封城断路，我们成了United Cities of China。\n人们离群索居，恐惧无声蔓延，病毒有如天上淅淅沥沥的时间雨，吞噬着希望和快乐。一旦死去，尸体必须马上就近火化，生者无法举行任何仪式。\n就连抢夺货物囤积在自己营地的米尔人也真实地还原了。\n快递员孤独地在路上奔波着，送药物，送口罩，送食品——一如游戏里的披萨和香槟。货物被留在冷冰冰的丰巢，小区门口的桌子上。因为没有3D投影，下单的人们甚至不能和快递员说一句赞美和感谢。\n不知道这样的日子还要过多久，如果有PS4，不妨买一份《死亡搁浅》，感受一下另一个相似的世界。\n即使在最冰冷和孤独的荒野，也能响起Low Roar的歌。\n———转自weibo:lilimarleen\n\n\n<!--more-->\n\n\n### 先吹一波\n\n - 世界观庞大且严谨，随着主线推进逐渐解锁世界的真相。\n - 游戏内容重复但却不枯燥，即使是同一个任务，也有无数种不同的完成方式。\n - 优美的风景辅以悠扬的音乐实在是画龙点睛之用。\n - 所有出场的人物角色都是根据真人3D建模的，在剧情中有很大的代入感。\n\n### 不足之处\n\n - 顽人的伏笔还没收呢，是要出续作的节奏？\n - 难度设置不均衡，前三章缺乏有效抗BT武器~~（其实前三章都是新手教程，真实的**走路模拟器**）~~，容易劝退新玩家。左下雪山区难度也十分劝退。\n - 缺乏互动性，该作只能与其他玩家建造的建筑互动，无法和其他快递员一起飙车还是蛮遗憾的。\n\n### 小彩蛋\n\n- 在点赞数比较多的小石堆休息会加快体力恢复速度。\n- 在点赞数比较多的蘑菇堆旁能捉到隐生虫，~~捉完记得浇花~~。\n- 在点赞数比较多的小石堆和蘑菇堆旁呼喊能够得到~~不明人员~~的回应和祝福！\n- 运送`mama`和`开罗尔艺术家`的时候可以绕道和妹子一起去泡温泉！！\n- 如果在生日那天送快递，对周围呼喊时会有~~不明人员~~祝你生日快乐！！！\n\n![生日小彩蛋](http://a1.qpic.cn/psc?/2f78ab1d-9f0c-40a8-b8ed-fc20fe8c44e3/xBo1HguJwfqPLd*kRKpWsEcMYmv9E9Xd4f9mt2mu7KM*p481WV2wbbRi8Pi2Qf0KNPq5q9t9TbFkqWnbRd9nwQ!!/b&ek=1&kp=1&pt=0&bo=gAc4BIAHOAQRECc!&tl=3&vuin=736233029&tm=1589817600&sce=60-2-2&rf=viewer_311)\n\n\n### 白金感言\n\n整个作品给人最大的印象就是`干净`。剧情中有一个相当重要的意象：`绳子`。绳子象征着`连接`，将各地孤立无援的人们连在一起、互相帮助，共同对抗末日。而整部游戏更是宣扬的`人性至善`,不管走到哪里，都会得到其他玩家的帮助，只要帮助过别人，便能收获他人的赞赏与激励。这种受到他人赞美与感谢的感觉真是令人沉迷其中。\n\n> 这款游戏的神奇之处就在于：**并非玩家挑选游戏，而是让游戏来挑选玩家**！\n\n对于习惯于快节奏对抗的玩家来说，这款游戏极有可能与他们无缘——被劝退于前两章的新手教程，而留存下来的玩家则是适合慢节奏大片时间游玩的玩家，只有被筛选出来的玩家才有机会尽情享受这款游戏带来的震撼与感动。\n\n{% asset_img IMG_20200319_004053.jpg [白金截图] %}\n\n###  一句话总结\n\n这个作品前无古人，不知道后是否有来者。","source":"_posts/Death_Standing.md","raw":"---\n\n\n\ntitle: \"Death_Standing\"\ndate: 2020/3/12 20:30:53\ncategories: \n    - [想到啥写啥]\ntags: \n    - Games\ncover: https://pic2.zhimg.com/v2-e0a965a2365bdadda41dedcb9fe5ec58_r.jpg\ncoverWidth: 1284\ncoverHeight: 722\n---\n\n\n### 前言\n\n\n> 三个月前《死亡搁浅》发售时，没有人想到里面近未来的世界观，会成为中国当下的现实。\n各地限制交通，封城断路，我们成了United Cities of China。\n人们离群索居，恐惧无声蔓延，病毒有如天上淅淅沥沥的时间雨，吞噬着希望和快乐。一旦死去，尸体必须马上就近火化，生者无法举行任何仪式。\n就连抢夺货物囤积在自己营地的米尔人也真实地还原了。\n快递员孤独地在路上奔波着，送药物，送口罩，送食品——一如游戏里的披萨和香槟。货物被留在冷冰冰的丰巢，小区门口的桌子上。因为没有3D投影，下单的人们甚至不能和快递员说一句赞美和感谢。\n不知道这样的日子还要过多久，如果有PS4，不妨买一份《死亡搁浅》，感受一下另一个相似的世界。\n即使在最冰冷和孤独的荒野，也能响起Low Roar的歌。\n———转自weibo:lilimarleen\n\n\n<!--more-->\n\n\n### 先吹一波\n\n - 世界观庞大且严谨，随着主线推进逐渐解锁世界的真相。\n - 游戏内容重复但却不枯燥，即使是同一个任务，也有无数种不同的完成方式。\n - 优美的风景辅以悠扬的音乐实在是画龙点睛之用。\n - 所有出场的人物角色都是根据真人3D建模的，在剧情中有很大的代入感。\n\n### 不足之处\n\n - 顽人的伏笔还没收呢，是要出续作的节奏？\n - 难度设置不均衡，前三章缺乏有效抗BT武器~~（其实前三章都是新手教程，真实的**走路模拟器**）~~，容易劝退新玩家。左下雪山区难度也十分劝退。\n - 缺乏互动性，该作只能与其他玩家建造的建筑互动，无法和其他快递员一起飙车还是蛮遗憾的。\n\n### 小彩蛋\n\n- 在点赞数比较多的小石堆休息会加快体力恢复速度。\n- 在点赞数比较多的蘑菇堆旁能捉到隐生虫，~~捉完记得浇花~~。\n- 在点赞数比较多的小石堆和蘑菇堆旁呼喊能够得到~~不明人员~~的回应和祝福！\n- 运送`mama`和`开罗尔艺术家`的时候可以绕道和妹子一起去泡温泉！！\n- 如果在生日那天送快递，对周围呼喊时会有~~不明人员~~祝你生日快乐！！！\n\n![生日小彩蛋](http://a1.qpic.cn/psc?/2f78ab1d-9f0c-40a8-b8ed-fc20fe8c44e3/xBo1HguJwfqPLd*kRKpWsEcMYmv9E9Xd4f9mt2mu7KM*p481WV2wbbRi8Pi2Qf0KNPq5q9t9TbFkqWnbRd9nwQ!!/b&ek=1&kp=1&pt=0&bo=gAc4BIAHOAQRECc!&tl=3&vuin=736233029&tm=1589817600&sce=60-2-2&rf=viewer_311)\n\n\n### 白金感言\n\n整个作品给人最大的印象就是`干净`。剧情中有一个相当重要的意象：`绳子`。绳子象征着`连接`，将各地孤立无援的人们连在一起、互相帮助，共同对抗末日。而整部游戏更是宣扬的`人性至善`,不管走到哪里，都会得到其他玩家的帮助，只要帮助过别人，便能收获他人的赞赏与激励。这种受到他人赞美与感谢的感觉真是令人沉迷其中。\n\n> 这款游戏的神奇之处就在于：**并非玩家挑选游戏，而是让游戏来挑选玩家**！\n\n对于习惯于快节奏对抗的玩家来说，这款游戏极有可能与他们无缘——被劝退于前两章的新手教程，而留存下来的玩家则是适合慢节奏大片时间游玩的玩家，只有被筛选出来的玩家才有机会尽情享受这款游戏带来的震撼与感动。\n\n{% asset_img IMG_20200319_004053.jpg [白金截图] %}\n\n###  一句话总结\n\n这个作品前无古人，不知道后是否有来者。","slug":"Death_Standing","published":1,"updated":"2020-08-07T03:28:33.724Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cktp91zkn000c4cow28aobtb1","content":"<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><blockquote>\n<p>三个月前《死亡搁浅》发售时，没有人想到里面近未来的世界观，会成为中国当下的现实。<br>各地限制交通，封城断路，我们成了United Cities of China。<br>人们离群索居，恐惧无声蔓延，病毒有如天上淅淅沥沥的时间雨，吞噬着希望和快乐。一旦死去，尸体必须马上就近火化，生者无法举行任何仪式。<br>就连抢夺货物囤积在自己营地的米尔人也真实地还原了。<br>快递员孤独地在路上奔波着，送药物，送口罩，送食品——一如游戏里的披萨和香槟。货物被留在冷冰冰的丰巢，小区门口的桌子上。因为没有3D投影，下单的人们甚至不能和快递员说一句赞美和感谢。<br>不知道这样的日子还要过多久，如果有PS4，不妨买一份《死亡搁浅》，感受一下另一个相似的世界。<br>即使在最冰冷和孤独的荒野，也能响起Low Roar的歌。<br>———转自weibo:lilimarleen</p>\n</blockquote>\n<a id=\"more\"></a>\n\n\n<h3 id=\"先吹一波\"><a href=\"#先吹一波\" class=\"headerlink\" title=\"先吹一波\"></a>先吹一波</h3><ul>\n<li>世界观庞大且严谨，随着主线推进逐渐解锁世界的真相。</li>\n<li>游戏内容重复但却不枯燥，即使是同一个任务，也有无数种不同的完成方式。</li>\n<li>优美的风景辅以悠扬的音乐实在是画龙点睛之用。</li>\n<li>所有出场的人物角色都是根据真人3D建模的，在剧情中有很大的代入感。</li>\n</ul>\n<h3 id=\"不足之处\"><a href=\"#不足之处\" class=\"headerlink\" title=\"不足之处\"></a>不足之处</h3><ul>\n<li>顽人的伏笔还没收呢，是要出续作的节奏？</li>\n<li>难度设置不均衡，前三章缺乏有效抗BT武器<del>（其实前三章都是新手教程，真实的<strong>走路模拟器</strong>）</del>，容易劝退新玩家。左下雪山区难度也十分劝退。</li>\n<li>缺乏互动性，该作只能与其他玩家建造的建筑互动，无法和其他快递员一起飙车还是蛮遗憾的。</li>\n</ul>\n<h3 id=\"小彩蛋\"><a href=\"#小彩蛋\" class=\"headerlink\" title=\"小彩蛋\"></a>小彩蛋</h3><ul>\n<li>在点赞数比较多的小石堆休息会加快体力恢复速度。</li>\n<li>在点赞数比较多的蘑菇堆旁能捉到隐生虫，<del>捉完记得浇花</del>。</li>\n<li>在点赞数比较多的小石堆和蘑菇堆旁呼喊能够得到<del>不明人员</del>的回应和祝福！</li>\n<li>运送<code>mama</code>和<code>开罗尔艺术家</code>的时候可以绕道和妹子一起去泡温泉！！</li>\n<li>如果在生日那天送快递，对周围呼喊时会有<del>不明人员</del>祝你生日快乐！！！</li>\n</ul>\n<p><img src=\"http://a1.qpic.cn/psc?/2f78ab1d-9f0c-40a8-b8ed-fc20fe8c44e3/xBo1HguJwfqPLd*kRKpWsEcMYmv9E9Xd4f9mt2mu7KM*p481WV2wbbRi8Pi2Qf0KNPq5q9t9TbFkqWnbRd9nwQ!!/b&ek=1&kp=1&pt=0&bo=gAc4BIAHOAQRECc!&tl=3&vuin=736233029&tm=1589817600&sce=60-2-2&rf=viewer_311\" alt=\"生日小彩蛋\"></p>\n<h3 id=\"白金感言\"><a href=\"#白金感言\" class=\"headerlink\" title=\"白金感言\"></a>白金感言</h3><p>整个作品给人最大的印象就是<code>干净</code>。剧情中有一个相当重要的意象：<code>绳子</code>。绳子象征着<code>连接</code>，将各地孤立无援的人们连在一起、互相帮助，共同对抗末日。而整部游戏更是宣扬的<code>人性至善</code>,不管走到哪里，都会得到其他玩家的帮助，只要帮助过别人，便能收获他人的赞赏与激励。这种受到他人赞美与感谢的感觉真是令人沉迷其中。</p>\n<blockquote>\n<p>这款游戏的神奇之处就在于：<strong>并非玩家挑选游戏，而是让游戏来挑选玩家</strong>！</p>\n</blockquote>\n<p>对于习惯于快节奏对抗的玩家来说，这款游戏极有可能与他们无缘——被劝退于前两章的新手教程，而留存下来的玩家则是适合慢节奏大片时间游玩的玩家，只有被筛选出来的玩家才有机会尽情享受这款游戏带来的震撼与感动。</p>\n<img src=\"/2020/03/12/Death_Standing/IMG_20200319_004053.jpg\" class=\"\" title=\"[白金截图]\">\n\n<h3 id=\"一句话总结\"><a href=\"#一句话总结\" class=\"headerlink\" title=\"一句话总结\"></a>一句话总结</h3><p>这个作品前无古人，不知道后是否有来者。</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><blockquote>\n<p>三个月前《死亡搁浅》发售时，没有人想到里面近未来的世界观，会成为中国当下的现实。<br>各地限制交通，封城断路，我们成了United Cities of China。<br>人们离群索居，恐惧无声蔓延，病毒有如天上淅淅沥沥的时间雨，吞噬着希望和快乐。一旦死去，尸体必须马上就近火化，生者无法举行任何仪式。<br>就连抢夺货物囤积在自己营地的米尔人也真实地还原了。<br>快递员孤独地在路上奔波着，送药物，送口罩，送食品——一如游戏里的披萨和香槟。货物被留在冷冰冰的丰巢，小区门口的桌子上。因为没有3D投影，下单的人们甚至不能和快递员说一句赞美和感谢。<br>不知道这样的日子还要过多久，如果有PS4，不妨买一份《死亡搁浅》，感受一下另一个相似的世界。<br>即使在最冰冷和孤独的荒野，也能响起Low Roar的歌。<br>———转自weibo:lilimarleen</p>\n</blockquote>","more":"<h3 id=\"先吹一波\"><a href=\"#先吹一波\" class=\"headerlink\" title=\"先吹一波\"></a>先吹一波</h3><ul>\n<li>世界观庞大且严谨，随着主线推进逐渐解锁世界的真相。</li>\n<li>游戏内容重复但却不枯燥，即使是同一个任务，也有无数种不同的完成方式。</li>\n<li>优美的风景辅以悠扬的音乐实在是画龙点睛之用。</li>\n<li>所有出场的人物角色都是根据真人3D建模的，在剧情中有很大的代入感。</li>\n</ul>\n<h3 id=\"不足之处\"><a href=\"#不足之处\" class=\"headerlink\" title=\"不足之处\"></a>不足之处</h3><ul>\n<li>顽人的伏笔还没收呢，是要出续作的节奏？</li>\n<li>难度设置不均衡，前三章缺乏有效抗BT武器<del>（其实前三章都是新手教程，真实的<strong>走路模拟器</strong>）</del>，容易劝退新玩家。左下雪山区难度也十分劝退。</li>\n<li>缺乏互动性，该作只能与其他玩家建造的建筑互动，无法和其他快递员一起飙车还是蛮遗憾的。</li>\n</ul>\n<h3 id=\"小彩蛋\"><a href=\"#小彩蛋\" class=\"headerlink\" title=\"小彩蛋\"></a>小彩蛋</h3><ul>\n<li>在点赞数比较多的小石堆休息会加快体力恢复速度。</li>\n<li>在点赞数比较多的蘑菇堆旁能捉到隐生虫，<del>捉完记得浇花</del>。</li>\n<li>在点赞数比较多的小石堆和蘑菇堆旁呼喊能够得到<del>不明人员</del>的回应和祝福！</li>\n<li>运送<code>mama</code>和<code>开罗尔艺术家</code>的时候可以绕道和妹子一起去泡温泉！！</li>\n<li>如果在生日那天送快递，对周围呼喊时会有<del>不明人员</del>祝你生日快乐！！！</li>\n</ul>\n<p><img src=\"http://a1.qpic.cn/psc?/2f78ab1d-9f0c-40a8-b8ed-fc20fe8c44e3/xBo1HguJwfqPLd*kRKpWsEcMYmv9E9Xd4f9mt2mu7KM*p481WV2wbbRi8Pi2Qf0KNPq5q9t9TbFkqWnbRd9nwQ!!/b&ek=1&kp=1&pt=0&bo=gAc4BIAHOAQRECc!&tl=3&vuin=736233029&tm=1589817600&sce=60-2-2&rf=viewer_311\" alt=\"生日小彩蛋\"></p>\n<h3 id=\"白金感言\"><a href=\"#白金感言\" class=\"headerlink\" title=\"白金感言\"></a>白金感言</h3><p>整个作品给人最大的印象就是<code>干净</code>。剧情中有一个相当重要的意象：<code>绳子</code>。绳子象征着<code>连接</code>，将各地孤立无援的人们连在一起、互相帮助，共同对抗末日。而整部游戏更是宣扬的<code>人性至善</code>,不管走到哪里，都会得到其他玩家的帮助，只要帮助过别人，便能收获他人的赞赏与激励。这种受到他人赞美与感谢的感觉真是令人沉迷其中。</p>\n<blockquote>\n<p>这款游戏的神奇之处就在于：<strong>并非玩家挑选游戏，而是让游戏来挑选玩家</strong>！</p>\n</blockquote>\n<p>对于习惯于快节奏对抗的玩家来说，这款游戏极有可能与他们无缘——被劝退于前两章的新手教程，而留存下来的玩家则是适合慢节奏大片时间游玩的玩家，只有被筛选出来的玩家才有机会尽情享受这款游戏带来的震撼与感动。</p>\n<img src=\"/2020/03/12/Death_Standing/IMG_20200319_004053.jpg\" class=\"\" title=\"[白金截图]\">\n\n<h3 id=\"一句话总结\"><a href=\"#一句话总结\" class=\"headerlink\" title=\"一句话总结\"></a>一句话总结</h3><p>这个作品前无古人，不知道后是否有来者。</p>"},{"title":"[WSL2]子系统ubuntu安装jdk8","date":"2019-01-04T07:42:01.000Z","updated":"2020-02-20T07:41:36.000Z","comments":1,"_content":"\n这是个大坑 平时装个JDK这么简单的事 在WSL上问题还真不少\n<!--more-->\n\n### 安装环境\n```\n适用于 Linux 的 Windows 子系统:\nUbuntu-18.04 (默认)\n```\n\n\n\n### \n\n以前都是用的centos,直接`yum localinstall ./jdk-???-linux-x64.rpm`就可以安装本地的RPM包了。 \n但是现在使用的Ubuntu，只能安装DEB包，查询了一下有三种安装方式：\n\n- RPM包转制为DEB包\n- 使用开箱即用的tar.gz并配置环境变量\n- 使用ppa源安装\n \n### 开始安装\n\n很明显使用ppa源安装更稳定不容易遇到问题，参考了此文章 \n[Install Oracle Java 8 (JDK8 and JRE8) in Ubuntu or Linux Mint](http://www.webupd8.org/2012/09/install-oracle-java-8-in-ubuntu-via-ppa.html)\n\n```\nsudo add-apt-repository ppa:webupd8team/java    //添加PPA源\nsudo apt-get update                             //更新本地包\nsudo apt-get install oracle-java8-installer     //安装JDK\n\n// 很遗憾报错了\n\nroot@DESKTOP-UFOJIL7:/wsl_share# apt-get install oracle-java8-installer\nReading package lists... Done\nBuilding dependency tree\nReading state information... Done\nPackage oracle-java8-installer is not available, but is referred to by another package.\nThis may mean that the package is missing, has been obsoleted, or\nis only available from another source\n\nE: Package 'oracle-java8-installer' has no installation candidate\n```\n\n### \n\n在这里找到了答案\n[Oracle-Java8-Installer: No installation candidate](https://askubuntu.com/questions/790671/oracle-java8-installer-no-installation-candidate)\n\n&gt; NOTE: This answer no longer works, as the WebUpd8 PPA has been deprecated since Oracle has changed licensing and access restrictions to the Oracle Java codebase. Details at http://www.webupd8.org/2014/03/how-to-install-oracle-java-8-in-debian.html\n\n翻译一下\n\n&gt;注意：此答案不再有效，因为WebUpd8 PPA已被弃用，因为Oracle已将许可和访问限制更改为Oracle Java代码库。 有关详细信息， 请访问http://www.webupd8.org/2014/03/how-to-install-oracle-java-8-in-debian.html\n\n既然如此，那没啥办法只能手动安装一个了\n\n### 手动配置\n\n首先下载一个`jdk-8u221-linux-x64.tar.gz`,拷贝到wsl_share中\n\n```\nroot@DESKTOP-UFOJIL7:/wsl_share# tar -zxvf ./jdk-8u221-linux-x64.tar.gz      //首先解压\nroot@DESKTOP-UFOJIL7:/wsl_share# vim ~/.bashrc                              //配置环境变量\n```\n\n```\n// bashrc中追加以下内容\nexport JAVA_HOME=/app/jdk1.8.0_221\nexport JRE_HOME=${JAVA_HOME}/jre\nexport CLASSPATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib\nexport PATH=${JAVA_HOME}/bin:$PATH\n```\n\n```\nroot@DESKTOP-UFOJIL7:/wsl_share# source ~/.bashrc    //重新加载环境变量\n\nroot@DESKTOP-UFOJIL7:/wsl_share# java -version\njava version \"1.8.0_221\"\nJava(TM) SE Runtime Environment (build 1.8.0_221-b11)\nJava HotSpot(TM) 64-Bit Server VM (build 25.221-b11, mixed mode)\n\n\n```\n","source":"_posts/[WSL2]子系统ubuntu安装jdk8.md","raw":"---\ntitle: '[WSL2]子系统ubuntu安装jdk8'\ndate: 2019/1/4 15:42:01\nupdated: 2020/2/20 15:41:36\ncomments: true\ncategories: \n    - [搞点骚操作]\ntags: \n    - linux\n---\n\n这是个大坑 平时装个JDK这么简单的事 在WSL上问题还真不少\n<!--more-->\n\n### 安装环境\n```\n适用于 Linux 的 Windows 子系统:\nUbuntu-18.04 (默认)\n```\n\n\n\n### \n\n以前都是用的centos,直接`yum localinstall ./jdk-???-linux-x64.rpm`就可以安装本地的RPM包了。 \n但是现在使用的Ubuntu，只能安装DEB包，查询了一下有三种安装方式：\n\n- RPM包转制为DEB包\n- 使用开箱即用的tar.gz并配置环境变量\n- 使用ppa源安装\n \n### 开始安装\n\n很明显使用ppa源安装更稳定不容易遇到问题，参考了此文章 \n[Install Oracle Java 8 (JDK8 and JRE8) in Ubuntu or Linux Mint](http://www.webupd8.org/2012/09/install-oracle-java-8-in-ubuntu-via-ppa.html)\n\n```\nsudo add-apt-repository ppa:webupd8team/java    //添加PPA源\nsudo apt-get update                             //更新本地包\nsudo apt-get install oracle-java8-installer     //安装JDK\n\n// 很遗憾报错了\n\nroot@DESKTOP-UFOJIL7:/wsl_share# apt-get install oracle-java8-installer\nReading package lists... Done\nBuilding dependency tree\nReading state information... Done\nPackage oracle-java8-installer is not available, but is referred to by another package.\nThis may mean that the package is missing, has been obsoleted, or\nis only available from another source\n\nE: Package 'oracle-java8-installer' has no installation candidate\n```\n\n### \n\n在这里找到了答案\n[Oracle-Java8-Installer: No installation candidate](https://askubuntu.com/questions/790671/oracle-java8-installer-no-installation-candidate)\n\n&gt; NOTE: This answer no longer works, as the WebUpd8 PPA has been deprecated since Oracle has changed licensing and access restrictions to the Oracle Java codebase. Details at http://www.webupd8.org/2014/03/how-to-install-oracle-java-8-in-debian.html\n\n翻译一下\n\n&gt;注意：此答案不再有效，因为WebUpd8 PPA已被弃用，因为Oracle已将许可和访问限制更改为Oracle Java代码库。 有关详细信息， 请访问http://www.webupd8.org/2014/03/how-to-install-oracle-java-8-in-debian.html\n\n既然如此，那没啥办法只能手动安装一个了\n\n### 手动配置\n\n首先下载一个`jdk-8u221-linux-x64.tar.gz`,拷贝到wsl_share中\n\n```\nroot@DESKTOP-UFOJIL7:/wsl_share# tar -zxvf ./jdk-8u221-linux-x64.tar.gz      //首先解压\nroot@DESKTOP-UFOJIL7:/wsl_share# vim ~/.bashrc                              //配置环境变量\n```\n\n```\n// bashrc中追加以下内容\nexport JAVA_HOME=/app/jdk1.8.0_221\nexport JRE_HOME=${JAVA_HOME}/jre\nexport CLASSPATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib\nexport PATH=${JAVA_HOME}/bin:$PATH\n```\n\n```\nroot@DESKTOP-UFOJIL7:/wsl_share# source ~/.bashrc    //重新加载环境变量\n\nroot@DESKTOP-UFOJIL7:/wsl_share# java -version\njava version \"1.8.0_221\"\nJava(TM) SE Runtime Environment (build 1.8.0_221-b11)\nJava HotSpot(TM) 64-Bit Server VM (build 25.221-b11, mixed mode)\n\n\n```\n","slug":"[WSL2]子系统ubuntu安装jdk8","published":1,"layout":"post","photos":[],"link":"","_id":"cktp91zko000d4cowe9hjba1z","content":"<p>这是个大坑 平时装个JDK这么简单的事 在WSL上问题还真不少</p>\n<a id=\"more\"></a>\n\n<h3 id=\"安装环境\"><a href=\"#安装环境\" class=\"headerlink\" title=\"安装环境\"></a>安装环境</h3><pre><code>适用于 Linux 的 Windows 子系统:\nUbuntu-18.04 (默认)</code></pre><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>以前都是用的centos,直接<code>yum localinstall ./jdk-???-linux-x64.rpm</code>就可以安装本地的RPM包了。<br>但是现在使用的Ubuntu，只能安装DEB包，查询了一下有三种安装方式：</p>\n<ul>\n<li>RPM包转制为DEB包</li>\n<li>使用开箱即用的tar.gz并配置环境变量</li>\n<li>使用ppa源安装</li>\n</ul>\n<h3 id=\"开始安装\"><a href=\"#开始安装\" class=\"headerlink\" title=\"开始安装\"></a>开始安装</h3><p>很明显使用ppa源安装更稳定不容易遇到问题，参考了此文章<br><a href=\"http://www.webupd8.org/2012/09/install-oracle-java-8-in-ubuntu-via-ppa.html\" target=\"_blank\" rel=\"noopener\">Install Oracle Java 8 (JDK8 and JRE8) in Ubuntu or Linux Mint</a></p>\n<pre><code>sudo add-apt-repository ppa:webupd8team/java    //添加PPA源\nsudo apt-get update                             //更新本地包\nsudo apt-get install oracle-java8-installer     //安装JDK\n\n// 很遗憾报错了\n\nroot@DESKTOP-UFOJIL7:/wsl_share# apt-get install oracle-java8-installer\nReading package lists... Done\nBuilding dependency tree\nReading state information... Done\nPackage oracle-java8-installer is not available, but is referred to by another package.\nThis may mean that the package is missing, has been obsoleted, or\nis only available from another source\n\nE: Package &#39;oracle-java8-installer&#39; has no installation candidate</code></pre><h3 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h3><p>在这里找到了答案<br><a href=\"https://askubuntu.com/questions/790671/oracle-java8-installer-no-installation-candidate\" target=\"_blank\" rel=\"noopener\">Oracle-Java8-Installer: No installation candidate</a></p>\n<p>&gt; NOTE: This answer no longer works, as the WebUpd8 PPA has been deprecated since Oracle has changed licensing and access restrictions to the Oracle Java codebase. Details at <a href=\"http://www.webupd8.org/2014/03/how-to-install-oracle-java-8-in-debian.html\" target=\"_blank\" rel=\"noopener\">http://www.webupd8.org/2014/03/how-to-install-oracle-java-8-in-debian.html</a></p>\n<p>翻译一下</p>\n<p>&gt;注意：此答案不再有效，因为WebUpd8 PPA已被弃用，因为Oracle已将许可和访问限制更改为Oracle Java代码库。 有关详细信息， 请访问<a href=\"http://www.webupd8.org/2014/03/how-to-install-oracle-java-8-in-debian.html\" target=\"_blank\" rel=\"noopener\">http://www.webupd8.org/2014/03/how-to-install-oracle-java-8-in-debian.html</a></p>\n<p>既然如此，那没啥办法只能手动安装一个了</p>\n<h3 id=\"手动配置\"><a href=\"#手动配置\" class=\"headerlink\" title=\"手动配置\"></a>手动配置</h3><p>首先下载一个<code>jdk-8u221-linux-x64.tar.gz</code>,拷贝到wsl_share中</p>\n<pre><code>root@DESKTOP-UFOJIL7:/wsl_share# tar -zxvf ./jdk-8u221-linux-x64.tar.gz      //首先解压\nroot@DESKTOP-UFOJIL7:/wsl_share# vim ~/.bashrc                              //配置环境变量</code></pre><pre><code>// bashrc中追加以下内容\nexport JAVA_HOME=/app/jdk1.8.0_221\nexport JRE_HOME=${JAVA_HOME}/jre\nexport CLASSPATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib\nexport PATH=${JAVA_HOME}/bin:$PATH</code></pre><pre><code>root@DESKTOP-UFOJIL7:/wsl_share# source ~/.bashrc    //重新加载环境变量\n\nroot@DESKTOP-UFOJIL7:/wsl_share# java -version\njava version &quot;1.8.0_221&quot;\nJava(TM) SE Runtime Environment (build 1.8.0_221-b11)\nJava HotSpot(TM) 64-Bit Server VM (build 25.221-b11, mixed mode)\n\n</code></pre>","site":{"data":{}},"excerpt":"<p>这是个大坑 平时装个JDK这么简单的事 在WSL上问题还真不少</p>","more":"<h3 id=\"安装环境\"><a href=\"#安装环境\" class=\"headerlink\" title=\"安装环境\"></a>安装环境</h3><pre><code>适用于 Linux 的 Windows 子系统:\nUbuntu-18.04 (默认)</code></pre><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>以前都是用的centos,直接<code>yum localinstall ./jdk-???-linux-x64.rpm</code>就可以安装本地的RPM包了。<br>但是现在使用的Ubuntu，只能安装DEB包，查询了一下有三种安装方式：</p>\n<ul>\n<li>RPM包转制为DEB包</li>\n<li>使用开箱即用的tar.gz并配置环境变量</li>\n<li>使用ppa源安装</li>\n</ul>\n<h3 id=\"开始安装\"><a href=\"#开始安装\" class=\"headerlink\" title=\"开始安装\"></a>开始安装</h3><p>很明显使用ppa源安装更稳定不容易遇到问题，参考了此文章<br><a href=\"http://www.webupd8.org/2012/09/install-oracle-java-8-in-ubuntu-via-ppa.html\" target=\"_blank\" rel=\"noopener\">Install Oracle Java 8 (JDK8 and JRE8) in Ubuntu or Linux Mint</a></p>\n<pre><code>sudo add-apt-repository ppa:webupd8team/java    //添加PPA源\nsudo apt-get update                             //更新本地包\nsudo apt-get install oracle-java8-installer     //安装JDK\n\n// 很遗憾报错了\n\nroot@DESKTOP-UFOJIL7:/wsl_share# apt-get install oracle-java8-installer\nReading package lists... Done\nBuilding dependency tree\nReading state information... Done\nPackage oracle-java8-installer is not available, but is referred to by another package.\nThis may mean that the package is missing, has been obsoleted, or\nis only available from another source\n\nE: Package &#39;oracle-java8-installer&#39; has no installation candidate</code></pre><h3 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h3><p>在这里找到了答案<br><a href=\"https://askubuntu.com/questions/790671/oracle-java8-installer-no-installation-candidate\" target=\"_blank\" rel=\"noopener\">Oracle-Java8-Installer: No installation candidate</a></p>\n<p>&gt; NOTE: This answer no longer works, as the WebUpd8 PPA has been deprecated since Oracle has changed licensing and access restrictions to the Oracle Java codebase. Details at <a href=\"http://www.webupd8.org/2014/03/how-to-install-oracle-java-8-in-debian.html\" target=\"_blank\" rel=\"noopener\">http://www.webupd8.org/2014/03/how-to-install-oracle-java-8-in-debian.html</a></p>\n<p>翻译一下</p>\n<p>&gt;注意：此答案不再有效，因为WebUpd8 PPA已被弃用，因为Oracle已将许可和访问限制更改为Oracle Java代码库。 有关详细信息， 请访问<a href=\"http://www.webupd8.org/2014/03/how-to-install-oracle-java-8-in-debian.html\" target=\"_blank\" rel=\"noopener\">http://www.webupd8.org/2014/03/how-to-install-oracle-java-8-in-debian.html</a></p>\n<p>既然如此，那没啥办法只能手动安装一个了</p>\n<h3 id=\"手动配置\"><a href=\"#手动配置\" class=\"headerlink\" title=\"手动配置\"></a>手动配置</h3><p>首先下载一个<code>jdk-8u221-linux-x64.tar.gz</code>,拷贝到wsl_share中</p>\n<pre><code>root@DESKTOP-UFOJIL7:/wsl_share# tar -zxvf ./jdk-8u221-linux-x64.tar.gz      //首先解压\nroot@DESKTOP-UFOJIL7:/wsl_share# vim ~/.bashrc                              //配置环境变量</code></pre><pre><code>// bashrc中追加以下内容\nexport JAVA_HOME=/app/jdk1.8.0_221\nexport JRE_HOME=${JAVA_HOME}/jre\nexport CLASSPATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib\nexport PATH=${JAVA_HOME}/bin:$PATH</code></pre><pre><code>root@DESKTOP-UFOJIL7:/wsl_share# source ~/.bashrc    //重新加载环境变量\n\nroot@DESKTOP-UFOJIL7:/wsl_share# java -version\njava version &quot;1.8.0_221&quot;\nJava(TM) SE Runtime Environment (build 1.8.0_221-b11)\nJava HotSpot(TM) 64-Bit Server VM (build 25.221-b11, mixed mode)\n\n</code></pre>"},{"title":"PDF疑难杂症","date":"2021-08-26T09:50:10.000Z","comments":1,"cover":"https://www.adobe.com/content/dam/dx-dc/images/acrobat/about-adobe-pdf/desktop/DC-about-pdf-new-720x474.png.img.png","coverWidth":720,"coverHeight":424,"_content":"\nPDF是一个由Adobe编写现由国际标准化组织 (ISO) 维护的一个开放式标准，PDF 文档可以包含链接和按钮、表单域、音频、视频和业务逻辑。这种文件可进行电子签名，因此政府机构大量在用，但是仍然是个煞笔格式。\n\n<!--more-->\n## 编辑PDF相关的建议\n- IText有一整套pdf模板生成-填充-签名的工具链，如果公司愿意可以直接买服务，如果不愿意使用，那至少在pdf模板制作时需要统一PDF编辑工具。\n- IText工具集中包含一个`itext-rups`，该工具能展示pdf的结构树，方便debug\n- 推荐使用的pdf编辑工具为`PDF-XChange Editor`和`Adobe Acrobat DC`\n\n## 填充PDF容易遇到的问题\n### 文本域无法填充中文\n    检查文本框中使用的字体是否内嵌在Pdf中,如果没有内嵌，那么随便找一个文字，将该文字的字体设置为需要内嵌的字体并保存即可\n### 减小pdf的体积\n    可以使用编辑工具优化pdf，将未使用的字体都清理出pdf，pdf将只保留使用过的字形，这可能会影响不带字体的文本域填充\n### 文本域填充图片\n    在pdf标准中未定义图片文本域，当下的图片文本域都是基于ButtonField变形的，所以只需要给这个Button设置背景图片或者直接设置值为Base64即可\n### 按钮填充样式异常\n    pdf并未通过类型区分单选/复选框，而是为按钮定义了一系列的属性来决定其行为和样式\n    其中有一个样式列表，当按钮的value命中样式列表的key时，就会应用样式列表预定义的样式\n    因此直接检查为按钮填充的值是否与pdf工具中定义`按钮值`一致即可\n    *需要注意样式列表的key不能是中文，在`Acrobat`中`按钮值`被设置为中文时，会将`按钮值`定义在该按钮的opt属性中，在样式列表中定义key`\"0\"`，再将opt的属性映射过去，这种情况并不受大部分PDF的操作工具的支持，但是可以直接将按钮值填充为`\"0\"`来解决这个问题\n","source":"_posts/PDF疑难杂症以及治疗方法总结.md","raw":"---\ntitle: PDF疑难杂症\ndate: 2021-08-26 17:50:10\ncomments: true\ncategories:\n- [我永远爱学习]\ntags:\n- pdf\n\ncover: https://www.adobe.com/content/dam/dx-dc/images/acrobat/about-adobe-pdf/desktop/DC-about-pdf-new-720x474.png.img.png\ncoverWidth: 720\ncoverHeight: 424\n---\n\nPDF是一个由Adobe编写现由国际标准化组织 (ISO) 维护的一个开放式标准，PDF 文档可以包含链接和按钮、表单域、音频、视频和业务逻辑。这种文件可进行电子签名，因此政府机构大量在用，但是仍然是个煞笔格式。\n\n<!--more-->\n## 编辑PDF相关的建议\n- IText有一整套pdf模板生成-填充-签名的工具链，如果公司愿意可以直接买服务，如果不愿意使用，那至少在pdf模板制作时需要统一PDF编辑工具。\n- IText工具集中包含一个`itext-rups`，该工具能展示pdf的结构树，方便debug\n- 推荐使用的pdf编辑工具为`PDF-XChange Editor`和`Adobe Acrobat DC`\n\n## 填充PDF容易遇到的问题\n### 文本域无法填充中文\n    检查文本框中使用的字体是否内嵌在Pdf中,如果没有内嵌，那么随便找一个文字，将该文字的字体设置为需要内嵌的字体并保存即可\n### 减小pdf的体积\n    可以使用编辑工具优化pdf，将未使用的字体都清理出pdf，pdf将只保留使用过的字形，这可能会影响不带字体的文本域填充\n### 文本域填充图片\n    在pdf标准中未定义图片文本域，当下的图片文本域都是基于ButtonField变形的，所以只需要给这个Button设置背景图片或者直接设置值为Base64即可\n### 按钮填充样式异常\n    pdf并未通过类型区分单选/复选框，而是为按钮定义了一系列的属性来决定其行为和样式\n    其中有一个样式列表，当按钮的value命中样式列表的key时，就会应用样式列表预定义的样式\n    因此直接检查为按钮填充的值是否与pdf工具中定义`按钮值`一致即可\n    *需要注意样式列表的key不能是中文，在`Acrobat`中`按钮值`被设置为中文时，会将`按钮值`定义在该按钮的opt属性中，在样式列表中定义key`\"0\"`，再将opt的属性映射过去，这种情况并不受大部分PDF的操作工具的支持，但是可以直接将按钮值填充为`\"0\"`来解决这个问题\n","slug":"PDF疑难杂症以及治疗方法总结","published":1,"updated":"2021-09-02T10:06:08.928Z","layout":"post","photos":[],"link":"","_id":"cktp91zks000g4cow2sz95gc4","content":"<p>PDF是一个由Adobe编写现由国际标准化组织 (ISO) 维护的一个开放式标准，PDF 文档可以包含链接和按钮、表单域、音频、视频和业务逻辑。这种文件可进行电子签名，因此政府机构大量在用，但是仍然是个煞笔格式。</p>\n<a id=\"more\"></a>\n<h2 id=\"编辑PDF相关的建议\"><a href=\"#编辑PDF相关的建议\" class=\"headerlink\" title=\"编辑PDF相关的建议\"></a>编辑PDF相关的建议</h2><ul>\n<li>IText有一整套pdf模板生成-填充-签名的工具链，如果公司愿意可以直接买服务，如果不愿意使用，那至少在pdf模板制作时需要统一PDF编辑工具。</li>\n<li>IText工具集中包含一个<code>itext-rups</code>，该工具能展示pdf的结构树，方便debug</li>\n<li>推荐使用的pdf编辑工具为<code>PDF-XChange Editor</code>和<code>Adobe Acrobat DC</code></li>\n</ul>\n<h2 id=\"填充PDF容易遇到的问题\"><a href=\"#填充PDF容易遇到的问题\" class=\"headerlink\" title=\"填充PDF容易遇到的问题\"></a>填充PDF容易遇到的问题</h2><h3 id=\"文本域无法填充中文\"><a href=\"#文本域无法填充中文\" class=\"headerlink\" title=\"文本域无法填充中文\"></a>文本域无法填充中文</h3><pre><code>检查文本框中使用的字体是否内嵌在Pdf中,如果没有内嵌，那么随便找一个文字，将该文字的字体设置为需要内嵌的字体并保存即可</code></pre><h3 id=\"减小pdf的体积\"><a href=\"#减小pdf的体积\" class=\"headerlink\" title=\"减小pdf的体积\"></a>减小pdf的体积</h3><pre><code>可以使用编辑工具优化pdf，将未使用的字体都清理出pdf，pdf将只保留使用过的字形，这可能会影响不带字体的文本域填充</code></pre><h3 id=\"文本域填充图片\"><a href=\"#文本域填充图片\" class=\"headerlink\" title=\"文本域填充图片\"></a>文本域填充图片</h3><pre><code>在pdf标准中未定义图片文本域，当下的图片文本域都是基于ButtonField变形的，所以只需要给这个Button设置背景图片或者直接设置值为Base64即可</code></pre><h3 id=\"按钮填充样式异常\"><a href=\"#按钮填充样式异常\" class=\"headerlink\" title=\"按钮填充样式异常\"></a>按钮填充样式异常</h3><pre><code>pdf并未通过类型区分单选/复选框，而是为按钮定义了一系列的属性来决定其行为和样式\n其中有一个样式列表，当按钮的value命中样式列表的key时，就会应用样式列表预定义的样式\n因此直接检查为按钮填充的值是否与pdf工具中定义`按钮值`一致即可\n*需要注意样式列表的key不能是中文，在`Acrobat`中`按钮值`被设置为中文时，会将`按钮值`定义在该按钮的opt属性中，在样式列表中定义key`&quot;0&quot;`，再将opt的属性映射过去，这种情况并不受大部分PDF的操作工具的支持，但是可以直接将按钮值填充为`&quot;0&quot;`来解决这个问题</code></pre>","site":{"data":{}},"excerpt":"<p>PDF是一个由Adobe编写现由国际标准化组织 (ISO) 维护的一个开放式标准，PDF 文档可以包含链接和按钮、表单域、音频、视频和业务逻辑。这种文件可进行电子签名，因此政府机构大量在用，但是仍然是个煞笔格式。</p>","more":"<h2 id=\"编辑PDF相关的建议\"><a href=\"#编辑PDF相关的建议\" class=\"headerlink\" title=\"编辑PDF相关的建议\"></a>编辑PDF相关的建议</h2><ul>\n<li>IText有一整套pdf模板生成-填充-签名的工具链，如果公司愿意可以直接买服务，如果不愿意使用，那至少在pdf模板制作时需要统一PDF编辑工具。</li>\n<li>IText工具集中包含一个<code>itext-rups</code>，该工具能展示pdf的结构树，方便debug</li>\n<li>推荐使用的pdf编辑工具为<code>PDF-XChange Editor</code>和<code>Adobe Acrobat DC</code></li>\n</ul>\n<h2 id=\"填充PDF容易遇到的问题\"><a href=\"#填充PDF容易遇到的问题\" class=\"headerlink\" title=\"填充PDF容易遇到的问题\"></a>填充PDF容易遇到的问题</h2><h3 id=\"文本域无法填充中文\"><a href=\"#文本域无法填充中文\" class=\"headerlink\" title=\"文本域无法填充中文\"></a>文本域无法填充中文</h3><pre><code>检查文本框中使用的字体是否内嵌在Pdf中,如果没有内嵌，那么随便找一个文字，将该文字的字体设置为需要内嵌的字体并保存即可</code></pre><h3 id=\"减小pdf的体积\"><a href=\"#减小pdf的体积\" class=\"headerlink\" title=\"减小pdf的体积\"></a>减小pdf的体积</h3><pre><code>可以使用编辑工具优化pdf，将未使用的字体都清理出pdf，pdf将只保留使用过的字形，这可能会影响不带字体的文本域填充</code></pre><h3 id=\"文本域填充图片\"><a href=\"#文本域填充图片\" class=\"headerlink\" title=\"文本域填充图片\"></a>文本域填充图片</h3><pre><code>在pdf标准中未定义图片文本域，当下的图片文本域都是基于ButtonField变形的，所以只需要给这个Button设置背景图片或者直接设置值为Base64即可</code></pre><h3 id=\"按钮填充样式异常\"><a href=\"#按钮填充样式异常\" class=\"headerlink\" title=\"按钮填充样式异常\"></a>按钮填充样式异常</h3><pre><code>pdf并未通过类型区分单选/复选框，而是为按钮定义了一系列的属性来决定其行为和样式\n其中有一个样式列表，当按钮的value命中样式列表的key时，就会应用样式列表预定义的样式\n因此直接检查为按钮填充的值是否与pdf工具中定义`按钮值`一致即可\n*需要注意样式列表的key不能是中文，在`Acrobat`中`按钮值`被设置为中文时，会将`按钮值`定义在该按钮的opt属性中，在样式列表中定义key`&quot;0&quot;`，再将opt的属性映射过去，这种情况并不受大部分PDF的操作工具的支持，但是可以直接将按钮值填充为`&quot;0&quot;`来解决这个问题</code></pre>"},{"title":"SpringBoot中的redis密码问题","date":"2019-05-13T04:03:01.000Z","updated":"2020-02-20T07:41:36.000Z","comments":1,"_content":"\n很简单的一个问题，花了大力气去解决。重要的是解决问题的方式和思路。\n<!--more-->\n\n## 出现问题\n \n出问题的配置如下\n\n\n---\n\napplication.yml\n\n```yml\nspring:\n  redis:\n    # REDIS_URL\n    url: redis://192.168.1.233:6379\n    # 如果有密码\n    password: testpassword123\n    # 存储到分区1\n    database: 1\n    # 默认超时2000\n    timeout: 3000\n\n\n```\n\n\n报错的日志\n\n```log\n[20190827 20:42:53] ERROR 7900 --- [nio-8086-exec-2] c.z.v.d.a.c.mvc.GlobalExceptionHandler   : Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n\norg.springframework.data.redis.RedisConnectionFailureException: Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n\tat org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getNativeConnection(LettuceConnectionFactory.java:1092)\n\tat org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getConnection(LettuceConnectionFactory.java:1065)\n\tat org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getSharedConnection(LettuceConnectionFactory.java:865)\n\tat org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getConnection(LettuceConnectionFactory.java:340)\n\tat org.springframework.data.redis.cache.DefaultRedisCacheWriter.execute(DefaultRedisCacheWriter.java:238)\n\tat org.springframework.data.redis.cache.DefaultRedisCacheWriter.get(DefaultRedisCacheWriter.java:109)\n\tat org.springframework.data.redis.cache.RedisCache.lookup(RedisCache.java:82)\n\tat org.springframework.cache.support.AbstractValueAdaptingCache.get(AbstractValueAdaptingCache.java:58)\n\tat org.springframework.cache.interceptor.AbstractCacheInvoker.doGet(AbstractCacheInvoker.java:73)\n\tat org.springframework.cache.interceptor.CacheAspectSupport.findInCaches(CacheAspectSupport.java:554)\n\tat org.springframework.cache.interceptor.CacheAspectSupport.findCachedItem(CacheAspectSupport.java:519)\n\tat org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:401)\n\tat org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:345)\n\tat org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:61)\n\tat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)\n\tat org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)\n\tat com.zunchen.video.dmp.service.impl.onvif.OnvifDeviceCacheServiceImpl$EnhancerBySpringCGLIB$913f47a3.connectOnvifDevice(<generated>)\n\tat com.zunchen.video.dmp.admin.api.ConnectDeviceApiController.connect(ConnectDeviceApiController.java:36)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:215)\n\tat org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:142)\n\tat org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)\n\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)\n\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)\n\tat org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)\n\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)\n\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)\n\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:998)\n\tat org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:890)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:634)\n\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:875)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:741)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.boot.actuate.web.trace.servlet.HttpTraceFilter.doFilterInternal(HttpTraceFilter.java:90)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:154)\n\tat org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:122)\n\tat org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.doFilterInternal(WebMvcMetricsFilter.java:107)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:770)\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1415)\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Thread.java:748)\nCaused by: io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n\tat io.lettuce.core.ExceptionFactory.createExecutionException(ExceptionFactory.java:135)\n\tat io.lettuce.core.LettuceFutures.awaitOrCancel(LettuceFutures.java:122)\n\tat io.lettuce.core.AbstractRedisAsyncCommands.select(AbstractRedisAsyncCommands.java:1194)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat io.lettuce.core.FutureSyncInvocationHandler.handleInvocation(FutureSyncInvocationHandler.java:57)\n\tat io.lettuce.core.internal.AbstractInvocationHandler.invoke(AbstractInvocationHandler.java:80)\n\tat com.sun.proxy.$Proxy206.select(Unknown Source)\n\tat org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getNativeConnection(LettuceConnectionFactory.java:1087)\n\t... 69 common frames omitted\n```\n\n## 查询资料\n\n - [spring boot 配置redis 报错 NOAUTH Authentication required](https://bbs.csdn.net/topics/392009425)\n - [springboot整合redis报错NOAUTH Authentication required.解决方案](https://www.twblogs.net/a/5b7e13012b717768385523f9/zh-cn)\n \n### 归纳\n  大多解决方案都是通过配置注入的RedisConfig来setPassword解决的，SpringBoot未注入密码的原因仍然不明。\n\n## 原因探究\n\n### 原因分析\n\n  由报错信息可以看出，最终抛出的异常是io.lettuce.core.RedisCommandExecutionException，其中lettuce不知道是什么。\n\n  通过查阅资料 [高级的 Redis Java 客户端 Lettuce](https://toutiao.io/posts/pknpcs/preview) 得知lettuce是springboot2.0中用来代替jedis的新的redis客户端。\n\n  那为何lettuce为何会报错呢？这是我最大的疑惑，我决定去spring.redis的自动配置类中看看到底发生了什么\n\n### 源码跟踪\n\n&gt; spring.redis的自动配置包：org.springframework.boot.autoconfigure.data.redis\n\n![](leanote://file/getImage?fileId=5d847766e1488a763c000011)\n\n看着这个目录结构，第一反应直奔LettuceConnectionConfiguration中去看源码。\n\n![](leanote://file/getImage?fileId=5d84778be1488a763c000012)\n\n在其构造方法处打断点发现是拿到了密码的，发现同类下有一方法createLettuceConnectionFactory();明显是创建连接工厂的方法，断点套上去。\n\n![](leanote://file/getImage?fileId=5d8477a7e1488a763c000013)\n\n这个方法中干了啥，它看了看配置文件中有没有包含${spring.redis.sentinel}和${spring.redis.cluster}的配置，如果有就拿对应的配置去创建连接工厂。但是yml中既没有配置哨兵模式也没有配置集群模式，所以进入独立模式getStandaloneConfig();\n\n![](leanote://file/getImage?fileId=5d8478d0e1488a763c000014)\n\n顺手计算一下，看看standaloneConfig长什么样子…..嗯???!!!……密码呢？……发生了啥？\n\n![](leanote://file/getImage?fileId=5d8478e8e1488a763c000015)\n\n问题找到了，感觉自己好蠢。\n\n## 解决问题\n\n### 修改配置\n\n```yml\nspring:\n  redis:\n    # REDIS_URL 中自己带上密码\n    # Connection URL. Overrides host, port, and password. User is ignored. Example:\n    # redis://user:password@example.com:6379\n    # url: redis://UserIsIgnored:testpassword123@192.168.1.233:6379\n    # HOST 和 PASSWORD 是一套配置\n    host: 192.168.1.233\n    # 如果有密码 （用于RedisTemplate ，Lettuce不会拿这个password）\n    password: testpassword123\n    # 存储到分区1\n    database: 1\n    # 默认超时2000\n    timeout: 3000\n```\n\n修改后启动：\n\n```log\n[20190828 03:15:04] ERROR 8564 --- [nio-8086-exec-2] c.z.v.d.a.c.mvc.GlobalExceptionHandler   : Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n\norg.springframework.data.redis.RedisConnectionFailureException: Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n\tat org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getNativeConnection(LettuceConnectionFactory.java:1092)\n\tat org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getConnection(LettuceConnectionFactory.java:1065)\n\tat org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getSharedConnection(LettuceConnectionFactory.java:865)\n\tat org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getConnection(LettuceConnectionFactory.java:340)\n\tat org.springframework.data.redis.cache.DefaultRedisCacheWriter.execute(DefaultRedisCacheWriter.java:238)\n\tat org.springframework.data.redis.cache.DefaultRedisCacheWriter.get(DefaultRedisCacheWriter.java:109)\n\tat org.springframework.data.redis.cache.RedisCache.lookup(RedisCache.java:82)\n\tat org.springframework.cache.support.AbstractValueAdaptingCache.get(AbstractValueAdaptingCache.java:58)\n\tat org.springframework.cache.interceptor.AbstractCacheInvoker.doGet(AbstractCacheInvoker.java:73)\n\tat org.springframework.cache.interceptor.CacheAspectSupport.findInCaches(CacheAspectSupport.java:554)\n\tat org.springframework.cache.interceptor.CacheAspectSupport.findCachedItem(CacheAspectSupport.java:519)\n\tat org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:401)\n\tat org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:345)\n\tat org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:61)\n\tat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)\n\tat org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)\n\tat com.zunchen.video.dmp.service.impl.onvif.OnvifDeviceCacheServiceImpl$EnhancerBySpringCGLIB$b001f767.connectOnvifDevice(<generated>)\n\tat com.zunchen.video.dmp.admin.api.ConnectDeviceApiController.connect(ConnectDeviceApiController.java:36)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:215)\n\tat org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:142)\n\tat org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)\n\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)\n\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)\n\tat org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)\n\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)\n\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)\n\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:998)\n\tat org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:890)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:634)\n\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:875)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:741)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.boot.actuate.web.trace.servlet.HttpTraceFilter.doFilterInternal(HttpTraceFilter.java:90)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:154)\n\tat org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:122)\n\tat org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.doFilterInternal(WebMvcMetricsFilter.java:107)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:770)\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1415)\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Thread.java:748)\n```\n\n仍然在报错，这下尴尬了。\n\n\n### 再次解决问题\n\n![](leanote://file/getImage?fileId=5d847965e1488a763c000016)\n\n径直来到报错信息提示的地方，估计是红框出出现了异常。此处调用的是接口方法，不知道进了那个方法，没关系，打个断点强制步入。\n\n![](leanote://file/getImage?fileId=5d847984e1488a763c000017)\n\n有点懒，不想解释了，直接画图，发现是redisURISupplier中的password仍然是空的。不想知道为什么了，我只想解决问题。源码点过去看下。\n\n![](leanote://file/getImage?fileId=5d847996e1488a763c000018)\n\n 查看该类的构造方法，这个东西正在解析RedisURI，那RedisURI哪儿来的呢？配置里配的呗。\n \n## 成功解决问题\n\n```yml\nspring:\n  redis:\n    # REDIS_URL 中自己带上密码\n    # Connection URL. Overrides host, port, and password. User is ignored. Example:\n    # redis://user:password@example.com:6379\n    url: redis://UserIsIgnored:testpassword123@192.168.1.233:6379\n    # HOST 和 PASSWORD 是一套配置\n    # host: 192.168.1.233\n    # 如果有密码 （用于RedisTemplate ，Lettuce不会拿这个password）\n    # password: testpassword123\n    # 存储到分区1\n    database: 1\n    # 默认超时2000\n    timeout: 3000\n```\n\n这次好了，redis成功连接。大功告成。\n\n\n\n\n\n\n","source":"_posts/SpringBoot中的redis密码问题.md","raw":"---\ntitle: 'SpringBoot中的redis密码问题'\ndate: 2019/05/13 12:03:01\nupdated: 2020/2/20 15:41:36\ncomments: true\ncategories: \n    - [我永远爱学习]\ntags: \n    - spring\n    - java\n    - debug\n---\n\n很简单的一个问题，花了大力气去解决。重要的是解决问题的方式和思路。\n<!--more-->\n\n## 出现问题\n \n出问题的配置如下\n\n\n---\n\napplication.yml\n\n```yml\nspring:\n  redis:\n    # REDIS_URL\n    url: redis://192.168.1.233:6379\n    # 如果有密码\n    password: testpassword123\n    # 存储到分区1\n    database: 1\n    # 默认超时2000\n    timeout: 3000\n\n\n```\n\n\n报错的日志\n\n```log\n[20190827 20:42:53] ERROR 7900 --- [nio-8086-exec-2] c.z.v.d.a.c.mvc.GlobalExceptionHandler   : Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n\norg.springframework.data.redis.RedisConnectionFailureException: Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n\tat org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getNativeConnection(LettuceConnectionFactory.java:1092)\n\tat org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getConnection(LettuceConnectionFactory.java:1065)\n\tat org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getSharedConnection(LettuceConnectionFactory.java:865)\n\tat org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getConnection(LettuceConnectionFactory.java:340)\n\tat org.springframework.data.redis.cache.DefaultRedisCacheWriter.execute(DefaultRedisCacheWriter.java:238)\n\tat org.springframework.data.redis.cache.DefaultRedisCacheWriter.get(DefaultRedisCacheWriter.java:109)\n\tat org.springframework.data.redis.cache.RedisCache.lookup(RedisCache.java:82)\n\tat org.springframework.cache.support.AbstractValueAdaptingCache.get(AbstractValueAdaptingCache.java:58)\n\tat org.springframework.cache.interceptor.AbstractCacheInvoker.doGet(AbstractCacheInvoker.java:73)\n\tat org.springframework.cache.interceptor.CacheAspectSupport.findInCaches(CacheAspectSupport.java:554)\n\tat org.springframework.cache.interceptor.CacheAspectSupport.findCachedItem(CacheAspectSupport.java:519)\n\tat org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:401)\n\tat org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:345)\n\tat org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:61)\n\tat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)\n\tat org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)\n\tat com.zunchen.video.dmp.service.impl.onvif.OnvifDeviceCacheServiceImpl$EnhancerBySpringCGLIB$913f47a3.connectOnvifDevice(<generated>)\n\tat com.zunchen.video.dmp.admin.api.ConnectDeviceApiController.connect(ConnectDeviceApiController.java:36)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:215)\n\tat org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:142)\n\tat org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)\n\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)\n\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)\n\tat org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)\n\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)\n\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)\n\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:998)\n\tat org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:890)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:634)\n\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:875)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:741)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.boot.actuate.web.trace.servlet.HttpTraceFilter.doFilterInternal(HttpTraceFilter.java:90)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:154)\n\tat org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:122)\n\tat org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.doFilterInternal(WebMvcMetricsFilter.java:107)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:770)\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1415)\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Thread.java:748)\nCaused by: io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n\tat io.lettuce.core.ExceptionFactory.createExecutionException(ExceptionFactory.java:135)\n\tat io.lettuce.core.LettuceFutures.awaitOrCancel(LettuceFutures.java:122)\n\tat io.lettuce.core.AbstractRedisAsyncCommands.select(AbstractRedisAsyncCommands.java:1194)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat io.lettuce.core.FutureSyncInvocationHandler.handleInvocation(FutureSyncInvocationHandler.java:57)\n\tat io.lettuce.core.internal.AbstractInvocationHandler.invoke(AbstractInvocationHandler.java:80)\n\tat com.sun.proxy.$Proxy206.select(Unknown Source)\n\tat org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getNativeConnection(LettuceConnectionFactory.java:1087)\n\t... 69 common frames omitted\n```\n\n## 查询资料\n\n - [spring boot 配置redis 报错 NOAUTH Authentication required](https://bbs.csdn.net/topics/392009425)\n - [springboot整合redis报错NOAUTH Authentication required.解决方案](https://www.twblogs.net/a/5b7e13012b717768385523f9/zh-cn)\n \n### 归纳\n  大多解决方案都是通过配置注入的RedisConfig来setPassword解决的，SpringBoot未注入密码的原因仍然不明。\n\n## 原因探究\n\n### 原因分析\n\n  由报错信息可以看出，最终抛出的异常是io.lettuce.core.RedisCommandExecutionException，其中lettuce不知道是什么。\n\n  通过查阅资料 [高级的 Redis Java 客户端 Lettuce](https://toutiao.io/posts/pknpcs/preview) 得知lettuce是springboot2.0中用来代替jedis的新的redis客户端。\n\n  那为何lettuce为何会报错呢？这是我最大的疑惑，我决定去spring.redis的自动配置类中看看到底发生了什么\n\n### 源码跟踪\n\n&gt; spring.redis的自动配置包：org.springframework.boot.autoconfigure.data.redis\n\n![](leanote://file/getImage?fileId=5d847766e1488a763c000011)\n\n看着这个目录结构，第一反应直奔LettuceConnectionConfiguration中去看源码。\n\n![](leanote://file/getImage?fileId=5d84778be1488a763c000012)\n\n在其构造方法处打断点发现是拿到了密码的，发现同类下有一方法createLettuceConnectionFactory();明显是创建连接工厂的方法，断点套上去。\n\n![](leanote://file/getImage?fileId=5d8477a7e1488a763c000013)\n\n这个方法中干了啥，它看了看配置文件中有没有包含${spring.redis.sentinel}和${spring.redis.cluster}的配置，如果有就拿对应的配置去创建连接工厂。但是yml中既没有配置哨兵模式也没有配置集群模式，所以进入独立模式getStandaloneConfig();\n\n![](leanote://file/getImage?fileId=5d8478d0e1488a763c000014)\n\n顺手计算一下，看看standaloneConfig长什么样子…..嗯???!!!……密码呢？……发生了啥？\n\n![](leanote://file/getImage?fileId=5d8478e8e1488a763c000015)\n\n问题找到了，感觉自己好蠢。\n\n## 解决问题\n\n### 修改配置\n\n```yml\nspring:\n  redis:\n    # REDIS_URL 中自己带上密码\n    # Connection URL. Overrides host, port, and password. User is ignored. Example:\n    # redis://user:password@example.com:6379\n    # url: redis://UserIsIgnored:testpassword123@192.168.1.233:6379\n    # HOST 和 PASSWORD 是一套配置\n    host: 192.168.1.233\n    # 如果有密码 （用于RedisTemplate ，Lettuce不会拿这个password）\n    password: testpassword123\n    # 存储到分区1\n    database: 1\n    # 默认超时2000\n    timeout: 3000\n```\n\n修改后启动：\n\n```log\n[20190828 03:15:04] ERROR 8564 --- [nio-8086-exec-2] c.z.v.d.a.c.mvc.GlobalExceptionHandler   : Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n\norg.springframework.data.redis.RedisConnectionFailureException: Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n\tat org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getNativeConnection(LettuceConnectionFactory.java:1092)\n\tat org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getConnection(LettuceConnectionFactory.java:1065)\n\tat org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getSharedConnection(LettuceConnectionFactory.java:865)\n\tat org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getConnection(LettuceConnectionFactory.java:340)\n\tat org.springframework.data.redis.cache.DefaultRedisCacheWriter.execute(DefaultRedisCacheWriter.java:238)\n\tat org.springframework.data.redis.cache.DefaultRedisCacheWriter.get(DefaultRedisCacheWriter.java:109)\n\tat org.springframework.data.redis.cache.RedisCache.lookup(RedisCache.java:82)\n\tat org.springframework.cache.support.AbstractValueAdaptingCache.get(AbstractValueAdaptingCache.java:58)\n\tat org.springframework.cache.interceptor.AbstractCacheInvoker.doGet(AbstractCacheInvoker.java:73)\n\tat org.springframework.cache.interceptor.CacheAspectSupport.findInCaches(CacheAspectSupport.java:554)\n\tat org.springframework.cache.interceptor.CacheAspectSupport.findCachedItem(CacheAspectSupport.java:519)\n\tat org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:401)\n\tat org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:345)\n\tat org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:61)\n\tat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)\n\tat org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)\n\tat com.zunchen.video.dmp.service.impl.onvif.OnvifDeviceCacheServiceImpl$EnhancerBySpringCGLIB$b001f767.connectOnvifDevice(<generated>)\n\tat com.zunchen.video.dmp.admin.api.ConnectDeviceApiController.connect(ConnectDeviceApiController.java:36)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:215)\n\tat org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:142)\n\tat org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)\n\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)\n\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)\n\tat org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)\n\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)\n\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)\n\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:998)\n\tat org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:890)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:634)\n\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:875)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:741)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.boot.actuate.web.trace.servlet.HttpTraceFilter.doFilterInternal(HttpTraceFilter.java:90)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:154)\n\tat org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:122)\n\tat org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.doFilterInternal(WebMvcMetricsFilter.java:107)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:770)\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1415)\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Thread.java:748)\n```\n\n仍然在报错，这下尴尬了。\n\n\n### 再次解决问题\n\n![](leanote://file/getImage?fileId=5d847965e1488a763c000016)\n\n径直来到报错信息提示的地方，估计是红框出出现了异常。此处调用的是接口方法，不知道进了那个方法，没关系，打个断点强制步入。\n\n![](leanote://file/getImage?fileId=5d847984e1488a763c000017)\n\n有点懒，不想解释了，直接画图，发现是redisURISupplier中的password仍然是空的。不想知道为什么了，我只想解决问题。源码点过去看下。\n\n![](leanote://file/getImage?fileId=5d847996e1488a763c000018)\n\n 查看该类的构造方法，这个东西正在解析RedisURI，那RedisURI哪儿来的呢？配置里配的呗。\n \n## 成功解决问题\n\n```yml\nspring:\n  redis:\n    # REDIS_URL 中自己带上密码\n    # Connection URL. Overrides host, port, and password. User is ignored. Example:\n    # redis://user:password@example.com:6379\n    url: redis://UserIsIgnored:testpassword123@192.168.1.233:6379\n    # HOST 和 PASSWORD 是一套配置\n    # host: 192.168.1.233\n    # 如果有密码 （用于RedisTemplate ，Lettuce不会拿这个password）\n    # password: testpassword123\n    # 存储到分区1\n    database: 1\n    # 默认超时2000\n    timeout: 3000\n```\n\n这次好了，redis成功连接。大功告成。\n\n\n\n\n\n\n","slug":"SpringBoot中的redis密码问题","published":1,"layout":"post","photos":[],"link":"","_id":"cktp91zkt000j4cowfuy258xe","content":"<p>很简单的一个问题，花了大力气去解决。重要的是解决问题的方式和思路。</p>\n<a id=\"more\"></a>\n\n<h2 id=\"出现问题\"><a href=\"#出现问题\" class=\"headerlink\" title=\"出现问题\"></a>出现问题</h2><p>出问题的配置如下</p>\n<hr>\n<p>application.yml</p>\n<pre><code class=\"yml\">spring:\n  redis:\n    # REDIS_URL\n    url: redis://192.168.1.233:6379\n    # 如果有密码\n    password: testpassword123\n    # 存储到分区1\n    database: 1\n    # 默认超时2000\n    timeout: 3000\n\n</code></pre>\n<p>报错的日志</p>\n<pre><code class=\"log\">[20190827 20:42:53] ERROR 7900 --- [nio-8086-exec-2] c.z.v.d.a.c.mvc.GlobalExceptionHandler   : Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n\norg.springframework.data.redis.RedisConnectionFailureException: Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getNativeConnection(LettuceConnectionFactory.java:1092)\n    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getConnection(LettuceConnectionFactory.java:1065)\n    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getSharedConnection(LettuceConnectionFactory.java:865)\n    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getConnection(LettuceConnectionFactory.java:340)\n    at org.springframework.data.redis.cache.DefaultRedisCacheWriter.execute(DefaultRedisCacheWriter.java:238)\n    at org.springframework.data.redis.cache.DefaultRedisCacheWriter.get(DefaultRedisCacheWriter.java:109)\n    at org.springframework.data.redis.cache.RedisCache.lookup(RedisCache.java:82)\n    at org.springframework.cache.support.AbstractValueAdaptingCache.get(AbstractValueAdaptingCache.java:58)\n    at org.springframework.cache.interceptor.AbstractCacheInvoker.doGet(AbstractCacheInvoker.java:73)\n    at org.springframework.cache.interceptor.CacheAspectSupport.findInCaches(CacheAspectSupport.java:554)\n    at org.springframework.cache.interceptor.CacheAspectSupport.findCachedItem(CacheAspectSupport.java:519)\n    at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:401)\n    at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:345)\n    at org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:61)\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)\n    at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)\n    at com.zunchen.video.dmp.service.impl.onvif.OnvifDeviceCacheServiceImpl$EnhancerBySpringCGLIB$913f47a3.connectOnvifDevice(&lt;generated&gt;)\n    at com.zunchen.video.dmp.admin.api.ConnectDeviceApiController.connect(ConnectDeviceApiController.java:36)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:498)\n    at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:215)\n    at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:142)\n    at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)\n    at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)\n    at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)\n    at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)\n    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:998)\n    at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:890)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:634)\n    at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:875)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.springframework.boot.actuate.web.trace.servlet.HttpTraceFilter.doFilterInternal(HttpTraceFilter.java:90)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:154)\n    at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:122)\n    at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.doFilterInternal(WebMvcMetricsFilter.java:107)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)\n    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)\n    at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)\n    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)\n    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)\n    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\n    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)\n    at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)\n    at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n    at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:770)\n    at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1415)\n    at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n    at java.lang.Thread.run(Thread.java:748)\nCaused by: io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n    at io.lettuce.core.ExceptionFactory.createExecutionException(ExceptionFactory.java:135)\n    at io.lettuce.core.LettuceFutures.awaitOrCancel(LettuceFutures.java:122)\n    at io.lettuce.core.AbstractRedisAsyncCommands.select(AbstractRedisAsyncCommands.java:1194)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:498)\n    at io.lettuce.core.FutureSyncInvocationHandler.handleInvocation(FutureSyncInvocationHandler.java:57)\n    at io.lettuce.core.internal.AbstractInvocationHandler.invoke(AbstractInvocationHandler.java:80)\n    at com.sun.proxy.$Proxy206.select(Unknown Source)\n    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getNativeConnection(LettuceConnectionFactory.java:1087)\n    ... 69 common frames omitted</code></pre>\n<h2 id=\"查询资料\"><a href=\"#查询资料\" class=\"headerlink\" title=\"查询资料\"></a>查询资料</h2><ul>\n<li><a href=\"https://bbs.csdn.net/topics/392009425\" target=\"_blank\" rel=\"noopener\">spring boot 配置redis 报错 NOAUTH Authentication required</a></li>\n<li><a href=\"https://www.twblogs.net/a/5b7e13012b717768385523f9/zh-cn\" target=\"_blank\" rel=\"noopener\">springboot整合redis报错NOAUTH Authentication required.解决方案</a></li>\n</ul>\n<h3 id=\"归纳\"><a href=\"#归纳\" class=\"headerlink\" title=\"归纳\"></a>归纳</h3><p>  大多解决方案都是通过配置注入的RedisConfig来setPassword解决的，SpringBoot未注入密码的原因仍然不明。</p>\n<h2 id=\"原因探究\"><a href=\"#原因探究\" class=\"headerlink\" title=\"原因探究\"></a>原因探究</h2><h3 id=\"原因分析\"><a href=\"#原因分析\" class=\"headerlink\" title=\"原因分析\"></a>原因分析</h3><p>  由报错信息可以看出，最终抛出的异常是io.lettuce.core.RedisCommandExecutionException，其中lettuce不知道是什么。</p>\n<p>  通过查阅资料 <a href=\"https://toutiao.io/posts/pknpcs/preview\" target=\"_blank\" rel=\"noopener\">高级的 Redis Java 客户端 Lettuce</a> 得知lettuce是springboot2.0中用来代替jedis的新的redis客户端。</p>\n<p>  那为何lettuce为何会报错呢？这是我最大的疑惑，我决定去spring.redis的自动配置类中看看到底发生了什么</p>\n<h3 id=\"源码跟踪\"><a href=\"#源码跟踪\" class=\"headerlink\" title=\"源码跟踪\"></a>源码跟踪</h3><p>&gt; spring.redis的自动配置包：org.springframework.boot.autoconfigure.data.redis</p>\n<p><img src=\"leanote://file/getImage?fileId=5d847766e1488a763c000011\" alt=\"\"></p>\n<p>看着这个目录结构，第一反应直奔LettuceConnectionConfiguration中去看源码。</p>\n<p><img src=\"leanote://file/getImage?fileId=5d84778be1488a763c000012\" alt=\"\"></p>\n<p>在其构造方法处打断点发现是拿到了密码的，发现同类下有一方法createLettuceConnectionFactory();明显是创建连接工厂的方法，断点套上去。</p>\n<p><img src=\"leanote://file/getImage?fileId=5d8477a7e1488a763c000013\" alt=\"\"></p>\n<p>这个方法中干了啥，它看了看配置文件中有没有包含${spring.redis.sentinel}和${spring.redis.cluster}的配置，如果有就拿对应的配置去创建连接工厂。但是yml中既没有配置哨兵模式也没有配置集群模式，所以进入独立模式getStandaloneConfig();</p>\n<p><img src=\"leanote://file/getImage?fileId=5d8478d0e1488a763c000014\" alt=\"\"></p>\n<p>顺手计算一下，看看standaloneConfig长什么样子…..嗯???!!!……密码呢？……发生了啥？</p>\n<p><img src=\"leanote://file/getImage?fileId=5d8478e8e1488a763c000015\" alt=\"\"></p>\n<p>问题找到了，感觉自己好蠢。</p>\n<h2 id=\"解决问题\"><a href=\"#解决问题\" class=\"headerlink\" title=\"解决问题\"></a>解决问题</h2><h3 id=\"修改配置\"><a href=\"#修改配置\" class=\"headerlink\" title=\"修改配置\"></a>修改配置</h3><pre><code class=\"yml\">spring:\n  redis:\n    # REDIS_URL 中自己带上密码\n    # Connection URL. Overrides host, port, and password. User is ignored. Example:\n    # redis://user:password@example.com:6379\n    # url: redis://UserIsIgnored:testpassword123@192.168.1.233:6379\n    # HOST 和 PASSWORD 是一套配置\n    host: 192.168.1.233\n    # 如果有密码 （用于RedisTemplate ，Lettuce不会拿这个password）\n    password: testpassword123\n    # 存储到分区1\n    database: 1\n    # 默认超时2000\n    timeout: 3000</code></pre>\n<p>修改后启动：</p>\n<pre><code class=\"log\">[20190828 03:15:04] ERROR 8564 --- [nio-8086-exec-2] c.z.v.d.a.c.mvc.GlobalExceptionHandler   : Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n\norg.springframework.data.redis.RedisConnectionFailureException: Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getNativeConnection(LettuceConnectionFactory.java:1092)\n    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getConnection(LettuceConnectionFactory.java:1065)\n    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getSharedConnection(LettuceConnectionFactory.java:865)\n    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getConnection(LettuceConnectionFactory.java:340)\n    at org.springframework.data.redis.cache.DefaultRedisCacheWriter.execute(DefaultRedisCacheWriter.java:238)\n    at org.springframework.data.redis.cache.DefaultRedisCacheWriter.get(DefaultRedisCacheWriter.java:109)\n    at org.springframework.data.redis.cache.RedisCache.lookup(RedisCache.java:82)\n    at org.springframework.cache.support.AbstractValueAdaptingCache.get(AbstractValueAdaptingCache.java:58)\n    at org.springframework.cache.interceptor.AbstractCacheInvoker.doGet(AbstractCacheInvoker.java:73)\n    at org.springframework.cache.interceptor.CacheAspectSupport.findInCaches(CacheAspectSupport.java:554)\n    at org.springframework.cache.interceptor.CacheAspectSupport.findCachedItem(CacheAspectSupport.java:519)\n    at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:401)\n    at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:345)\n    at org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:61)\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)\n    at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)\n    at com.zunchen.video.dmp.service.impl.onvif.OnvifDeviceCacheServiceImpl$EnhancerBySpringCGLIB$b001f767.connectOnvifDevice(&lt;generated&gt;)\n    at com.zunchen.video.dmp.admin.api.ConnectDeviceApiController.connect(ConnectDeviceApiController.java:36)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:498)\n    at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:215)\n    at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:142)\n    at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)\n    at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)\n    at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)\n    at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)\n    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:998)\n    at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:890)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:634)\n    at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:875)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.springframework.boot.actuate.web.trace.servlet.HttpTraceFilter.doFilterInternal(HttpTraceFilter.java:90)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:154)\n    at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:122)\n    at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.doFilterInternal(WebMvcMetricsFilter.java:107)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)\n    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)\n    at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)\n    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)\n    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)\n    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\n    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)\n    at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)\n    at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n    at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:770)\n    at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1415)\n    at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n    at java.lang.Thread.run(Thread.java:748)</code></pre>\n<p>仍然在报错，这下尴尬了。</p>\n<h3 id=\"再次解决问题\"><a href=\"#再次解决问题\" class=\"headerlink\" title=\"再次解决问题\"></a>再次解决问题</h3><p><img src=\"leanote://file/getImage?fileId=5d847965e1488a763c000016\" alt=\"\"></p>\n<p>径直来到报错信息提示的地方，估计是红框出出现了异常。此处调用的是接口方法，不知道进了那个方法，没关系，打个断点强制步入。</p>\n<p><img src=\"leanote://file/getImage?fileId=5d847984e1488a763c000017\" alt=\"\"></p>\n<p>有点懒，不想解释了，直接画图，发现是redisURISupplier中的password仍然是空的。不想知道为什么了，我只想解决问题。源码点过去看下。</p>\n<p><img src=\"leanote://file/getImage?fileId=5d847996e1488a763c000018\" alt=\"\"></p>\n<p> 查看该类的构造方法，这个东西正在解析RedisURI，那RedisURI哪儿来的呢？配置里配的呗。\n </p>\n<h2 id=\"成功解决问题\"><a href=\"#成功解决问题\" class=\"headerlink\" title=\"成功解决问题\"></a>成功解决问题</h2><pre><code class=\"yml\">spring:\n  redis:\n    # REDIS_URL 中自己带上密码\n    # Connection URL. Overrides host, port, and password. User is ignored. Example:\n    # redis://user:password@example.com:6379\n    url: redis://UserIsIgnored:testpassword123@192.168.1.233:6379\n    # HOST 和 PASSWORD 是一套配置\n    # host: 192.168.1.233\n    # 如果有密码 （用于RedisTemplate ，Lettuce不会拿这个password）\n    # password: testpassword123\n    # 存储到分区1\n    database: 1\n    # 默认超时2000\n    timeout: 3000</code></pre>\n<p>这次好了，redis成功连接。大功告成。</p>\n","site":{"data":{}},"excerpt":"<p>很简单的一个问题，花了大力气去解决。重要的是解决问题的方式和思路。</p>","more":"<h2 id=\"出现问题\"><a href=\"#出现问题\" class=\"headerlink\" title=\"出现问题\"></a>出现问题</h2><p>出问题的配置如下</p>\n<hr>\n<p>application.yml</p>\n<pre><code class=\"yml\">spring:\n  redis:\n    # REDIS_URL\n    url: redis://192.168.1.233:6379\n    # 如果有密码\n    password: testpassword123\n    # 存储到分区1\n    database: 1\n    # 默认超时2000\n    timeout: 3000\n\n</code></pre>\n<p>报错的日志</p>\n<pre><code class=\"log\">[20190827 20:42:53] ERROR 7900 --- [nio-8086-exec-2] c.z.v.d.a.c.mvc.GlobalExceptionHandler   : Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n\norg.springframework.data.redis.RedisConnectionFailureException: Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getNativeConnection(LettuceConnectionFactory.java:1092)\n    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getConnection(LettuceConnectionFactory.java:1065)\n    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getSharedConnection(LettuceConnectionFactory.java:865)\n    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getConnection(LettuceConnectionFactory.java:340)\n    at org.springframework.data.redis.cache.DefaultRedisCacheWriter.execute(DefaultRedisCacheWriter.java:238)\n    at org.springframework.data.redis.cache.DefaultRedisCacheWriter.get(DefaultRedisCacheWriter.java:109)\n    at org.springframework.data.redis.cache.RedisCache.lookup(RedisCache.java:82)\n    at org.springframework.cache.support.AbstractValueAdaptingCache.get(AbstractValueAdaptingCache.java:58)\n    at org.springframework.cache.interceptor.AbstractCacheInvoker.doGet(AbstractCacheInvoker.java:73)\n    at org.springframework.cache.interceptor.CacheAspectSupport.findInCaches(CacheAspectSupport.java:554)\n    at org.springframework.cache.interceptor.CacheAspectSupport.findCachedItem(CacheAspectSupport.java:519)\n    at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:401)\n    at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:345)\n    at org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:61)\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)\n    at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)\n    at com.zunchen.video.dmp.service.impl.onvif.OnvifDeviceCacheServiceImpl$EnhancerBySpringCGLIB$913f47a3.connectOnvifDevice(&lt;generated&gt;)\n    at com.zunchen.video.dmp.admin.api.ConnectDeviceApiController.connect(ConnectDeviceApiController.java:36)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:498)\n    at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:215)\n    at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:142)\n    at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)\n    at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)\n    at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)\n    at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)\n    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:998)\n    at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:890)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:634)\n    at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:875)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.springframework.boot.actuate.web.trace.servlet.HttpTraceFilter.doFilterInternal(HttpTraceFilter.java:90)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:154)\n    at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:122)\n    at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.doFilterInternal(WebMvcMetricsFilter.java:107)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)\n    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)\n    at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)\n    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)\n    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)\n    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\n    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)\n    at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)\n    at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n    at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:770)\n    at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1415)\n    at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n    at java.lang.Thread.run(Thread.java:748)\nCaused by: io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n    at io.lettuce.core.ExceptionFactory.createExecutionException(ExceptionFactory.java:135)\n    at io.lettuce.core.LettuceFutures.awaitOrCancel(LettuceFutures.java:122)\n    at io.lettuce.core.AbstractRedisAsyncCommands.select(AbstractRedisAsyncCommands.java:1194)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:498)\n    at io.lettuce.core.FutureSyncInvocationHandler.handleInvocation(FutureSyncInvocationHandler.java:57)\n    at io.lettuce.core.internal.AbstractInvocationHandler.invoke(AbstractInvocationHandler.java:80)\n    at com.sun.proxy.$Proxy206.select(Unknown Source)\n    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getNativeConnection(LettuceConnectionFactory.java:1087)\n    ... 69 common frames omitted</code></pre>\n<h2 id=\"查询资料\"><a href=\"#查询资料\" class=\"headerlink\" title=\"查询资料\"></a>查询资料</h2><ul>\n<li><a href=\"https://bbs.csdn.net/topics/392009425\" target=\"_blank\" rel=\"noopener\">spring boot 配置redis 报错 NOAUTH Authentication required</a></li>\n<li><a href=\"https://www.twblogs.net/a/5b7e13012b717768385523f9/zh-cn\" target=\"_blank\" rel=\"noopener\">springboot整合redis报错NOAUTH Authentication required.解决方案</a></li>\n</ul>\n<h3 id=\"归纳\"><a href=\"#归纳\" class=\"headerlink\" title=\"归纳\"></a>归纳</h3><p>  大多解决方案都是通过配置注入的RedisConfig来setPassword解决的，SpringBoot未注入密码的原因仍然不明。</p>\n<h2 id=\"原因探究\"><a href=\"#原因探究\" class=\"headerlink\" title=\"原因探究\"></a>原因探究</h2><h3 id=\"原因分析\"><a href=\"#原因分析\" class=\"headerlink\" title=\"原因分析\"></a>原因分析</h3><p>  由报错信息可以看出，最终抛出的异常是io.lettuce.core.RedisCommandExecutionException，其中lettuce不知道是什么。</p>\n<p>  通过查阅资料 <a href=\"https://toutiao.io/posts/pknpcs/preview\" target=\"_blank\" rel=\"noopener\">高级的 Redis Java 客户端 Lettuce</a> 得知lettuce是springboot2.0中用来代替jedis的新的redis客户端。</p>\n<p>  那为何lettuce为何会报错呢？这是我最大的疑惑，我决定去spring.redis的自动配置类中看看到底发生了什么</p>\n<h3 id=\"源码跟踪\"><a href=\"#源码跟踪\" class=\"headerlink\" title=\"源码跟踪\"></a>源码跟踪</h3><p>&gt; spring.redis的自动配置包：org.springframework.boot.autoconfigure.data.redis</p>\n<p><img src=\"leanote://file/getImage?fileId=5d847766e1488a763c000011\" alt=\"\"></p>\n<p>看着这个目录结构，第一反应直奔LettuceConnectionConfiguration中去看源码。</p>\n<p><img src=\"leanote://file/getImage?fileId=5d84778be1488a763c000012\" alt=\"\"></p>\n<p>在其构造方法处打断点发现是拿到了密码的，发现同类下有一方法createLettuceConnectionFactory();明显是创建连接工厂的方法，断点套上去。</p>\n<p><img src=\"leanote://file/getImage?fileId=5d8477a7e1488a763c000013\" alt=\"\"></p>\n<p>这个方法中干了啥，它看了看配置文件中有没有包含${spring.redis.sentinel}和${spring.redis.cluster}的配置，如果有就拿对应的配置去创建连接工厂。但是yml中既没有配置哨兵模式也没有配置集群模式，所以进入独立模式getStandaloneConfig();</p>\n<p><img src=\"leanote://file/getImage?fileId=5d8478d0e1488a763c000014\" alt=\"\"></p>\n<p>顺手计算一下，看看standaloneConfig长什么样子…..嗯???!!!……密码呢？……发生了啥？</p>\n<p><img src=\"leanote://file/getImage?fileId=5d8478e8e1488a763c000015\" alt=\"\"></p>\n<p>问题找到了，感觉自己好蠢。</p>\n<h2 id=\"解决问题\"><a href=\"#解决问题\" class=\"headerlink\" title=\"解决问题\"></a>解决问题</h2><h3 id=\"修改配置\"><a href=\"#修改配置\" class=\"headerlink\" title=\"修改配置\"></a>修改配置</h3><pre><code class=\"yml\">spring:\n  redis:\n    # REDIS_URL 中自己带上密码\n    # Connection URL. Overrides host, port, and password. User is ignored. Example:\n    # redis://user:password@example.com:6379\n    # url: redis://UserIsIgnored:testpassword123@192.168.1.233:6379\n    # HOST 和 PASSWORD 是一套配置\n    host: 192.168.1.233\n    # 如果有密码 （用于RedisTemplate ，Lettuce不会拿这个password）\n    password: testpassword123\n    # 存储到分区1\n    database: 1\n    # 默认超时2000\n    timeout: 3000</code></pre>\n<p>修改后启动：</p>\n<pre><code class=\"log\">[20190828 03:15:04] ERROR 8564 --- [nio-8086-exec-2] c.z.v.d.a.c.mvc.GlobalExceptionHandler   : Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n\norg.springframework.data.redis.RedisConnectionFailureException: Unable to connect to Redis; nested exception is io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.\n    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getNativeConnection(LettuceConnectionFactory.java:1092)\n    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getConnection(LettuceConnectionFactory.java:1065)\n    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getSharedConnection(LettuceConnectionFactory.java:865)\n    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getConnection(LettuceConnectionFactory.java:340)\n    at org.springframework.data.redis.cache.DefaultRedisCacheWriter.execute(DefaultRedisCacheWriter.java:238)\n    at org.springframework.data.redis.cache.DefaultRedisCacheWriter.get(DefaultRedisCacheWriter.java:109)\n    at org.springframework.data.redis.cache.RedisCache.lookup(RedisCache.java:82)\n    at org.springframework.cache.support.AbstractValueAdaptingCache.get(AbstractValueAdaptingCache.java:58)\n    at org.springframework.cache.interceptor.AbstractCacheInvoker.doGet(AbstractCacheInvoker.java:73)\n    at org.springframework.cache.interceptor.CacheAspectSupport.findInCaches(CacheAspectSupport.java:554)\n    at org.springframework.cache.interceptor.CacheAspectSupport.findCachedItem(CacheAspectSupport.java:519)\n    at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:401)\n    at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:345)\n    at org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:61)\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)\n    at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)\n    at com.zunchen.video.dmp.service.impl.onvif.OnvifDeviceCacheServiceImpl$EnhancerBySpringCGLIB$b001f767.connectOnvifDevice(&lt;generated&gt;)\n    at com.zunchen.video.dmp.admin.api.ConnectDeviceApiController.connect(ConnectDeviceApiController.java:36)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:498)\n    at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:215)\n    at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:142)\n    at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)\n    at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)\n    at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)\n    at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)\n    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:998)\n    at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:890)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:634)\n    at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:875)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.springframework.boot.actuate.web.trace.servlet.HttpTraceFilter.doFilterInternal(HttpTraceFilter.java:90)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:154)\n    at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:122)\n    at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.doFilterInternal(WebMvcMetricsFilter.java:107)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)\n    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)\n    at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)\n    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)\n    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)\n    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\n    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)\n    at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)\n    at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n    at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:770)\n    at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1415)\n    at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n    at java.lang.Thread.run(Thread.java:748)</code></pre>\n<p>仍然在报错，这下尴尬了。</p>\n<h3 id=\"再次解决问题\"><a href=\"#再次解决问题\" class=\"headerlink\" title=\"再次解决问题\"></a>再次解决问题</h3><p><img src=\"leanote://file/getImage?fileId=5d847965e1488a763c000016\" alt=\"\"></p>\n<p>径直来到报错信息提示的地方，估计是红框出出现了异常。此处调用的是接口方法，不知道进了那个方法，没关系，打个断点强制步入。</p>\n<p><img src=\"leanote://file/getImage?fileId=5d847984e1488a763c000017\" alt=\"\"></p>\n<p>有点懒，不想解释了，直接画图，发现是redisURISupplier中的password仍然是空的。不想知道为什么了，我只想解决问题。源码点过去看下。</p>\n<p><img src=\"leanote://file/getImage?fileId=5d847996e1488a763c000018\" alt=\"\"></p>\n<p> 查看该类的构造方法，这个东西正在解析RedisURI，那RedisURI哪儿来的呢？配置里配的呗。\n </p>\n<h2 id=\"成功解决问题\"><a href=\"#成功解决问题\" class=\"headerlink\" title=\"成功解决问题\"></a>成功解决问题</h2><pre><code class=\"yml\">spring:\n  redis:\n    # REDIS_URL 中自己带上密码\n    # Connection URL. Overrides host, port, and password. User is ignored. Example:\n    # redis://user:password@example.com:6379\n    url: redis://UserIsIgnored:testpassword123@192.168.1.233:6379\n    # HOST 和 PASSWORD 是一套配置\n    # host: 192.168.1.233\n    # 如果有密码 （用于RedisTemplate ，Lettuce不会拿这个password）\n    # password: testpassword123\n    # 存储到分区1\n    database: 1\n    # 默认超时2000\n    timeout: 3000</code></pre>\n<p>这次好了，redis成功连接。大功告成。</p>"},{"title":"[ESP8266]01_刷写测试AT固件","date":"2020-11-16T14:34:01.000Z","cover":"/2020/11/16/%5BESP8266%5D01_刷写测试AT固件/title_s.jpg","coverWidth":981,"coverHeight":673,"_content":"\n## [ESP8266]01_刷写测试AT固件 TEST ","source":"_posts/[ESP8266]01_刷写测试AT固件.md","raw":"---\ntitle: \"[ESP8266]01_刷写测试AT固件\"\ndate: 2020/11/16 22:34:01\ncategories: \n    - [我永远爱学习]\ntags: \n    - 单片机\n    - IOT\ncover: /2020/11/16/%5BESP8266%5D01_刷写测试AT固件/title_s.jpg\ncoverWidth: 981\ncoverHeight: 673\n---\n\n## [ESP8266]01_刷写测试AT固件 TEST ","slug":"[ESP8266]01_刷写测试AT固件","published":1,"updated":"2021-07-28T03:03:19.615Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cktp91zkv000n4cowgwtl9465","content":"<h2 id=\"ESP8266-01-刷写测试AT固件-TEST\"><a href=\"#ESP8266-01-刷写测试AT固件-TEST\" class=\"headerlink\" title=\"[ESP8266]01_刷写测试AT固件 TEST\"></a>[ESP8266]01_刷写测试AT固件 TEST</h2>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"ESP8266-01-刷写测试AT固件-TEST\"><a href=\"#ESP8266-01-刷写测试AT固件-TEST\" class=\"headerlink\" title=\"[ESP8266]01_刷写测试AT固件 TEST\"></a>[ESP8266]01_刷写测试AT固件 TEST</h2>"},{"title":"[DEBUG日记]Swagger扫不到类-Jdk代理导致的反射类型故障","date":"2021-09-02T10:07:29.000Z","_content":"\n## 先说结论\n\njdk代理的问题，换用cglib代理就好了。随便找个配置类，加上` @EnableAspectJAutoProxy`注解即可解决。\n<!--more-->\n\n## 整理接口后突然暴毙\n\n整理了一下项目中的Controller，然后有几个接口就扫描不到了。无论怎么更换扫描注解都找不到这些接口，甚至使用包路径扫描都找不到，很是魔幻。\n\n## 哪痛治哪\n\n俗话说哪里痛治哪里，既然swagger扫不到接口，就先看看swagger到底是怎么去扫接口的\n\n1. 先看swagger的配置\n   ```java \n    @Bean(\"docket\")\n    public Docket docket() {\n        return new Docket(DocumentationType.SWAGGER_2)\n                .apiInfo(apiInfo())\n                .select()\n                // 扫描带Api注解的类\n                .apis(RequestHandlerSelectors.withClassAnnotation(Api.class))\n                .paths(PathSelectors.any())\n                .build()\n                .securitySchemes(securitySchemes())\n                .globalOperationParameters(globalOperationParameters())\n                ;\n    }\n   ```\n2. 再看上文中`.apis()`这个接口的源码\n   ```java\n   public ApiSelectorBuilder apis(Predicate<RequestHandler> selector) {\n       requestHandlerSelector = requestHandlerSelector.and(selector);\n       return this;\n   }\n   ```\n   看这方法签名，返回值是this没啥用,直接忽略。入参是个将`RequestHandler`处理成布尔值的函数， 根据其变量名`selector`可以猜测其作用是传入一个RequestHandler判断其是否满足条件,这里的条件是指啥？\n   当然是指我们从外部传进来的`RequestHandlerSelectors.withClassAnnotation(Api.class)`这个玩意儿啦！\n3. 在深入我们传入的`RequestHandlerSelectors.withClassAnnotation(Api.class)`中，看他的源码：\n   ```java\n   /**\n    * Predicate that matches RequestHandler with given annotation on the declaring class of the handler method\n    *\n    * @param annotation - annotation to check\n    * @return this\n    */\n   public static Predicate<RequestHandler> withClassAnnotation(final Class<? extends Annotation> annotation) {\n      return input -> declaringClass(input).map(annotationPresent(annotation)).orElse(false);\n   }   \n   ```\n   这里是判断是否满足条件的关键位置，每一个RequestHandler(就是上面的input)都会通过上文的表达式判断得到一个布尔值\n4. 再继续往前找到调用这个函数的地方\n   ```java\n   // 上面第二点的位置是在ApiSelectorBuilder中，要想找到第三点的函数真正在哪里被使用了，需要反向找回去\n   // 在springfox.documentation.spi.service.contexts.ApiSelector中找到了我们传入的`private final Predicate<RequestHandler> requestHandlerSelector;`\n   // 通过其getter反向找回去\n   // 找到了springfox.documentation.spring.web.scanners.ApiListingReferenceScanner#scan\n    public ApiListingReferenceScanResult scan(DocumentationContext context) {\n       LOG.info(\"Scanning for api listing references\");\n   \n       Map<ResourceGroup, List<RequestMappingContext>> resourceGroupRequestMappings\n           = new HashMap<>();\n   \n       int requestMappingContextId = 0;\n   \n       ApiSelector selector = context.getApiSelector();\n    // 看这里，要找的东西就在这里\n       Iterable<RequestHandler> matchingHandlers = context.getRequestHandlers().stream()\n           .filter(selector.getRequestHandlerSelector()).collect(toList());\n       for (RequestHandler handler : matchingHandlers) {\n         ResourceGroup resourceGroup = new ResourceGroup(\n             handler.groupName(),\n             handler.declaringClass(),\n             0);\n   \n         RequestMappingContext requestMappingContext\n             = new RequestMappingContext(\n             String.valueOf(requestMappingContextId),\n             context,\n             handler);\n   \n         resourceGroupRequestMappings.putIfAbsent(\n             resourceGroup,\n             new ArrayList<>());\n         resourceGroupRequestMappings.get(resourceGroup).add(requestMappingContext);\n   \n         ++requestMappingContextId;\n       }\n       return new ApiListingReferenceScanResult(resourceGroupRequestMappings);\n   }\n   ```\n5. 打上断点开始Debug，看看controller有没有被swagger扫到\n   ![ApiListingReferenceScanner](https://dreamccc-note-ia.oss-cn-chengdu.aliyuncs.com/note/%5BDEBUG%E6%97%A5%E8%AE%B0%5DSwagger%E6%89%AB%E4%B8%8D%E5%88%B0%E7%B1%BB-Jdk%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E7%9A%84%E5%8F%8D%E5%B0%84%E7%B1%BB%E5%9E%8B%E6%95%85%E9%9A%9C/ApiListingReferenceScanner.png \"ApiListingReferenceScanner\")\n   发现swagger是直接从spring中取出的RequestHandler，而我们的Controller是被Spring正常扫描的(废话，没被Spring扫到都不能用了好吧)\n6. 前往步骤3处打上条件断点\n   ![RequestHandlerSelectors#1](https://dreamccc-note-ia.oss-cn-chengdu.aliyuncs.com/note/%5BDEBUG%E6%97%A5%E8%AE%B0%5DSwagger%E6%89%AB%E4%B8%8D%E5%88%B0%E7%B1%BB-Jdk%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E7%9A%84%E5%8F%8D%E5%B0%84%E7%B1%BB%E5%9E%8B%E6%95%85%E9%9A%9C/RequestHandlerSelectors%231.png \"RequestHandlerSelectors#1\")\n   ？？？这是咋回事\n7. 继续排查\n   ![RequestHandlerSelectors#2](https://dreamccc-note-ia.oss-cn-chengdu.aliyuncs.com/note/%5BDEBUG%E6%97%A5%E8%AE%B0%5DSwagger%E6%89%AB%E4%B8%8D%E5%88%B0%E7%B1%BB-Jdk%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E7%9A%84%E5%8F%8D%E5%B0%84%E7%B1%BB%E5%9E%8B%E6%95%85%E9%9A%9C/RequestHandlerSelectors%232.png \"RequestHandlerSelectors#2\")\n   草，这个类被jdk代理了，这直接导致反射获取类型的时候获取到了jdk的`Proxy$?.class`这个类型，从而导致检查注解失败\n   `declaringClass()`方法原本应该获取到声明类，我们预计他应该会返回我们Controller的真实类型，但是由于Controller实现了一个接口，\n   导致Spring使用了jdk代理这个对象，从而导致获取声明类时获取到了jdk代理所用的类型，最终导致获取注解失败\n8. 问题清楚了，都是jdk代理的锅，那么我们有多个方法解决这个问题：\n    1. 使用继承代替实现\n    2. 使用cglib代替jdkProxy进行代理\n\n## 最终解决\n\n- 由于这里定义在Controller上的的接口是由其他模块的spi，为了保证调用安全，因此采用方式2来解决\n  ```java\n  // 随便找个配置类加注解\n  @EnableAspectJAutoProxy(\n      // 示代理应由 AOP 框架公开为ThreadLocal以通过org.springframework.aop.framework.AopContext类进行检索\n      exposeProxy = true,\n      // 指示是否要创建基于子类 (CGLIB) 的代理，而不是基于标准 Java 接口的代理\n      proxyTargetClass = true\n      )\n  ```\n  采用jdk的方式代理会更快，相较于cglib会有一定的性能提升，但应该仅在启动时有提升，类加载完毕Bean注册完成后应该都是一样的，随口BB一句没有验证过是否正确。\n- 最后上个图对比一下\n  ![RequestHandlerSelectors#3](https://dreamccc-note-ia.oss-cn-chengdu.aliyuncs.com/note/%5BDEBUG%E6%97%A5%E8%AE%B0%5DSwagger%E6%89%AB%E4%B8%8D%E5%88%B0%E7%B1%BB-Jdk%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E7%9A%84%E5%8F%8D%E5%B0%84%E7%B1%BB%E5%9E%8B%E6%95%85%E9%9A%9C/RequestHandlerSelectors%233.png \"RequestHandlerSelectors#3\")\n\n\n\n","source":"_posts/[DEBUG日记]Swagger扫不到类-Jdk代理导致的反射类型故障.md","raw":"---\ntitle: '[DEBUG日记]Swagger扫不到类-Jdk代理导致的反射类型故障' date: 2021-09-02 18:07:29\n\ncategories:\n\n- [我永远爱学习]\n\ntags:\n\n- debug\n\n---\n\n## 先说结论\n\njdk代理的问题，换用cglib代理就好了。随便找个配置类，加上` @EnableAspectJAutoProxy`注解即可解决。\n<!--more-->\n\n## 整理接口后突然暴毙\n\n整理了一下项目中的Controller，然后有几个接口就扫描不到了。无论怎么更换扫描注解都找不到这些接口，甚至使用包路径扫描都找不到，很是魔幻。\n\n## 哪痛治哪\n\n俗话说哪里痛治哪里，既然swagger扫不到接口，就先看看swagger到底是怎么去扫接口的\n\n1. 先看swagger的配置\n   ```java \n    @Bean(\"docket\")\n    public Docket docket() {\n        return new Docket(DocumentationType.SWAGGER_2)\n                .apiInfo(apiInfo())\n                .select()\n                // 扫描带Api注解的类\n                .apis(RequestHandlerSelectors.withClassAnnotation(Api.class))\n                .paths(PathSelectors.any())\n                .build()\n                .securitySchemes(securitySchemes())\n                .globalOperationParameters(globalOperationParameters())\n                ;\n    }\n   ```\n2. 再看上文中`.apis()`这个接口的源码\n   ```java\n   public ApiSelectorBuilder apis(Predicate<RequestHandler> selector) {\n       requestHandlerSelector = requestHandlerSelector.and(selector);\n       return this;\n   }\n   ```\n   看这方法签名，返回值是this没啥用,直接忽略。入参是个将`RequestHandler`处理成布尔值的函数， 根据其变量名`selector`可以猜测其作用是传入一个RequestHandler判断其是否满足条件,这里的条件是指啥？\n   当然是指我们从外部传进来的`RequestHandlerSelectors.withClassAnnotation(Api.class)`这个玩意儿啦！\n3. 在深入我们传入的`RequestHandlerSelectors.withClassAnnotation(Api.class)`中，看他的源码：\n   ```java\n   /**\n    * Predicate that matches RequestHandler with given annotation on the declaring class of the handler method\n    *\n    * @param annotation - annotation to check\n    * @return this\n    */\n   public static Predicate<RequestHandler> withClassAnnotation(final Class<? extends Annotation> annotation) {\n      return input -> declaringClass(input).map(annotationPresent(annotation)).orElse(false);\n   }   \n   ```\n   这里是判断是否满足条件的关键位置，每一个RequestHandler(就是上面的input)都会通过上文的表达式判断得到一个布尔值\n4. 再继续往前找到调用这个函数的地方\n   ```java\n   // 上面第二点的位置是在ApiSelectorBuilder中，要想找到第三点的函数真正在哪里被使用了，需要反向找回去\n   // 在springfox.documentation.spi.service.contexts.ApiSelector中找到了我们传入的`private final Predicate<RequestHandler> requestHandlerSelector;`\n   // 通过其getter反向找回去\n   // 找到了springfox.documentation.spring.web.scanners.ApiListingReferenceScanner#scan\n    public ApiListingReferenceScanResult scan(DocumentationContext context) {\n       LOG.info(\"Scanning for api listing references\");\n   \n       Map<ResourceGroup, List<RequestMappingContext>> resourceGroupRequestMappings\n           = new HashMap<>();\n   \n       int requestMappingContextId = 0;\n   \n       ApiSelector selector = context.getApiSelector();\n    // 看这里，要找的东西就在这里\n       Iterable<RequestHandler> matchingHandlers = context.getRequestHandlers().stream()\n           .filter(selector.getRequestHandlerSelector()).collect(toList());\n       for (RequestHandler handler : matchingHandlers) {\n         ResourceGroup resourceGroup = new ResourceGroup(\n             handler.groupName(),\n             handler.declaringClass(),\n             0);\n   \n         RequestMappingContext requestMappingContext\n             = new RequestMappingContext(\n             String.valueOf(requestMappingContextId),\n             context,\n             handler);\n   \n         resourceGroupRequestMappings.putIfAbsent(\n             resourceGroup,\n             new ArrayList<>());\n         resourceGroupRequestMappings.get(resourceGroup).add(requestMappingContext);\n   \n         ++requestMappingContextId;\n       }\n       return new ApiListingReferenceScanResult(resourceGroupRequestMappings);\n   }\n   ```\n5. 打上断点开始Debug，看看controller有没有被swagger扫到\n   ![ApiListingReferenceScanner](https://dreamccc-note-ia.oss-cn-chengdu.aliyuncs.com/note/%5BDEBUG%E6%97%A5%E8%AE%B0%5DSwagger%E6%89%AB%E4%B8%8D%E5%88%B0%E7%B1%BB-Jdk%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E7%9A%84%E5%8F%8D%E5%B0%84%E7%B1%BB%E5%9E%8B%E6%95%85%E9%9A%9C/ApiListingReferenceScanner.png \"ApiListingReferenceScanner\")\n   发现swagger是直接从spring中取出的RequestHandler，而我们的Controller是被Spring正常扫描的(废话，没被Spring扫到都不能用了好吧)\n6. 前往步骤3处打上条件断点\n   ![RequestHandlerSelectors#1](https://dreamccc-note-ia.oss-cn-chengdu.aliyuncs.com/note/%5BDEBUG%E6%97%A5%E8%AE%B0%5DSwagger%E6%89%AB%E4%B8%8D%E5%88%B0%E7%B1%BB-Jdk%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E7%9A%84%E5%8F%8D%E5%B0%84%E7%B1%BB%E5%9E%8B%E6%95%85%E9%9A%9C/RequestHandlerSelectors%231.png \"RequestHandlerSelectors#1\")\n   ？？？这是咋回事\n7. 继续排查\n   ![RequestHandlerSelectors#2](https://dreamccc-note-ia.oss-cn-chengdu.aliyuncs.com/note/%5BDEBUG%E6%97%A5%E8%AE%B0%5DSwagger%E6%89%AB%E4%B8%8D%E5%88%B0%E7%B1%BB-Jdk%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E7%9A%84%E5%8F%8D%E5%B0%84%E7%B1%BB%E5%9E%8B%E6%95%85%E9%9A%9C/RequestHandlerSelectors%232.png \"RequestHandlerSelectors#2\")\n   草，这个类被jdk代理了，这直接导致反射获取类型的时候获取到了jdk的`Proxy$?.class`这个类型，从而导致检查注解失败\n   `declaringClass()`方法原本应该获取到声明类，我们预计他应该会返回我们Controller的真实类型，但是由于Controller实现了一个接口，\n   导致Spring使用了jdk代理这个对象，从而导致获取声明类时获取到了jdk代理所用的类型，最终导致获取注解失败\n8. 问题清楚了，都是jdk代理的锅，那么我们有多个方法解决这个问题：\n    1. 使用继承代替实现\n    2. 使用cglib代替jdkProxy进行代理\n\n## 最终解决\n\n- 由于这里定义在Controller上的的接口是由其他模块的spi，为了保证调用安全，因此采用方式2来解决\n  ```java\n  // 随便找个配置类加注解\n  @EnableAspectJAutoProxy(\n      // 示代理应由 AOP 框架公开为ThreadLocal以通过org.springframework.aop.framework.AopContext类进行检索\n      exposeProxy = true,\n      // 指示是否要创建基于子类 (CGLIB) 的代理，而不是基于标准 Java 接口的代理\n      proxyTargetClass = true\n      )\n  ```\n  采用jdk的方式代理会更快，相较于cglib会有一定的性能提升，但应该仅在启动时有提升，类加载完毕Bean注册完成后应该都是一样的，随口BB一句没有验证过是否正确。\n- 最后上个图对比一下\n  ![RequestHandlerSelectors#3](https://dreamccc-note-ia.oss-cn-chengdu.aliyuncs.com/note/%5BDEBUG%E6%97%A5%E8%AE%B0%5DSwagger%E6%89%AB%E4%B8%8D%E5%88%B0%E7%B1%BB-Jdk%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E7%9A%84%E5%8F%8D%E5%B0%84%E7%B1%BB%E5%9E%8B%E6%95%85%E9%9A%9C/RequestHandlerSelectors%233.png \"RequestHandlerSelectors#3\")\n\n\n\n","slug":"[DEBUG日记]Swagger扫不到类-Jdk代理导致的反射类型故障","published":1,"updated":"2021-09-16T15:33:57.131Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cktp91zkw000q4cow1ga53fhe","content":"<h2 id=\"先说结论\"><a href=\"#先说结论\" class=\"headerlink\" title=\"先说结论\"></a>先说结论</h2><p>jdk代理的问题，换用cglib代理就好了。随便找个配置类，加上<code>@EnableAspectJAutoProxy</code>注解即可解决。</p>\n<a id=\"more\"></a>\n\n<h2 id=\"整理接口后突然暴毙\"><a href=\"#整理接口后突然暴毙\" class=\"headerlink\" title=\"整理接口后突然暴毙\"></a>整理接口后突然暴毙</h2><p>整理了一下项目中的Controller，然后有几个接口就扫描不到了。无论怎么更换扫描注解都找不到这些接口，甚至使用包路径扫描都找不到，很是魔幻。</p>\n<h2 id=\"哪痛治哪\"><a href=\"#哪痛治哪\" class=\"headerlink\" title=\"哪痛治哪\"></a>哪痛治哪</h2><p>俗话说哪里痛治哪里，既然swagger扫不到接口，就先看看swagger到底是怎么去扫接口的</p>\n<ol>\n<li><p>先看swagger的配置</p>\n<pre><code class=\"java\"> @Bean(&quot;docket&quot;)\n public Docket docket() {\n     return new Docket(DocumentationType.SWAGGER_2)\n             .apiInfo(apiInfo())\n             .select()\n             // 扫描带Api注解的类\n             .apis(RequestHandlerSelectors.withClassAnnotation(Api.class))\n             .paths(PathSelectors.any())\n             .build()\n             .securitySchemes(securitySchemes())\n             .globalOperationParameters(globalOperationParameters())\n             ;\n }</code></pre>\n</li>\n<li><p>再看上文中<code>.apis()</code>这个接口的源码</p>\n<pre><code class=\"java\">public ApiSelectorBuilder apis(Predicate&lt;RequestHandler&gt; selector) {\n    requestHandlerSelector = requestHandlerSelector.and(selector);\n    return this;\n}</code></pre>\n<p>看这方法签名，返回值是this没啥用,直接忽略。入参是个将<code>RequestHandler</code>处理成布尔值的函数， 根据其变量名<code>selector</code>可以猜测其作用是传入一个RequestHandler判断其是否满足条件,这里的条件是指啥？<br>当然是指我们从外部传进来的<code>RequestHandlerSelectors.withClassAnnotation(Api.class)</code>这个玩意儿啦！</p>\n</li>\n<li><p>在深入我们传入的<code>RequestHandlerSelectors.withClassAnnotation(Api.class)</code>中，看他的源码：</p>\n<pre><code class=\"java\">/**\n * Predicate that matches RequestHandler with given annotation on the declaring class of the handler method\n *\n * @param annotation - annotation to check\n * @return this\n */\npublic static Predicate&lt;RequestHandler&gt; withClassAnnotation(final Class&lt;? extends Annotation&gt; annotation) {\n   return input -&gt; declaringClass(input).map(annotationPresent(annotation)).orElse(false);\n}   </code></pre>\n<p>这里是判断是否满足条件的关键位置，每一个RequestHandler(就是上面的input)都会通过上文的表达式判断得到一个布尔值</p>\n</li>\n<li><p>再继续往前找到调用这个函数的地方</p>\n<pre><code class=\"java\">// 上面第二点的位置是在ApiSelectorBuilder中，要想找到第三点的函数真正在哪里被使用了，需要反向找回去\n// 在springfox.documentation.spi.service.contexts.ApiSelector中找到了我们传入的`private final Predicate&lt;RequestHandler&gt; requestHandlerSelector;`\n// 通过其getter反向找回去\n// 找到了springfox.documentation.spring.web.scanners.ApiListingReferenceScanner#scan\n public ApiListingReferenceScanResult scan(DocumentationContext context) {\n    LOG.info(&quot;Scanning for api listing references&quot;);\n\n    Map&lt;ResourceGroup, List&lt;RequestMappingContext&gt;&gt; resourceGroupRequestMappings\n        = new HashMap&lt;&gt;();\n\n    int requestMappingContextId = 0;\n\n    ApiSelector selector = context.getApiSelector();\n // 看这里，要找的东西就在这里\n    Iterable&lt;RequestHandler&gt; matchingHandlers = context.getRequestHandlers().stream()\n        .filter(selector.getRequestHandlerSelector()).collect(toList());\n    for (RequestHandler handler : matchingHandlers) {\n      ResourceGroup resourceGroup = new ResourceGroup(\n          handler.groupName(),\n          handler.declaringClass(),\n          0);\n\n      RequestMappingContext requestMappingContext\n          = new RequestMappingContext(\n          String.valueOf(requestMappingContextId),\n          context,\n          handler);\n\n      resourceGroupRequestMappings.putIfAbsent(\n          resourceGroup,\n          new ArrayList&lt;&gt;());\n      resourceGroupRequestMappings.get(resourceGroup).add(requestMappingContext);\n\n      ++requestMappingContextId;\n    }\n    return new ApiListingReferenceScanResult(resourceGroupRequestMappings);\n}</code></pre>\n</li>\n<li><p>打上断点开始Debug，看看controller有没有被swagger扫到<br><img src=\"https://dreamccc-note-ia.oss-cn-chengdu.aliyuncs.com/note/%5BDEBUG%E6%97%A5%E8%AE%B0%5DSwagger%E6%89%AB%E4%B8%8D%E5%88%B0%E7%B1%BB-Jdk%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E7%9A%84%E5%8F%8D%E5%B0%84%E7%B1%BB%E5%9E%8B%E6%95%85%E9%9A%9C/ApiListingReferenceScanner.png\" alt=\"ApiListingReferenceScanner\" title=\"ApiListingReferenceScanner\"><br>发现swagger是直接从spring中取出的RequestHandler，而我们的Controller是被Spring正常扫描的(废话，没被Spring扫到都不能用了好吧)</p>\n</li>\n<li><p>前往步骤3处打上条件断点<br><img src=\"https://dreamccc-note-ia.oss-cn-chengdu.aliyuncs.com/note/%5BDEBUG%E6%97%A5%E8%AE%B0%5DSwagger%E6%89%AB%E4%B8%8D%E5%88%B0%E7%B1%BB-Jdk%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E7%9A%84%E5%8F%8D%E5%B0%84%E7%B1%BB%E5%9E%8B%E6%95%85%E9%9A%9C/RequestHandlerSelectors%231.png\" alt=\"RequestHandlerSelectors#1\" title=\"RequestHandlerSelectors#1\"><br>？？？这是咋回事</p>\n</li>\n<li><p>继续排查<br><img src=\"https://dreamccc-note-ia.oss-cn-chengdu.aliyuncs.com/note/%5BDEBUG%E6%97%A5%E8%AE%B0%5DSwagger%E6%89%AB%E4%B8%8D%E5%88%B0%E7%B1%BB-Jdk%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E7%9A%84%E5%8F%8D%E5%B0%84%E7%B1%BB%E5%9E%8B%E6%95%85%E9%9A%9C/RequestHandlerSelectors%232.png\" alt=\"RequestHandlerSelectors#2\" title=\"RequestHandlerSelectors#2\"><br>草，这个类被jdk代理了，这直接导致反射获取类型的时候获取到了jdk的<code>Proxy$?.class</code>这个类型，从而导致检查注解失败<br><code>declaringClass()</code>方法原本应该获取到声明类，我们预计他应该会返回我们Controller的真实类型，但是由于Controller实现了一个接口，<br>导致Spring使用了jdk代理这个对象，从而导致获取声明类时获取到了jdk代理所用的类型，最终导致获取注解失败</p>\n</li>\n<li><p>问题清楚了，都是jdk代理的锅，那么我们有多个方法解决这个问题：</p>\n<ol>\n<li>使用继承代替实现</li>\n<li>使用cglib代替jdkProxy进行代理</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"最终解决\"><a href=\"#最终解决\" class=\"headerlink\" title=\"最终解决\"></a>最终解决</h2><ul>\n<li>由于这里定义在Controller上的的接口是由其他模块的spi，为了保证调用安全，因此采用方式2来解决<pre><code class=\"java\">// 随便找个配置类加注解\n@EnableAspectJAutoProxy(\n    // 示代理应由 AOP 框架公开为ThreadLocal以通过org.springframework.aop.framework.AopContext类进行检索\n    exposeProxy = true,\n    // 指示是否要创建基于子类 (CGLIB) 的代理，而不是基于标准 Java 接口的代理\n    proxyTargetClass = true\n    )</code></pre>\n采用jdk的方式代理会更快，相较于cglib会有一定的性能提升，但应该仅在启动时有提升，类加载完毕Bean注册完成后应该都是一样的，随口BB一句没有验证过是否正确。</li>\n<li>最后上个图对比一下<br><img src=\"https://dreamccc-note-ia.oss-cn-chengdu.aliyuncs.com/note/%5BDEBUG%E6%97%A5%E8%AE%B0%5DSwagger%E6%89%AB%E4%B8%8D%E5%88%B0%E7%B1%BB-Jdk%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E7%9A%84%E5%8F%8D%E5%B0%84%E7%B1%BB%E5%9E%8B%E6%95%85%E9%9A%9C/RequestHandlerSelectors%233.png\" alt=\"RequestHandlerSelectors#3\" title=\"RequestHandlerSelectors#3\"></li>\n</ul>\n","site":{"data":{}},"excerpt":"<h2 id=\"先说结论\"><a href=\"#先说结论\" class=\"headerlink\" title=\"先说结论\"></a>先说结论</h2><p>jdk代理的问题，换用cglib代理就好了。随便找个配置类，加上<code>@EnableAspectJAutoProxy</code>注解即可解决。</p>","more":"<h2 id=\"整理接口后突然暴毙\"><a href=\"#整理接口后突然暴毙\" class=\"headerlink\" title=\"整理接口后突然暴毙\"></a>整理接口后突然暴毙</h2><p>整理了一下项目中的Controller，然后有几个接口就扫描不到了。无论怎么更换扫描注解都找不到这些接口，甚至使用包路径扫描都找不到，很是魔幻。</p>\n<h2 id=\"哪痛治哪\"><a href=\"#哪痛治哪\" class=\"headerlink\" title=\"哪痛治哪\"></a>哪痛治哪</h2><p>俗话说哪里痛治哪里，既然swagger扫不到接口，就先看看swagger到底是怎么去扫接口的</p>\n<ol>\n<li><p>先看swagger的配置</p>\n<pre><code class=\"java\"> @Bean(&quot;docket&quot;)\n public Docket docket() {\n     return new Docket(DocumentationType.SWAGGER_2)\n             .apiInfo(apiInfo())\n             .select()\n             // 扫描带Api注解的类\n             .apis(RequestHandlerSelectors.withClassAnnotation(Api.class))\n             .paths(PathSelectors.any())\n             .build()\n             .securitySchemes(securitySchemes())\n             .globalOperationParameters(globalOperationParameters())\n             ;\n }</code></pre>\n</li>\n<li><p>再看上文中<code>.apis()</code>这个接口的源码</p>\n<pre><code class=\"java\">public ApiSelectorBuilder apis(Predicate&lt;RequestHandler&gt; selector) {\n    requestHandlerSelector = requestHandlerSelector.and(selector);\n    return this;\n}</code></pre>\n<p>看这方法签名，返回值是this没啥用,直接忽略。入参是个将<code>RequestHandler</code>处理成布尔值的函数， 根据其变量名<code>selector</code>可以猜测其作用是传入一个RequestHandler判断其是否满足条件,这里的条件是指啥？<br>当然是指我们从外部传进来的<code>RequestHandlerSelectors.withClassAnnotation(Api.class)</code>这个玩意儿啦！</p>\n</li>\n<li><p>在深入我们传入的<code>RequestHandlerSelectors.withClassAnnotation(Api.class)</code>中，看他的源码：</p>\n<pre><code class=\"java\">/**\n * Predicate that matches RequestHandler with given annotation on the declaring class of the handler method\n *\n * @param annotation - annotation to check\n * @return this\n */\npublic static Predicate&lt;RequestHandler&gt; withClassAnnotation(final Class&lt;? extends Annotation&gt; annotation) {\n   return input -&gt; declaringClass(input).map(annotationPresent(annotation)).orElse(false);\n}   </code></pre>\n<p>这里是判断是否满足条件的关键位置，每一个RequestHandler(就是上面的input)都会通过上文的表达式判断得到一个布尔值</p>\n</li>\n<li><p>再继续往前找到调用这个函数的地方</p>\n<pre><code class=\"java\">// 上面第二点的位置是在ApiSelectorBuilder中，要想找到第三点的函数真正在哪里被使用了，需要反向找回去\n// 在springfox.documentation.spi.service.contexts.ApiSelector中找到了我们传入的`private final Predicate&lt;RequestHandler&gt; requestHandlerSelector;`\n// 通过其getter反向找回去\n// 找到了springfox.documentation.spring.web.scanners.ApiListingReferenceScanner#scan\n public ApiListingReferenceScanResult scan(DocumentationContext context) {\n    LOG.info(&quot;Scanning for api listing references&quot;);\n\n    Map&lt;ResourceGroup, List&lt;RequestMappingContext&gt;&gt; resourceGroupRequestMappings\n        = new HashMap&lt;&gt;();\n\n    int requestMappingContextId = 0;\n\n    ApiSelector selector = context.getApiSelector();\n // 看这里，要找的东西就在这里\n    Iterable&lt;RequestHandler&gt; matchingHandlers = context.getRequestHandlers().stream()\n        .filter(selector.getRequestHandlerSelector()).collect(toList());\n    for (RequestHandler handler : matchingHandlers) {\n      ResourceGroup resourceGroup = new ResourceGroup(\n          handler.groupName(),\n          handler.declaringClass(),\n          0);\n\n      RequestMappingContext requestMappingContext\n          = new RequestMappingContext(\n          String.valueOf(requestMappingContextId),\n          context,\n          handler);\n\n      resourceGroupRequestMappings.putIfAbsent(\n          resourceGroup,\n          new ArrayList&lt;&gt;());\n      resourceGroupRequestMappings.get(resourceGroup).add(requestMappingContext);\n\n      ++requestMappingContextId;\n    }\n    return new ApiListingReferenceScanResult(resourceGroupRequestMappings);\n}</code></pre>\n</li>\n<li><p>打上断点开始Debug，看看controller有没有被swagger扫到<br><img src=\"https://dreamccc-note-ia.oss-cn-chengdu.aliyuncs.com/note/%5BDEBUG%E6%97%A5%E8%AE%B0%5DSwagger%E6%89%AB%E4%B8%8D%E5%88%B0%E7%B1%BB-Jdk%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E7%9A%84%E5%8F%8D%E5%B0%84%E7%B1%BB%E5%9E%8B%E6%95%85%E9%9A%9C/ApiListingReferenceScanner.png\" alt=\"ApiListingReferenceScanner\" title=\"ApiListingReferenceScanner\"><br>发现swagger是直接从spring中取出的RequestHandler，而我们的Controller是被Spring正常扫描的(废话，没被Spring扫到都不能用了好吧)</p>\n</li>\n<li><p>前往步骤3处打上条件断点<br><img src=\"https://dreamccc-note-ia.oss-cn-chengdu.aliyuncs.com/note/%5BDEBUG%E6%97%A5%E8%AE%B0%5DSwagger%E6%89%AB%E4%B8%8D%E5%88%B0%E7%B1%BB-Jdk%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E7%9A%84%E5%8F%8D%E5%B0%84%E7%B1%BB%E5%9E%8B%E6%95%85%E9%9A%9C/RequestHandlerSelectors%231.png\" alt=\"RequestHandlerSelectors#1\" title=\"RequestHandlerSelectors#1\"><br>？？？这是咋回事</p>\n</li>\n<li><p>继续排查<br><img src=\"https://dreamccc-note-ia.oss-cn-chengdu.aliyuncs.com/note/%5BDEBUG%E6%97%A5%E8%AE%B0%5DSwagger%E6%89%AB%E4%B8%8D%E5%88%B0%E7%B1%BB-Jdk%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E7%9A%84%E5%8F%8D%E5%B0%84%E7%B1%BB%E5%9E%8B%E6%95%85%E9%9A%9C/RequestHandlerSelectors%232.png\" alt=\"RequestHandlerSelectors#2\" title=\"RequestHandlerSelectors#2\"><br>草，这个类被jdk代理了，这直接导致反射获取类型的时候获取到了jdk的<code>Proxy$?.class</code>这个类型，从而导致检查注解失败<br><code>declaringClass()</code>方法原本应该获取到声明类，我们预计他应该会返回我们Controller的真实类型，但是由于Controller实现了一个接口，<br>导致Spring使用了jdk代理这个对象，从而导致获取声明类时获取到了jdk代理所用的类型，最终导致获取注解失败</p>\n</li>\n<li><p>问题清楚了，都是jdk代理的锅，那么我们有多个方法解决这个问题：</p>\n<ol>\n<li>使用继承代替实现</li>\n<li>使用cglib代替jdkProxy进行代理</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"最终解决\"><a href=\"#最终解决\" class=\"headerlink\" title=\"最终解决\"></a>最终解决</h2><ul>\n<li>由于这里定义在Controller上的的接口是由其他模块的spi，为了保证调用安全，因此采用方式2来解决<pre><code class=\"java\">// 随便找个配置类加注解\n@EnableAspectJAutoProxy(\n    // 示代理应由 AOP 框架公开为ThreadLocal以通过org.springframework.aop.framework.AopContext类进行检索\n    exposeProxy = true,\n    // 指示是否要创建基于子类 (CGLIB) 的代理，而不是基于标准 Java 接口的代理\n    proxyTargetClass = true\n    )</code></pre>\n采用jdk的方式代理会更快，相较于cglib会有一定的性能提升，但应该仅在启动时有提升，类加载完毕Bean注册完成后应该都是一样的，随口BB一句没有验证过是否正确。</li>\n<li>最后上个图对比一下<br><img src=\"https://dreamccc-note-ia.oss-cn-chengdu.aliyuncs.com/note/%5BDEBUG%E6%97%A5%E8%AE%B0%5DSwagger%E6%89%AB%E4%B8%8D%E5%88%B0%E7%B1%BB-Jdk%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E7%9A%84%E5%8F%8D%E5%B0%84%E7%B1%BB%E5%9E%8B%E6%95%85%E9%9A%9C/RequestHandlerSelectors%233.png\" alt=\"RequestHandlerSelectors#3\" title=\"RequestHandlerSelectors#3\"></li>\n</ul>"},{"title":"[Zookeeper学习-第二章]用作SpringCloud的注册中心","date":"2019-07-01T07:53:24.000Z","updated":"2020-02-20T07:41:36.000Z","comments":1,"_content":"\n太长懒得写了 用作注册中心->手动维护节点->节点树操作 最后配合feign完成服务动态调用\n<!--more-->\n#\n","source":"_posts/[Zookeeper学习-第二章]用作SpringCloud的注册中心.md","raw":"---\ntitle: '[Zookeeper学习-第二章]用作SpringCloud的注册中心'\ndate: 2019/7/1 15:53:24\nupdated: 2020/2/20 15:41:36\ncomments: true\ncategories: \n    - [我永远爱学习]\ntags: \n    - java\n    - zookeeper\n---\n\n太长懒得写了 用作注册中心->手动维护节点->节点树操作 最后配合feign完成服务动态调用\n<!--more-->\n#\n","slug":"[Zookeeper学习-第二章]用作SpringCloud的注册中心","published":1,"layout":"post","photos":[],"link":"","_id":"cktp91zkx000u4cow6zhthd3w","content":"<p>太长懒得写了 用作注册中心-&gt;手动维护节点-&gt;节点树操作 最后配合feign完成服务动态调用</p>\n<a id=\"more\"></a>\n<p>#</p>\n","site":{"data":{}},"excerpt":"<p>太长懒得写了 用作注册中心-&gt;手动维护节点-&gt;节点树操作 最后配合feign完成服务动态调用</p>","more":"<p>#</p>"},{"title":"java8函数设计[1]-在filter中根据Key去重的函数","date":"2019-12-19T09:54:52.000Z","updated":"2020-02-20T07:41:36.000Z","cover":"/2019/12/19/java8函数设计[1]-在filter中根据Key去重的函数/title.jpg","coverWidth":599,"coverHeight":271,"comments":1,"_content":"\n函数接口是如何写出来的？\n<!--more-->\n\n# java函数接口设计\n## 在filter中根据Key去重的函数 StreamUtil.distinctByKey()\n\n### 具体使用方法\n\n- 该函数用于在filter中根据传入参数的某一属性进行过滤，以保证在收集为map的情况下不会出现重复主键\n\n\n```java\nList<entry<string, string=\"\">&gt; simpleList = baseProjects.stream()\n                .filter(StreamUtil.distinctByKey(BaseProject::getTypeDic))\n                .map(StreamUtil.entry(BaseProject::getTypeDic, BaseProject::getTypeStr))\n                .collect(Collectors.toList());\n``` \n\n\n### 接口设计\n```java\n    /**\n     * <h3>distinctByKey</h3>\n     * <p>可用于在filter中根据属性过滤</p>\n     *\n     * @param function 接受一个 接受 类型A 返回 类型B 的函数式接口\n     * @return Predicate 返回一个 接受 类型A 返回 Boolean型 的函数式接口\n     */\n    public static <t> Predicate<t> distinctByKey(Function<!--? super T, ?--> function) {\n        Map filterMap = Maps.newConcurrentMap();\n\n        return t -&gt; filterMap.putIfAbsent(function.apply(t), Boolean.TRUE) == null;\n    }\n```\n\n### 设计思路\n\n1. 观察Stream.filter()接口\n2. 对接Stream.filter()接口\n3. 实现去重功能\n4. 参数优化\n\n### 开始编写\n\n####  观察Stream.filter()接口 &amp;&amp; 对接Stream.filter()接口\n\n Stream.filter()接口:`Stream<t> filter(Predicate<!--? super T--> predicate)`\n\n\n 首先可以看到filter接口需要接收一个类型为`Predicate<!--? super T-->`的函数,这个函数接受一个参数返回一个boolean类型。\n\n根据以上信息先写一个函数出来\n```java\npublic static <e> Predicate<e> distinctByKey2() {\n        return new Predicate<e>() {\n            @Override\n            public boolean test(E e) {\n                return false;\n            }\n        };\n    }\n\n```\n\n这个函数虽然可以被filter正常接收，但是由于没有形参，因此无法传递参数\n```java\n public static void main(String[] args) {\n        Lists.newArrayList()\n                .stream()\n                .filter(StreamUtil.distinctByKey2())\n                .collect(Collectors.toList());\n    }\n```\n\n现在与预期的效果比对一下\n| 对比  | 函数 |\n| :-- | - |\n| 目前效果 | `.filter(StreamUtil.distinctByKey2())` |\n| 预期的效果 | `.filter(StreamUtil.distinctByKey2(Xxxxx:getId))` |\n有点不对？！这个函数虽然可以被filter正常接收，但是去无法传入参数。因此要给`distinctByKey2()`方法加上传入的参数。\n通过观察预期效果，是需要传入的参数应该是一个函数的，这个函数接收一个`T类型`参数，返回一个`不知道什么类型`的参数。\n`Function<t, r=\"\">`函数接收一个T类型，返回一个R类型，可以满足这个需求。\n继续观察预期效果，这个`不知道什么类型的参数`实际上就是`distinctByKey2方法中new出来Predicate<e>#test(E e)`中的那个e，说人话就是`Function<t,r>`中的R在此处就是`Predicate<e>`中的E。\n那么补上我们的形参\n```java\npublic static <e,r> Predicate<e> distinctByKey2(Function<e,r> function) {\n        return new Predicate<e>() {\n            @Override\n            public boolean test(E t) {\n\n                return false;\n            }\n        };\n    }\n```\n\n#### 实现去重功能\n现在与预期效果一致了，需要实现去重功能 去重功能可以用Set或者ConcurrentMap实现\n使用ConcurrentMap存储function返回值的状态\n根据`ConcurrentMap.putIfAbsent(xxx)`的特性 如果map中已经有同样的key和value就返回null，根据返回值是否为null来判断是否需要被过滤\n\n```java\n   public static <e,r> Predicate<e> distinctByKey2(Function<e,r> function) {\n\n        Map filterMap = Maps.newConcurrentMap();\n\n        return new Predicate<e>() {\n            @Override\n            public boolean test(E t) {\n                // 调用方传入函数的结果\n                R apply = function.apply(t);\n                // putIfAbsent 在首次关联K,V时返回null 非首次的时候不执行put()方法 直接返回之前的值\n                Boolean isNullIsDuplicate = filterMap.putIfAbsent(apply, Boolean.TRUE);\n                // isNullIsDuplicate==null时 K就没重复 函数返回true\n                return isNullIsDuplicate == null;\n            }\n        };\n    }\n```\n\n\n#### 参数优化\n\n把匿名内部类使用lambda替换掉，在把冗余代码inline，最后调整一下泛型参数\n    \n    在上面的例子中`Function<e,r>`中\n    R是调用者函数的返回值类型，仅仅被当做key使用，本身是什么类型不重要，因此可以直接去掉这个R泛型，由?代替\n    E是调用者函数的形参类型，函数调用方在函数中可能会显式声明参数类型`[注1]`，以达到强转形参类型的目的，因此将E修改为 <!--? super E-->\n    \n```java\n public static <e> Predicate<e> distinctByKey2(Function<!--? super E, ?--> function) {\n        Map filterMap = Maps.newConcurrentMap();\n\n        return e -&gt; filterMap.putIfAbsent(function.apply(e), Boolean.TRUE) == null;\n    }\n    \n //[注1] \n public static void main(String[] args) {\n        List collect = Lists.newArrayList()\n                .stream()\n                // 显式强转形参类型\n                .filter(StreamUtil.distinctByKey2(baseEntity -&gt; baseEntity))\n                .collect(Collectors.toList());\n    }\n```\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/java8函数设计[1]-在filter中根据Key去重的函数.md","raw":"---\ntitle: \"java8函数设计[1]-在filter中根据Key去重的函数\"\ndate: 2019/12/19 17:54:52\nupdated: 2020/2/20 15:41:36\ncover: /2019/12/19/java8函数设计[1]-在filter中根据Key去重的函数/title.jpg\ncoverWidth: 599\ncoverHeight: 271\ncomments: true\ncategories: \n    - [我永远爱学习]\ntags: \n    - lambda\n    - java\n---\n\n函数接口是如何写出来的？\n<!--more-->\n\n# java函数接口设计\n## 在filter中根据Key去重的函数 StreamUtil.distinctByKey()\n\n### 具体使用方法\n\n- 该函数用于在filter中根据传入参数的某一属性进行过滤，以保证在收集为map的情况下不会出现重复主键\n\n\n```java\nList<entry<string, string=\"\">&gt; simpleList = baseProjects.stream()\n                .filter(StreamUtil.distinctByKey(BaseProject::getTypeDic))\n                .map(StreamUtil.entry(BaseProject::getTypeDic, BaseProject::getTypeStr))\n                .collect(Collectors.toList());\n``` \n\n\n### 接口设计\n```java\n    /**\n     * <h3>distinctByKey</h3>\n     * <p>可用于在filter中根据属性过滤</p>\n     *\n     * @param function 接受一个 接受 类型A 返回 类型B 的函数式接口\n     * @return Predicate 返回一个 接受 类型A 返回 Boolean型 的函数式接口\n     */\n    public static <t> Predicate<t> distinctByKey(Function<!--? super T, ?--> function) {\n        Map filterMap = Maps.newConcurrentMap();\n\n        return t -&gt; filterMap.putIfAbsent(function.apply(t), Boolean.TRUE) == null;\n    }\n```\n\n### 设计思路\n\n1. 观察Stream.filter()接口\n2. 对接Stream.filter()接口\n3. 实现去重功能\n4. 参数优化\n\n### 开始编写\n\n####  观察Stream.filter()接口 &amp;&amp; 对接Stream.filter()接口\n\n Stream.filter()接口:`Stream<t> filter(Predicate<!--? super T--> predicate)`\n\n\n 首先可以看到filter接口需要接收一个类型为`Predicate<!--? super T-->`的函数,这个函数接受一个参数返回一个boolean类型。\n\n根据以上信息先写一个函数出来\n```java\npublic static <e> Predicate<e> distinctByKey2() {\n        return new Predicate<e>() {\n            @Override\n            public boolean test(E e) {\n                return false;\n            }\n        };\n    }\n\n```\n\n这个函数虽然可以被filter正常接收，但是由于没有形参，因此无法传递参数\n```java\n public static void main(String[] args) {\n        Lists.newArrayList()\n                .stream()\n                .filter(StreamUtil.distinctByKey2())\n                .collect(Collectors.toList());\n    }\n```\n\n现在与预期的效果比对一下\n| 对比  | 函数 |\n| :-- | - |\n| 目前效果 | `.filter(StreamUtil.distinctByKey2())` |\n| 预期的效果 | `.filter(StreamUtil.distinctByKey2(Xxxxx:getId))` |\n有点不对？！这个函数虽然可以被filter正常接收，但是去无法传入参数。因此要给`distinctByKey2()`方法加上传入的参数。\n通过观察预期效果，是需要传入的参数应该是一个函数的，这个函数接收一个`T类型`参数，返回一个`不知道什么类型`的参数。\n`Function<t, r=\"\">`函数接收一个T类型，返回一个R类型，可以满足这个需求。\n继续观察预期效果，这个`不知道什么类型的参数`实际上就是`distinctByKey2方法中new出来Predicate<e>#test(E e)`中的那个e，说人话就是`Function<t,r>`中的R在此处就是`Predicate<e>`中的E。\n那么补上我们的形参\n```java\npublic static <e,r> Predicate<e> distinctByKey2(Function<e,r> function) {\n        return new Predicate<e>() {\n            @Override\n            public boolean test(E t) {\n\n                return false;\n            }\n        };\n    }\n```\n\n#### 实现去重功能\n现在与预期效果一致了，需要实现去重功能 去重功能可以用Set或者ConcurrentMap实现\n使用ConcurrentMap存储function返回值的状态\n根据`ConcurrentMap.putIfAbsent(xxx)`的特性 如果map中已经有同样的key和value就返回null，根据返回值是否为null来判断是否需要被过滤\n\n```java\n   public static <e,r> Predicate<e> distinctByKey2(Function<e,r> function) {\n\n        Map filterMap = Maps.newConcurrentMap();\n\n        return new Predicate<e>() {\n            @Override\n            public boolean test(E t) {\n                // 调用方传入函数的结果\n                R apply = function.apply(t);\n                // putIfAbsent 在首次关联K,V时返回null 非首次的时候不执行put()方法 直接返回之前的值\n                Boolean isNullIsDuplicate = filterMap.putIfAbsent(apply, Boolean.TRUE);\n                // isNullIsDuplicate==null时 K就没重复 函数返回true\n                return isNullIsDuplicate == null;\n            }\n        };\n    }\n```\n\n\n#### 参数优化\n\n把匿名内部类使用lambda替换掉，在把冗余代码inline，最后调整一下泛型参数\n    \n    在上面的例子中`Function<e,r>`中\n    R是调用者函数的返回值类型，仅仅被当做key使用，本身是什么类型不重要，因此可以直接去掉这个R泛型，由?代替\n    E是调用者函数的形参类型，函数调用方在函数中可能会显式声明参数类型`[注1]`，以达到强转形参类型的目的，因此将E修改为 <!--? super E-->\n    \n```java\n public static <e> Predicate<e> distinctByKey2(Function<!--? super E, ?--> function) {\n        Map filterMap = Maps.newConcurrentMap();\n\n        return e -&gt; filterMap.putIfAbsent(function.apply(e), Boolean.TRUE) == null;\n    }\n    \n //[注1] \n public static void main(String[] args) {\n        List collect = Lists.newArrayList()\n                .stream()\n                // 显式强转形参类型\n                .filter(StreamUtil.distinctByKey2(baseEntity -&gt; baseEntity))\n                .collect(Collectors.toList());\n    }\n```\n\n\n\n\n\n\n\n\n\n\n","slug":"java8函数设计[1]-在filter中根据Key去重的函数","published":1,"layout":"post","photos":[],"link":"","_id":"cktp91zky000w4cow4iqe1yjd","content":"<p>函数接口是如何写出来的？</p>\n<a id=\"more\"></a>\n\n<h1 id=\"java函数接口设计\"><a href=\"#java函数接口设计\" class=\"headerlink\" title=\"java函数接口设计\"></a>java函数接口设计</h1><h2 id=\"在filter中根据Key去重的函数-StreamUtil-distinctByKey\"><a href=\"#在filter中根据Key去重的函数-StreamUtil-distinctByKey\" class=\"headerlink\" title=\"在filter中根据Key去重的函数 StreamUtil.distinctByKey()\"></a>在filter中根据Key去重的函数 StreamUtil.distinctByKey()</h2><h3 id=\"具体使用方法\"><a href=\"#具体使用方法\" class=\"headerlink\" title=\"具体使用方法\"></a>具体使用方法</h3><ul>\n<li>该函数用于在filter中根据传入参数的某一属性进行过滤，以保证在收集为map的情况下不会出现重复主键</li>\n</ul>\n<pre><code class=\"java\">List&lt;entry&lt;string, string=&quot;&quot;&gt;&amp;gt; simpleList = baseProjects.stream()\n                .filter(StreamUtil.distinctByKey(BaseProject::getTypeDic))\n                .map(StreamUtil.entry(BaseProject::getTypeDic, BaseProject::getTypeStr))\n                .collect(Collectors.toList());</code></pre>\n<h3 id=\"接口设计\"><a href=\"#接口设计\" class=\"headerlink\" title=\"接口设计\"></a>接口设计</h3><pre><code class=\"java\">    /**\n     * &lt;h3&gt;distinctByKey&lt;/h3&gt;\n     * &lt;p&gt;可用于在filter中根据属性过滤&lt;/p&gt;\n     *\n     * @param function 接受一个 接受 类型A 返回 类型B 的函数式接口\n     * @return Predicate 返回一个 接受 类型A 返回 Boolean型 的函数式接口\n     */\n    public static &lt;t&gt; Predicate&lt;t&gt; distinctByKey(Function&lt;!--? super T, ?--&gt; function) {\n        Map filterMap = Maps.newConcurrentMap();\n\n        return t -&amp;gt; filterMap.putIfAbsent(function.apply(t), Boolean.TRUE) == null;\n    }</code></pre>\n<h3 id=\"设计思路\"><a href=\"#设计思路\" class=\"headerlink\" title=\"设计思路\"></a>设计思路</h3><ol>\n<li>观察Stream.filter()接口</li>\n<li>对接Stream.filter()接口</li>\n<li>实现去重功能</li>\n<li>参数优化</li>\n</ol>\n<h3 id=\"开始编写\"><a href=\"#开始编写\" class=\"headerlink\" title=\"开始编写\"></a>开始编写</h3><h4 id=\"观察Stream-filter-接口-amp-amp-对接Stream-filter-接口\"><a href=\"#观察Stream-filter-接口-amp-amp-对接Stream-filter-接口\" class=\"headerlink\" title=\"观察Stream.filter()接口 &amp;&amp; 对接Stream.filter()接口\"></a>观察Stream.filter()接口 &amp;&amp; 对接Stream.filter()接口</h4><p> Stream.filter()接口:<code>Stream&lt;t&gt; filter(Predicate&lt;!--? super T--&gt; predicate)</code></p>\n<p> 首先可以看到filter接口需要接收一个类型为<code>Predicate&lt;!--? super T--&gt;</code>的函数,这个函数接受一个参数返回一个boolean类型。</p>\n<p>根据以上信息先写一个函数出来</p>\n<pre><code class=\"java\">public static &lt;e&gt; Predicate&lt;e&gt; distinctByKey2() {\n        return new Predicate&lt;e&gt;() {\n            @Override\n            public boolean test(E e) {\n                return false;\n            }\n        };\n    }\n</code></pre>\n<p>这个函数虽然可以被filter正常接收，但是由于没有形参，因此无法传递参数</p>\n<pre><code class=\"java\"> public static void main(String[] args) {\n        Lists.newArrayList()\n                .stream()\n                .filter(StreamUtil.distinctByKey2())\n                .collect(Collectors.toList());\n    }</code></pre>\n<p>现在与预期的效果比对一下<br>| 对比  | 函数 |<br>| :– | - |<br>| 目前效果 | <code>.filter(StreamUtil.distinctByKey2())</code> |<br>| 预期的效果 | <code>.filter(StreamUtil.distinctByKey2(Xxxxx:getId))</code> |<br>有点不对？！这个函数虽然可以被filter正常接收，但是去无法传入参数。因此要给<code>distinctByKey2()</code>方法加上传入的参数。<br>通过观察预期效果，是需要传入的参数应该是一个函数的，这个函数接收一个<code>T类型</code>参数，返回一个<code>不知道什么类型</code>的参数。<br><code>Function&lt;t, r=&quot;&quot;&gt;</code>函数接收一个T类型，返回一个R类型，可以满足这个需求。<br>继续观察预期效果，这个<code>不知道什么类型的参数</code>实际上就是<code>distinctByKey2方法中new出来Predicate&lt;e&gt;#test(E e)</code>中的那个e，说人话就是<code>Function&lt;t,r&gt;</code>中的R在此处就是<code>Predicate&lt;e&gt;</code>中的E。<br>那么补上我们的形参</p>\n<pre><code class=\"java\">public static &lt;e,r&gt; Predicate&lt;e&gt; distinctByKey2(Function&lt;e,r&gt; function) {\n        return new Predicate&lt;e&gt;() {\n            @Override\n            public boolean test(E t) {\n\n                return false;\n            }\n        };\n    }</code></pre>\n<h4 id=\"实现去重功能\"><a href=\"#实现去重功能\" class=\"headerlink\" title=\"实现去重功能\"></a>实现去重功能</h4><p>现在与预期效果一致了，需要实现去重功能 去重功能可以用Set或者ConcurrentMap实现<br>使用ConcurrentMap存储function返回值的状态<br>根据<code>ConcurrentMap.putIfAbsent(xxx)</code>的特性 如果map中已经有同样的key和value就返回null，根据返回值是否为null来判断是否需要被过滤</p>\n<pre><code class=\"java\">   public static &lt;e,r&gt; Predicate&lt;e&gt; distinctByKey2(Function&lt;e,r&gt; function) {\n\n        Map filterMap = Maps.newConcurrentMap();\n\n        return new Predicate&lt;e&gt;() {\n            @Override\n            public boolean test(E t) {\n                // 调用方传入函数的结果\n                R apply = function.apply(t);\n                // putIfAbsent 在首次关联K,V时返回null 非首次的时候不执行put()方法 直接返回之前的值\n                Boolean isNullIsDuplicate = filterMap.putIfAbsent(apply, Boolean.TRUE);\n                // isNullIsDuplicate==null时 K就没重复 函数返回true\n                return isNullIsDuplicate == null;\n            }\n        };\n    }</code></pre>\n<h4 id=\"参数优化\"><a href=\"#参数优化\" class=\"headerlink\" title=\"参数优化\"></a>参数优化</h4><p>把匿名内部类使用lambda替换掉，在把冗余代码inline，最后调整一下泛型参数</p>\n<pre><code>在上面的例子中`Function&lt;e,r&gt;`中\nR是调用者函数的返回值类型，仅仅被当做key使用，本身是什么类型不重要，因此可以直接去掉这个R泛型，由?代替\nE是调用者函数的形参类型，函数调用方在函数中可能会显式声明参数类型`[注1]`，以达到强转形参类型的目的，因此将E修改为 &lt;!--? super E--&gt;</code></pre><pre><code class=\"java\"> public static &lt;e&gt; Predicate&lt;e&gt; distinctByKey2(Function&lt;!--? super E, ?--&gt; function) {\n        Map filterMap = Maps.newConcurrentMap();\n\n        return e -&amp;gt; filterMap.putIfAbsent(function.apply(e), Boolean.TRUE) == null;\n    }\n\n //[注1] \n public static void main(String[] args) {\n        List collect = Lists.newArrayList()\n                .stream()\n                // 显式强转形参类型\n                .filter(StreamUtil.distinctByKey2(baseEntity -&amp;gt; baseEntity))\n                .collect(Collectors.toList());\n    }</code></pre>\n","site":{"data":{}},"excerpt":"<p>函数接口是如何写出来的？</p>","more":"<h1 id=\"java函数接口设计\"><a href=\"#java函数接口设计\" class=\"headerlink\" title=\"java函数接口设计\"></a>java函数接口设计</h1><h2 id=\"在filter中根据Key去重的函数-StreamUtil-distinctByKey\"><a href=\"#在filter中根据Key去重的函数-StreamUtil-distinctByKey\" class=\"headerlink\" title=\"在filter中根据Key去重的函数 StreamUtil.distinctByKey()\"></a>在filter中根据Key去重的函数 StreamUtil.distinctByKey()</h2><h3 id=\"具体使用方法\"><a href=\"#具体使用方法\" class=\"headerlink\" title=\"具体使用方法\"></a>具体使用方法</h3><ul>\n<li>该函数用于在filter中根据传入参数的某一属性进行过滤，以保证在收集为map的情况下不会出现重复主键</li>\n</ul>\n<pre><code class=\"java\">List&lt;entry&lt;string, string=&quot;&quot;&gt;&amp;gt; simpleList = baseProjects.stream()\n                .filter(StreamUtil.distinctByKey(BaseProject::getTypeDic))\n                .map(StreamUtil.entry(BaseProject::getTypeDic, BaseProject::getTypeStr))\n                .collect(Collectors.toList());</code></pre>\n<h3 id=\"接口设计\"><a href=\"#接口设计\" class=\"headerlink\" title=\"接口设计\"></a>接口设计</h3><pre><code class=\"java\">    /**\n     * &lt;h3&gt;distinctByKey&lt;/h3&gt;\n     * &lt;p&gt;可用于在filter中根据属性过滤&lt;/p&gt;\n     *\n     * @param function 接受一个 接受 类型A 返回 类型B 的函数式接口\n     * @return Predicate 返回一个 接受 类型A 返回 Boolean型 的函数式接口\n     */\n    public static &lt;t&gt; Predicate&lt;t&gt; distinctByKey(Function&lt;!--? super T, ?--&gt; function) {\n        Map filterMap = Maps.newConcurrentMap();\n\n        return t -&amp;gt; filterMap.putIfAbsent(function.apply(t), Boolean.TRUE) == null;\n    }</code></pre>\n<h3 id=\"设计思路\"><a href=\"#设计思路\" class=\"headerlink\" title=\"设计思路\"></a>设计思路</h3><ol>\n<li>观察Stream.filter()接口</li>\n<li>对接Stream.filter()接口</li>\n<li>实现去重功能</li>\n<li>参数优化</li>\n</ol>\n<h3 id=\"开始编写\"><a href=\"#开始编写\" class=\"headerlink\" title=\"开始编写\"></a>开始编写</h3><h4 id=\"观察Stream-filter-接口-amp-amp-对接Stream-filter-接口\"><a href=\"#观察Stream-filter-接口-amp-amp-对接Stream-filter-接口\" class=\"headerlink\" title=\"观察Stream.filter()接口 &amp;&amp; 对接Stream.filter()接口\"></a>观察Stream.filter()接口 &amp;&amp; 对接Stream.filter()接口</h4><p> Stream.filter()接口:<code>Stream&lt;t&gt; filter(Predicate&lt;!--? super T--&gt; predicate)</code></p>\n<p> 首先可以看到filter接口需要接收一个类型为<code>Predicate&lt;!--? super T--&gt;</code>的函数,这个函数接受一个参数返回一个boolean类型。</p>\n<p>根据以上信息先写一个函数出来</p>\n<pre><code class=\"java\">public static &lt;e&gt; Predicate&lt;e&gt; distinctByKey2() {\n        return new Predicate&lt;e&gt;() {\n            @Override\n            public boolean test(E e) {\n                return false;\n            }\n        };\n    }\n</code></pre>\n<p>这个函数虽然可以被filter正常接收，但是由于没有形参，因此无法传递参数</p>\n<pre><code class=\"java\"> public static void main(String[] args) {\n        Lists.newArrayList()\n                .stream()\n                .filter(StreamUtil.distinctByKey2())\n                .collect(Collectors.toList());\n    }</code></pre>\n<p>现在与预期的效果比对一下<br>| 对比  | 函数 |<br>| :– | - |<br>| 目前效果 | <code>.filter(StreamUtil.distinctByKey2())</code> |<br>| 预期的效果 | <code>.filter(StreamUtil.distinctByKey2(Xxxxx:getId))</code> |<br>有点不对？！这个函数虽然可以被filter正常接收，但是去无法传入参数。因此要给<code>distinctByKey2()</code>方法加上传入的参数。<br>通过观察预期效果，是需要传入的参数应该是一个函数的，这个函数接收一个<code>T类型</code>参数，返回一个<code>不知道什么类型</code>的参数。<br><code>Function&lt;t, r=&quot;&quot;&gt;</code>函数接收一个T类型，返回一个R类型，可以满足这个需求。<br>继续观察预期效果，这个<code>不知道什么类型的参数</code>实际上就是<code>distinctByKey2方法中new出来Predicate&lt;e&gt;#test(E e)</code>中的那个e，说人话就是<code>Function&lt;t,r&gt;</code>中的R在此处就是<code>Predicate&lt;e&gt;</code>中的E。<br>那么补上我们的形参</p>\n<pre><code class=\"java\">public static &lt;e,r&gt; Predicate&lt;e&gt; distinctByKey2(Function&lt;e,r&gt; function) {\n        return new Predicate&lt;e&gt;() {\n            @Override\n            public boolean test(E t) {\n\n                return false;\n            }\n        };\n    }</code></pre>\n<h4 id=\"实现去重功能\"><a href=\"#实现去重功能\" class=\"headerlink\" title=\"实现去重功能\"></a>实现去重功能</h4><p>现在与预期效果一致了，需要实现去重功能 去重功能可以用Set或者ConcurrentMap实现<br>使用ConcurrentMap存储function返回值的状态<br>根据<code>ConcurrentMap.putIfAbsent(xxx)</code>的特性 如果map中已经有同样的key和value就返回null，根据返回值是否为null来判断是否需要被过滤</p>\n<pre><code class=\"java\">   public static &lt;e,r&gt; Predicate&lt;e&gt; distinctByKey2(Function&lt;e,r&gt; function) {\n\n        Map filterMap = Maps.newConcurrentMap();\n\n        return new Predicate&lt;e&gt;() {\n            @Override\n            public boolean test(E t) {\n                // 调用方传入函数的结果\n                R apply = function.apply(t);\n                // putIfAbsent 在首次关联K,V时返回null 非首次的时候不执行put()方法 直接返回之前的值\n                Boolean isNullIsDuplicate = filterMap.putIfAbsent(apply, Boolean.TRUE);\n                // isNullIsDuplicate==null时 K就没重复 函数返回true\n                return isNullIsDuplicate == null;\n            }\n        };\n    }</code></pre>\n<h4 id=\"参数优化\"><a href=\"#参数优化\" class=\"headerlink\" title=\"参数优化\"></a>参数优化</h4><p>把匿名内部类使用lambda替换掉，在把冗余代码inline，最后调整一下泛型参数</p>\n<pre><code>在上面的例子中`Function&lt;e,r&gt;`中\nR是调用者函数的返回值类型，仅仅被当做key使用，本身是什么类型不重要，因此可以直接去掉这个R泛型，由?代替\nE是调用者函数的形参类型，函数调用方在函数中可能会显式声明参数类型`[注1]`，以达到强转形参类型的目的，因此将E修改为 &lt;!--? super E--&gt;</code></pre><pre><code class=\"java\"> public static &lt;e&gt; Predicate&lt;e&gt; distinctByKey2(Function&lt;!--? super E, ?--&gt; function) {\n        Map filterMap = Maps.newConcurrentMap();\n\n        return e -&amp;gt; filterMap.putIfAbsent(function.apply(e), Boolean.TRUE) == null;\n    }\n\n //[注1] \n public static void main(String[] args) {\n        List collect = Lists.newArrayList()\n                .stream()\n                // 显式强转形参类型\n                .filter(StreamUtil.distinctByKey2(baseEntity -&amp;gt; baseEntity))\n                .collect(Collectors.toList());\n    }</code></pre>"},{"title":"发码平台结构设计","date":"2021-09-17T02:57:02.000Z","_content":"\n同事接到个任务要做一个发码平台，但产品没说清楚怎么做，也不造要做成什么样子。</br>\n虽然跟我没关系，但由于之前就对发码平台的实现逻辑感兴趣，因此基于兴趣进行了业务设计，这里简单记录个人的一些想法。\n<!--more-->\n\n## 需求猜测\n\n如果只是为了保证公司内所有的券码的唯一性，那我觉得做一个随机数生成器就足够了，做成平台级的功能没有意义，基于此进行需求猜测：\n\n- 唯一性保证：保证业务平台内券码唯一性\n- 券码生成管理：能查看每种优惠券的生成以及使用情况\n- 批量生成券码：一次返回限量的券码给业务端\n- 券码核销：核销并同步回调业务端。\n\n## 唯一性保证\n\n### 缩短雪花位数\n这个好说。保证唯一性的算法多得很，听到这个需求就想到使用雪花ID。但产品冒出来说要求券码长度在10位以内，这个需要斟酌一下。</br>\n想了一下，雪花ID是64位二进制数,如果把base提高，那么位数就会下降。</br>\n随便做个测试：\n```java\npublic static void main(String[] args) {\n    System.out.println(Long.toString(SnowflakeIdUtil.generateId(), 32));\n}\n// output => gjnk3gf62400\n```\n32进制下只有12个字符了，加把劲把进制弄成64试试：\n```java\npublic static void main(String[] args) {\n    System.out.println(Long.toString(SnowflakeIdUtil.generateId(), 64));\n}\n// output => 598684081116483584\n```\n输出变成十进制了，感觉有问题，进去看看代码：\n```java \njava.util.Long:\n   public static String toString(long i, int radix) {\n        // Look Here！ MIN_RADIX = 2   MAX_RADIX = 36\n        if (radix < Character.MIN_RADIX || radix > Character.MAX_RADIX)\n            radix = 10;\n        if (radix == 10)\n            return toString(i);\n   ......\n```\nLong这个类中的toString做了限制，只能将number表示为2-36进制编码的字符串,因为(0-9)+(a-z)刚好36个字符。这里没有考虑到大写字符也可以来做编码，\n如果加上A-Z的大写字符，就有62个字符可用，可以将这个long表示为62进制的字符串，字符串内无特殊字符，既好看又不用考虑转义。\n测试Base62：\n```java \n使用hutool的Base62：\npublic static void main(String[] args) {\n    System.out.println(Base62.encode(Longs.toByteArray(nextId)));\n}\n// output => iDzwMuZe76\n```\n需求满足！\n\n### 不连续性\n\n这个着实有点头疼，思考了一下把这个拆解为两个部分\n\n#### 业务线隔离\n\n总的来说就是要让同一时间内每个业务线生成的ID不连续，这样可以充分降低每个业务线之间券码冲突的可能性（虽然雪花ID本来就不冲突，只要时间不被NTP回调）。\n\n从SnowFlake类本身着手，由于我们应用跑在k8s内，本身就有全系统唯一的标识，且实例数也不会大于32，所以这里近似的任务SnowFlake中的datacenterId和workId没必要都用，\n这里将容器的Id对32取余作为datacenterId(此处可能会导致冲突，后期可以与运维协商为容器编号，这里使用编号即可)，再对业务方提供的业务Id对32取余作为workId，这样基本达成了通过业务线隔离Id的要求。\n11101010111101100010010110000000000\n#### 同一批券码隔离\n\n虽说同一批券码生成之间不冲突，但是由于雪花ID尾数是个序列，同一批券码生成出来尾数是连续的，这可能会导致相邻的券码被盗用，因此同一批券码隔离也是有必要的。\n\n还是打算从SnowFlake类着手，64位数，每一位都有用处，其中时间戳占用的空间比较大，占用了整整11位。要想腾空间，就只有拿时间戳开刀了。\n首先我们计算1年的时间用时间戳表示需要多长：\n``` \n毫秒*秒*分*时*天\n1000*60*60*24*365 \n = 31536000000\n = 0b11101010111101100010010110000000000\n1年时间需要35个二进制位表示，剩下6个二进制位，可以提供出0b111111(64)个位置\n\n31536000000*3\n = 0b1011000000111000100111000010000000000\n3年的时间需要37个二进制位来表示，剩下4个二进制位，可以提供处0b1111(16)个位置给用户猜测\n\n31536000000*5\n = 0b10010010110110011101011101110000000000\n5年的时间需要38个二进制位来表示，剩下3个二进制位，可以提供处0b111(8)个位置给用户猜测\n\n感觉差不多了，就用38个二进制位:\n\n38个二进制位\n0b11111111111111111111111111111111111111\n = 274877906943\n274877906943/1000/3600/24 约 3181.46天 合 8.7年\n\n```\n如此这般，便省下来3个二进制位和时间戳前面的符号位一起组成4个二进制位用于放猜解，可以提供16种组合\n\n这里吐槽一下，这个限制10位要求全局唯一要求生成性能高还要抗猜解真的有点过分，当然雪花算法也并不特别适合这种场景，有其他好的方案就更好了。\n\n后续重写Snowflake类，重新设置位移位数并新增抗猜解位数就可以了。\n\n## 业务以及表结构设计\n\n这个功能说来简单，其实也有不明确的点：\n1. 一次要生成多少张券？每一批券需不需要记录批次？\n2. 是即时生成还是仅记录数量用时再取？\n3. 需要管理什么字段？\n\n就个人想法来说，先假设每个系统会有一个账户，系统收到钱后会生成订单，根据订单数额，找本系统添加对应数量的券码。但是由于生成的数量较多，因此在这里并不会真正地生成券码，只会记录该系统拥有对应数量的券码额度。随后调用获取券码接口时，再生成券码，再通过限制该接口的调用频率和最大券码数来控制性能消耗。\n\n最终交互设计图如下：\n![发码平台交互图](../_images/发码平台结构设计/发码平台交互图.jpg  \"发码平台交互图\")\n\n### 生成管理表设计(省略大家都有的字段) generate_manage\n\n| field</br>(驼峰/下划线脑内自行转换) | type | function |\n| --- | --- | --- |\n| id | varchar(32) | - |\n| systemId | varchar(32) | 具体业务线Id |\n| systemName | varchar(128) | 业务系统名冗余在此</br>避免远程查表 |\n| type | varchar(64) | 这批券码的生成方式(SNOWFLAKE_LITE/UUID) |\n| total | bigint | 该批次拥有的券码总数 |\n| current | bigint | 该批次已生成的券码总数（保证原子性） |\n| systemName | varchar(128) | 业务系统名冗余在此</br>避免远程查表 |\n| businessTypeTemplate | varchar(64) | [模板]提供给业务方存储业务上的类型</br>在获取券码时可以覆盖该值</br>可能是以后做查询的条件 |\n| businessDataTemplate | json | [模板]提供给业务方存储该批次券码的公有属性</br>在获取券码时可以覆盖该值</br>券码被消费时将返给业务方 |\n| callbackTemplate | json | [模板]券码被消费回调地址</br>在获取券码时可以覆盖该值\n| createTime | date(3)| - |\n\n\n### 生成操作记录表设计(省略大家都有的字段) generate_operation\n\n| field</br>(驼峰/下划线脑内自行转换) | type | function |\n| --- | --- | --- |\n| id | varchar(32) | - |\n| manageId | varchar(32) | 关联generate_manage |\n| total | bigint | 该批次拥有的券码总数 |\n| original | bigint | 消费前数量 |\n| consumption | bigint | 本次消费数量 |\n| remaining | bigint | 剩余消费数量 |\n| createTime | date(3)| - |\n\n### 券码表设计 coupon\n\n| field</br>(驼峰/下划线脑内自行转换) | type | function |\n| --- | --- | --- |\n| id | varchar(32) | - |\n| manageId | varchar(32) | 关联 generate_manage |\n| operationId | varchar(32) | 关联 generate_operation |\n| systemId | varchar(32) | [冗余以避免连表]具体业务线Id |\n| systemName | varchar(128) | [冗余以避免连表]业务系统名冗余在此</br>避免远程查表 |\n| generateTime | date(3)| [冗余以避免连表]券码生成时间 |\n| code | varchar(32) | 这个才是券码 |\n| businessType | varchar(32) | 提供给业务方存储业务上的类型</br>可能是以后做查询的条件 |\n| businessData | json | 提供给业务方存储该批次券码的公有属性</br>券码被消费时将返给业务方 |\n| callback | json | 券码被消费回调地址，格式为map为升级预留空间</br>Map<String callbackUrl,String callbackVersion> |\n| createTime | date(3)| - |\n\n\n### 生成/获取券码API\n\n#### request\n\n| field</br>(驼峰/下划线脑内自行转换) | type | function |\n| --- | --- | --- |\n| manageId  | String | 关联 generate_manage |\n| businessType  | String | --- |\n| businessData  | JSONObject | --- |\n| callback  | Map<String,String> | --- |\n\n#### response\n\n| field</br>(驼峰/下划线脑内自行转换) | type | function |\n| --- | --- | --- |\n| operation  | `GenerateOperation` | |\n| coupons  | `List<Coupon>`| |\n","source":"_posts/发码平台结构设计.md","raw":"---\ntitle: 发码平台结构设计\ndate: 2021-09-17 10:57:02\ntags:\n---\n\n同事接到个任务要做一个发码平台，但产品没说清楚怎么做，也不造要做成什么样子。</br>\n虽然跟我没关系，但由于之前就对发码平台的实现逻辑感兴趣，因此基于兴趣进行了业务设计，这里简单记录个人的一些想法。\n<!--more-->\n\n## 需求猜测\n\n如果只是为了保证公司内所有的券码的唯一性，那我觉得做一个随机数生成器就足够了，做成平台级的功能没有意义，基于此进行需求猜测：\n\n- 唯一性保证：保证业务平台内券码唯一性\n- 券码生成管理：能查看每种优惠券的生成以及使用情况\n- 批量生成券码：一次返回限量的券码给业务端\n- 券码核销：核销并同步回调业务端。\n\n## 唯一性保证\n\n### 缩短雪花位数\n这个好说。保证唯一性的算法多得很，听到这个需求就想到使用雪花ID。但产品冒出来说要求券码长度在10位以内，这个需要斟酌一下。</br>\n想了一下，雪花ID是64位二进制数,如果把base提高，那么位数就会下降。</br>\n随便做个测试：\n```java\npublic static void main(String[] args) {\n    System.out.println(Long.toString(SnowflakeIdUtil.generateId(), 32));\n}\n// output => gjnk3gf62400\n```\n32进制下只有12个字符了，加把劲把进制弄成64试试：\n```java\npublic static void main(String[] args) {\n    System.out.println(Long.toString(SnowflakeIdUtil.generateId(), 64));\n}\n// output => 598684081116483584\n```\n输出变成十进制了，感觉有问题，进去看看代码：\n```java \njava.util.Long:\n   public static String toString(long i, int radix) {\n        // Look Here！ MIN_RADIX = 2   MAX_RADIX = 36\n        if (radix < Character.MIN_RADIX || radix > Character.MAX_RADIX)\n            radix = 10;\n        if (radix == 10)\n            return toString(i);\n   ......\n```\nLong这个类中的toString做了限制，只能将number表示为2-36进制编码的字符串,因为(0-9)+(a-z)刚好36个字符。这里没有考虑到大写字符也可以来做编码，\n如果加上A-Z的大写字符，就有62个字符可用，可以将这个long表示为62进制的字符串，字符串内无特殊字符，既好看又不用考虑转义。\n测试Base62：\n```java \n使用hutool的Base62：\npublic static void main(String[] args) {\n    System.out.println(Base62.encode(Longs.toByteArray(nextId)));\n}\n// output => iDzwMuZe76\n```\n需求满足！\n\n### 不连续性\n\n这个着实有点头疼，思考了一下把这个拆解为两个部分\n\n#### 业务线隔离\n\n总的来说就是要让同一时间内每个业务线生成的ID不连续，这样可以充分降低每个业务线之间券码冲突的可能性（虽然雪花ID本来就不冲突，只要时间不被NTP回调）。\n\n从SnowFlake类本身着手，由于我们应用跑在k8s内，本身就有全系统唯一的标识，且实例数也不会大于32，所以这里近似的任务SnowFlake中的datacenterId和workId没必要都用，\n这里将容器的Id对32取余作为datacenterId(此处可能会导致冲突，后期可以与运维协商为容器编号，这里使用编号即可)，再对业务方提供的业务Id对32取余作为workId，这样基本达成了通过业务线隔离Id的要求。\n11101010111101100010010110000000000\n#### 同一批券码隔离\n\n虽说同一批券码生成之间不冲突，但是由于雪花ID尾数是个序列，同一批券码生成出来尾数是连续的，这可能会导致相邻的券码被盗用，因此同一批券码隔离也是有必要的。\n\n还是打算从SnowFlake类着手，64位数，每一位都有用处，其中时间戳占用的空间比较大，占用了整整11位。要想腾空间，就只有拿时间戳开刀了。\n首先我们计算1年的时间用时间戳表示需要多长：\n``` \n毫秒*秒*分*时*天\n1000*60*60*24*365 \n = 31536000000\n = 0b11101010111101100010010110000000000\n1年时间需要35个二进制位表示，剩下6个二进制位，可以提供出0b111111(64)个位置\n\n31536000000*3\n = 0b1011000000111000100111000010000000000\n3年的时间需要37个二进制位来表示，剩下4个二进制位，可以提供处0b1111(16)个位置给用户猜测\n\n31536000000*5\n = 0b10010010110110011101011101110000000000\n5年的时间需要38个二进制位来表示，剩下3个二进制位，可以提供处0b111(8)个位置给用户猜测\n\n感觉差不多了，就用38个二进制位:\n\n38个二进制位\n0b11111111111111111111111111111111111111\n = 274877906943\n274877906943/1000/3600/24 约 3181.46天 合 8.7年\n\n```\n如此这般，便省下来3个二进制位和时间戳前面的符号位一起组成4个二进制位用于放猜解，可以提供16种组合\n\n这里吐槽一下，这个限制10位要求全局唯一要求生成性能高还要抗猜解真的有点过分，当然雪花算法也并不特别适合这种场景，有其他好的方案就更好了。\n\n后续重写Snowflake类，重新设置位移位数并新增抗猜解位数就可以了。\n\n## 业务以及表结构设计\n\n这个功能说来简单，其实也有不明确的点：\n1. 一次要生成多少张券？每一批券需不需要记录批次？\n2. 是即时生成还是仅记录数量用时再取？\n3. 需要管理什么字段？\n\n就个人想法来说，先假设每个系统会有一个账户，系统收到钱后会生成订单，根据订单数额，找本系统添加对应数量的券码。但是由于生成的数量较多，因此在这里并不会真正地生成券码，只会记录该系统拥有对应数量的券码额度。随后调用获取券码接口时，再生成券码，再通过限制该接口的调用频率和最大券码数来控制性能消耗。\n\n最终交互设计图如下：\n![发码平台交互图](../_images/发码平台结构设计/发码平台交互图.jpg  \"发码平台交互图\")\n\n### 生成管理表设计(省略大家都有的字段) generate_manage\n\n| field</br>(驼峰/下划线脑内自行转换) | type | function |\n| --- | --- | --- |\n| id | varchar(32) | - |\n| systemId | varchar(32) | 具体业务线Id |\n| systemName | varchar(128) | 业务系统名冗余在此</br>避免远程查表 |\n| type | varchar(64) | 这批券码的生成方式(SNOWFLAKE_LITE/UUID) |\n| total | bigint | 该批次拥有的券码总数 |\n| current | bigint | 该批次已生成的券码总数（保证原子性） |\n| systemName | varchar(128) | 业务系统名冗余在此</br>避免远程查表 |\n| businessTypeTemplate | varchar(64) | [模板]提供给业务方存储业务上的类型</br>在获取券码时可以覆盖该值</br>可能是以后做查询的条件 |\n| businessDataTemplate | json | [模板]提供给业务方存储该批次券码的公有属性</br>在获取券码时可以覆盖该值</br>券码被消费时将返给业务方 |\n| callbackTemplate | json | [模板]券码被消费回调地址</br>在获取券码时可以覆盖该值\n| createTime | date(3)| - |\n\n\n### 生成操作记录表设计(省略大家都有的字段) generate_operation\n\n| field</br>(驼峰/下划线脑内自行转换) | type | function |\n| --- | --- | --- |\n| id | varchar(32) | - |\n| manageId | varchar(32) | 关联generate_manage |\n| total | bigint | 该批次拥有的券码总数 |\n| original | bigint | 消费前数量 |\n| consumption | bigint | 本次消费数量 |\n| remaining | bigint | 剩余消费数量 |\n| createTime | date(3)| - |\n\n### 券码表设计 coupon\n\n| field</br>(驼峰/下划线脑内自行转换) | type | function |\n| --- | --- | --- |\n| id | varchar(32) | - |\n| manageId | varchar(32) | 关联 generate_manage |\n| operationId | varchar(32) | 关联 generate_operation |\n| systemId | varchar(32) | [冗余以避免连表]具体业务线Id |\n| systemName | varchar(128) | [冗余以避免连表]业务系统名冗余在此</br>避免远程查表 |\n| generateTime | date(3)| [冗余以避免连表]券码生成时间 |\n| code | varchar(32) | 这个才是券码 |\n| businessType | varchar(32) | 提供给业务方存储业务上的类型</br>可能是以后做查询的条件 |\n| businessData | json | 提供给业务方存储该批次券码的公有属性</br>券码被消费时将返给业务方 |\n| callback | json | 券码被消费回调地址，格式为map为升级预留空间</br>Map<String callbackUrl,String callbackVersion> |\n| createTime | date(3)| - |\n\n\n### 生成/获取券码API\n\n#### request\n\n| field</br>(驼峰/下划线脑内自行转换) | type | function |\n| --- | --- | --- |\n| manageId  | String | 关联 generate_manage |\n| businessType  | String | --- |\n| businessData  | JSONObject | --- |\n| callback  | Map<String,String> | --- |\n\n#### response\n\n| field</br>(驼峰/下划线脑内自行转换) | type | function |\n| --- | --- | --- |\n| operation  | `GenerateOperation` | |\n| coupons  | `List<Coupon>`| |\n","slug":"发码平台结构设计","published":1,"updated":"2021-09-18T03:46:30.751Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cktp91zl000104cowb1rdaxos","content":"<p>同事接到个任务要做一个发码平台，但产品没说清楚怎么做，也不造要做成什么样子。</br><br>虽然跟我没关系，但由于之前就对发码平台的实现逻辑感兴趣，因此基于兴趣进行了业务设计，这里简单记录个人的一些想法。</p>\n<a id=\"more\"></a>\n\n<h2 id=\"需求猜测\"><a href=\"#需求猜测\" class=\"headerlink\" title=\"需求猜测\"></a>需求猜测</h2><p>如果只是为了保证公司内所有的券码的唯一性，那我觉得做一个随机数生成器就足够了，做成平台级的功能没有意义，基于此进行需求猜测：</p>\n<ul>\n<li>唯一性保证：保证业务平台内券码唯一性</li>\n<li>券码生成管理：能查看每种优惠券的生成以及使用情况</li>\n<li>批量生成券码：一次返回限量的券码给业务端</li>\n<li>券码核销：核销并同步回调业务端。</li>\n</ul>\n<h2 id=\"唯一性保证\"><a href=\"#唯一性保证\" class=\"headerlink\" title=\"唯一性保证\"></a>唯一性保证</h2><h3 id=\"缩短雪花位数\"><a href=\"#缩短雪花位数\" class=\"headerlink\" title=\"缩短雪花位数\"></a>缩短雪花位数</h3><p>这个好说。保证唯一性的算法多得很，听到这个需求就想到使用雪花ID。但产品冒出来说要求券码长度在10位以内，这个需要斟酌一下。</br><br>想了一下，雪花ID是64位二进制数,如果把base提高，那么位数就会下降。</br><br>随便做个测试：</p>\n<pre><code class=\"java\">public static void main(String[] args) {\n    System.out.println(Long.toString(SnowflakeIdUtil.generateId(), 32));\n}\n// output =&gt; gjnk3gf62400</code></pre>\n<p>32进制下只有12个字符了，加把劲把进制弄成64试试：</p>\n<pre><code class=\"java\">public static void main(String[] args) {\n    System.out.println(Long.toString(SnowflakeIdUtil.generateId(), 64));\n}\n// output =&gt; 598684081116483584</code></pre>\n<p>输出变成十进制了，感觉有问题，进去看看代码：</p>\n<pre><code class=\"java\">java.util.Long:\n   public static String toString(long i, int radix) {\n        // Look Here！ MIN_RADIX = 2   MAX_RADIX = 36\n        if (radix &lt; Character.MIN_RADIX || radix &gt; Character.MAX_RADIX)\n            radix = 10;\n        if (radix == 10)\n            return toString(i);\n   ......</code></pre>\n<p>Long这个类中的toString做了限制，只能将number表示为2-36进制编码的字符串,因为(0-9)+(a-z)刚好36个字符。这里没有考虑到大写字符也可以来做编码，<br>如果加上A-Z的大写字符，就有62个字符可用，可以将这个long表示为62进制的字符串，字符串内无特殊字符，既好看又不用考虑转义。<br>测试Base62：</p>\n<pre><code class=\"java\">使用hutool的Base62：\npublic static void main(String[] args) {\n    System.out.println(Base62.encode(Longs.toByteArray(nextId)));\n}\n// output =&gt; iDzwMuZe76</code></pre>\n<p>需求满足！</p>\n<h3 id=\"不连续性\"><a href=\"#不连续性\" class=\"headerlink\" title=\"不连续性\"></a>不连续性</h3><p>这个着实有点头疼，思考了一下把这个拆解为两个部分</p>\n<h4 id=\"业务线隔离\"><a href=\"#业务线隔离\" class=\"headerlink\" title=\"业务线隔离\"></a>业务线隔离</h4><p>总的来说就是要让同一时间内每个业务线生成的ID不连续，这样可以充分降低每个业务线之间券码冲突的可能性（虽然雪花ID本来就不冲突，只要时间不被NTP回调）。</p>\n<p>从SnowFlake类本身着手，由于我们应用跑在k8s内，本身就有全系统唯一的标识，且实例数也不会大于32，所以这里近似的任务SnowFlake中的datacenterId和workId没必要都用，<br>这里将容器的Id对32取余作为datacenterId(此处可能会导致冲突，后期可以与运维协商为容器编号，这里使用编号即可)，再对业务方提供的业务Id对32取余作为workId，这样基本达成了通过业务线隔离Id的要求。<br>11101010111101100010010110000000000</p>\n<h4 id=\"同一批券码隔离\"><a href=\"#同一批券码隔离\" class=\"headerlink\" title=\"同一批券码隔离\"></a>同一批券码隔离</h4><p>虽说同一批券码生成之间不冲突，但是由于雪花ID尾数是个序列，同一批券码生成出来尾数是连续的，这可能会导致相邻的券码被盗用，因此同一批券码隔离也是有必要的。</p>\n<p>还是打算从SnowFlake类着手，64位数，每一位都有用处，其中时间戳占用的空间比较大，占用了整整11位。要想腾空间，就只有拿时间戳开刀了。<br>首先我们计算1年的时间用时间戳表示需要多长：</p>\n<pre><code>毫秒*秒*分*时*天\n1000*60*60*24*365 \n = 31536000000\n = 0b11101010111101100010010110000000000\n1年时间需要35个二进制位表示，剩下6个二进制位，可以提供出0b111111(64)个位置\n\n31536000000*3\n = 0b1011000000111000100111000010000000000\n3年的时间需要37个二进制位来表示，剩下4个二进制位，可以提供处0b1111(16)个位置给用户猜测\n\n31536000000*5\n = 0b10010010110110011101011101110000000000\n5年的时间需要38个二进制位来表示，剩下3个二进制位，可以提供处0b111(8)个位置给用户猜测\n\n感觉差不多了，就用38个二进制位:\n\n38个二进制位\n0b11111111111111111111111111111111111111\n = 274877906943\n274877906943/1000/3600/24 约 3181.46天 合 8.7年\n</code></pre><p>如此这般，便省下来3个二进制位和时间戳前面的符号位一起组成4个二进制位用于放猜解，可以提供16种组合</p>\n<p>这里吐槽一下，这个限制10位要求全局唯一要求生成性能高还要抗猜解真的有点过分，当然雪花算法也并不特别适合这种场景，有其他好的方案就更好了。</p>\n<p>后续重写Snowflake类，重新设置位移位数并新增抗猜解位数就可以了。</p>\n<h2 id=\"业务以及表结构设计\"><a href=\"#业务以及表结构设计\" class=\"headerlink\" title=\"业务以及表结构设计\"></a>业务以及表结构设计</h2><p>这个功能说来简单，其实也有不明确的点：</p>\n<ol>\n<li>一次要生成多少张券？每一批券需不需要记录批次？</li>\n<li>是即时生成还是仅记录数量用时再取？</li>\n<li>需要管理什么字段？</li>\n</ol>\n<p>就个人想法来说，先假设每个系统会有一个账户，系统收到钱后会生成订单，根据订单数额，找本系统添加对应数量的券码。但是由于生成的数量较多，因此在这里并不会真正地生成券码，只会记录该系统拥有对应数量的券码额度。随后调用获取券码接口时，再生成券码，再通过限制该接口的调用频率和最大券码数来控制性能消耗。</p>\n<p>最终交互设计图如下：<br><img src=\"../_images/%E5%8F%91%E7%A0%81%E5%B9%B3%E5%8F%B0%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%8F%91%E7%A0%81%E5%B9%B3%E5%8F%B0%E4%BA%A4%E4%BA%92%E5%9B%BE.jpg\" alt=\"发码平台交互图\" title=\"发码平台交互图\"></p>\n<h3 id=\"生成管理表设计-省略大家都有的字段-generate-manage\"><a href=\"#生成管理表设计-省略大家都有的字段-generate-manage\" class=\"headerlink\" title=\"生成管理表设计(省略大家都有的字段) generate_manage\"></a>生成管理表设计(省略大家都有的字段) generate_manage</h3><table>\n<thead>\n<tr>\n<th>field</br>(驼峰/下划线脑内自行转换)</th>\n<th>type</th>\n<th>function</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>id</td>\n<td>varchar(32)</td>\n<td>-</td>\n</tr>\n<tr>\n<td>systemId</td>\n<td>varchar(32)</td>\n<td>具体业务线Id</td>\n</tr>\n<tr>\n<td>systemName</td>\n<td>varchar(128)</td>\n<td>业务系统名冗余在此</br>避免远程查表</td>\n</tr>\n<tr>\n<td>type</td>\n<td>varchar(64)</td>\n<td>这批券码的生成方式(SNOWFLAKE_LITE/UUID)</td>\n</tr>\n<tr>\n<td>total</td>\n<td>bigint</td>\n<td>该批次拥有的券码总数</td>\n</tr>\n<tr>\n<td>current</td>\n<td>bigint</td>\n<td>该批次已生成的券码总数（保证原子性）</td>\n</tr>\n<tr>\n<td>systemName</td>\n<td>varchar(128)</td>\n<td>业务系统名冗余在此</br>避免远程查表</td>\n</tr>\n<tr>\n<td>businessTypeTemplate</td>\n<td>varchar(64)</td>\n<td>[模板]提供给业务方存储业务上的类型</br>在获取券码时可以覆盖该值</br>可能是以后做查询的条件</td>\n</tr>\n<tr>\n<td>businessDataTemplate</td>\n<td>json</td>\n<td>[模板]提供给业务方存储该批次券码的公有属性</br>在获取券码时可以覆盖该值</br>券码被消费时将返给业务方</td>\n</tr>\n<tr>\n<td>callbackTemplate</td>\n<td>json</td>\n<td>[模板]券码被消费回调地址</br>在获取券码时可以覆盖该值</td>\n</tr>\n<tr>\n<td>createTime</td>\n<td>date(3)</td>\n<td>-</td>\n</tr>\n</tbody></table>\n<h3 id=\"生成操作记录表设计-省略大家都有的字段-generate-operation\"><a href=\"#生成操作记录表设计-省略大家都有的字段-generate-operation\" class=\"headerlink\" title=\"生成操作记录表设计(省略大家都有的字段) generate_operation\"></a>生成操作记录表设计(省略大家都有的字段) generate_operation</h3><table>\n<thead>\n<tr>\n<th>field</br>(驼峰/下划线脑内自行转换)</th>\n<th>type</th>\n<th>function</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>id</td>\n<td>varchar(32)</td>\n<td>-</td>\n</tr>\n<tr>\n<td>manageId</td>\n<td>varchar(32)</td>\n<td>关联generate_manage</td>\n</tr>\n<tr>\n<td>total</td>\n<td>bigint</td>\n<td>该批次拥有的券码总数</td>\n</tr>\n<tr>\n<td>original</td>\n<td>bigint</td>\n<td>消费前数量</td>\n</tr>\n<tr>\n<td>consumption</td>\n<td>bigint</td>\n<td>本次消费数量</td>\n</tr>\n<tr>\n<td>remaining</td>\n<td>bigint</td>\n<td>剩余消费数量</td>\n</tr>\n<tr>\n<td>createTime</td>\n<td>date(3)</td>\n<td>-</td>\n</tr>\n</tbody></table>\n<h3 id=\"券码表设计-coupon\"><a href=\"#券码表设计-coupon\" class=\"headerlink\" title=\"券码表设计 coupon\"></a>券码表设计 coupon</h3><table>\n<thead>\n<tr>\n<th>field</br>(驼峰/下划线脑内自行转换)</th>\n<th>type</th>\n<th>function</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>id</td>\n<td>varchar(32)</td>\n<td>-</td>\n</tr>\n<tr>\n<td>manageId</td>\n<td>varchar(32)</td>\n<td>关联 generate_manage</td>\n</tr>\n<tr>\n<td>operationId</td>\n<td>varchar(32)</td>\n<td>关联 generate_operation</td>\n</tr>\n<tr>\n<td>systemId</td>\n<td>varchar(32)</td>\n<td>[冗余以避免连表]具体业务线Id</td>\n</tr>\n<tr>\n<td>systemName</td>\n<td>varchar(128)</td>\n<td>[冗余以避免连表]业务系统名冗余在此</br>避免远程查表</td>\n</tr>\n<tr>\n<td>generateTime</td>\n<td>date(3)</td>\n<td>[冗余以避免连表]券码生成时间</td>\n</tr>\n<tr>\n<td>code</td>\n<td>varchar(32)</td>\n<td>这个才是券码</td>\n</tr>\n<tr>\n<td>businessType</td>\n<td>varchar(32)</td>\n<td>提供给业务方存储业务上的类型</br>可能是以后做查询的条件</td>\n</tr>\n<tr>\n<td>businessData</td>\n<td>json</td>\n<td>提供给业务方存储该批次券码的公有属性</br>券码被消费时将返给业务方</td>\n</tr>\n<tr>\n<td>callback</td>\n<td>json</td>\n<td>券码被消费回调地址，格式为map为升级预留空间</br>Map&lt;String callbackUrl,String callbackVersion&gt;</td>\n</tr>\n<tr>\n<td>createTime</td>\n<td>date(3)</td>\n<td>-</td>\n</tr>\n</tbody></table>\n<h3 id=\"生成-获取券码API\"><a href=\"#生成-获取券码API\" class=\"headerlink\" title=\"生成/获取券码API\"></a>生成/获取券码API</h3><h4 id=\"request\"><a href=\"#request\" class=\"headerlink\" title=\"request\"></a>request</h4><table>\n<thead>\n<tr>\n<th>field</br>(驼峰/下划线脑内自行转换)</th>\n<th>type</th>\n<th>function</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>manageId</td>\n<td>String</td>\n<td>关联 generate_manage</td>\n</tr>\n<tr>\n<td>businessType</td>\n<td>String</td>\n<td>—</td>\n</tr>\n<tr>\n<td>businessData</td>\n<td>JSONObject</td>\n<td>—</td>\n</tr>\n<tr>\n<td>callback</td>\n<td>Map&lt;String,String&gt;</td>\n<td>—</td>\n</tr>\n</tbody></table>\n<h4 id=\"response\"><a href=\"#response\" class=\"headerlink\" title=\"response\"></a>response</h4><table>\n<thead>\n<tr>\n<th>field</br>(驼峰/下划线脑内自行转换)</th>\n<th>type</th>\n<th>function</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>operation</td>\n<td><code>GenerateOperation</code></td>\n<td></td>\n</tr>\n<tr>\n<td>coupons</td>\n<td><code>List&lt;Coupon&gt;</code></td>\n<td></td>\n</tr>\n</tbody></table>\n","site":{"data":{}},"excerpt":"<p>同事接到个任务要做一个发码平台，但产品没说清楚怎么做，也不造要做成什么样子。</br><br>虽然跟我没关系，但由于之前就对发码平台的实现逻辑感兴趣，因此基于兴趣进行了业务设计，这里简单记录个人的一些想法。</p>","more":"<h2 id=\"需求猜测\"><a href=\"#需求猜测\" class=\"headerlink\" title=\"需求猜测\"></a>需求猜测</h2><p>如果只是为了保证公司内所有的券码的唯一性，那我觉得做一个随机数生成器就足够了，做成平台级的功能没有意义，基于此进行需求猜测：</p>\n<ul>\n<li>唯一性保证：保证业务平台内券码唯一性</li>\n<li>券码生成管理：能查看每种优惠券的生成以及使用情况</li>\n<li>批量生成券码：一次返回限量的券码给业务端</li>\n<li>券码核销：核销并同步回调业务端。</li>\n</ul>\n<h2 id=\"唯一性保证\"><a href=\"#唯一性保证\" class=\"headerlink\" title=\"唯一性保证\"></a>唯一性保证</h2><h3 id=\"缩短雪花位数\"><a href=\"#缩短雪花位数\" class=\"headerlink\" title=\"缩短雪花位数\"></a>缩短雪花位数</h3><p>这个好说。保证唯一性的算法多得很，听到这个需求就想到使用雪花ID。但产品冒出来说要求券码长度在10位以内，这个需要斟酌一下。</br><br>想了一下，雪花ID是64位二进制数,如果把base提高，那么位数就会下降。</br><br>随便做个测试：</p>\n<pre><code class=\"java\">public static void main(String[] args) {\n    System.out.println(Long.toString(SnowflakeIdUtil.generateId(), 32));\n}\n// output =&gt; gjnk3gf62400</code></pre>\n<p>32进制下只有12个字符了，加把劲把进制弄成64试试：</p>\n<pre><code class=\"java\">public static void main(String[] args) {\n    System.out.println(Long.toString(SnowflakeIdUtil.generateId(), 64));\n}\n// output =&gt; 598684081116483584</code></pre>\n<p>输出变成十进制了，感觉有问题，进去看看代码：</p>\n<pre><code class=\"java\">java.util.Long:\n   public static String toString(long i, int radix) {\n        // Look Here！ MIN_RADIX = 2   MAX_RADIX = 36\n        if (radix &lt; Character.MIN_RADIX || radix &gt; Character.MAX_RADIX)\n            radix = 10;\n        if (radix == 10)\n            return toString(i);\n   ......</code></pre>\n<p>Long这个类中的toString做了限制，只能将number表示为2-36进制编码的字符串,因为(0-9)+(a-z)刚好36个字符。这里没有考虑到大写字符也可以来做编码，<br>如果加上A-Z的大写字符，就有62个字符可用，可以将这个long表示为62进制的字符串，字符串内无特殊字符，既好看又不用考虑转义。<br>测试Base62：</p>\n<pre><code class=\"java\">使用hutool的Base62：\npublic static void main(String[] args) {\n    System.out.println(Base62.encode(Longs.toByteArray(nextId)));\n}\n// output =&gt; iDzwMuZe76</code></pre>\n<p>需求满足！</p>\n<h3 id=\"不连续性\"><a href=\"#不连续性\" class=\"headerlink\" title=\"不连续性\"></a>不连续性</h3><p>这个着实有点头疼，思考了一下把这个拆解为两个部分</p>\n<h4 id=\"业务线隔离\"><a href=\"#业务线隔离\" class=\"headerlink\" title=\"业务线隔离\"></a>业务线隔离</h4><p>总的来说就是要让同一时间内每个业务线生成的ID不连续，这样可以充分降低每个业务线之间券码冲突的可能性（虽然雪花ID本来就不冲突，只要时间不被NTP回调）。</p>\n<p>从SnowFlake类本身着手，由于我们应用跑在k8s内，本身就有全系统唯一的标识，且实例数也不会大于32，所以这里近似的任务SnowFlake中的datacenterId和workId没必要都用，<br>这里将容器的Id对32取余作为datacenterId(此处可能会导致冲突，后期可以与运维协商为容器编号，这里使用编号即可)，再对业务方提供的业务Id对32取余作为workId，这样基本达成了通过业务线隔离Id的要求。<br>11101010111101100010010110000000000</p>\n<h4 id=\"同一批券码隔离\"><a href=\"#同一批券码隔离\" class=\"headerlink\" title=\"同一批券码隔离\"></a>同一批券码隔离</h4><p>虽说同一批券码生成之间不冲突，但是由于雪花ID尾数是个序列，同一批券码生成出来尾数是连续的，这可能会导致相邻的券码被盗用，因此同一批券码隔离也是有必要的。</p>\n<p>还是打算从SnowFlake类着手，64位数，每一位都有用处，其中时间戳占用的空间比较大，占用了整整11位。要想腾空间，就只有拿时间戳开刀了。<br>首先我们计算1年的时间用时间戳表示需要多长：</p>\n<pre><code>毫秒*秒*分*时*天\n1000*60*60*24*365 \n = 31536000000\n = 0b11101010111101100010010110000000000\n1年时间需要35个二进制位表示，剩下6个二进制位，可以提供出0b111111(64)个位置\n\n31536000000*3\n = 0b1011000000111000100111000010000000000\n3年的时间需要37个二进制位来表示，剩下4个二进制位，可以提供处0b1111(16)个位置给用户猜测\n\n31536000000*5\n = 0b10010010110110011101011101110000000000\n5年的时间需要38个二进制位来表示，剩下3个二进制位，可以提供处0b111(8)个位置给用户猜测\n\n感觉差不多了，就用38个二进制位:\n\n38个二进制位\n0b11111111111111111111111111111111111111\n = 274877906943\n274877906943/1000/3600/24 约 3181.46天 合 8.7年\n</code></pre><p>如此这般，便省下来3个二进制位和时间戳前面的符号位一起组成4个二进制位用于放猜解，可以提供16种组合</p>\n<p>这里吐槽一下，这个限制10位要求全局唯一要求生成性能高还要抗猜解真的有点过分，当然雪花算法也并不特别适合这种场景，有其他好的方案就更好了。</p>\n<p>后续重写Snowflake类，重新设置位移位数并新增抗猜解位数就可以了。</p>\n<h2 id=\"业务以及表结构设计\"><a href=\"#业务以及表结构设计\" class=\"headerlink\" title=\"业务以及表结构设计\"></a>业务以及表结构设计</h2><p>这个功能说来简单，其实也有不明确的点：</p>\n<ol>\n<li>一次要生成多少张券？每一批券需不需要记录批次？</li>\n<li>是即时生成还是仅记录数量用时再取？</li>\n<li>需要管理什么字段？</li>\n</ol>\n<p>就个人想法来说，先假设每个系统会有一个账户，系统收到钱后会生成订单，根据订单数额，找本系统添加对应数量的券码。但是由于生成的数量较多，因此在这里并不会真正地生成券码，只会记录该系统拥有对应数量的券码额度。随后调用获取券码接口时，再生成券码，再通过限制该接口的调用频率和最大券码数来控制性能消耗。</p>\n<p>最终交互设计图如下：<br><img src=\"../_images/%E5%8F%91%E7%A0%81%E5%B9%B3%E5%8F%B0%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%8F%91%E7%A0%81%E5%B9%B3%E5%8F%B0%E4%BA%A4%E4%BA%92%E5%9B%BE.jpg\" alt=\"发码平台交互图\" title=\"发码平台交互图\"></p>\n<h3 id=\"生成管理表设计-省略大家都有的字段-generate-manage\"><a href=\"#生成管理表设计-省略大家都有的字段-generate-manage\" class=\"headerlink\" title=\"生成管理表设计(省略大家都有的字段) generate_manage\"></a>生成管理表设计(省略大家都有的字段) generate_manage</h3><table>\n<thead>\n<tr>\n<th>field</br>(驼峰/下划线脑内自行转换)</th>\n<th>type</th>\n<th>function</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>id</td>\n<td>varchar(32)</td>\n<td>-</td>\n</tr>\n<tr>\n<td>systemId</td>\n<td>varchar(32)</td>\n<td>具体业务线Id</td>\n</tr>\n<tr>\n<td>systemName</td>\n<td>varchar(128)</td>\n<td>业务系统名冗余在此</br>避免远程查表</td>\n</tr>\n<tr>\n<td>type</td>\n<td>varchar(64)</td>\n<td>这批券码的生成方式(SNOWFLAKE_LITE/UUID)</td>\n</tr>\n<tr>\n<td>total</td>\n<td>bigint</td>\n<td>该批次拥有的券码总数</td>\n</tr>\n<tr>\n<td>current</td>\n<td>bigint</td>\n<td>该批次已生成的券码总数（保证原子性）</td>\n</tr>\n<tr>\n<td>systemName</td>\n<td>varchar(128)</td>\n<td>业务系统名冗余在此</br>避免远程查表</td>\n</tr>\n<tr>\n<td>businessTypeTemplate</td>\n<td>varchar(64)</td>\n<td>[模板]提供给业务方存储业务上的类型</br>在获取券码时可以覆盖该值</br>可能是以后做查询的条件</td>\n</tr>\n<tr>\n<td>businessDataTemplate</td>\n<td>json</td>\n<td>[模板]提供给业务方存储该批次券码的公有属性</br>在获取券码时可以覆盖该值</br>券码被消费时将返给业务方</td>\n</tr>\n<tr>\n<td>callbackTemplate</td>\n<td>json</td>\n<td>[模板]券码被消费回调地址</br>在获取券码时可以覆盖该值</td>\n</tr>\n<tr>\n<td>createTime</td>\n<td>date(3)</td>\n<td>-</td>\n</tr>\n</tbody></table>\n<h3 id=\"生成操作记录表设计-省略大家都有的字段-generate-operation\"><a href=\"#生成操作记录表设计-省略大家都有的字段-generate-operation\" class=\"headerlink\" title=\"生成操作记录表设计(省略大家都有的字段) generate_operation\"></a>生成操作记录表设计(省略大家都有的字段) generate_operation</h3><table>\n<thead>\n<tr>\n<th>field</br>(驼峰/下划线脑内自行转换)</th>\n<th>type</th>\n<th>function</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>id</td>\n<td>varchar(32)</td>\n<td>-</td>\n</tr>\n<tr>\n<td>manageId</td>\n<td>varchar(32)</td>\n<td>关联generate_manage</td>\n</tr>\n<tr>\n<td>total</td>\n<td>bigint</td>\n<td>该批次拥有的券码总数</td>\n</tr>\n<tr>\n<td>original</td>\n<td>bigint</td>\n<td>消费前数量</td>\n</tr>\n<tr>\n<td>consumption</td>\n<td>bigint</td>\n<td>本次消费数量</td>\n</tr>\n<tr>\n<td>remaining</td>\n<td>bigint</td>\n<td>剩余消费数量</td>\n</tr>\n<tr>\n<td>createTime</td>\n<td>date(3)</td>\n<td>-</td>\n</tr>\n</tbody></table>\n<h3 id=\"券码表设计-coupon\"><a href=\"#券码表设计-coupon\" class=\"headerlink\" title=\"券码表设计 coupon\"></a>券码表设计 coupon</h3><table>\n<thead>\n<tr>\n<th>field</br>(驼峰/下划线脑内自行转换)</th>\n<th>type</th>\n<th>function</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>id</td>\n<td>varchar(32)</td>\n<td>-</td>\n</tr>\n<tr>\n<td>manageId</td>\n<td>varchar(32)</td>\n<td>关联 generate_manage</td>\n</tr>\n<tr>\n<td>operationId</td>\n<td>varchar(32)</td>\n<td>关联 generate_operation</td>\n</tr>\n<tr>\n<td>systemId</td>\n<td>varchar(32)</td>\n<td>[冗余以避免连表]具体业务线Id</td>\n</tr>\n<tr>\n<td>systemName</td>\n<td>varchar(128)</td>\n<td>[冗余以避免连表]业务系统名冗余在此</br>避免远程查表</td>\n</tr>\n<tr>\n<td>generateTime</td>\n<td>date(3)</td>\n<td>[冗余以避免连表]券码生成时间</td>\n</tr>\n<tr>\n<td>code</td>\n<td>varchar(32)</td>\n<td>这个才是券码</td>\n</tr>\n<tr>\n<td>businessType</td>\n<td>varchar(32)</td>\n<td>提供给业务方存储业务上的类型</br>可能是以后做查询的条件</td>\n</tr>\n<tr>\n<td>businessData</td>\n<td>json</td>\n<td>提供给业务方存储该批次券码的公有属性</br>券码被消费时将返给业务方</td>\n</tr>\n<tr>\n<td>callback</td>\n<td>json</td>\n<td>券码被消费回调地址，格式为map为升级预留空间</br>Map&lt;String callbackUrl,String callbackVersion&gt;</td>\n</tr>\n<tr>\n<td>createTime</td>\n<td>date(3)</td>\n<td>-</td>\n</tr>\n</tbody></table>\n<h3 id=\"生成-获取券码API\"><a href=\"#生成-获取券码API\" class=\"headerlink\" title=\"生成/获取券码API\"></a>生成/获取券码API</h3><h4 id=\"request\"><a href=\"#request\" class=\"headerlink\" title=\"request\"></a>request</h4><table>\n<thead>\n<tr>\n<th>field</br>(驼峰/下划线脑内自行转换)</th>\n<th>type</th>\n<th>function</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>manageId</td>\n<td>String</td>\n<td>关联 generate_manage</td>\n</tr>\n<tr>\n<td>businessType</td>\n<td>String</td>\n<td>—</td>\n</tr>\n<tr>\n<td>businessData</td>\n<td>JSONObject</td>\n<td>—</td>\n</tr>\n<tr>\n<td>callback</td>\n<td>Map&lt;String,String&gt;</td>\n<td>—</td>\n</tr>\n</tbody></table>\n<h4 id=\"response\"><a href=\"#response\" class=\"headerlink\" title=\"response\"></a>response</h4><table>\n<thead>\n<tr>\n<th>field</br>(驼峰/下划线脑内自行转换)</th>\n<th>type</th>\n<th>function</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>operation</td>\n<td><code>GenerateOperation</code></td>\n<td></td>\n</tr>\n<tr>\n<td>coupons</td>\n<td><code>List&lt;Coupon&gt;</code></td>\n<td></td>\n</tr>\n</tbody></table>"},{"title":"泛型上下界","date":"2019-04-25T17:08:33.000Z","updated":"2020-02-20T07:41:36.000Z","comments":1,"_content":"\njava是基于类型擦除的伪泛型 没其他语言的泛型好用 \n<!--more-->\n###  super 类型下界通配符  \n\n- List中只能存储一种元素，此处声明的`<!--? super BaseDemoEntity-->`,表明这个List中存放的元素属于 BaseDemoEntity **其中一种** 父类类型\n\n-  BaseDemoEntity的父类可能有复数个，比如 Object，BaseEntity。取出时不知道到底List里到底装的啥，但一定是继承于Object，所以统一强转为Object类型\n\n- 存入时只能放入 BaseDemoEntity 和它的子类，因为声明的`<!--? super BaseDemoEntity-->`，BaseDemoEntity 可以被安全的强转为`<!--? super BaseDemoEntity-->`此处如果传入BaseDemoEntity的父类，那么运行时jvm将传入的类型转为`<!--? super BaseDemoEntity-->`时可能会因为类型不一致报错\n\n\n\n```java\n    @RequestMapping(\"/superBaseDemoEntity\")\n    public void superBaseDemoEntity() {\n\n        List<!--? super BaseDemoEntity--> appList = new ArrayList&lt;&gt;();\n        appList.add(new Music());\n        appList.add(new BaseDemoEntity());\n        Object object1 = appList.get(0);\n\n    }\n```\n\n### extends 类型上界通配符 \n\n- `<!--? extends BaseDemoEntity-->` =&gt; BaseDemoEntity的任意一种子类\n\n-  List中只能存储一种元素，此处声明的`<!--? extends BaseDemoEntity-->`表明这个List中存放的元素可能是继承与 BaseDemoEntity 的 **其中一种** 元素\n\n- 取出时可以被安全的强转为 BaseDemoEntity\n\n- 存入时由于不知道你存入的类型是否跟`<!--? extends BaseDemoEntity-->`类型是一个类型，因此不能存入\n\n```java\n     @RequestMapping(\"/extendsBaseDemoEntity\")\n    public void extendsBaseDemoEntity() {\n\n        List<!--? extends BaseDemoEntity--> appList2 = new ArrayList&lt;&gt;();\n        BaseDemoEntity baseDemoEntity = appList2.get(0);\n    }\n\n```\n","source":"_posts/泛型上下界.md","raw":"---\ntitle: '泛型上下界'\ndate: 2019/04/26 01:08:33\nupdated: 2020/2/20 15:41:36\ncomments: true\ncategories: \n    - [我永远爱学习]\ntags: \n    - java\n---\n\njava是基于类型擦除的伪泛型 没其他语言的泛型好用 \n<!--more-->\n###  super 类型下界通配符  \n\n- List中只能存储一种元素，此处声明的`<!--? super BaseDemoEntity-->`,表明这个List中存放的元素属于 BaseDemoEntity **其中一种** 父类类型\n\n-  BaseDemoEntity的父类可能有复数个，比如 Object，BaseEntity。取出时不知道到底List里到底装的啥，但一定是继承于Object，所以统一强转为Object类型\n\n- 存入时只能放入 BaseDemoEntity 和它的子类，因为声明的`<!--? super BaseDemoEntity-->`，BaseDemoEntity 可以被安全的强转为`<!--? super BaseDemoEntity-->`此处如果传入BaseDemoEntity的父类，那么运行时jvm将传入的类型转为`<!--? super BaseDemoEntity-->`时可能会因为类型不一致报错\n\n\n\n```java\n    @RequestMapping(\"/superBaseDemoEntity\")\n    public void superBaseDemoEntity() {\n\n        List<!--? super BaseDemoEntity--> appList = new ArrayList&lt;&gt;();\n        appList.add(new Music());\n        appList.add(new BaseDemoEntity());\n        Object object1 = appList.get(0);\n\n    }\n```\n\n### extends 类型上界通配符 \n\n- `<!--? extends BaseDemoEntity-->` =&gt; BaseDemoEntity的任意一种子类\n\n-  List中只能存储一种元素，此处声明的`<!--? extends BaseDemoEntity-->`表明这个List中存放的元素可能是继承与 BaseDemoEntity 的 **其中一种** 元素\n\n- 取出时可以被安全的强转为 BaseDemoEntity\n\n- 存入时由于不知道你存入的类型是否跟`<!--? extends BaseDemoEntity-->`类型是一个类型，因此不能存入\n\n```java\n     @RequestMapping(\"/extendsBaseDemoEntity\")\n    public void extendsBaseDemoEntity() {\n\n        List<!--? extends BaseDemoEntity--> appList2 = new ArrayList&lt;&gt;();\n        BaseDemoEntity baseDemoEntity = appList2.get(0);\n    }\n\n```\n","slug":"泛型上下界","published":1,"layout":"post","photos":[],"link":"","_id":"cktp91zl100124cowfz851fdx","content":"<p>java是基于类型擦除的伪泛型 没其他语言的泛型好用 </p>\n<a id=\"more\"></a>\n<h3 id=\"super-类型下界通配符\"><a href=\"#super-类型下界通配符\" class=\"headerlink\" title=\"super 类型下界通配符\"></a>super 类型下界通配符</h3><ul>\n<li><p>List中只能存储一种元素，此处声明的<code>&lt;!--? super BaseDemoEntity--&gt;</code>,表明这个List中存放的元素属于 BaseDemoEntity <strong>其中一种</strong> 父类类型</p>\n</li>\n<li><p>BaseDemoEntity的父类可能有复数个，比如 Object，BaseEntity。取出时不知道到底List里到底装的啥，但一定是继承于Object，所以统一强转为Object类型</p>\n</li>\n<li><p>存入时只能放入 BaseDemoEntity 和它的子类，因为声明的<code>&lt;!--? super BaseDemoEntity--&gt;</code>，BaseDemoEntity 可以被安全的强转为<code>&lt;!--? super BaseDemoEntity--&gt;</code>此处如果传入BaseDemoEntity的父类，那么运行时jvm将传入的类型转为<code>&lt;!--? super BaseDemoEntity--&gt;</code>时可能会因为类型不一致报错</p>\n</li>\n</ul>\n<pre><code class=\"java\">    @RequestMapping(&quot;/superBaseDemoEntity&quot;)\n    public void superBaseDemoEntity() {\n\n        List&lt;!--? super BaseDemoEntity--&gt; appList = new ArrayList&amp;lt;&amp;gt;();\n        appList.add(new Music());\n        appList.add(new BaseDemoEntity());\n        Object object1 = appList.get(0);\n\n    }</code></pre>\n<h3 id=\"extends-类型上界通配符\"><a href=\"#extends-类型上界通配符\" class=\"headerlink\" title=\"extends 类型上界通配符\"></a>extends 类型上界通配符</h3><ul>\n<li><p><code>&lt;!--? extends BaseDemoEntity--&gt;</code> =&gt; BaseDemoEntity的任意一种子类</p>\n</li>\n<li><p>List中只能存储一种元素，此处声明的<code>&lt;!--? extends BaseDemoEntity--&gt;</code>表明这个List中存放的元素可能是继承与 BaseDemoEntity 的 <strong>其中一种</strong> 元素</p>\n</li>\n<li><p>取出时可以被安全的强转为 BaseDemoEntity</p>\n</li>\n<li><p>存入时由于不知道你存入的类型是否跟<code>&lt;!--? extends BaseDemoEntity--&gt;</code>类型是一个类型，因此不能存入</p>\n</li>\n</ul>\n<pre><code class=\"java\">     @RequestMapping(&quot;/extendsBaseDemoEntity&quot;)\n    public void extendsBaseDemoEntity() {\n\n        List&lt;!--? extends BaseDemoEntity--&gt; appList2 = new ArrayList&amp;lt;&amp;gt;();\n        BaseDemoEntity baseDemoEntity = appList2.get(0);\n    }\n</code></pre>\n","site":{"data":{}},"excerpt":"<p>java是基于类型擦除的伪泛型 没其他语言的泛型好用 </p>","more":"<h3 id=\"super-类型下界通配符\"><a href=\"#super-类型下界通配符\" class=\"headerlink\" title=\"super 类型下界通配符\"></a>super 类型下界通配符</h3><ul>\n<li><p>List中只能存储一种元素，此处声明的<code>&lt;!--? super BaseDemoEntity--&gt;</code>,表明这个List中存放的元素属于 BaseDemoEntity <strong>其中一种</strong> 父类类型</p>\n</li>\n<li><p>BaseDemoEntity的父类可能有复数个，比如 Object，BaseEntity。取出时不知道到底List里到底装的啥，但一定是继承于Object，所以统一强转为Object类型</p>\n</li>\n<li><p>存入时只能放入 BaseDemoEntity 和它的子类，因为声明的<code>&lt;!--? super BaseDemoEntity--&gt;</code>，BaseDemoEntity 可以被安全的强转为<code>&lt;!--? super BaseDemoEntity--&gt;</code>此处如果传入BaseDemoEntity的父类，那么运行时jvm将传入的类型转为<code>&lt;!--? super BaseDemoEntity--&gt;</code>时可能会因为类型不一致报错</p>\n</li>\n</ul>\n<pre><code class=\"java\">    @RequestMapping(&quot;/superBaseDemoEntity&quot;)\n    public void superBaseDemoEntity() {\n\n        List&lt;!--? super BaseDemoEntity--&gt; appList = new ArrayList&amp;lt;&amp;gt;();\n        appList.add(new Music());\n        appList.add(new BaseDemoEntity());\n        Object object1 = appList.get(0);\n\n    }</code></pre>\n<h3 id=\"extends-类型上界通配符\"><a href=\"#extends-类型上界通配符\" class=\"headerlink\" title=\"extends 类型上界通配符\"></a>extends 类型上界通配符</h3><ul>\n<li><p><code>&lt;!--? extends BaseDemoEntity--&gt;</code> =&gt; BaseDemoEntity的任意一种子类</p>\n</li>\n<li><p>List中只能存储一种元素，此处声明的<code>&lt;!--? extends BaseDemoEntity--&gt;</code>表明这个List中存放的元素可能是继承与 BaseDemoEntity 的 <strong>其中一种</strong> 元素</p>\n</li>\n<li><p>取出时可以被安全的强转为 BaseDemoEntity</p>\n</li>\n<li><p>存入时由于不知道你存入的类型是否跟<code>&lt;!--? extends BaseDemoEntity--&gt;</code>类型是一个类型，因此不能存入</p>\n</li>\n</ul>\n<pre><code class=\"java\">     @RequestMapping(&quot;/extendsBaseDemoEntity&quot;)\n    public void extendsBaseDemoEntity() {\n\n        List&lt;!--? extends BaseDemoEntity--&gt; appList2 = new ArrayList&amp;lt;&amp;gt;();\n        BaseDemoEntity baseDemoEntity = appList2.get(0);\n    }\n</code></pre>"},{"title":"[Zookeeper学习-第一章]zk环境搭建[单机+控制台]","date":"2019-07-01T07:53:24.000Z","updated":"2020-02-20T07:41:36.000Z","comments":1,"_content":"\n系统环境为 Centos ，由于项目需要，准备搭建 zookeeper-3.5.5 + 用于方便展示节点的zookeeperAdmin用作公司开发之用\n<!--more-->\n\n## zookeeper-3.5.5\n\n### 下载\n\n前往开源项目[下载页面](http://zookeeper.apache.org/releases.html#download)根据需要下载对应的版本（注意要下载文件名后面带\"-bin\"的包）<br/>\n[懒人链接](https://archive.apache.org/dist/zookeeper/)\n\n```bash\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# tar -zxvf ./apache-zookeeper-3.5.5-bin.tar.gz\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# cd ./apache-zookeeper-3.5.5-bin.tar.gz\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# ll\ntotal 44\ndrwxr-xr-x 2 2002 2002  4096 Apr  9 19:13 bin\ndrwxr-xr-x 2 2002 2002  4096 Sep 20 14:00 conf\ndrwxr-xr-x 5 2002 2002  4096 May  3 20:07 docs\ndrwxr-xr-x 2 root root  4096 Sep 20 13:40 lib\n-rw-r--r-- 1 2002 2002 11358 Feb 15  2019 LICENSE.txt\ndrwxr-xr-x 2 root root  4096 Sep 20 13:43 logs\n-rw-r--r-- 1 2002 2002   432 Apr  9 19:13 NOTICE.txt\n-rw-r--r-- 1 2002 2002  1560 May  3 19:41 README.md\n-rw-r--r-- 1 2002 2002  1347 Apr  2 21:05 README_packaging.txt\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# ll\n[root@iZuf6imeqt5e7fo9jw7918Z apache-zookeeper-3.5.5-bin]# cd conf\n[root@iZuf6imeqt5e7fo9jw7918Z conf]# ll\ntotal 16\n-rw-r--r-- 1 2002 2002  535 Feb 15  2019 configuration.xsl\n-rw-r--r-- 1 2002 2002 2712 Apr  2 21:05 log4j.properties\n-rw-r--r-- 1 2002 2002  922 Feb 15  2019 zoo_sample.cfg\n[root@iZuf6imeqt5e7fo9jw7918Z conf]# cp ./zoo_sample.cfg ./zoo.cfg\n[root@iZuf6imeqt5e7fo9jw7918Z conf]# cd ../bin/\n[root@iZuf6imeqt5e7fo9jw7918Z conf]# \n\n```\n\n### 需要留意的\n如果在这里直接启动的话可能会启动不成功，因为apache-zookeeper默认监听了8080端口作为自己的`zookeeper-server`的服务端。最好是自己在./conf/zoo.cfg中配置一下`admin.serverPort=[自己随便改个端口]`，对的，配置文件里默认是没有这行的，这个比较坑。\n\n### 启动\n```bash\n[root@iZuf6imeqt5e7fo9jw7918Z bin]# ./zkServer.sh start\n/usr/bin/java\nZooKeeper JMX enabled by default\nUsing config: /app/zookeeper/apache-zookeeper-3.5.5-bin/bin/../conf/zoo.cfg\nStarting zookeeper ... STARTED\n[root@iZuf6imeqt5e7fo9jw7918Z bin]# ./zkServer.sh start\n/usr/bin/java\nZooKeeper JMX enabled by default\nUsing config: /app/zookeeper/apache-zookeeper-3.5.5-bin/bin/../conf/zoo.cfg\nStarting zookeeper ... already running as process 29414.\n[root@iZuf6imeqt5e7fo9jw7918Z bin]# ./zkServer.sh status\n/usr/bin/java\nZooKeeper JMX enabled by default\nUsing config: /app/zookeeper/apache-zookeeper-3.5.5-bin/bin/../conf/zoo.cfg\nClient port found: 2181. Client address: localhost.\nMode: standalone\n```\n\n\n\n##  zookeeper-admin\n这是一个github上的小[项目](https://github.com/Ahoo-Wang/ZooKeeper-Admin)<br/>\n功能不多，刚刚够用就行，不整那些花里胡哨的，支持直接使用docker构建，非常方便\n\n```bash\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# docker run --name zookeeper-admin -p 80:2182 docker.io/ahoowang/zookeeper.admin\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# docker container ls\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES\n56bf5522f4fe        4232addbc345        \"dotnet ZooKeeper....\"   About an hour ago   Up 2 minutes        0.0.0.0:2182-&gt;80/tcp   zookeeper-admin\n\n```\n![zookeeper-admin](leanote://file/getImage?fileId=5d84827ce1488a763c000019)\n\n界面看上去还不错。\n\n然而好景不长，跑了一阵发现无法访问了。\n```bash\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# docker container ls\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n```\n??? 怎么停止了，看看日志怎么说\n```\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# docker logs 56bf5522f4fe\nHosting environment: Production\nContent root path: /app\nNow listening on: http://+:80\nApplication started. Press Ctrl+C to shut down.\nApplication is shutting down...\nHosting environment: Production\nContent root path: /app\nNow listening on: http://+:80\nApplication started. Press Ctrl+C to shut down.\nUnhandled Exception: System.InvalidOperationException: Collection was modified; enumeration operation may not execute.\n   at System.ThrowHelper.ThrowInvalidOperationException(ExceptionResource resource)\n   at System.Collections.Generic.Dictionary`2.ValueCollection.Enumerator.MoveNext()\n   at ZooKeeper.Admin.ZooKeeperManager.<dispose>d__9.MoveNext() in E:\\ZooKeeper-Admin\\ZooKeeper.Admin\\ZooKeeperManager.cs:line 55\n--- End of stack trace from previous location where exception was thrown ---\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\n   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)\n   at System.Threading.QueueUserWorkItemCallback.System.Threading.IThreadPoolWorkItem.ExecuteWorkItem()\n   at System.Threading.ThreadPoolWorkQueue.Dispatch()\n\n```\n\n\n\n","source":"_posts/[Zookeeper学习-第一章]zk环境搭建[单机+控制台].md","raw":"---\ntitle: '[Zookeeper学习-第一章]zk环境搭建[单机+控制台]'\ndate: 2019/7/1 15:53:24\nupdated: 2020/2/20 15:41:36\ncomments: true\ncategories: \n    - [我永远爱学习]\ntags: \n    - java\n    - zookeeper\n---\n\n系统环境为 Centos ，由于项目需要，准备搭建 zookeeper-3.5.5 + 用于方便展示节点的zookeeperAdmin用作公司开发之用\n<!--more-->\n\n## zookeeper-3.5.5\n\n### 下载\n\n前往开源项目[下载页面](http://zookeeper.apache.org/releases.html#download)根据需要下载对应的版本（注意要下载文件名后面带\"-bin\"的包）<br/>\n[懒人链接](https://archive.apache.org/dist/zookeeper/)\n\n```bash\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# tar -zxvf ./apache-zookeeper-3.5.5-bin.tar.gz\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# cd ./apache-zookeeper-3.5.5-bin.tar.gz\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# ll\ntotal 44\ndrwxr-xr-x 2 2002 2002  4096 Apr  9 19:13 bin\ndrwxr-xr-x 2 2002 2002  4096 Sep 20 14:00 conf\ndrwxr-xr-x 5 2002 2002  4096 May  3 20:07 docs\ndrwxr-xr-x 2 root root  4096 Sep 20 13:40 lib\n-rw-r--r-- 1 2002 2002 11358 Feb 15  2019 LICENSE.txt\ndrwxr-xr-x 2 root root  4096 Sep 20 13:43 logs\n-rw-r--r-- 1 2002 2002   432 Apr  9 19:13 NOTICE.txt\n-rw-r--r-- 1 2002 2002  1560 May  3 19:41 README.md\n-rw-r--r-- 1 2002 2002  1347 Apr  2 21:05 README_packaging.txt\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# ll\n[root@iZuf6imeqt5e7fo9jw7918Z apache-zookeeper-3.5.5-bin]# cd conf\n[root@iZuf6imeqt5e7fo9jw7918Z conf]# ll\ntotal 16\n-rw-r--r-- 1 2002 2002  535 Feb 15  2019 configuration.xsl\n-rw-r--r-- 1 2002 2002 2712 Apr  2 21:05 log4j.properties\n-rw-r--r-- 1 2002 2002  922 Feb 15  2019 zoo_sample.cfg\n[root@iZuf6imeqt5e7fo9jw7918Z conf]# cp ./zoo_sample.cfg ./zoo.cfg\n[root@iZuf6imeqt5e7fo9jw7918Z conf]# cd ../bin/\n[root@iZuf6imeqt5e7fo9jw7918Z conf]# \n\n```\n\n### 需要留意的\n如果在这里直接启动的话可能会启动不成功，因为apache-zookeeper默认监听了8080端口作为自己的`zookeeper-server`的服务端。最好是自己在./conf/zoo.cfg中配置一下`admin.serverPort=[自己随便改个端口]`，对的，配置文件里默认是没有这行的，这个比较坑。\n\n### 启动\n```bash\n[root@iZuf6imeqt5e7fo9jw7918Z bin]# ./zkServer.sh start\n/usr/bin/java\nZooKeeper JMX enabled by default\nUsing config: /app/zookeeper/apache-zookeeper-3.5.5-bin/bin/../conf/zoo.cfg\nStarting zookeeper ... STARTED\n[root@iZuf6imeqt5e7fo9jw7918Z bin]# ./zkServer.sh start\n/usr/bin/java\nZooKeeper JMX enabled by default\nUsing config: /app/zookeeper/apache-zookeeper-3.5.5-bin/bin/../conf/zoo.cfg\nStarting zookeeper ... already running as process 29414.\n[root@iZuf6imeqt5e7fo9jw7918Z bin]# ./zkServer.sh status\n/usr/bin/java\nZooKeeper JMX enabled by default\nUsing config: /app/zookeeper/apache-zookeeper-3.5.5-bin/bin/../conf/zoo.cfg\nClient port found: 2181. Client address: localhost.\nMode: standalone\n```\n\n\n\n##  zookeeper-admin\n这是一个github上的小[项目](https://github.com/Ahoo-Wang/ZooKeeper-Admin)<br/>\n功能不多，刚刚够用就行，不整那些花里胡哨的，支持直接使用docker构建，非常方便\n\n```bash\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# docker run --name zookeeper-admin -p 80:2182 docker.io/ahoowang/zookeeper.admin\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# docker container ls\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES\n56bf5522f4fe        4232addbc345        \"dotnet ZooKeeper....\"   About an hour ago   Up 2 minutes        0.0.0.0:2182-&gt;80/tcp   zookeeper-admin\n\n```\n![zookeeper-admin](leanote://file/getImage?fileId=5d84827ce1488a763c000019)\n\n界面看上去还不错。\n\n然而好景不长，跑了一阵发现无法访问了。\n```bash\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# docker container ls\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n```\n??? 怎么停止了，看看日志怎么说\n```\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# docker logs 56bf5522f4fe\nHosting environment: Production\nContent root path: /app\nNow listening on: http://+:80\nApplication started. Press Ctrl+C to shut down.\nApplication is shutting down...\nHosting environment: Production\nContent root path: /app\nNow listening on: http://+:80\nApplication started. Press Ctrl+C to shut down.\nUnhandled Exception: System.InvalidOperationException: Collection was modified; enumeration operation may not execute.\n   at System.ThrowHelper.ThrowInvalidOperationException(ExceptionResource resource)\n   at System.Collections.Generic.Dictionary`2.ValueCollection.Enumerator.MoveNext()\n   at ZooKeeper.Admin.ZooKeeperManager.<dispose>d__9.MoveNext() in E:\\ZooKeeper-Admin\\ZooKeeper.Admin\\ZooKeeperManager.cs:line 55\n--- End of stack trace from previous location where exception was thrown ---\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\n   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)\n   at System.Threading.QueueUserWorkItemCallback.System.Threading.IThreadPoolWorkItem.ExecuteWorkItem()\n   at System.Threading.ThreadPoolWorkQueue.Dispatch()\n\n```\n\n\n\n","slug":"[Zookeeper学习-第一章]zk环境搭建[单机+控制台]","published":1,"layout":"post","photos":[],"link":"","_id":"cktp91zl400154cowhhj4htrn","content":"<p>系统环境为 Centos ，由于项目需要，准备搭建 zookeeper-3.5.5 + 用于方便展示节点的zookeeperAdmin用作公司开发之用</p>\n<a id=\"more\"></a>\n\n<h2 id=\"zookeeper-3-5-5\"><a href=\"#zookeeper-3-5-5\" class=\"headerlink\" title=\"zookeeper-3.5.5\"></a>zookeeper-3.5.5</h2><h3 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h3><p>前往开源项目<a href=\"http://zookeeper.apache.org/releases.html#download\" target=\"_blank\" rel=\"noopener\">下载页面</a>根据需要下载对应的版本（注意要下载文件名后面带”-bin”的包）<br/><br><a href=\"https://archive.apache.org/dist/zookeeper/\" target=\"_blank\" rel=\"noopener\">懒人链接</a></p>\n<pre><code class=\"bash\">[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# tar -zxvf ./apache-zookeeper-3.5.5-bin.tar.gz\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# cd ./apache-zookeeper-3.5.5-bin.tar.gz\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# ll\ntotal 44\ndrwxr-xr-x 2 2002 2002  4096 Apr  9 19:13 bin\ndrwxr-xr-x 2 2002 2002  4096 Sep 20 14:00 conf\ndrwxr-xr-x 5 2002 2002  4096 May  3 20:07 docs\ndrwxr-xr-x 2 root root  4096 Sep 20 13:40 lib\n-rw-r--r-- 1 2002 2002 11358 Feb 15  2019 LICENSE.txt\ndrwxr-xr-x 2 root root  4096 Sep 20 13:43 logs\n-rw-r--r-- 1 2002 2002   432 Apr  9 19:13 NOTICE.txt\n-rw-r--r-- 1 2002 2002  1560 May  3 19:41 README.md\n-rw-r--r-- 1 2002 2002  1347 Apr  2 21:05 README_packaging.txt\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# ll\n[root@iZuf6imeqt5e7fo9jw7918Z apache-zookeeper-3.5.5-bin]# cd conf\n[root@iZuf6imeqt5e7fo9jw7918Z conf]# ll\ntotal 16\n-rw-r--r-- 1 2002 2002  535 Feb 15  2019 configuration.xsl\n-rw-r--r-- 1 2002 2002 2712 Apr  2 21:05 log4j.properties\n-rw-r--r-- 1 2002 2002  922 Feb 15  2019 zoo_sample.cfg\n[root@iZuf6imeqt5e7fo9jw7918Z conf]# cp ./zoo_sample.cfg ./zoo.cfg\n[root@iZuf6imeqt5e7fo9jw7918Z conf]# cd ../bin/\n[root@iZuf6imeqt5e7fo9jw7918Z conf]# \n</code></pre>\n<h3 id=\"需要留意的\"><a href=\"#需要留意的\" class=\"headerlink\" title=\"需要留意的\"></a>需要留意的</h3><p>如果在这里直接启动的话可能会启动不成功，因为apache-zookeeper默认监听了8080端口作为自己的<code>zookeeper-server</code>的服务端。最好是自己在./conf/zoo.cfg中配置一下<code>admin.serverPort=[自己随便改个端口]</code>，对的，配置文件里默认是没有这行的，这个比较坑。</p>\n<h3 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h3><pre><code class=\"bash\">[root@iZuf6imeqt5e7fo9jw7918Z bin]# ./zkServer.sh start\n/usr/bin/java\nZooKeeper JMX enabled by default\nUsing config: /app/zookeeper/apache-zookeeper-3.5.5-bin/bin/../conf/zoo.cfg\nStarting zookeeper ... STARTED\n[root@iZuf6imeqt5e7fo9jw7918Z bin]# ./zkServer.sh start\n/usr/bin/java\nZooKeeper JMX enabled by default\nUsing config: /app/zookeeper/apache-zookeeper-3.5.5-bin/bin/../conf/zoo.cfg\nStarting zookeeper ... already running as process 29414.\n[root@iZuf6imeqt5e7fo9jw7918Z bin]# ./zkServer.sh status\n/usr/bin/java\nZooKeeper JMX enabled by default\nUsing config: /app/zookeeper/apache-zookeeper-3.5.5-bin/bin/../conf/zoo.cfg\nClient port found: 2181. Client address: localhost.\nMode: standalone</code></pre>\n<h2 id=\"zookeeper-admin\"><a href=\"#zookeeper-admin\" class=\"headerlink\" title=\"zookeeper-admin\"></a>zookeeper-admin</h2><p>这是一个github上的小<a href=\"https://github.com/Ahoo-Wang/ZooKeeper-Admin\" target=\"_blank\" rel=\"noopener\">项目</a><br/><br>功能不多，刚刚够用就行，不整那些花里胡哨的，支持直接使用docker构建，非常方便</p>\n<pre><code class=\"bash\">[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# docker run --name zookeeper-admin -p 80:2182 docker.io/ahoowang/zookeeper.admin\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# docker container ls\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES\n56bf5522f4fe        4232addbc345        &quot;dotnet ZooKeeper....&quot;   About an hour ago   Up 2 minutes        0.0.0.0:2182-&amp;gt;80/tcp   zookeeper-admin\n</code></pre>\n<p><img src=\"leanote://file/getImage?fileId=5d84827ce1488a763c000019\" alt=\"zookeeper-admin\"></p>\n<p>界面看上去还不错。</p>\n<p>然而好景不长，跑了一阵发现无法访问了。</p>\n<pre><code class=\"bash\">[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# docker container ls\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</code></pre>\n<p>??? 怎么停止了，看看日志怎么说</p>\n<pre><code>[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# docker logs 56bf5522f4fe\nHosting environment: Production\nContent root path: /app\nNow listening on: http://+:80\nApplication started. Press Ctrl+C to shut down.\nApplication is shutting down...\nHosting environment: Production\nContent root path: /app\nNow listening on: http://+:80\nApplication started. Press Ctrl+C to shut down.\nUnhandled Exception: System.InvalidOperationException: Collection was modified; enumeration operation may not execute.\n   at System.ThrowHelper.ThrowInvalidOperationException(ExceptionResource resource)\n   at System.Collections.Generic.Dictionary`2.ValueCollection.Enumerator.MoveNext()\n   at ZooKeeper.Admin.ZooKeeperManager.&lt;dispose&gt;d__9.MoveNext() in E:\\ZooKeeper-Admin\\ZooKeeper.Admin\\ZooKeeperManager.cs:line 55\n--- End of stack trace from previous location where exception was thrown ---\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\n   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)\n   at System.Threading.QueueUserWorkItemCallback.System.Threading.IThreadPoolWorkItem.ExecuteWorkItem()\n   at System.Threading.ThreadPoolWorkQueue.Dispatch()\n</code></pre>","site":{"data":{}},"excerpt":"<p>系统环境为 Centos ，由于项目需要，准备搭建 zookeeper-3.5.5 + 用于方便展示节点的zookeeperAdmin用作公司开发之用</p>","more":"<h2 id=\"zookeeper-3-5-5\"><a href=\"#zookeeper-3-5-5\" class=\"headerlink\" title=\"zookeeper-3.5.5\"></a>zookeeper-3.5.5</h2><h3 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h3><p>前往开源项目<a href=\"http://zookeeper.apache.org/releases.html#download\" target=\"_blank\" rel=\"noopener\">下载页面</a>根据需要下载对应的版本（注意要下载文件名后面带”-bin”的包）<br/><br><a href=\"https://archive.apache.org/dist/zookeeper/\" target=\"_blank\" rel=\"noopener\">懒人链接</a></p>\n<pre><code class=\"bash\">[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# tar -zxvf ./apache-zookeeper-3.5.5-bin.tar.gz\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# cd ./apache-zookeeper-3.5.5-bin.tar.gz\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# ll\ntotal 44\ndrwxr-xr-x 2 2002 2002  4096 Apr  9 19:13 bin\ndrwxr-xr-x 2 2002 2002  4096 Sep 20 14:00 conf\ndrwxr-xr-x 5 2002 2002  4096 May  3 20:07 docs\ndrwxr-xr-x 2 root root  4096 Sep 20 13:40 lib\n-rw-r--r-- 1 2002 2002 11358 Feb 15  2019 LICENSE.txt\ndrwxr-xr-x 2 root root  4096 Sep 20 13:43 logs\n-rw-r--r-- 1 2002 2002   432 Apr  9 19:13 NOTICE.txt\n-rw-r--r-- 1 2002 2002  1560 May  3 19:41 README.md\n-rw-r--r-- 1 2002 2002  1347 Apr  2 21:05 README_packaging.txt\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# ll\n[root@iZuf6imeqt5e7fo9jw7918Z apache-zookeeper-3.5.5-bin]# cd conf\n[root@iZuf6imeqt5e7fo9jw7918Z conf]# ll\ntotal 16\n-rw-r--r-- 1 2002 2002  535 Feb 15  2019 configuration.xsl\n-rw-r--r-- 1 2002 2002 2712 Apr  2 21:05 log4j.properties\n-rw-r--r-- 1 2002 2002  922 Feb 15  2019 zoo_sample.cfg\n[root@iZuf6imeqt5e7fo9jw7918Z conf]# cp ./zoo_sample.cfg ./zoo.cfg\n[root@iZuf6imeqt5e7fo9jw7918Z conf]# cd ../bin/\n[root@iZuf6imeqt5e7fo9jw7918Z conf]# \n</code></pre>\n<h3 id=\"需要留意的\"><a href=\"#需要留意的\" class=\"headerlink\" title=\"需要留意的\"></a>需要留意的</h3><p>如果在这里直接启动的话可能会启动不成功，因为apache-zookeeper默认监听了8080端口作为自己的<code>zookeeper-server</code>的服务端。最好是自己在./conf/zoo.cfg中配置一下<code>admin.serverPort=[自己随便改个端口]</code>，对的，配置文件里默认是没有这行的，这个比较坑。</p>\n<h3 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h3><pre><code class=\"bash\">[root@iZuf6imeqt5e7fo9jw7918Z bin]# ./zkServer.sh start\n/usr/bin/java\nZooKeeper JMX enabled by default\nUsing config: /app/zookeeper/apache-zookeeper-3.5.5-bin/bin/../conf/zoo.cfg\nStarting zookeeper ... STARTED\n[root@iZuf6imeqt5e7fo9jw7918Z bin]# ./zkServer.sh start\n/usr/bin/java\nZooKeeper JMX enabled by default\nUsing config: /app/zookeeper/apache-zookeeper-3.5.5-bin/bin/../conf/zoo.cfg\nStarting zookeeper ... already running as process 29414.\n[root@iZuf6imeqt5e7fo9jw7918Z bin]# ./zkServer.sh status\n/usr/bin/java\nZooKeeper JMX enabled by default\nUsing config: /app/zookeeper/apache-zookeeper-3.5.5-bin/bin/../conf/zoo.cfg\nClient port found: 2181. Client address: localhost.\nMode: standalone</code></pre>\n<h2 id=\"zookeeper-admin\"><a href=\"#zookeeper-admin\" class=\"headerlink\" title=\"zookeeper-admin\"></a>zookeeper-admin</h2><p>这是一个github上的小<a href=\"https://github.com/Ahoo-Wang/ZooKeeper-Admin\" target=\"_blank\" rel=\"noopener\">项目</a><br/><br>功能不多，刚刚够用就行，不整那些花里胡哨的，支持直接使用docker构建，非常方便</p>\n<pre><code class=\"bash\">[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# docker run --name zookeeper-admin -p 80:2182 docker.io/ahoowang/zookeeper.admin\n[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# docker container ls\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES\n56bf5522f4fe        4232addbc345        &quot;dotnet ZooKeeper....&quot;   About an hour ago   Up 2 minutes        0.0.0.0:2182-&amp;gt;80/tcp   zookeeper-admin\n</code></pre>\n<p><img src=\"leanote://file/getImage?fileId=5d84827ce1488a763c000019\" alt=\"zookeeper-admin\"></p>\n<p>界面看上去还不错。</p>\n<p>然而好景不长，跑了一阵发现无法访问了。</p>\n<pre><code class=\"bash\">[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# docker container ls\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</code></pre>\n<p>??? 怎么停止了，看看日志怎么说</p>\n<pre><code>[root@iZuf6imeqt5e7fo9jw7918Z zookeeper]# docker logs 56bf5522f4fe\nHosting environment: Production\nContent root path: /app\nNow listening on: http://+:80\nApplication started. Press Ctrl+C to shut down.\nApplication is shutting down...\nHosting environment: Production\nContent root path: /app\nNow listening on: http://+:80\nApplication started. Press Ctrl+C to shut down.\nUnhandled Exception: System.InvalidOperationException: Collection was modified; enumeration operation may not execute.\n   at System.ThrowHelper.ThrowInvalidOperationException(ExceptionResource resource)\n   at System.Collections.Generic.Dictionary`2.ValueCollection.Enumerator.MoveNext()\n   at ZooKeeper.Admin.ZooKeeperManager.&lt;dispose&gt;d__9.MoveNext() in E:\\ZooKeeper-Admin\\ZooKeeper.Admin\\ZooKeeperManager.cs:line 55\n--- End of stack trace from previous location where exception was thrown ---\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\n   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)\n   at System.Threading.QueueUserWorkItemCallback.System.Threading.IThreadPoolWorkItem.ExecuteWorkItem()\n   at System.Threading.ThreadPoolWorkQueue.Dispatch()\n</code></pre>"},{"title":"好用常用人人都要会的最基本的Maven插件收集","date":"2019-03-10T19:05:56.000Z","updated":"2020-02-20T07:41:36.000Z","comments":1,"cover":"/2019/03/11/好用常用人人都要会的最基本的Maven插件收集/title.jpg","coverWidth":776,"coverHeight":450,"_content":"\n把手上的好几个项目的pom整理了一遍 规范了一下model 整理出了一些插件 方便新手们入门maven\n<!--more-->\n\n# 好用常用人人都要会的最基本的Maven插件收集\n大部分的插件其实都可以从[MAVEN官方的可用插件列表]( https://maven.apache.org/plugins/index.html)中直接找到\n在这里取了比较常用并且实用的几个插件做一点说明\n大多数使用场景无非是：\n- 要自定义打包的名称\n- 要将打包后的jar包自动复制到某处\n- 要将外置lib目录和maven依赖一起打进去\n- 要根据环境复制对应的配置文件\n\n这里选出的插件足以应对大部分情况了 \n\n\n## Maven依赖管理插件[maven-dependency-plugin](https://maven.apache.org/plugins/maven-dependency-plugin)\n\n主要用于管理依赖，比如引入某个特殊的jar包，或者从某个jar包中提取文件\n`tree`命令和`display-ancestors`命令在搭建工程时是比较好用的，可以很方便的找出重复依赖项，保证依赖版本一致\n\n### 常用功能\n- list 列出的依赖关系\n- tree 以树型结构列出的依赖关系\n- copy-dependencies 拷贝某个依赖项\n- unpack-dependencies 解包某个依赖项\n- display-ancestors 显示所有父依赖\n\n\n\n## Maven构建小助手 [build-helper-maven-plugin](https://www.mojohaus.org/build-helper-maven-plugin/)\n\n主要用于为POM生成各种属性,比如打包时间、IP地址之类的，功能比较多就不上代码了。\n\n###  常用功能\n- add-source 将更多`source`目录添加到POM\n- add-test-source 将更多`test source`目录添加到POM\n- add-resource 将更多`resource directories`目录添加到POM\n- add-test-resource 将更多`test resource directories`目录添加到POM\n- attach-artifact Attach additional artifacts to be installed and deployed.  不知道???干啥的\n- maven-version 获取Maven核心版本\n- regex-property 使用正则生成某个属性\n- regex-properties使用正则生成属性\n- released-version Resolve the latest released version of this project.\n- parse-version Parse the version into different properties.\n- remove-project-artifact 用于在构建过程中删除某个作为依赖的项目以节省空间\n- reserve-network-port 保留一个未使用的端口号的随机列表\n- local-ip 获取当前主机IP\n- cpu-count 获取当前主机CPU核心数\n- timestamp-property 生成一个事件放入指定属性中 常用于在包名上附加打包时间\n- uptodate-property 检查某个属性根据检查结果设置其他属性\n- uptodate-properties 检查多个属性根据检查结果设置多个其他属性\n- rootlocation 重定义多模块构建的根目录\n\n## 复制并重命名插件 [Copy Rename Maven Plugin](https://coderplus.github.io/copy-rename-maven-plugin/)\n\n功能字如其名,就是用来复制和重命名的，可以用来复制打包好的jar包，也可以在打包过程中复制文件。\n  \n### 常用功能\n- copy 复制\n- rename 重命名\n- 没了\n\n### 一个小栗子\n```xml\n<plugin>\n    <groupid>com.coderplus.maven.plugins</groupid>\n    <artifactid>copy-rename-maven-plugin</artifactid>\n    <version>1.0</version>\n    <executions>\n        <execution>\n            <id>copy-file</id>\n            <phase>package</phase>\n            <goals>\n                <goal>copy</goal>\n            </goals>\n            <configuration>\n                <sourcefile>target/${project.build.finalName}.jar</sourcefile>\n                <destinationfile>/xingyi/${project.build.finalName}.jar</destinationfile>\n            </configuration>\n        </execution>\n    </executions>\n</plugin>\n```\n\n\n## Maven编译插件 [maven-compiler-plugin](https://maven.apache.org/plugins/maven-compiler-plugin/)\n\n主要用于设定编译环境和编译器的属性,是比较基础的插件\n\n```xml\n <plugin>\n    <groupid>org.apache.maven.plugins</groupid>\n    <artifactid>maven-compiler-plugin</artifactid>\n    <version>3.8.0</version>\n    <configuration>\n        <!-- 一般而言，target与source是保持一致的，但是，有时候为了让程序能在其他版本的jdk中运行(对于低版本目标jdk，源代码中不能使用低版本jdk中不支持的语法 )，会存在target不同于source的情况 -->\n        <!-- 源代码使用的JDK版本 -->\n        <source>1.8</source>\n        <!-- 需要生成的目标class文件的编译版本 -->\n        <target>1.8</target> \n        <!-- 字符集编码 -->\n        <encoding>UTF-8</encoding>\n        <verbose>true</verbose>\n        <showwarnings>true</showwarnings>\n        <!-- 要使compilerVersion标签生效，还需要将fork设为true，用于明确表示编译版本配置的可用 -->\n        <fork>true</fork>\n        <!-- 指定插件将使用的编译器的版本 -->\n        <compilerversion>1.5</compilerversion>\n        <!-- 编译器使用的初始内存 -->\n        <meminitial>128m</meminitial>\n        <!-- 编译器使用的最大内存 -->\n        <maxmem>512m</maxmem>\n        <!--使用指定的javac命令，例如：<executable>${JAVA_1_4_HOME}/bin/javac</executable> -->\n        <executable><!-- path-to-javac --></executable>\n        <!-- 跳过测试 -->\n        <skiptests>true</skiptests>\n        <!-- 这个选项用来传递编译器自身不包含但是却支持的参数选项-->\n        <compilerargument>-verbose -bootclasspath ${java.home}\\lib\\rt.jar</compilerargument>\n    </configuration>\n</plugin>\n```\n\n###  SpringBootMaven插件[spring-boot-maven-plugin](https://www.mojohaus.org/build-helper-maven-plugin/)\n\n\n####  configuration.layout=ZIP 的用处\n\n###### 资料\n- [How to really package and deploy a Spring Boot application](\"http://weyprecht.de/2018/05/02/how-to-really-package-and-deploy-a-spring-boot-application/\")\n\n###### 作用\n将该工程的布局改为ZIP布局，所有的lib将外置到jar包外，在打包时将com.example:demo下的所有依赖放入外置的lib目录\n\n```xml\n    <build>\n      <plugins>\n        <plugin>\n          <groupid>org.springframework.boot</groupid>\n          <artifactid>spring-boot-maven-plugin</artifactid>\n          <configuration>\n            <layout>ZIP</layout>\n          </configuration>\n          <includes>\n            <include>\n           \t\t<groupid>com.example</groupid>\n            \t<artifactid>demo</artifactid>\n            </include>\n          </includes>\n        </plugin>\n      </plugins>\n    </build>\n```\n","source":"_posts/好用常用人人都要会的最基本的Maven插件收集.md","raw":"---\ntitle: '好用常用人人都要会的最基本的Maven插件收集'\ndate: 2019-03-11 03:05:56\nupdated: 2020/2/20 15:41:36\ncomments: true\ncover: /2019/03/11/好用常用人人都要会的最基本的Maven插件收集/title.jpg\ncoverWidth: 776\ncoverHeight: 450\ncategories: \n    - [我永远爱学习]\ntags: \n    - java\n    - maven\n---\n\n把手上的好几个项目的pom整理了一遍 规范了一下model 整理出了一些插件 方便新手们入门maven\n<!--more-->\n\n# 好用常用人人都要会的最基本的Maven插件收集\n大部分的插件其实都可以从[MAVEN官方的可用插件列表]( https://maven.apache.org/plugins/index.html)中直接找到\n在这里取了比较常用并且实用的几个插件做一点说明\n大多数使用场景无非是：\n- 要自定义打包的名称\n- 要将打包后的jar包自动复制到某处\n- 要将外置lib目录和maven依赖一起打进去\n- 要根据环境复制对应的配置文件\n\n这里选出的插件足以应对大部分情况了 \n\n\n## Maven依赖管理插件[maven-dependency-plugin](https://maven.apache.org/plugins/maven-dependency-plugin)\n\n主要用于管理依赖，比如引入某个特殊的jar包，或者从某个jar包中提取文件\n`tree`命令和`display-ancestors`命令在搭建工程时是比较好用的，可以很方便的找出重复依赖项，保证依赖版本一致\n\n### 常用功能\n- list 列出的依赖关系\n- tree 以树型结构列出的依赖关系\n- copy-dependencies 拷贝某个依赖项\n- unpack-dependencies 解包某个依赖项\n- display-ancestors 显示所有父依赖\n\n\n\n## Maven构建小助手 [build-helper-maven-plugin](https://www.mojohaus.org/build-helper-maven-plugin/)\n\n主要用于为POM生成各种属性,比如打包时间、IP地址之类的，功能比较多就不上代码了。\n\n###  常用功能\n- add-source 将更多`source`目录添加到POM\n- add-test-source 将更多`test source`目录添加到POM\n- add-resource 将更多`resource directories`目录添加到POM\n- add-test-resource 将更多`test resource directories`目录添加到POM\n- attach-artifact Attach additional artifacts to be installed and deployed.  不知道???干啥的\n- maven-version 获取Maven核心版本\n- regex-property 使用正则生成某个属性\n- regex-properties使用正则生成属性\n- released-version Resolve the latest released version of this project.\n- parse-version Parse the version into different properties.\n- remove-project-artifact 用于在构建过程中删除某个作为依赖的项目以节省空间\n- reserve-network-port 保留一个未使用的端口号的随机列表\n- local-ip 获取当前主机IP\n- cpu-count 获取当前主机CPU核心数\n- timestamp-property 生成一个事件放入指定属性中 常用于在包名上附加打包时间\n- uptodate-property 检查某个属性根据检查结果设置其他属性\n- uptodate-properties 检查多个属性根据检查结果设置多个其他属性\n- rootlocation 重定义多模块构建的根目录\n\n## 复制并重命名插件 [Copy Rename Maven Plugin](https://coderplus.github.io/copy-rename-maven-plugin/)\n\n功能字如其名,就是用来复制和重命名的，可以用来复制打包好的jar包，也可以在打包过程中复制文件。\n  \n### 常用功能\n- copy 复制\n- rename 重命名\n- 没了\n\n### 一个小栗子\n```xml\n<plugin>\n    <groupid>com.coderplus.maven.plugins</groupid>\n    <artifactid>copy-rename-maven-plugin</artifactid>\n    <version>1.0</version>\n    <executions>\n        <execution>\n            <id>copy-file</id>\n            <phase>package</phase>\n            <goals>\n                <goal>copy</goal>\n            </goals>\n            <configuration>\n                <sourcefile>target/${project.build.finalName}.jar</sourcefile>\n                <destinationfile>/xingyi/${project.build.finalName}.jar</destinationfile>\n            </configuration>\n        </execution>\n    </executions>\n</plugin>\n```\n\n\n## Maven编译插件 [maven-compiler-plugin](https://maven.apache.org/plugins/maven-compiler-plugin/)\n\n主要用于设定编译环境和编译器的属性,是比较基础的插件\n\n```xml\n <plugin>\n    <groupid>org.apache.maven.plugins</groupid>\n    <artifactid>maven-compiler-plugin</artifactid>\n    <version>3.8.0</version>\n    <configuration>\n        <!-- 一般而言，target与source是保持一致的，但是，有时候为了让程序能在其他版本的jdk中运行(对于低版本目标jdk，源代码中不能使用低版本jdk中不支持的语法 )，会存在target不同于source的情况 -->\n        <!-- 源代码使用的JDK版本 -->\n        <source>1.8</source>\n        <!-- 需要生成的目标class文件的编译版本 -->\n        <target>1.8</target> \n        <!-- 字符集编码 -->\n        <encoding>UTF-8</encoding>\n        <verbose>true</verbose>\n        <showwarnings>true</showwarnings>\n        <!-- 要使compilerVersion标签生效，还需要将fork设为true，用于明确表示编译版本配置的可用 -->\n        <fork>true</fork>\n        <!-- 指定插件将使用的编译器的版本 -->\n        <compilerversion>1.5</compilerversion>\n        <!-- 编译器使用的初始内存 -->\n        <meminitial>128m</meminitial>\n        <!-- 编译器使用的最大内存 -->\n        <maxmem>512m</maxmem>\n        <!--使用指定的javac命令，例如：<executable>${JAVA_1_4_HOME}/bin/javac</executable> -->\n        <executable><!-- path-to-javac --></executable>\n        <!-- 跳过测试 -->\n        <skiptests>true</skiptests>\n        <!-- 这个选项用来传递编译器自身不包含但是却支持的参数选项-->\n        <compilerargument>-verbose -bootclasspath ${java.home}\\lib\\rt.jar</compilerargument>\n    </configuration>\n</plugin>\n```\n\n###  SpringBootMaven插件[spring-boot-maven-plugin](https://www.mojohaus.org/build-helper-maven-plugin/)\n\n\n####  configuration.layout=ZIP 的用处\n\n###### 资料\n- [How to really package and deploy a Spring Boot application](\"http://weyprecht.de/2018/05/02/how-to-really-package-and-deploy-a-spring-boot-application/\")\n\n###### 作用\n将该工程的布局改为ZIP布局，所有的lib将外置到jar包外，在打包时将com.example:demo下的所有依赖放入外置的lib目录\n\n```xml\n    <build>\n      <plugins>\n        <plugin>\n          <groupid>org.springframework.boot</groupid>\n          <artifactid>spring-boot-maven-plugin</artifactid>\n          <configuration>\n            <layout>ZIP</layout>\n          </configuration>\n          <includes>\n            <include>\n           \t\t<groupid>com.example</groupid>\n            \t<artifactid>demo</artifactid>\n            </include>\n          </includes>\n        </plugin>\n      </plugins>\n    </build>\n```\n","slug":"好用常用人人都要会的最基本的Maven插件收集","published":1,"layout":"post","photos":[],"link":"","_id":"cktp91zl600194cowa4fb9gat","content":"<p>把手上的好几个项目的pom整理了一遍 规范了一下model 整理出了一些插件 方便新手们入门maven</p>\n<a id=\"more\"></a>\n\n<h1 id=\"好用常用人人都要会的最基本的Maven插件收集\"><a href=\"#好用常用人人都要会的最基本的Maven插件收集\" class=\"headerlink\" title=\"好用常用人人都要会的最基本的Maven插件收集\"></a>好用常用人人都要会的最基本的Maven插件收集</h1><p>大部分的插件其实都可以从<a href=\"https://maven.apache.org/plugins/index.html\" target=\"_blank\" rel=\"noopener\">MAVEN官方的可用插件列表</a>中直接找到<br>在这里取了比较常用并且实用的几个插件做一点说明<br>大多数使用场景无非是：</p>\n<ul>\n<li>要自定义打包的名称</li>\n<li>要将打包后的jar包自动复制到某处</li>\n<li>要将外置lib目录和maven依赖一起打进去</li>\n<li>要根据环境复制对应的配置文件</li>\n</ul>\n<p>这里选出的插件足以应对大部分情况了 </p>\n<h2 id=\"Maven依赖管理插件maven-dependency-plugin\"><a href=\"#Maven依赖管理插件maven-dependency-plugin\" class=\"headerlink\" title=\"Maven依赖管理插件maven-dependency-plugin\"></a>Maven依赖管理插件<a href=\"https://maven.apache.org/plugins/maven-dependency-plugin\" target=\"_blank\" rel=\"noopener\">maven-dependency-plugin</a></h2><p>主要用于管理依赖，比如引入某个特殊的jar包，或者从某个jar包中提取文件<br><code>tree</code>命令和<code>display-ancestors</code>命令在搭建工程时是比较好用的，可以很方便的找出重复依赖项，保证依赖版本一致</p>\n<h3 id=\"常用功能\"><a href=\"#常用功能\" class=\"headerlink\" title=\"常用功能\"></a>常用功能</h3><ul>\n<li>list 列出的依赖关系</li>\n<li>tree 以树型结构列出的依赖关系</li>\n<li>copy-dependencies 拷贝某个依赖项</li>\n<li>unpack-dependencies 解包某个依赖项</li>\n<li>display-ancestors 显示所有父依赖</li>\n</ul>\n<h2 id=\"Maven构建小助手-build-helper-maven-plugin\"><a href=\"#Maven构建小助手-build-helper-maven-plugin\" class=\"headerlink\" title=\"Maven构建小助手 build-helper-maven-plugin\"></a>Maven构建小助手 <a href=\"https://www.mojohaus.org/build-helper-maven-plugin/\" target=\"_blank\" rel=\"noopener\">build-helper-maven-plugin</a></h2><p>主要用于为POM生成各种属性,比如打包时间、IP地址之类的，功能比较多就不上代码了。</p>\n<h3 id=\"常用功能-1\"><a href=\"#常用功能-1\" class=\"headerlink\" title=\"常用功能\"></a>常用功能</h3><ul>\n<li>add-source 将更多<code>source</code>目录添加到POM</li>\n<li>add-test-source 将更多<code>test source</code>目录添加到POM</li>\n<li>add-resource 将更多<code>resource directories</code>目录添加到POM</li>\n<li>add-test-resource 将更多<code>test resource directories</code>目录添加到POM</li>\n<li>attach-artifact Attach additional artifacts to be installed and deployed.  不知道???干啥的</li>\n<li>maven-version 获取Maven核心版本</li>\n<li>regex-property 使用正则生成某个属性</li>\n<li>regex-properties使用正则生成属性</li>\n<li>released-version Resolve the latest released version of this project.</li>\n<li>parse-version Parse the version into different properties.</li>\n<li>remove-project-artifact 用于在构建过程中删除某个作为依赖的项目以节省空间</li>\n<li>reserve-network-port 保留一个未使用的端口号的随机列表</li>\n<li>local-ip 获取当前主机IP</li>\n<li>cpu-count 获取当前主机CPU核心数</li>\n<li>timestamp-property 生成一个事件放入指定属性中 常用于在包名上附加打包时间</li>\n<li>uptodate-property 检查某个属性根据检查结果设置其他属性</li>\n<li>uptodate-properties 检查多个属性根据检查结果设置多个其他属性</li>\n<li>rootlocation 重定义多模块构建的根目录</li>\n</ul>\n<h2 id=\"复制并重命名插件-Copy-Rename-Maven-Plugin\"><a href=\"#复制并重命名插件-Copy-Rename-Maven-Plugin\" class=\"headerlink\" title=\"复制并重命名插件 Copy Rename Maven Plugin\"></a>复制并重命名插件 <a href=\"https://coderplus.github.io/copy-rename-maven-plugin/\" target=\"_blank\" rel=\"noopener\">Copy Rename Maven Plugin</a></h2><p>功能字如其名,就是用来复制和重命名的，可以用来复制打包好的jar包，也可以在打包过程中复制文件。</p>\n<h3 id=\"常用功能-2\"><a href=\"#常用功能-2\" class=\"headerlink\" title=\"常用功能\"></a>常用功能</h3><ul>\n<li>copy 复制</li>\n<li>rename 重命名</li>\n<li>没了</li>\n</ul>\n<h3 id=\"一个小栗子\"><a href=\"#一个小栗子\" class=\"headerlink\" title=\"一个小栗子\"></a>一个小栗子</h3><pre><code class=\"xml\">&lt;plugin&gt;\n    &lt;groupid&gt;com.coderplus.maven.plugins&lt;/groupid&gt;\n    &lt;artifactid&gt;copy-rename-maven-plugin&lt;/artifactid&gt;\n    &lt;version&gt;1.0&lt;/version&gt;\n    &lt;executions&gt;\n        &lt;execution&gt;\n            &lt;id&gt;copy-file&lt;/id&gt;\n            &lt;phase&gt;package&lt;/phase&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;copy&lt;/goal&gt;\n            &lt;/goals&gt;\n            &lt;configuration&gt;\n                &lt;sourcefile&gt;target/${project.build.finalName}.jar&lt;/sourcefile&gt;\n                &lt;destinationfile&gt;/xingyi/${project.build.finalName}.jar&lt;/destinationfile&gt;\n            &lt;/configuration&gt;\n        &lt;/execution&gt;\n    &lt;/executions&gt;\n&lt;/plugin&gt;</code></pre>\n<h2 id=\"Maven编译插件-maven-compiler-plugin\"><a href=\"#Maven编译插件-maven-compiler-plugin\" class=\"headerlink\" title=\"Maven编译插件 maven-compiler-plugin\"></a>Maven编译插件 <a href=\"https://maven.apache.org/plugins/maven-compiler-plugin/\" target=\"_blank\" rel=\"noopener\">maven-compiler-plugin</a></h2><p>主要用于设定编译环境和编译器的属性,是比较基础的插件</p>\n<pre><code class=\"xml\"> &lt;plugin&gt;\n    &lt;groupid&gt;org.apache.maven.plugins&lt;/groupid&gt;\n    &lt;artifactid&gt;maven-compiler-plugin&lt;/artifactid&gt;\n    &lt;version&gt;3.8.0&lt;/version&gt;\n    &lt;configuration&gt;\n        &lt;!-- 一般而言，target与source是保持一致的，但是，有时候为了让程序能在其他版本的jdk中运行(对于低版本目标jdk，源代码中不能使用低版本jdk中不支持的语法 )，会存在target不同于source的情况 --&gt;\n        &lt;!-- 源代码使用的JDK版本 --&gt;\n        &lt;source&gt;1.8&lt;/source&gt;\n        &lt;!-- 需要生成的目标class文件的编译版本 --&gt;\n        &lt;target&gt;1.8&lt;/target&gt; \n        &lt;!-- 字符集编码 --&gt;\n        &lt;encoding&gt;UTF-8&lt;/encoding&gt;\n        &lt;verbose&gt;true&lt;/verbose&gt;\n        &lt;showwarnings&gt;true&lt;/showwarnings&gt;\n        &lt;!-- 要使compilerVersion标签生效，还需要将fork设为true，用于明确表示编译版本配置的可用 --&gt;\n        &lt;fork&gt;true&lt;/fork&gt;\n        &lt;!-- 指定插件将使用的编译器的版本 --&gt;\n        &lt;compilerversion&gt;1.5&lt;/compilerversion&gt;\n        &lt;!-- 编译器使用的初始内存 --&gt;\n        &lt;meminitial&gt;128m&lt;/meminitial&gt;\n        &lt;!-- 编译器使用的最大内存 --&gt;\n        &lt;maxmem&gt;512m&lt;/maxmem&gt;\n        &lt;!--使用指定的javac命令，例如：&lt;executable&gt;${JAVA_1_4_HOME}/bin/javac&lt;/executable&gt; --&gt;\n        &lt;executable&gt;&lt;!-- path-to-javac --&gt;&lt;/executable&gt;\n        &lt;!-- 跳过测试 --&gt;\n        &lt;skiptests&gt;true&lt;/skiptests&gt;\n        &lt;!-- 这个选项用来传递编译器自身不包含但是却支持的参数选项--&gt;\n        &lt;compilerargument&gt;-verbose -bootclasspath ${java.home}\\lib\\rt.jar&lt;/compilerargument&gt;\n    &lt;/configuration&gt;\n&lt;/plugin&gt;</code></pre>\n<h3 id=\"SpringBootMaven插件spring-boot-maven-plugin\"><a href=\"#SpringBootMaven插件spring-boot-maven-plugin\" class=\"headerlink\" title=\"SpringBootMaven插件spring-boot-maven-plugin\"></a>SpringBootMaven插件<a href=\"https://www.mojohaus.org/build-helper-maven-plugin/\" target=\"_blank\" rel=\"noopener\">spring-boot-maven-plugin</a></h3><h4 id=\"configuration-layout-ZIP-的用处\"><a href=\"#configuration-layout-ZIP-的用处\" class=\"headerlink\" title=\"configuration.layout=ZIP 的用处\"></a>configuration.layout=ZIP 的用处</h4><h6 id=\"资料\"><a href=\"#资料\" class=\"headerlink\" title=\"资料\"></a>资料</h6><ul>\n<li><a href=\"\"http://weyprecht.de/2018/05/02/how-to-really-package-and-deploy-a-spring-boot-application/\"\">How to really package and deploy a Spring Boot application</a></li>\n</ul>\n<h6 id=\"作用\"><a href=\"#作用\" class=\"headerlink\" title=\"作用\"></a>作用</h6><p>将该工程的布局改为ZIP布局，所有的lib将外置到jar包外，在打包时将com.example:demo下的所有依赖放入外置的lib目录</p>\n<pre><code class=\"xml\">    &lt;build&gt;\n      &lt;plugins&gt;\n        &lt;plugin&gt;\n          &lt;groupid&gt;org.springframework.boot&lt;/groupid&gt;\n          &lt;artifactid&gt;spring-boot-maven-plugin&lt;/artifactid&gt;\n          &lt;configuration&gt;\n            &lt;layout&gt;ZIP&lt;/layout&gt;\n          &lt;/configuration&gt;\n          &lt;includes&gt;\n            &lt;include&gt;\n                   &lt;groupid&gt;com.example&lt;/groupid&gt;\n                &lt;artifactid&gt;demo&lt;/artifactid&gt;\n            &lt;/include&gt;\n          &lt;/includes&gt;\n        &lt;/plugin&gt;\n      &lt;/plugins&gt;\n    &lt;/build&gt;</code></pre>\n","site":{"data":{}},"excerpt":"<p>把手上的好几个项目的pom整理了一遍 规范了一下model 整理出了一些插件 方便新手们入门maven</p>","more":"<h1 id=\"好用常用人人都要会的最基本的Maven插件收集\"><a href=\"#好用常用人人都要会的最基本的Maven插件收集\" class=\"headerlink\" title=\"好用常用人人都要会的最基本的Maven插件收集\"></a>好用常用人人都要会的最基本的Maven插件收集</h1><p>大部分的插件其实都可以从<a href=\"https://maven.apache.org/plugins/index.html\" target=\"_blank\" rel=\"noopener\">MAVEN官方的可用插件列表</a>中直接找到<br>在这里取了比较常用并且实用的几个插件做一点说明<br>大多数使用场景无非是：</p>\n<ul>\n<li>要自定义打包的名称</li>\n<li>要将打包后的jar包自动复制到某处</li>\n<li>要将外置lib目录和maven依赖一起打进去</li>\n<li>要根据环境复制对应的配置文件</li>\n</ul>\n<p>这里选出的插件足以应对大部分情况了 </p>\n<h2 id=\"Maven依赖管理插件maven-dependency-plugin\"><a href=\"#Maven依赖管理插件maven-dependency-plugin\" class=\"headerlink\" title=\"Maven依赖管理插件maven-dependency-plugin\"></a>Maven依赖管理插件<a href=\"https://maven.apache.org/plugins/maven-dependency-plugin\" target=\"_blank\" rel=\"noopener\">maven-dependency-plugin</a></h2><p>主要用于管理依赖，比如引入某个特殊的jar包，或者从某个jar包中提取文件<br><code>tree</code>命令和<code>display-ancestors</code>命令在搭建工程时是比较好用的，可以很方便的找出重复依赖项，保证依赖版本一致</p>\n<h3 id=\"常用功能\"><a href=\"#常用功能\" class=\"headerlink\" title=\"常用功能\"></a>常用功能</h3><ul>\n<li>list 列出的依赖关系</li>\n<li>tree 以树型结构列出的依赖关系</li>\n<li>copy-dependencies 拷贝某个依赖项</li>\n<li>unpack-dependencies 解包某个依赖项</li>\n<li>display-ancestors 显示所有父依赖</li>\n</ul>\n<h2 id=\"Maven构建小助手-build-helper-maven-plugin\"><a href=\"#Maven构建小助手-build-helper-maven-plugin\" class=\"headerlink\" title=\"Maven构建小助手 build-helper-maven-plugin\"></a>Maven构建小助手 <a href=\"https://www.mojohaus.org/build-helper-maven-plugin/\" target=\"_blank\" rel=\"noopener\">build-helper-maven-plugin</a></h2><p>主要用于为POM生成各种属性,比如打包时间、IP地址之类的，功能比较多就不上代码了。</p>\n<h3 id=\"常用功能-1\"><a href=\"#常用功能-1\" class=\"headerlink\" title=\"常用功能\"></a>常用功能</h3><ul>\n<li>add-source 将更多<code>source</code>目录添加到POM</li>\n<li>add-test-source 将更多<code>test source</code>目录添加到POM</li>\n<li>add-resource 将更多<code>resource directories</code>目录添加到POM</li>\n<li>add-test-resource 将更多<code>test resource directories</code>目录添加到POM</li>\n<li>attach-artifact Attach additional artifacts to be installed and deployed.  不知道???干啥的</li>\n<li>maven-version 获取Maven核心版本</li>\n<li>regex-property 使用正则生成某个属性</li>\n<li>regex-properties使用正则生成属性</li>\n<li>released-version Resolve the latest released version of this project.</li>\n<li>parse-version Parse the version into different properties.</li>\n<li>remove-project-artifact 用于在构建过程中删除某个作为依赖的项目以节省空间</li>\n<li>reserve-network-port 保留一个未使用的端口号的随机列表</li>\n<li>local-ip 获取当前主机IP</li>\n<li>cpu-count 获取当前主机CPU核心数</li>\n<li>timestamp-property 生成一个事件放入指定属性中 常用于在包名上附加打包时间</li>\n<li>uptodate-property 检查某个属性根据检查结果设置其他属性</li>\n<li>uptodate-properties 检查多个属性根据检查结果设置多个其他属性</li>\n<li>rootlocation 重定义多模块构建的根目录</li>\n</ul>\n<h2 id=\"复制并重命名插件-Copy-Rename-Maven-Plugin\"><a href=\"#复制并重命名插件-Copy-Rename-Maven-Plugin\" class=\"headerlink\" title=\"复制并重命名插件 Copy Rename Maven Plugin\"></a>复制并重命名插件 <a href=\"https://coderplus.github.io/copy-rename-maven-plugin/\" target=\"_blank\" rel=\"noopener\">Copy Rename Maven Plugin</a></h2><p>功能字如其名,就是用来复制和重命名的，可以用来复制打包好的jar包，也可以在打包过程中复制文件。</p>\n<h3 id=\"常用功能-2\"><a href=\"#常用功能-2\" class=\"headerlink\" title=\"常用功能\"></a>常用功能</h3><ul>\n<li>copy 复制</li>\n<li>rename 重命名</li>\n<li>没了</li>\n</ul>\n<h3 id=\"一个小栗子\"><a href=\"#一个小栗子\" class=\"headerlink\" title=\"一个小栗子\"></a>一个小栗子</h3><pre><code class=\"xml\">&lt;plugin&gt;\n    &lt;groupid&gt;com.coderplus.maven.plugins&lt;/groupid&gt;\n    &lt;artifactid&gt;copy-rename-maven-plugin&lt;/artifactid&gt;\n    &lt;version&gt;1.0&lt;/version&gt;\n    &lt;executions&gt;\n        &lt;execution&gt;\n            &lt;id&gt;copy-file&lt;/id&gt;\n            &lt;phase&gt;package&lt;/phase&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;copy&lt;/goal&gt;\n            &lt;/goals&gt;\n            &lt;configuration&gt;\n                &lt;sourcefile&gt;target/${project.build.finalName}.jar&lt;/sourcefile&gt;\n                &lt;destinationfile&gt;/xingyi/${project.build.finalName}.jar&lt;/destinationfile&gt;\n            &lt;/configuration&gt;\n        &lt;/execution&gt;\n    &lt;/executions&gt;\n&lt;/plugin&gt;</code></pre>\n<h2 id=\"Maven编译插件-maven-compiler-plugin\"><a href=\"#Maven编译插件-maven-compiler-plugin\" class=\"headerlink\" title=\"Maven编译插件 maven-compiler-plugin\"></a>Maven编译插件 <a href=\"https://maven.apache.org/plugins/maven-compiler-plugin/\" target=\"_blank\" rel=\"noopener\">maven-compiler-plugin</a></h2><p>主要用于设定编译环境和编译器的属性,是比较基础的插件</p>\n<pre><code class=\"xml\"> &lt;plugin&gt;\n    &lt;groupid&gt;org.apache.maven.plugins&lt;/groupid&gt;\n    &lt;artifactid&gt;maven-compiler-plugin&lt;/artifactid&gt;\n    &lt;version&gt;3.8.0&lt;/version&gt;\n    &lt;configuration&gt;\n        &lt;!-- 一般而言，target与source是保持一致的，但是，有时候为了让程序能在其他版本的jdk中运行(对于低版本目标jdk，源代码中不能使用低版本jdk中不支持的语法 )，会存在target不同于source的情况 --&gt;\n        &lt;!-- 源代码使用的JDK版本 --&gt;\n        &lt;source&gt;1.8&lt;/source&gt;\n        &lt;!-- 需要生成的目标class文件的编译版本 --&gt;\n        &lt;target&gt;1.8&lt;/target&gt; \n        &lt;!-- 字符集编码 --&gt;\n        &lt;encoding&gt;UTF-8&lt;/encoding&gt;\n        &lt;verbose&gt;true&lt;/verbose&gt;\n        &lt;showwarnings&gt;true&lt;/showwarnings&gt;\n        &lt;!-- 要使compilerVersion标签生效，还需要将fork设为true，用于明确表示编译版本配置的可用 --&gt;\n        &lt;fork&gt;true&lt;/fork&gt;\n        &lt;!-- 指定插件将使用的编译器的版本 --&gt;\n        &lt;compilerversion&gt;1.5&lt;/compilerversion&gt;\n        &lt;!-- 编译器使用的初始内存 --&gt;\n        &lt;meminitial&gt;128m&lt;/meminitial&gt;\n        &lt;!-- 编译器使用的最大内存 --&gt;\n        &lt;maxmem&gt;512m&lt;/maxmem&gt;\n        &lt;!--使用指定的javac命令，例如：&lt;executable&gt;${JAVA_1_4_HOME}/bin/javac&lt;/executable&gt; --&gt;\n        &lt;executable&gt;&lt;!-- path-to-javac --&gt;&lt;/executable&gt;\n        &lt;!-- 跳过测试 --&gt;\n        &lt;skiptests&gt;true&lt;/skiptests&gt;\n        &lt;!-- 这个选项用来传递编译器自身不包含但是却支持的参数选项--&gt;\n        &lt;compilerargument&gt;-verbose -bootclasspath ${java.home}\\lib\\rt.jar&lt;/compilerargument&gt;\n    &lt;/configuration&gt;\n&lt;/plugin&gt;</code></pre>\n<h3 id=\"SpringBootMaven插件spring-boot-maven-plugin\"><a href=\"#SpringBootMaven插件spring-boot-maven-plugin\" class=\"headerlink\" title=\"SpringBootMaven插件spring-boot-maven-plugin\"></a>SpringBootMaven插件<a href=\"https://www.mojohaus.org/build-helper-maven-plugin/\" target=\"_blank\" rel=\"noopener\">spring-boot-maven-plugin</a></h3><h4 id=\"configuration-layout-ZIP-的用处\"><a href=\"#configuration-layout-ZIP-的用处\" class=\"headerlink\" title=\"configuration.layout=ZIP 的用处\"></a>configuration.layout=ZIP 的用处</h4><h6 id=\"资料\"><a href=\"#资料\" class=\"headerlink\" title=\"资料\"></a>资料</h6><ul>\n<li><a href=\"\"http://weyprecht.de/2018/05/02/how-to-really-package-and-deploy-a-spring-boot-application/\"\">How to really package and deploy a Spring Boot application</a></li>\n</ul>\n<h6 id=\"作用\"><a href=\"#作用\" class=\"headerlink\" title=\"作用\"></a>作用</h6><p>将该工程的布局改为ZIP布局，所有的lib将外置到jar包外，在打包时将com.example:demo下的所有依赖放入外置的lib目录</p>\n<pre><code class=\"xml\">    &lt;build&gt;\n      &lt;plugins&gt;\n        &lt;plugin&gt;\n          &lt;groupid&gt;org.springframework.boot&lt;/groupid&gt;\n          &lt;artifactid&gt;spring-boot-maven-plugin&lt;/artifactid&gt;\n          &lt;configuration&gt;\n            &lt;layout&gt;ZIP&lt;/layout&gt;\n          &lt;/configuration&gt;\n          &lt;includes&gt;\n            &lt;include&gt;\n                   &lt;groupid&gt;com.example&lt;/groupid&gt;\n                &lt;artifactid&gt;demo&lt;/artifactid&gt;\n            &lt;/include&gt;\n          &lt;/includes&gt;\n        &lt;/plugin&gt;\n      &lt;/plugins&gt;\n    &lt;/build&gt;</code></pre>"},{"title":"计划任务的Spring实现与手动实现","date":"2019-06-04T02:23:06.000Z","updated":"2020-02-20T07:41:36.000Z","cover":"/2019/06/04/计划任务的Spring实现与手动实现/title.jpg","coverWidth":716,"coverHeight":540,"comments":1,"_content":"\n手写计划任务当然比不过简单又好用的SpringScheduled\n<!--more-->\n## 使用Spring Scheduled的计划任务 \n\n### 关键方法\n\n- 计算下一次匹配CRON表达式的时间\n- `new CronSequenceGenerator(\"1 1 0 1 * ?\").next(new Date());`\n- 该方法用于计算下一次运行的到现在时间的时间差\n- `org.springframework.scheduling.concurrent.ReschedulingRunnable#schedule();`\n    \n### 实现代码\n\n```java\n/**\n * <h2>ScheduleConfig</h2>\n * <p>定时任务配置</p>\n *\n * @author Daizc\n * @date 2019/12/10\n */\n@Component\n@EnableScheduling\npublic class ScheduleConfig {\n\n    // 每月第一天的0分0秒执行\n    public static final String CRON_EXPRESSION = \"0 0 0 1 * ?\";\n\n    @Scheduled(cron = CRON_EXPRESSION, zone = \"Asia/Shanghai\")\n    public void generateFormJob() {\n        System.out.println(new Date().toString() + \" &gt;&gt;计划任务执行....\");\n    }\n}\n```\n## 自己写的计划任务\n\n### 思路\n\n- 使用一个阻塞队列\n- 使用一个线程去消费队列\n- 使用一个线程在计算`现在到下次执行时间的时间差`并睡到下次执行时间将Runable放入队列中消费\n\n### 实现代码\n\n```java\n\n    /**\n     * 自己写的计划任务\n     */\n    private LinkedBlockingQueue<runnable> queue = new LinkedBlockingQueue&lt;&gt;();\n\n    private Runnable task = () -&gt; {\n        System.out.println(new Date().toString() + \" &gt;&gt;计划任务执行....\");\n    };\n\n    @SuppressWarnings({\"all\", \"AlibabaAvoidManuallyCreateThread\"})\n    public ScheduleConfig() {\n        Thread take = new Thread(() -&gt; {\n            try {\n                while (true) {\n                    Runnable runnable = runnable = queue.take();\n                    runnable.run();\n                }\n            } catch (InterruptedException ignored) {}\n        });\n        take.setDaemon(true);\n        take.setName(\"schedule-take\");\n\n        Thread put = new Thread(() -&gt; {\n            Runnable runnable = null;\n            try {\n                while (true) {\n                    // 计算下次执行时间\n                    Date next = new CronSequenceGenerator(CRON_EXPRESSION).next(new Date());\n                    Thread.sleep(next.getTime() - System.currentTimeMillis());\n                    queue.put(task);\n                }\n            } catch (InterruptedException ignored) {}\n        });\n        put.setDaemon(true);\n        put.setName(\"schedule-put\");\n\n        take.start();\n        put.start();\n    }\n```\n","source":"_posts/计划任务的Spring实现与手动实现.md","raw":"---\ntitle: '计划任务的Spring实现与手动实现'\ndate: 2019/06/04 10:23:06\nupdated: 2020/2/20 15:41:36\ncover: /2019/06/04/计划任务的Spring实现与手动实现/title.jpg\ncoverWidth: 716\ncoverHeight: 540\ncomments: true\ncategories: \n    - [我永远爱学习]\ntags: \n    - java\n    - spring\n---\n\n手写计划任务当然比不过简单又好用的SpringScheduled\n<!--more-->\n## 使用Spring Scheduled的计划任务 \n\n### 关键方法\n\n- 计算下一次匹配CRON表达式的时间\n- `new CronSequenceGenerator(\"1 1 0 1 * ?\").next(new Date());`\n- 该方法用于计算下一次运行的到现在时间的时间差\n- `org.springframework.scheduling.concurrent.ReschedulingRunnable#schedule();`\n    \n### 实现代码\n\n```java\n/**\n * <h2>ScheduleConfig</h2>\n * <p>定时任务配置</p>\n *\n * @author Daizc\n * @date 2019/12/10\n */\n@Component\n@EnableScheduling\npublic class ScheduleConfig {\n\n    // 每月第一天的0分0秒执行\n    public static final String CRON_EXPRESSION = \"0 0 0 1 * ?\";\n\n    @Scheduled(cron = CRON_EXPRESSION, zone = \"Asia/Shanghai\")\n    public void generateFormJob() {\n        System.out.println(new Date().toString() + \" &gt;&gt;计划任务执行....\");\n    }\n}\n```\n## 自己写的计划任务\n\n### 思路\n\n- 使用一个阻塞队列\n- 使用一个线程去消费队列\n- 使用一个线程在计算`现在到下次执行时间的时间差`并睡到下次执行时间将Runable放入队列中消费\n\n### 实现代码\n\n```java\n\n    /**\n     * 自己写的计划任务\n     */\n    private LinkedBlockingQueue<runnable> queue = new LinkedBlockingQueue&lt;&gt;();\n\n    private Runnable task = () -&gt; {\n        System.out.println(new Date().toString() + \" &gt;&gt;计划任务执行....\");\n    };\n\n    @SuppressWarnings({\"all\", \"AlibabaAvoidManuallyCreateThread\"})\n    public ScheduleConfig() {\n        Thread take = new Thread(() -&gt; {\n            try {\n                while (true) {\n                    Runnable runnable = runnable = queue.take();\n                    runnable.run();\n                }\n            } catch (InterruptedException ignored) {}\n        });\n        take.setDaemon(true);\n        take.setName(\"schedule-take\");\n\n        Thread put = new Thread(() -&gt; {\n            Runnable runnable = null;\n            try {\n                while (true) {\n                    // 计算下次执行时间\n                    Date next = new CronSequenceGenerator(CRON_EXPRESSION).next(new Date());\n                    Thread.sleep(next.getTime() - System.currentTimeMillis());\n                    queue.put(task);\n                }\n            } catch (InterruptedException ignored) {}\n        });\n        put.setDaemon(true);\n        put.setName(\"schedule-put\");\n\n        take.start();\n        put.start();\n    }\n```\n","slug":"计划任务的Spring实现与手动实现","published":1,"layout":"post","photos":[],"link":"","_id":"cktp91zl8001c4cowbeym5yzz","content":"<p>手写计划任务当然比不过简单又好用的SpringScheduled</p>\n<a id=\"more\"></a>\n<h2 id=\"使用Spring-Scheduled的计划任务\"><a href=\"#使用Spring-Scheduled的计划任务\" class=\"headerlink\" title=\"使用Spring Scheduled的计划任务\"></a>使用Spring Scheduled的计划任务</h2><h3 id=\"关键方法\"><a href=\"#关键方法\" class=\"headerlink\" title=\"关键方法\"></a>关键方法</h3><ul>\n<li>计算下一次匹配CRON表达式的时间</li>\n<li><code>new CronSequenceGenerator(&quot;1 1 0 1 * ?&quot;).next(new Date());</code></li>\n<li>该方法用于计算下一次运行的到现在时间的时间差</li>\n<li><code>org.springframework.scheduling.concurrent.ReschedulingRunnable#schedule();</code></li>\n</ul>\n<h3 id=\"实现代码\"><a href=\"#实现代码\" class=\"headerlink\" title=\"实现代码\"></a>实现代码</h3><pre><code class=\"java\">/**\n * &lt;h2&gt;ScheduleConfig&lt;/h2&gt;\n * &lt;p&gt;定时任务配置&lt;/p&gt;\n *\n * @author Daizc\n * @date 2019/12/10\n */\n@Component\n@EnableScheduling\npublic class ScheduleConfig {\n\n    // 每月第一天的0分0秒执行\n    public static final String CRON_EXPRESSION = &quot;0 0 0 1 * ?&quot;;\n\n    @Scheduled(cron = CRON_EXPRESSION, zone = &quot;Asia/Shanghai&quot;)\n    public void generateFormJob() {\n        System.out.println(new Date().toString() + &quot; &amp;gt;&amp;gt;计划任务执行....&quot;);\n    }\n}</code></pre>\n<h2 id=\"自己写的计划任务\"><a href=\"#自己写的计划任务\" class=\"headerlink\" title=\"自己写的计划任务\"></a>自己写的计划任务</h2><h3 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h3><ul>\n<li>使用一个阻塞队列</li>\n<li>使用一个线程去消费队列</li>\n<li>使用一个线程在计算<code>现在到下次执行时间的时间差</code>并睡到下次执行时间将Runable放入队列中消费</li>\n</ul>\n<h3 id=\"实现代码-1\"><a href=\"#实现代码-1\" class=\"headerlink\" title=\"实现代码\"></a>实现代码</h3><pre><code class=\"java\">\n    /**\n     * 自己写的计划任务\n     */\n    private LinkedBlockingQueue&lt;runnable&gt; queue = new LinkedBlockingQueue&amp;lt;&amp;gt;();\n\n    private Runnable task = () -&amp;gt; {\n        System.out.println(new Date().toString() + &quot; &amp;gt;&amp;gt;计划任务执行....&quot;);\n    };\n\n    @SuppressWarnings({&quot;all&quot;, &quot;AlibabaAvoidManuallyCreateThread&quot;})\n    public ScheduleConfig() {\n        Thread take = new Thread(() -&amp;gt; {\n            try {\n                while (true) {\n                    Runnable runnable = runnable = queue.take();\n                    runnable.run();\n                }\n            } catch (InterruptedException ignored) {}\n        });\n        take.setDaemon(true);\n        take.setName(&quot;schedule-take&quot;);\n\n        Thread put = new Thread(() -&amp;gt; {\n            Runnable runnable = null;\n            try {\n                while (true) {\n                    // 计算下次执行时间\n                    Date next = new CronSequenceGenerator(CRON_EXPRESSION).next(new Date());\n                    Thread.sleep(next.getTime() - System.currentTimeMillis());\n                    queue.put(task);\n                }\n            } catch (InterruptedException ignored) {}\n        });\n        put.setDaemon(true);\n        put.setName(&quot;schedule-put&quot;);\n\n        take.start();\n        put.start();\n    }</code></pre>\n","site":{"data":{}},"excerpt":"<p>手写计划任务当然比不过简单又好用的SpringScheduled</p>","more":"<h2 id=\"使用Spring-Scheduled的计划任务\"><a href=\"#使用Spring-Scheduled的计划任务\" class=\"headerlink\" title=\"使用Spring Scheduled的计划任务\"></a>使用Spring Scheduled的计划任务</h2><h3 id=\"关键方法\"><a href=\"#关键方法\" class=\"headerlink\" title=\"关键方法\"></a>关键方法</h3><ul>\n<li>计算下一次匹配CRON表达式的时间</li>\n<li><code>new CronSequenceGenerator(&quot;1 1 0 1 * ?&quot;).next(new Date());</code></li>\n<li>该方法用于计算下一次运行的到现在时间的时间差</li>\n<li><code>org.springframework.scheduling.concurrent.ReschedulingRunnable#schedule();</code></li>\n</ul>\n<h3 id=\"实现代码\"><a href=\"#实现代码\" class=\"headerlink\" title=\"实现代码\"></a>实现代码</h3><pre><code class=\"java\">/**\n * &lt;h2&gt;ScheduleConfig&lt;/h2&gt;\n * &lt;p&gt;定时任务配置&lt;/p&gt;\n *\n * @author Daizc\n * @date 2019/12/10\n */\n@Component\n@EnableScheduling\npublic class ScheduleConfig {\n\n    // 每月第一天的0分0秒执行\n    public static final String CRON_EXPRESSION = &quot;0 0 0 1 * ?&quot;;\n\n    @Scheduled(cron = CRON_EXPRESSION, zone = &quot;Asia/Shanghai&quot;)\n    public void generateFormJob() {\n        System.out.println(new Date().toString() + &quot; &amp;gt;&amp;gt;计划任务执行....&quot;);\n    }\n}</code></pre>\n<h2 id=\"自己写的计划任务\"><a href=\"#自己写的计划任务\" class=\"headerlink\" title=\"自己写的计划任务\"></a>自己写的计划任务</h2><h3 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h3><ul>\n<li>使用一个阻塞队列</li>\n<li>使用一个线程去消费队列</li>\n<li>使用一个线程在计算<code>现在到下次执行时间的时间差</code>并睡到下次执行时间将Runable放入队列中消费</li>\n</ul>\n<h3 id=\"实现代码-1\"><a href=\"#实现代码-1\" class=\"headerlink\" title=\"实现代码\"></a>实现代码</h3><pre><code class=\"java\">\n    /**\n     * 自己写的计划任务\n     */\n    private LinkedBlockingQueue&lt;runnable&gt; queue = new LinkedBlockingQueue&amp;lt;&amp;gt;();\n\n    private Runnable task = () -&amp;gt; {\n        System.out.println(new Date().toString() + &quot; &amp;gt;&amp;gt;计划任务执行....&quot;);\n    };\n\n    @SuppressWarnings({&quot;all&quot;, &quot;AlibabaAvoidManuallyCreateThread&quot;})\n    public ScheduleConfig() {\n        Thread take = new Thread(() -&amp;gt; {\n            try {\n                while (true) {\n                    Runnable runnable = runnable = queue.take();\n                    runnable.run();\n                }\n            } catch (InterruptedException ignored) {}\n        });\n        take.setDaemon(true);\n        take.setName(&quot;schedule-take&quot;);\n\n        Thread put = new Thread(() -&amp;gt; {\n            Runnable runnable = null;\n            try {\n                while (true) {\n                    // 计算下次执行时间\n                    Date next = new CronSequenceGenerator(CRON_EXPRESSION).next(new Date());\n                    Thread.sleep(next.getTime() - System.currentTimeMillis());\n                    queue.put(task);\n                }\n            } catch (InterruptedException ignored) {}\n        });\n        put.setDaemon(true);\n        put.setName(&quot;schedule-put&quot;);\n\n        take.start();\n        put.start();\n    }</code></pre>"},{"title":"解决由https转发导致的SpringCloudGateway转发异常","date":"2021-07-26T03:06:50.000Z","comments":1,"_content":"\n错误日志如下:\n\n```log\n2021-07-27 15:51:31.302  WARN [TID:TID-1419928421240946688][PID:1][or-http-epoll-2] r.netty.http.client.HttpClientConnect    [299]: [id: 0xe9859259, L:/10.42.8.227:41228 ! R:10.42.4.120/10.42.4.120:8080] The connection observed an error\n\nio.netty.handler.codec.DecoderException: io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record: 485454502f312e31203430302042616420526571756573740d0a436f6e74656e742d4c656e6774683a20300d0a436f6e6e656374696f6e3a20636c6f73650d0a0d0a\n        at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:477)\n        at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:276)\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\n        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n        at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:795)\n        at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:480)\n        at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:378)\n        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n        at java.lang.Thread.run(Thread.java:748)\nCaused by: io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record: 485454502f312e31203430302042616420526571756573740d0a436f6e74656e742d4c656e6774683a20300d0a436f6e6e656374696f6e3a20636c6f73650d0a0d0a\n        at io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1213)\n        Suppressed: reactor.core.publisher.FluxOnAssembly$OnAssemblyException:\nError has been observed at the following site(s):\n        |_ checkpoint â‡¢ org.springframework.cloud.gateway.filter.WeightCalculatorWebFilter [DefaultWebFilterChain]\n        |_ checkpoint â‡¢ com.alibaba.csp.sentinel.adapter.spring.webflux.SentinelWebFluxFilter [DefaultWebFilterChain]\n        |_ checkpoint â‡¢ org.springframework.boot.actuate.metrics.web.reactive.server.MetricsWebFilter [DefaultWebFilterChain]\n        |_ checkpoint â‡¢ HTTP GET \"/某个service/v2/api-docs\" [ExceptionHandlingWebHandler]\nStack trace:\n                at io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1213)\n                at io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1280)\n                at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:507)\n                at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:446)\n                at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:276)\n                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\n                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\n                at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\n                at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\n                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\n                at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n                at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:795)\n                at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:480)\n                at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:378)\n                at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\n                at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n                at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n                at java.lang.Thread.run(Thread.java:748)\n```\n\n<!--more-->\n\n### 问题描述\n\n这是一个很奇怪的只在测试环境存在的异常。</br>\n生产环境一切正常，测试环境访问以http访问正常，以https访问出现出现500错误。\n\n#### 开发架构\n\n- spring-boot:2.3.12.RELEASE\n- spring-cloud:Hoxton.SR8\n- spring-cloud-alibaba:2.2.5.RELEASE\n\n#### 生产环境链路：\n\n```\n访问域名 =公网dns=> 云服务商slb =lb&https转http=> ingress-nginx =lb=> service-gateway =lb=> service\n```\n\n#### 测试环境链路：\n\n```\n访问域名 =内网dns=> ingress-nginx =lb&https转http=> service-gateway =lb=> service\n```\n\n## Debug思路\n\n1. 查看应用日志发现service并未收到该请求，请求在service-gateway已经失败了，判断是网关问题。\n2. 查看网关日志发现报错（见文章一开始处的日志）。\n    1. 请求在nettyClient处的SSLHandler报错，说明网关的filter流程已经走完\n    2. 最终异常是NotSslRecordException，直译为`非SSL记录异常`，不知道为啥会抛出这个异常\n3. 在网关中加日志走一波，打印这个请求的所有HttpHeader，对比问题请求与正常请求的特征\n    1. 查看问题请求的Header\n        ```\n        header:\n            Host: \"aaa-bbb-test.xxx.com\",\n            X-Scheme: \"https\"\n            X-Request-ID: \"37cd98713db6b101d813171e0be609a\",\n            X-Forwarded-For: \"aaa-bbb-test.xxx.com\",\n            X-Forwarded-Port: \"443\",\n            X-Forwarded-Proto: \"https\",\n            referer: \"https://aaa-bbb-test.xxx.com/doc.html\",\n            ....此处略过ContentType、Accept\n        ```\n    2. Header中有转发来源的部分头部，先尝试在Filter中除掉这些头部试试\n        ```java\n          public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n      \n              ServerHttpRequest serverHttpRequest = exchange.getRequest().mutate()\n                      .headers(h -> {\n                          h.remove(\"X-Forwarded-For\");\n                          h.remove(\"X-Forwarded-Port\");\n                          h.remove(\"X-Forwarded-Proto\");\n                      })\n                      .build();\n              return chain.filter(exchange.mutate().request(serverHttpRequest).build());\n          }\n        ```\n       然而并没有什么卵用，异常依旧。\n    3. 根据异常堆栈可知，是在发起请求时出现问题，尝试找到请求发起类\n        - 由于网关使用webflux导致通过日志查看的堆栈的信息不够全面，通过本地调试正常请求查看异步堆栈跟踪到请求发起类`NettyRoutingFilter`\n        - 110行处发现一个协议判断的代码\n            ```java\n                public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n                   URI requestUrl = exchange.getRequiredAttribute(GATEWAY_REQUEST_URL_ATTR);\n            \n                   String scheme = requestUrl.getScheme();\n                   if (isAlreadyRouted(exchange)\n                   || (!\"http\".equals(scheme) && !\"https\".equals(scheme))) {\n                   return chain.filter(exchange);\n                   }\n                   setAlreadyRouted(exchange);\n                   ...\n            ```     \n        - 这个`scheme`控制了网关向其他服务的转发协议，决定这个变量的是`requestUrl`\n        - `requestUrl`是从exchange取出来的，通过查看`GATEWAY_REQUEST_URL_ATTR`这个常量的引用，找到了`requestUrl`\n          的来源`ReactiveLoadBalancerClientFilter#filter[113]`\n        - 发现源码注释\n            ```\n                  // if the `lb:<scheme>` mechanism was used, use `<scheme>` as the default,\n                  // if the loadbalancer doesn't provide one.\n            ```\n        - 根据源码注释修改网关的配置\n            ```\n              修改前:\n              [\n                {\n                \"id\": \"service-a\",\n                \"name\": \"A服务\",\n                \"predicates\": [\"Path=/service-a/**\"],\n                \"filters\": [],\n                \"uri\": \"lb://service-a\"\n                }\n              ]\n              修改后:\n              [\n                {\n                \"id\": \"service-a\",\n                \"name\": \"A服务\",\n                \"predicates\": [\"Path=/service-a/**\"],\n                \"filters\": [],\n                \"uri\": \"lb:http://service-a\"\n                }\n              ]\n            ```\n    4. 服务恢复正常了\n\n\n## 找到根本原因\n    \n#### 整理出SpringCloudGateway的请求处理流程的关键类：\n\n 1. 由LoadBalancerUriTools计算scheme、host、port。其中scheme由`overrideScheme`和``\n    1. `org.springframework.cloud.gateway.filter.ReactiveLoadBalancerClientFilter#filter[108]`\n    2. `org.springframework.cloud.client.loadbalancer.LoadBalancerUriTools#doReconstructURI[100]`\n\n 2. 共享 GATEWAY_REQUEST_URL_ATTR 变量给其他的Filter\n    1. `org.springframework.cloud.gateway.filter.ReactiveLoadBalancerClientFilter#filter[113]`\n    2. `org.springframework.cloud.gateway.filter.NettyRoutingFilter#filter[108]`\n\n 3. 交由Netty发起请求\n    1. `org.springframework.cloud.gateway.filter.NettyRoutingFilter#filter[108]`\n\n#### 问题发生在第一步：由LoadBalancerUriTools计算scheme、host、port\n 1. 在ReactiveLoadBalancerClientFilter中，主要逻辑如下\n    ```java\n        return choose(exchange).doOnNext(response -> {\n    \n            if (!response.hasServer()) {\n                throw NotFoundException.create(properties.isUse404(),\n                        \"Unable to find instance for \" + url.getHost());\n            }\n    \n            URI uri = exchange.getRequest().getURI();\n    \n            // if the `lb:<scheme>` mechanism was used, use `<scheme>` as the default,\n            // if the loadbalancer doesn't provide one.\n            String overrideScheme = null;\n            if (schemePrefix != null) {\n                overrideScheme = url.getScheme();\n            }\n    \n            DelegatingServiceInstance serviceInstance = new DelegatingServiceInstance(\n                    response.getServer(), overrideScheme);\n    \n            URI requestUrl = reconstructURI(serviceInstance, uri);\n    \n            if (log.isTraceEnabled()) {\n                log.trace(\"LoadBalancerClientFilter url chosen: \" + requestUrl);\n            }\n            exchange.getAttributes().put(GATEWAY_REQUEST_URL_ATTR, requestUrl);\n        }).then(chain.filter(exchange));\n    ```\n 2. 此处的`overrideScheme`就是刚才配置中添加的`http:`,这是优先级最高的配置\n 3. 然后`response.getServer()`和`overrideScheme`被送入委派类DelegatingServiceInstance中，项目中ServiceInstance的实现类是NacosServiceInstance\n 4. 紧接着`reconstructURI(serviceInstance, uri);`被执行，重建后的URI的scheme、host、port都是从`ServiceInstance`中获取的\n 5. 由于NacosServiceInstance没实现getScheme()，因此进入接口的default方法返回null值\n    - `org.springframework.cloud.gateway.support.DelegatingServiceInstance#getScheme[76]`\n    - `org.springframework.cloud.client.ServiceInstance#getScheme[71]`\n 6. 由于路由配置和服务实例中都没有取到scheme最终选取了原始URI中的scheme\n    - `org.springframework.cloud.client.loadbalancer.LoadBalancerUriTools#computeScheme`\n 7. NettyRoutingFilter将Response原样送出，协议是https内容是http，因此导致在建立TLS链接时发生了异常\n    - `org.springframework.cloud.gateway.filter.NettyRoutingFilter#filter[147]`\n","source":"_posts/解决由https转发导致的SpringCloudGateway转发异常.md","raw":"---\ntitle: 解决由https转发导致的SpringCloudGateway转发异常\ndate: 2021-07-26 11:06:50\ncomments: true\ncategories:\n    - [我永远爱学习]\ntags:\n    - spring \n    - java \n    - debug\n---\n\n错误日志如下:\n\n```log\n2021-07-27 15:51:31.302  WARN [TID:TID-1419928421240946688][PID:1][or-http-epoll-2] r.netty.http.client.HttpClientConnect    [299]: [id: 0xe9859259, L:/10.42.8.227:41228 ! R:10.42.4.120/10.42.4.120:8080] The connection observed an error\n\nio.netty.handler.codec.DecoderException: io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record: 485454502f312e31203430302042616420526571756573740d0a436f6e74656e742d4c656e6774683a20300d0a436f6e6e656374696f6e3a20636c6f73650d0a0d0a\n        at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:477)\n        at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:276)\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\n        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n        at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:795)\n        at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:480)\n        at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:378)\n        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n        at java.lang.Thread.run(Thread.java:748)\nCaused by: io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record: 485454502f312e31203430302042616420526571756573740d0a436f6e74656e742d4c656e6774683a20300d0a436f6e6e656374696f6e3a20636c6f73650d0a0d0a\n        at io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1213)\n        Suppressed: reactor.core.publisher.FluxOnAssembly$OnAssemblyException:\nError has been observed at the following site(s):\n        |_ checkpoint â‡¢ org.springframework.cloud.gateway.filter.WeightCalculatorWebFilter [DefaultWebFilterChain]\n        |_ checkpoint â‡¢ com.alibaba.csp.sentinel.adapter.spring.webflux.SentinelWebFluxFilter [DefaultWebFilterChain]\n        |_ checkpoint â‡¢ org.springframework.boot.actuate.metrics.web.reactive.server.MetricsWebFilter [DefaultWebFilterChain]\n        |_ checkpoint â‡¢ HTTP GET \"/某个service/v2/api-docs\" [ExceptionHandlingWebHandler]\nStack trace:\n                at io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1213)\n                at io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1280)\n                at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:507)\n                at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:446)\n                at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:276)\n                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\n                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\n                at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\n                at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\n                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\n                at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n                at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:795)\n                at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:480)\n                at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:378)\n                at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\n                at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n                at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n                at java.lang.Thread.run(Thread.java:748)\n```\n\n<!--more-->\n\n### 问题描述\n\n这是一个很奇怪的只在测试环境存在的异常。</br>\n生产环境一切正常，测试环境访问以http访问正常，以https访问出现出现500错误。\n\n#### 开发架构\n\n- spring-boot:2.3.12.RELEASE\n- spring-cloud:Hoxton.SR8\n- spring-cloud-alibaba:2.2.5.RELEASE\n\n#### 生产环境链路：\n\n```\n访问域名 =公网dns=> 云服务商slb =lb&https转http=> ingress-nginx =lb=> service-gateway =lb=> service\n```\n\n#### 测试环境链路：\n\n```\n访问域名 =内网dns=> ingress-nginx =lb&https转http=> service-gateway =lb=> service\n```\n\n## Debug思路\n\n1. 查看应用日志发现service并未收到该请求，请求在service-gateway已经失败了，判断是网关问题。\n2. 查看网关日志发现报错（见文章一开始处的日志）。\n    1. 请求在nettyClient处的SSLHandler报错，说明网关的filter流程已经走完\n    2. 最终异常是NotSslRecordException，直译为`非SSL记录异常`，不知道为啥会抛出这个异常\n3. 在网关中加日志走一波，打印这个请求的所有HttpHeader，对比问题请求与正常请求的特征\n    1. 查看问题请求的Header\n        ```\n        header:\n            Host: \"aaa-bbb-test.xxx.com\",\n            X-Scheme: \"https\"\n            X-Request-ID: \"37cd98713db6b101d813171e0be609a\",\n            X-Forwarded-For: \"aaa-bbb-test.xxx.com\",\n            X-Forwarded-Port: \"443\",\n            X-Forwarded-Proto: \"https\",\n            referer: \"https://aaa-bbb-test.xxx.com/doc.html\",\n            ....此处略过ContentType、Accept\n        ```\n    2. Header中有转发来源的部分头部，先尝试在Filter中除掉这些头部试试\n        ```java\n          public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n      \n              ServerHttpRequest serverHttpRequest = exchange.getRequest().mutate()\n                      .headers(h -> {\n                          h.remove(\"X-Forwarded-For\");\n                          h.remove(\"X-Forwarded-Port\");\n                          h.remove(\"X-Forwarded-Proto\");\n                      })\n                      .build();\n              return chain.filter(exchange.mutate().request(serverHttpRequest).build());\n          }\n        ```\n       然而并没有什么卵用，异常依旧。\n    3. 根据异常堆栈可知，是在发起请求时出现问题，尝试找到请求发起类\n        - 由于网关使用webflux导致通过日志查看的堆栈的信息不够全面，通过本地调试正常请求查看异步堆栈跟踪到请求发起类`NettyRoutingFilter`\n        - 110行处发现一个协议判断的代码\n            ```java\n                public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n                   URI requestUrl = exchange.getRequiredAttribute(GATEWAY_REQUEST_URL_ATTR);\n            \n                   String scheme = requestUrl.getScheme();\n                   if (isAlreadyRouted(exchange)\n                   || (!\"http\".equals(scheme) && !\"https\".equals(scheme))) {\n                   return chain.filter(exchange);\n                   }\n                   setAlreadyRouted(exchange);\n                   ...\n            ```     \n        - 这个`scheme`控制了网关向其他服务的转发协议，决定这个变量的是`requestUrl`\n        - `requestUrl`是从exchange取出来的，通过查看`GATEWAY_REQUEST_URL_ATTR`这个常量的引用，找到了`requestUrl`\n          的来源`ReactiveLoadBalancerClientFilter#filter[113]`\n        - 发现源码注释\n            ```\n                  // if the `lb:<scheme>` mechanism was used, use `<scheme>` as the default,\n                  // if the loadbalancer doesn't provide one.\n            ```\n        - 根据源码注释修改网关的配置\n            ```\n              修改前:\n              [\n                {\n                \"id\": \"service-a\",\n                \"name\": \"A服务\",\n                \"predicates\": [\"Path=/service-a/**\"],\n                \"filters\": [],\n                \"uri\": \"lb://service-a\"\n                }\n              ]\n              修改后:\n              [\n                {\n                \"id\": \"service-a\",\n                \"name\": \"A服务\",\n                \"predicates\": [\"Path=/service-a/**\"],\n                \"filters\": [],\n                \"uri\": \"lb:http://service-a\"\n                }\n              ]\n            ```\n    4. 服务恢复正常了\n\n\n## 找到根本原因\n    \n#### 整理出SpringCloudGateway的请求处理流程的关键类：\n\n 1. 由LoadBalancerUriTools计算scheme、host、port。其中scheme由`overrideScheme`和``\n    1. `org.springframework.cloud.gateway.filter.ReactiveLoadBalancerClientFilter#filter[108]`\n    2. `org.springframework.cloud.client.loadbalancer.LoadBalancerUriTools#doReconstructURI[100]`\n\n 2. 共享 GATEWAY_REQUEST_URL_ATTR 变量给其他的Filter\n    1. `org.springframework.cloud.gateway.filter.ReactiveLoadBalancerClientFilter#filter[113]`\n    2. `org.springframework.cloud.gateway.filter.NettyRoutingFilter#filter[108]`\n\n 3. 交由Netty发起请求\n    1. `org.springframework.cloud.gateway.filter.NettyRoutingFilter#filter[108]`\n\n#### 问题发生在第一步：由LoadBalancerUriTools计算scheme、host、port\n 1. 在ReactiveLoadBalancerClientFilter中，主要逻辑如下\n    ```java\n        return choose(exchange).doOnNext(response -> {\n    \n            if (!response.hasServer()) {\n                throw NotFoundException.create(properties.isUse404(),\n                        \"Unable to find instance for \" + url.getHost());\n            }\n    \n            URI uri = exchange.getRequest().getURI();\n    \n            // if the `lb:<scheme>` mechanism was used, use `<scheme>` as the default,\n            // if the loadbalancer doesn't provide one.\n            String overrideScheme = null;\n            if (schemePrefix != null) {\n                overrideScheme = url.getScheme();\n            }\n    \n            DelegatingServiceInstance serviceInstance = new DelegatingServiceInstance(\n                    response.getServer(), overrideScheme);\n    \n            URI requestUrl = reconstructURI(serviceInstance, uri);\n    \n            if (log.isTraceEnabled()) {\n                log.trace(\"LoadBalancerClientFilter url chosen: \" + requestUrl);\n            }\n            exchange.getAttributes().put(GATEWAY_REQUEST_URL_ATTR, requestUrl);\n        }).then(chain.filter(exchange));\n    ```\n 2. 此处的`overrideScheme`就是刚才配置中添加的`http:`,这是优先级最高的配置\n 3. 然后`response.getServer()`和`overrideScheme`被送入委派类DelegatingServiceInstance中，项目中ServiceInstance的实现类是NacosServiceInstance\n 4. 紧接着`reconstructURI(serviceInstance, uri);`被执行，重建后的URI的scheme、host、port都是从`ServiceInstance`中获取的\n 5. 由于NacosServiceInstance没实现getScheme()，因此进入接口的default方法返回null值\n    - `org.springframework.cloud.gateway.support.DelegatingServiceInstance#getScheme[76]`\n    - `org.springframework.cloud.client.ServiceInstance#getScheme[71]`\n 6. 由于路由配置和服务实例中都没有取到scheme最终选取了原始URI中的scheme\n    - `org.springframework.cloud.client.loadbalancer.LoadBalancerUriTools#computeScheme`\n 7. NettyRoutingFilter将Response原样送出，协议是https内容是http，因此导致在建立TLS链接时发生了异常\n    - `org.springframework.cloud.gateway.filter.NettyRoutingFilter#filter[147]`\n","slug":"解决由https转发导致的SpringCloudGateway转发异常","published":1,"updated":"2021-07-28T07:53:54.924Z","layout":"post","photos":[],"link":"","_id":"cktp91zla001g4cow2mcv2rqv","content":"<p>错误日志如下:</p>\n<pre><code class=\"log\">2021-07-27 15:51:31.302  WARN [TID:TID-1419928421240946688][PID:1][or-http-epoll-2] r.netty.http.client.HttpClientConnect    [299]: [id: 0xe9859259, L:/10.42.8.227:41228 ! R:10.42.4.120/10.42.4.120:8080] The connection observed an error\n\nio.netty.handler.codec.DecoderException: io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record: 485454502f312e31203430302042616420526571756573740d0a436f6e74656e742d4c656e6774683a20300d0a436f6e6e656374696f6e3a20636c6f73650d0a0d0a\n        at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:477)\n        at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:276)\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\n        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n        at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:795)\n        at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:480)\n        at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:378)\n        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n        at java.lang.Thread.run(Thread.java:748)\nCaused by: io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record: 485454502f312e31203430302042616420526571756573740d0a436f6e74656e742d4c656e6774683a20300d0a436f6e6e656374696f6e3a20636c6f73650d0a0d0a\n        at io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1213)\n        Suppressed: reactor.core.publisher.FluxOnAssembly$OnAssemblyException:\nError has been observed at the following site(s):\n        |_ checkpoint â‡¢ org.springframework.cloud.gateway.filter.WeightCalculatorWebFilter [DefaultWebFilterChain]\n        |_ checkpoint â‡¢ com.alibaba.csp.sentinel.adapter.spring.webflux.SentinelWebFluxFilter [DefaultWebFilterChain]\n        |_ checkpoint â‡¢ org.springframework.boot.actuate.metrics.web.reactive.server.MetricsWebFilter [DefaultWebFilterChain]\n        |_ checkpoint â‡¢ HTTP GET &quot;/某个service/v2/api-docs&quot; [ExceptionHandlingWebHandler]\nStack trace:\n                at io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1213)\n                at io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1280)\n                at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:507)\n                at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:446)\n                at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:276)\n                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\n                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\n                at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\n                at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\n                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\n                at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n                at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:795)\n                at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:480)\n                at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:378)\n                at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\n                at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n                at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n                at java.lang.Thread.run(Thread.java:748)</code></pre>\n<a id=\"more\"></a>\n\n<h3 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述\"></a>问题描述</h3><p>这是一个很奇怪的只在测试环境存在的异常。</br><br>生产环境一切正常，测试环境访问以http访问正常，以https访问出现出现500错误。</p>\n<h4 id=\"开发架构\"><a href=\"#开发架构\" class=\"headerlink\" title=\"开发架构\"></a>开发架构</h4><ul>\n<li>spring-boot:2.3.12.RELEASE</li>\n<li>spring-cloud:Hoxton.SR8</li>\n<li>spring-cloud-alibaba:2.2.5.RELEASE</li>\n</ul>\n<h4 id=\"生产环境链路：\"><a href=\"#生产环境链路：\" class=\"headerlink\" title=\"生产环境链路：\"></a>生产环境链路：</h4><pre><code>访问域名 =公网dns=&gt; 云服务商slb =lb&amp;https转http=&gt; ingress-nginx =lb=&gt; service-gateway =lb=&gt; service</code></pre><h4 id=\"测试环境链路：\"><a href=\"#测试环境链路：\" class=\"headerlink\" title=\"测试环境链路：\"></a>测试环境链路：</h4><pre><code>访问域名 =内网dns=&gt; ingress-nginx =lb&amp;https转http=&gt; service-gateway =lb=&gt; service</code></pre><h2 id=\"Debug思路\"><a href=\"#Debug思路\" class=\"headerlink\" title=\"Debug思路\"></a>Debug思路</h2><ol>\n<li><p>查看应用日志发现service并未收到该请求，请求在service-gateway已经失败了，判断是网关问题。</p>\n</li>\n<li><p>查看网关日志发现报错（见文章一开始处的日志）。</p>\n<ol>\n<li>请求在nettyClient处的SSLHandler报错，说明网关的filter流程已经走完</li>\n<li>最终异常是NotSslRecordException，直译为<code>非SSL记录异常</code>，不知道为啥会抛出这个异常</li>\n</ol>\n</li>\n<li><p>在网关中加日志走一波，打印这个请求的所有HttpHeader，对比问题请求与正常请求的特征</p>\n<ol>\n<li><p>查看问题请求的Header</p>\n<pre><code> header:\n     Host: &quot;aaa-bbb-test.xxx.com&quot;,\n     X-Scheme: &quot;https&quot;\n     X-Request-ID: &quot;37cd98713db6b101d813171e0be609a&quot;,\n     X-Forwarded-For: &quot;aaa-bbb-test.xxx.com&quot;,\n     X-Forwarded-Port: &quot;443&quot;,\n     X-Forwarded-Proto: &quot;https&quot;,\n     referer: &quot;https://aaa-bbb-test.xxx.com/doc.html&quot;,\n     ....此处略过ContentType、Accept</code></pre></li>\n<li><p>Header中有转发来源的部分头部，先尝试在Filter中除掉这些头部试试</p>\n<pre><code class=\"java\">   public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n\n       ServerHttpRequest serverHttpRequest = exchange.getRequest().mutate()\n               .headers(h -&gt; {\n                   h.remove(&quot;X-Forwarded-For&quot;);\n                   h.remove(&quot;X-Forwarded-Port&quot;);\n                   h.remove(&quot;X-Forwarded-Proto&quot;);\n               })\n               .build();\n       return chain.filter(exchange.mutate().request(serverHttpRequest).build());\n   }</code></pre>\n<p>然而并没有什么卵用，异常依旧。</p>\n</li>\n<li><p>根据异常堆栈可知，是在发起请求时出现问题，尝试找到请求发起类</p>\n<ul>\n<li><p>由于网关使用webflux导致通过日志查看的堆栈的信息不够全面，通过本地调试正常请求查看异步堆栈跟踪到请求发起类<code>NettyRoutingFilter</code></p>\n</li>\n<li><p>110行处发现一个协议判断的代码</p>\n<pre><code class=\"java\">      public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n         URI requestUrl = exchange.getRequiredAttribute(GATEWAY_REQUEST_URL_ATTR);\n\n         String scheme = requestUrl.getScheme();\n         if (isAlreadyRouted(exchange)\n         || (!&quot;http&quot;.equals(scheme) &amp;&amp; !&quot;https&quot;.equals(scheme))) {\n         return chain.filter(exchange);\n         }\n         setAlreadyRouted(exchange);\n         ...</code></pre>\n</li>\n<li><p>这个<code>scheme</code>控制了网关向其他服务的转发协议，决定这个变量的是<code>requestUrl</code></p>\n</li>\n<li><p><code>requestUrl</code>是从exchange取出来的，通过查看<code>GATEWAY_REQUEST_URL_ATTR</code>这个常量的引用，找到了<code>requestUrl</code><br>的来源<code>ReactiveLoadBalancerClientFilter#filter[113]</code></p>\n</li>\n<li><p>发现源码注释</p>\n<pre><code>        // if the `lb:&lt;scheme&gt;` mechanism was used, use `&lt;scheme&gt;` as the default,\n        // if the loadbalancer doesn&#39;t provide one.</code></pre></li>\n<li><p>根据源码注释修改网关的配置</p>\n<pre><code>    修改前:\n    [\n      {\n      &quot;id&quot;: &quot;service-a&quot;,\n      &quot;name&quot;: &quot;A服务&quot;,\n      &quot;predicates&quot;: [&quot;Path=/service-a/**&quot;],\n      &quot;filters&quot;: [],\n      &quot;uri&quot;: &quot;lb://service-a&quot;\n      }\n    ]\n    修改后:\n    [\n      {\n      &quot;id&quot;: &quot;service-a&quot;,\n      &quot;name&quot;: &quot;A服务&quot;,\n      &quot;predicates&quot;: [&quot;Path=/service-a/**&quot;],\n      &quot;filters&quot;: [],\n      &quot;uri&quot;: &quot;lb:http://service-a&quot;\n      }\n    ]</code></pre></li>\n</ul>\n</li>\n<li><p>服务恢复正常了</p>\n</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"找到根本原因\"><a href=\"#找到根本原因\" class=\"headerlink\" title=\"找到根本原因\"></a>找到根本原因</h2><h4 id=\"整理出SpringCloudGateway的请求处理流程的关键类：\"><a href=\"#整理出SpringCloudGateway的请求处理流程的关键类：\" class=\"headerlink\" title=\"整理出SpringCloudGateway的请求处理流程的关键类：\"></a>整理出SpringCloudGateway的请求处理流程的关键类：</h4><ol>\n<li><p>由LoadBalancerUriTools计算scheme、host、port。其中scheme由<code>overrideScheme</code>和``</p>\n<ol>\n<li><code>org.springframework.cloud.gateway.filter.ReactiveLoadBalancerClientFilter#filter[108]</code></li>\n<li><code>org.springframework.cloud.client.loadbalancer.LoadBalancerUriTools#doReconstructURI[100]</code></li>\n</ol>\n</li>\n<li><p>共享 GATEWAY_REQUEST_URL_ATTR 变量给其他的Filter</p>\n<ol>\n<li><code>org.springframework.cloud.gateway.filter.ReactiveLoadBalancerClientFilter#filter[113]</code></li>\n<li><code>org.springframework.cloud.gateway.filter.NettyRoutingFilter#filter[108]</code></li>\n</ol>\n</li>\n<li><p>交由Netty发起请求</p>\n<ol>\n<li><code>org.springframework.cloud.gateway.filter.NettyRoutingFilter#filter[108]</code></li>\n</ol>\n</li>\n</ol>\n<h4 id=\"问题发生在第一步：由LoadBalancerUriTools计算scheme、host、port\"><a href=\"#问题发生在第一步：由LoadBalancerUriTools计算scheme、host、port\" class=\"headerlink\" title=\"问题发生在第一步：由LoadBalancerUriTools计算scheme、host、port\"></a>问题发生在第一步：由LoadBalancerUriTools计算scheme、host、port</h4><ol>\n<li><p>在ReactiveLoadBalancerClientFilter中，主要逻辑如下</p>\n<pre><code class=\"java\">    return choose(exchange).doOnNext(response -&gt; {\n\n        if (!response.hasServer()) {\n            throw NotFoundException.create(properties.isUse404(),\n                    &quot;Unable to find instance for &quot; + url.getHost());\n        }\n\n        URI uri = exchange.getRequest().getURI();\n\n        // if the `lb:&lt;scheme&gt;` mechanism was used, use `&lt;scheme&gt;` as the default,\n        // if the loadbalancer doesn&#39;t provide one.\n        String overrideScheme = null;\n        if (schemePrefix != null) {\n            overrideScheme = url.getScheme();\n        }\n\n        DelegatingServiceInstance serviceInstance = new DelegatingServiceInstance(\n                response.getServer(), overrideScheme);\n\n        URI requestUrl = reconstructURI(serviceInstance, uri);\n\n        if (log.isTraceEnabled()) {\n            log.trace(&quot;LoadBalancerClientFilter url chosen: &quot; + requestUrl);\n        }\n        exchange.getAttributes().put(GATEWAY_REQUEST_URL_ATTR, requestUrl);\n    }).then(chain.filter(exchange));</code></pre>\n</li>\n<li><p>此处的<code>overrideScheme</code>就是刚才配置中添加的<code>http:</code>,这是优先级最高的配置</p>\n</li>\n<li><p>然后<code>response.getServer()</code>和<code>overrideScheme</code>被送入委派类DelegatingServiceInstance中，项目中ServiceInstance的实现类是NacosServiceInstance</p>\n</li>\n<li><p>紧接着<code>reconstructURI(serviceInstance, uri);</code>被执行，重建后的URI的scheme、host、port都是从<code>ServiceInstance</code>中获取的</p>\n</li>\n<li><p>由于NacosServiceInstance没实现getScheme()，因此进入接口的default方法返回null值</p>\n<ul>\n<li><code>org.springframework.cloud.gateway.support.DelegatingServiceInstance#getScheme[76]</code></li>\n<li><code>org.springframework.cloud.client.ServiceInstance#getScheme[71]</code></li>\n</ul>\n</li>\n<li><p>由于路由配置和服务实例中都没有取到scheme最终选取了原始URI中的scheme</p>\n<ul>\n<li><code>org.springframework.cloud.client.loadbalancer.LoadBalancerUriTools#computeScheme</code></li>\n</ul>\n</li>\n<li><p>NettyRoutingFilter将Response原样送出，协议是https内容是http，因此导致在建立TLS链接时发生了异常</p>\n<ul>\n<li><code>org.springframework.cloud.gateway.filter.NettyRoutingFilter#filter[147]</code></li>\n</ul>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>错误日志如下:</p>\n<pre><code class=\"log\">2021-07-27 15:51:31.302  WARN [TID:TID-1419928421240946688][PID:1][or-http-epoll-2] r.netty.http.client.HttpClientConnect    [299]: [id: 0xe9859259, L:/10.42.8.227:41228 ! R:10.42.4.120/10.42.4.120:8080] The connection observed an error\n\nio.netty.handler.codec.DecoderException: io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record: 485454502f312e31203430302042616420526571756573740d0a436f6e74656e742d4c656e6774683a20300d0a436f6e6e656374696f6e3a20636c6f73650d0a0d0a\n        at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:477)\n        at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:276)\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\n        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n        at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:795)\n        at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:480)\n        at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:378)\n        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n        at java.lang.Thread.run(Thread.java:748)\nCaused by: io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record: 485454502f312e31203430302042616420526571756573740d0a436f6e74656e742d4c656e6774683a20300d0a436f6e6e656374696f6e3a20636c6f73650d0a0d0a\n        at io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1213)\n        Suppressed: reactor.core.publisher.FluxOnAssembly$OnAssemblyException:\nError has been observed at the following site(s):\n        |_ checkpoint â‡¢ org.springframework.cloud.gateway.filter.WeightCalculatorWebFilter [DefaultWebFilterChain]\n        |_ checkpoint â‡¢ com.alibaba.csp.sentinel.adapter.spring.webflux.SentinelWebFluxFilter [DefaultWebFilterChain]\n        |_ checkpoint â‡¢ org.springframework.boot.actuate.metrics.web.reactive.server.MetricsWebFilter [DefaultWebFilterChain]\n        |_ checkpoint â‡¢ HTTP GET &quot;/某个service/v2/api-docs&quot; [ExceptionHandlingWebHandler]\nStack trace:\n                at io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1213)\n                at io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1280)\n                at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:507)\n                at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:446)\n                at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:276)\n                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\n                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\n                at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\n                at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\n                at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\n                at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n                at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:795)\n                at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:480)\n                at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:378)\n                at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\n                at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n                at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n                at java.lang.Thread.run(Thread.java:748)</code></pre>","more":"<h3 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述\"></a>问题描述</h3><p>这是一个很奇怪的只在测试环境存在的异常。</br><br>生产环境一切正常，测试环境访问以http访问正常，以https访问出现出现500错误。</p>\n<h4 id=\"开发架构\"><a href=\"#开发架构\" class=\"headerlink\" title=\"开发架构\"></a>开发架构</h4><ul>\n<li>spring-boot:2.3.12.RELEASE</li>\n<li>spring-cloud:Hoxton.SR8</li>\n<li>spring-cloud-alibaba:2.2.5.RELEASE</li>\n</ul>\n<h4 id=\"生产环境链路：\"><a href=\"#生产环境链路：\" class=\"headerlink\" title=\"生产环境链路：\"></a>生产环境链路：</h4><pre><code>访问域名 =公网dns=&gt; 云服务商slb =lb&amp;https转http=&gt; ingress-nginx =lb=&gt; service-gateway =lb=&gt; service</code></pre><h4 id=\"测试环境链路：\"><a href=\"#测试环境链路：\" class=\"headerlink\" title=\"测试环境链路：\"></a>测试环境链路：</h4><pre><code>访问域名 =内网dns=&gt; ingress-nginx =lb&amp;https转http=&gt; service-gateway =lb=&gt; service</code></pre><h2 id=\"Debug思路\"><a href=\"#Debug思路\" class=\"headerlink\" title=\"Debug思路\"></a>Debug思路</h2><ol>\n<li><p>查看应用日志发现service并未收到该请求，请求在service-gateway已经失败了，判断是网关问题。</p>\n</li>\n<li><p>查看网关日志发现报错（见文章一开始处的日志）。</p>\n<ol>\n<li>请求在nettyClient处的SSLHandler报错，说明网关的filter流程已经走完</li>\n<li>最终异常是NotSslRecordException，直译为<code>非SSL记录异常</code>，不知道为啥会抛出这个异常</li>\n</ol>\n</li>\n<li><p>在网关中加日志走一波，打印这个请求的所有HttpHeader，对比问题请求与正常请求的特征</p>\n<ol>\n<li><p>查看问题请求的Header</p>\n<pre><code> header:\n     Host: &quot;aaa-bbb-test.xxx.com&quot;,\n     X-Scheme: &quot;https&quot;\n     X-Request-ID: &quot;37cd98713db6b101d813171e0be609a&quot;,\n     X-Forwarded-For: &quot;aaa-bbb-test.xxx.com&quot;,\n     X-Forwarded-Port: &quot;443&quot;,\n     X-Forwarded-Proto: &quot;https&quot;,\n     referer: &quot;https://aaa-bbb-test.xxx.com/doc.html&quot;,\n     ....此处略过ContentType、Accept</code></pre></li>\n<li><p>Header中有转发来源的部分头部，先尝试在Filter中除掉这些头部试试</p>\n<pre><code class=\"java\">   public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n\n       ServerHttpRequest serverHttpRequest = exchange.getRequest().mutate()\n               .headers(h -&gt; {\n                   h.remove(&quot;X-Forwarded-For&quot;);\n                   h.remove(&quot;X-Forwarded-Port&quot;);\n                   h.remove(&quot;X-Forwarded-Proto&quot;);\n               })\n               .build();\n       return chain.filter(exchange.mutate().request(serverHttpRequest).build());\n   }</code></pre>\n<p>然而并没有什么卵用，异常依旧。</p>\n</li>\n<li><p>根据异常堆栈可知，是在发起请求时出现问题，尝试找到请求发起类</p>\n<ul>\n<li><p>由于网关使用webflux导致通过日志查看的堆栈的信息不够全面，通过本地调试正常请求查看异步堆栈跟踪到请求发起类<code>NettyRoutingFilter</code></p>\n</li>\n<li><p>110行处发现一个协议判断的代码</p>\n<pre><code class=\"java\">      public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n         URI requestUrl = exchange.getRequiredAttribute(GATEWAY_REQUEST_URL_ATTR);\n\n         String scheme = requestUrl.getScheme();\n         if (isAlreadyRouted(exchange)\n         || (!&quot;http&quot;.equals(scheme) &amp;&amp; !&quot;https&quot;.equals(scheme))) {\n         return chain.filter(exchange);\n         }\n         setAlreadyRouted(exchange);\n         ...</code></pre>\n</li>\n<li><p>这个<code>scheme</code>控制了网关向其他服务的转发协议，决定这个变量的是<code>requestUrl</code></p>\n</li>\n<li><p><code>requestUrl</code>是从exchange取出来的，通过查看<code>GATEWAY_REQUEST_URL_ATTR</code>这个常量的引用，找到了<code>requestUrl</code><br>的来源<code>ReactiveLoadBalancerClientFilter#filter[113]</code></p>\n</li>\n<li><p>发现源码注释</p>\n<pre><code>        // if the `lb:&lt;scheme&gt;` mechanism was used, use `&lt;scheme&gt;` as the default,\n        // if the loadbalancer doesn&#39;t provide one.</code></pre></li>\n<li><p>根据源码注释修改网关的配置</p>\n<pre><code>    修改前:\n    [\n      {\n      &quot;id&quot;: &quot;service-a&quot;,\n      &quot;name&quot;: &quot;A服务&quot;,\n      &quot;predicates&quot;: [&quot;Path=/service-a/**&quot;],\n      &quot;filters&quot;: [],\n      &quot;uri&quot;: &quot;lb://service-a&quot;\n      }\n    ]\n    修改后:\n    [\n      {\n      &quot;id&quot;: &quot;service-a&quot;,\n      &quot;name&quot;: &quot;A服务&quot;,\n      &quot;predicates&quot;: [&quot;Path=/service-a/**&quot;],\n      &quot;filters&quot;: [],\n      &quot;uri&quot;: &quot;lb:http://service-a&quot;\n      }\n    ]</code></pre></li>\n</ul>\n</li>\n<li><p>服务恢复正常了</p>\n</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"找到根本原因\"><a href=\"#找到根本原因\" class=\"headerlink\" title=\"找到根本原因\"></a>找到根本原因</h2><h4 id=\"整理出SpringCloudGateway的请求处理流程的关键类：\"><a href=\"#整理出SpringCloudGateway的请求处理流程的关键类：\" class=\"headerlink\" title=\"整理出SpringCloudGateway的请求处理流程的关键类：\"></a>整理出SpringCloudGateway的请求处理流程的关键类：</h4><ol>\n<li><p>由LoadBalancerUriTools计算scheme、host、port。其中scheme由<code>overrideScheme</code>和``</p>\n<ol>\n<li><code>org.springframework.cloud.gateway.filter.ReactiveLoadBalancerClientFilter#filter[108]</code></li>\n<li><code>org.springframework.cloud.client.loadbalancer.LoadBalancerUriTools#doReconstructURI[100]</code></li>\n</ol>\n</li>\n<li><p>共享 GATEWAY_REQUEST_URL_ATTR 变量给其他的Filter</p>\n<ol>\n<li><code>org.springframework.cloud.gateway.filter.ReactiveLoadBalancerClientFilter#filter[113]</code></li>\n<li><code>org.springframework.cloud.gateway.filter.NettyRoutingFilter#filter[108]</code></li>\n</ol>\n</li>\n<li><p>交由Netty发起请求</p>\n<ol>\n<li><code>org.springframework.cloud.gateway.filter.NettyRoutingFilter#filter[108]</code></li>\n</ol>\n</li>\n</ol>\n<h4 id=\"问题发生在第一步：由LoadBalancerUriTools计算scheme、host、port\"><a href=\"#问题发生在第一步：由LoadBalancerUriTools计算scheme、host、port\" class=\"headerlink\" title=\"问题发生在第一步：由LoadBalancerUriTools计算scheme、host、port\"></a>问题发生在第一步：由LoadBalancerUriTools计算scheme、host、port</h4><ol>\n<li><p>在ReactiveLoadBalancerClientFilter中，主要逻辑如下</p>\n<pre><code class=\"java\">    return choose(exchange).doOnNext(response -&gt; {\n\n        if (!response.hasServer()) {\n            throw NotFoundException.create(properties.isUse404(),\n                    &quot;Unable to find instance for &quot; + url.getHost());\n        }\n\n        URI uri = exchange.getRequest().getURI();\n\n        // if the `lb:&lt;scheme&gt;` mechanism was used, use `&lt;scheme&gt;` as the default,\n        // if the loadbalancer doesn&#39;t provide one.\n        String overrideScheme = null;\n        if (schemePrefix != null) {\n            overrideScheme = url.getScheme();\n        }\n\n        DelegatingServiceInstance serviceInstance = new DelegatingServiceInstance(\n                response.getServer(), overrideScheme);\n\n        URI requestUrl = reconstructURI(serviceInstance, uri);\n\n        if (log.isTraceEnabled()) {\n            log.trace(&quot;LoadBalancerClientFilter url chosen: &quot; + requestUrl);\n        }\n        exchange.getAttributes().put(GATEWAY_REQUEST_URL_ATTR, requestUrl);\n    }).then(chain.filter(exchange));</code></pre>\n</li>\n<li><p>此处的<code>overrideScheme</code>就是刚才配置中添加的<code>http:</code>,这是优先级最高的配置</p>\n</li>\n<li><p>然后<code>response.getServer()</code>和<code>overrideScheme</code>被送入委派类DelegatingServiceInstance中，项目中ServiceInstance的实现类是NacosServiceInstance</p>\n</li>\n<li><p>紧接着<code>reconstructURI(serviceInstance, uri);</code>被执行，重建后的URI的scheme、host、port都是从<code>ServiceInstance</code>中获取的</p>\n</li>\n<li><p>由于NacosServiceInstance没实现getScheme()，因此进入接口的default方法返回null值</p>\n<ul>\n<li><code>org.springframework.cloud.gateway.support.DelegatingServiceInstance#getScheme[76]</code></li>\n<li><code>org.springframework.cloud.client.ServiceInstance#getScheme[71]</code></li>\n</ul>\n</li>\n<li><p>由于路由配置和服务实例中都没有取到scheme最终选取了原始URI中的scheme</p>\n<ul>\n<li><code>org.springframework.cloud.client.loadbalancer.LoadBalancerUriTools#computeScheme</code></li>\n</ul>\n</li>\n<li><p>NettyRoutingFilter将Response原样送出，协议是https内容是http，因此导致在建立TLS链接时发生了异常</p>\n<ul>\n<li><code>org.springframework.cloud.gateway.filter.NettyRoutingFilter#filter[147]</code></li>\n</ul>\n</li>\n</ol>"},{"title":"改造Spring-data-redis 优雅设置过期时间","comments":1,"date":"2020-08-07T04:00:55.000Z","updated":"2020-08-07T04:00:55.000Z","_content":"\n\nSpring-data-redis是一个比较优雅的缓存解决方案，只需要在对应的方法上打上注解就可以便捷的将数据放入redis。\n\n但Spring-data-redis中配置TTL只能按照`cacheName`的维度进行配置，并不能精确到具体的接口上。\n\n比如以下需求就不能优雅的实现：\n```java\npublic interface CacheDemo{\n\n    // 这个接口只缓存30min\n    @Cacheable(value = \"user\", keyGenerator = \"xxxx\")\n    List<User> listByQuery(UserQuery query);\n    \n    // 这个接口只缓存1min\n    @Cacheable(value = \"user\", keyGenerator = \"xxxx\")\n    List<User> takeUserFromObj(Object obj);\n    \n    // 这个接口缓存180min\n    @Cacheable(value = \"user\", keyGenerator = \"xxxx\")\n    List<User> getByUserId(String userId);\n}\n```\n\n这篇文章就将以定制Cache具体实现类的方式优雅的实现这个功能.\n<!--more-->\n","source":"_posts/改造Spring-data-redis.md","raw":"---\ntitle: 改造Spring-data-redis 优雅设置过期时间\ncomments: true\ncategories:\n  - [我永远爱学习]\ntags:\n  - java\ndate: 2020-08-07 12:00:55\nupdated: 2020-08-07 12:00:55\n---\n\n\nSpring-data-redis是一个比较优雅的缓存解决方案，只需要在对应的方法上打上注解就可以便捷的将数据放入redis。\n\n但Spring-data-redis中配置TTL只能按照`cacheName`的维度进行配置，并不能精确到具体的接口上。\n\n比如以下需求就不能优雅的实现：\n```java\npublic interface CacheDemo{\n\n    // 这个接口只缓存30min\n    @Cacheable(value = \"user\", keyGenerator = \"xxxx\")\n    List<User> listByQuery(UserQuery query);\n    \n    // 这个接口只缓存1min\n    @Cacheable(value = \"user\", keyGenerator = \"xxxx\")\n    List<User> takeUserFromObj(Object obj);\n    \n    // 这个接口缓存180min\n    @Cacheable(value = \"user\", keyGenerator = \"xxxx\")\n    List<User> getByUserId(String userId);\n}\n```\n\n这篇文章就将以定制Cache具体实现类的方式优雅的实现这个功能.\n<!--more-->\n","slug":"改造Spring-data-redis","published":1,"layout":"post","photos":[],"link":"","_id":"cktp91zlb001i4cow0m308f7t","content":"<p>Spring-data-redis是一个比较优雅的缓存解决方案，只需要在对应的方法上打上注解就可以便捷的将数据放入redis。</p>\n<p>但Spring-data-redis中配置TTL只能按照<code>cacheName</code>的维度进行配置，并不能精确到具体的接口上。</p>\n<p>比如以下需求就不能优雅的实现：</p>\n<pre><code class=\"java\">public interface CacheDemo{\n\n    // 这个接口只缓存30min\n    @Cacheable(value = &quot;user&quot;, keyGenerator = &quot;xxxx&quot;)\n    List&lt;User&gt; listByQuery(UserQuery query);\n\n    // 这个接口只缓存1min\n    @Cacheable(value = &quot;user&quot;, keyGenerator = &quot;xxxx&quot;)\n    List&lt;User&gt; takeUserFromObj(Object obj);\n\n    // 这个接口缓存180min\n    @Cacheable(value = &quot;user&quot;, keyGenerator = &quot;xxxx&quot;)\n    List&lt;User&gt; getByUserId(String userId);\n}</code></pre>\n<p>这篇文章就将以定制Cache具体实现类的方式优雅的实现这个功能.</p>\n<a id=\"more\"></a>\n","site":{"data":{}},"excerpt":"<p>Spring-data-redis是一个比较优雅的缓存解决方案，只需要在对应的方法上打上注解就可以便捷的将数据放入redis。</p>\n<p>但Spring-data-redis中配置TTL只能按照<code>cacheName</code>的维度进行配置，并不能精确到具体的接口上。</p>\n<p>比如以下需求就不能优雅的实现：</p>\n<pre><code class=\"java\">public interface CacheDemo{\n\n    // 这个接口只缓存30min\n    @Cacheable(value = &quot;user&quot;, keyGenerator = &quot;xxxx&quot;)\n    List&lt;User&gt; listByQuery(UserQuery query);\n\n    // 这个接口只缓存1min\n    @Cacheable(value = &quot;user&quot;, keyGenerator = &quot;xxxx&quot;)\n    List&lt;User&gt; takeUserFromObj(Object obj);\n\n    // 这个接口缓存180min\n    @Cacheable(value = &quot;user&quot;, keyGenerator = &quot;xxxx&quot;)\n    List&lt;User&gt; getByUserId(String userId);\n}</code></pre>\n<p>这篇文章就将以定制Cache具体实现类的方式优雅的实现这个功能.</p>","more":""},{"title":"[ESP8266]02_Lua基础","date":"2020-11-16T16:36:57.000Z","cover":"/2020/11/17/%5BESP8266%5D02_Lua基础/title_s.jpg","coverWidth":1340,"coverHeight":768,"_content":"","source":"_posts/[ESP8266]02_Lua基础.md","raw":"---\ntitle: \"[ESP8266]02_Lua基础\"\ndate: 2020/11/17 00:36:57\ncategories: \n    - [我永远爱学习]\ntags: \n    - 单片机\n    - IOT\n    - Lua\ncover: /2020/11/17/%5BESP8266%5D02_Lua基础/title_s.jpg\ncoverWidth: 1340\ncoverHeight: 768\n---\n","slug":"[ESP8266]02_Lua基础","published":1,"updated":"2021-07-28T03:03:19.618Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cktp91zlg001l4cow7mr14mzb","content":"","site":{"data":{}},"excerpt":"","more":""},{"layout":"书单整理","title":"书单整理(2021/08/30)","date":"2021-09-09T12:45:28.000Z","_content":"\n建议部门采购的书单，有意向可以参考一下\n<!--more-->\n\n# 书单整理(2021/08/30)\n\n## 自己整理的\n### 查漏补缺(给部门所有人选的)\n- [码农翻身](https://item.jd.com/12364204.html)\n    - ```入门用基础书，适用2年以下经验```\n- [图灵经典计算机基础图书](https://item.jd.com/13320916.html#crumb-wrap)\n    - ```强烈推荐下面该丛书```\n    - [网络是怎样连接的](https://item.jd.com/13222600.html#crumb-wrap)\n    - [面向对象是怎样工作的](https://item.jd.com/12923388.html#crumb-wrap)\n    - [程序是怎样跑起来的](https://item.jd.com/13284946.html#crumb-wrap)\n    - [计算机是怎样跑起来的](https://item.jd.com/13264778.html#crumb-wrap)\n### 部门首选\n- [代码整洁之道+程序员的职业素养](https://item.jd.com/12842858.html)\n    - ```强烈推荐前面一本。 后面那姊妹书主要是讲故事的，可选```\n- [架构整洁之道](https://item.jd.com/12447192.html)\n- [流程的永恒之道：工作流及BPM技术的理论、规范、模式及最佳实践](https://item.jd.com/11465099.html)\n- [重构 改善既有代码的设计 Java语言版](https://item.jd.com/11728740.html#comment)\n### 扩展书单（自己想要的）\n- [数据密集型应用系统设计 [Designing Data-Intensive Applications]](https://item.jd.com/12437624.html?cu=true&utm_source=book.douban.com&utm_medium=tuiguang&utm_campaign=t_15055_&utm_term=b5147d1ea7b041c594a5d60d2fc94684)\n- [分布式系统应用设计 [Designing Distributed Systems]](https://item.jd.com/12711102.html)\n\n\n## 后端同事A\n- [数据结构与算法分析--java语言描述](https://item.jd.com/11886254.html)\n- [深入理解计算机系统(CSAPP)](https://item.jd.com/12006637.html)\n\n## 前端同事\n- 前端同事B [ES6标准入门（第3版）](https://item.jd.com/12172449.html#none)\n- 前端同事C [深入理解ES6](https://item.jd.com/12213616.html)\n- 前端同事D [JavaScript高级程序设计 第4版(图灵出品）](https://item.jd.com/12958580.html)\n- 前端同事E [TypeScript项目开发实战 [Advanced TypeScript Programming Projects]](https://item.jd.com/12945908.html)\n","source":"_posts/书单整理2021-08-30.md","raw":"---\nlayout: 书单整理\ntitle: 书单整理(2021/08/30)\ndate: 2021-09-09 20:45:28\ncategories:\n- [我永远爱学习]\ntags:\n- java\n- blog\n---\n\n建议部门采购的书单，有意向可以参考一下\n<!--more-->\n\n# 书单整理(2021/08/30)\n\n## 自己整理的\n### 查漏补缺(给部门所有人选的)\n- [码农翻身](https://item.jd.com/12364204.html)\n    - ```入门用基础书，适用2年以下经验```\n- [图灵经典计算机基础图书](https://item.jd.com/13320916.html#crumb-wrap)\n    - ```强烈推荐下面该丛书```\n    - [网络是怎样连接的](https://item.jd.com/13222600.html#crumb-wrap)\n    - [面向对象是怎样工作的](https://item.jd.com/12923388.html#crumb-wrap)\n    - [程序是怎样跑起来的](https://item.jd.com/13284946.html#crumb-wrap)\n    - [计算机是怎样跑起来的](https://item.jd.com/13264778.html#crumb-wrap)\n### 部门首选\n- [代码整洁之道+程序员的职业素养](https://item.jd.com/12842858.html)\n    - ```强烈推荐前面一本。 后面那姊妹书主要是讲故事的，可选```\n- [架构整洁之道](https://item.jd.com/12447192.html)\n- [流程的永恒之道：工作流及BPM技术的理论、规范、模式及最佳实践](https://item.jd.com/11465099.html)\n- [重构 改善既有代码的设计 Java语言版](https://item.jd.com/11728740.html#comment)\n### 扩展书单（自己想要的）\n- [数据密集型应用系统设计 [Designing Data-Intensive Applications]](https://item.jd.com/12437624.html?cu=true&utm_source=book.douban.com&utm_medium=tuiguang&utm_campaign=t_15055_&utm_term=b5147d1ea7b041c594a5d60d2fc94684)\n- [分布式系统应用设计 [Designing Distributed Systems]](https://item.jd.com/12711102.html)\n\n\n## 后端同事A\n- [数据结构与算法分析--java语言描述](https://item.jd.com/11886254.html)\n- [深入理解计算机系统(CSAPP)](https://item.jd.com/12006637.html)\n\n## 前端同事\n- 前端同事B [ES6标准入门（第3版）](https://item.jd.com/12172449.html#none)\n- 前端同事C [深入理解ES6](https://item.jd.com/12213616.html)\n- 前端同事D [JavaScript高级程序设计 第4版(图灵出品）](https://item.jd.com/12958580.html)\n- 前端同事E [TypeScript项目开发实战 [Advanced TypeScript Programming Projects]](https://item.jd.com/12945908.html)\n","slug":"书单整理2021-08-30","published":1,"updated":"2021-09-16T15:40:26.256Z","comments":1,"photos":[],"link":"","_id":"cktp91zlh001n4cow4qyna28u","content":"<p>建议部门采购的书单，有意向可以参考一下</p>\n<a id=\"more\"></a>\n\n<h1 id=\"书单整理-2021-08-30\"><a href=\"#书单整理-2021-08-30\" class=\"headerlink\" title=\"书单整理(2021/08/30)\"></a>书单整理(2021/08/30)</h1><h2 id=\"自己整理的\"><a href=\"#自己整理的\" class=\"headerlink\" title=\"自己整理的\"></a>自己整理的</h2><h3 id=\"查漏补缺-给部门所有人选的\"><a href=\"#查漏补缺-给部门所有人选的\" class=\"headerlink\" title=\"查漏补缺(给部门所有人选的)\"></a>查漏补缺(给部门所有人选的)</h3><ul>\n<li><a href=\"https://item.jd.com/12364204.html\" target=\"_blank\" rel=\"noopener\">码农翻身</a><ul>\n<li><code>入门用基础书，适用2年以下经验</code></li>\n</ul>\n</li>\n<li><a href=\"https://item.jd.com/13320916.html#crumb-wrap\" target=\"_blank\" rel=\"noopener\">图灵经典计算机基础图书</a><ul>\n<li><code>强烈推荐下面该丛书</code></li>\n<li><a href=\"https://item.jd.com/13222600.html#crumb-wrap\" target=\"_blank\" rel=\"noopener\">网络是怎样连接的</a></li>\n<li><a href=\"https://item.jd.com/12923388.html#crumb-wrap\" target=\"_blank\" rel=\"noopener\">面向对象是怎样工作的</a></li>\n<li><a href=\"https://item.jd.com/13284946.html#crumb-wrap\" target=\"_blank\" rel=\"noopener\">程序是怎样跑起来的</a></li>\n<li><a href=\"https://item.jd.com/13264778.html#crumb-wrap\" target=\"_blank\" rel=\"noopener\">计算机是怎样跑起来的</a><h3 id=\"部门首选\"><a href=\"#部门首选\" class=\"headerlink\" title=\"部门首选\"></a>部门首选</h3></li>\n</ul>\n</li>\n<li><a href=\"https://item.jd.com/12842858.html\" target=\"_blank\" rel=\"noopener\">代码整洁之道+程序员的职业素养</a><ul>\n<li><code>强烈推荐前面一本。 后面那姊妹书主要是讲故事的，可选</code></li>\n</ul>\n</li>\n<li><a href=\"https://item.jd.com/12447192.html\" target=\"_blank\" rel=\"noopener\">架构整洁之道</a></li>\n<li><a href=\"https://item.jd.com/11465099.html\" target=\"_blank\" rel=\"noopener\">流程的永恒之道：工作流及BPM技术的理论、规范、模式及最佳实践</a></li>\n<li><a href=\"https://item.jd.com/11728740.html#comment\" target=\"_blank\" rel=\"noopener\">重构 改善既有代码的设计 Java语言版</a><h3 id=\"扩展书单（自己想要的）\"><a href=\"#扩展书单（自己想要的）\" class=\"headerlink\" title=\"扩展书单（自己想要的）\"></a>扩展书单（自己想要的）</h3></li>\n<li><a href=\"https://item.jd.com/12437624.html?cu=true&utm_source=book.douban.com&utm_medium=tuiguang&utm_campaign=t_15055_&utm_term=b5147d1ea7b041c594a5d60d2fc94684\" target=\"_blank\" rel=\"noopener\">数据密集型应用系统设计 [Designing Data-Intensive Applications]</a></li>\n<li><a href=\"https://item.jd.com/12711102.html\" target=\"_blank\" rel=\"noopener\">分布式系统应用设计 [Designing Distributed Systems]</a></li>\n</ul>\n<h2 id=\"后端同事A\"><a href=\"#后端同事A\" class=\"headerlink\" title=\"后端同事A\"></a>后端同事A</h2><ul>\n<li><a href=\"https://item.jd.com/11886254.html\" target=\"_blank\" rel=\"noopener\">数据结构与算法分析–java语言描述</a></li>\n<li><a href=\"https://item.jd.com/12006637.html\" target=\"_blank\" rel=\"noopener\">深入理解计算机系统(CSAPP)</a></li>\n</ul>\n<h2 id=\"前端同事\"><a href=\"#前端同事\" class=\"headerlink\" title=\"前端同事\"></a>前端同事</h2><ul>\n<li>前端同事B <a href=\"https://item.jd.com/12172449.html#none\" target=\"_blank\" rel=\"noopener\">ES6标准入门（第3版）</a></li>\n<li>前端同事C <a href=\"https://item.jd.com/12213616.html\" target=\"_blank\" rel=\"noopener\">深入理解ES6</a></li>\n<li>前端同事D <a href=\"https://item.jd.com/12958580.html\" target=\"_blank\" rel=\"noopener\">JavaScript高级程序设计 第4版(图灵出品）</a></li>\n<li>前端同事E <a href=\"https://item.jd.com/12945908.html\" target=\"_blank\" rel=\"noopener\">TypeScript项目开发实战 [Advanced TypeScript Programming Projects]</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>建议部门采购的书单，有意向可以参考一下</p>","more":"<h1 id=\"书单整理-2021-08-30\"><a href=\"#书单整理-2021-08-30\" class=\"headerlink\" title=\"书单整理(2021/08/30)\"></a>书单整理(2021/08/30)</h1><h2 id=\"自己整理的\"><a href=\"#自己整理的\" class=\"headerlink\" title=\"自己整理的\"></a>自己整理的</h2><h3 id=\"查漏补缺-给部门所有人选的\"><a href=\"#查漏补缺-给部门所有人选的\" class=\"headerlink\" title=\"查漏补缺(给部门所有人选的)\"></a>查漏补缺(给部门所有人选的)</h3><ul>\n<li><a href=\"https://item.jd.com/12364204.html\" target=\"_blank\" rel=\"noopener\">码农翻身</a><ul>\n<li><code>入门用基础书，适用2年以下经验</code></li>\n</ul>\n</li>\n<li><a href=\"https://item.jd.com/13320916.html#crumb-wrap\" target=\"_blank\" rel=\"noopener\">图灵经典计算机基础图书</a><ul>\n<li><code>强烈推荐下面该丛书</code></li>\n<li><a href=\"https://item.jd.com/13222600.html#crumb-wrap\" target=\"_blank\" rel=\"noopener\">网络是怎样连接的</a></li>\n<li><a href=\"https://item.jd.com/12923388.html#crumb-wrap\" target=\"_blank\" rel=\"noopener\">面向对象是怎样工作的</a></li>\n<li><a href=\"https://item.jd.com/13284946.html#crumb-wrap\" target=\"_blank\" rel=\"noopener\">程序是怎样跑起来的</a></li>\n<li><a href=\"https://item.jd.com/13264778.html#crumb-wrap\" target=\"_blank\" rel=\"noopener\">计算机是怎样跑起来的</a><h3 id=\"部门首选\"><a href=\"#部门首选\" class=\"headerlink\" title=\"部门首选\"></a>部门首选</h3></li>\n</ul>\n</li>\n<li><a href=\"https://item.jd.com/12842858.html\" target=\"_blank\" rel=\"noopener\">代码整洁之道+程序员的职业素养</a><ul>\n<li><code>强烈推荐前面一本。 后面那姊妹书主要是讲故事的，可选</code></li>\n</ul>\n</li>\n<li><a href=\"https://item.jd.com/12447192.html\" target=\"_blank\" rel=\"noopener\">架构整洁之道</a></li>\n<li><a href=\"https://item.jd.com/11465099.html\" target=\"_blank\" rel=\"noopener\">流程的永恒之道：工作流及BPM技术的理论、规范、模式及最佳实践</a></li>\n<li><a href=\"https://item.jd.com/11728740.html#comment\" target=\"_blank\" rel=\"noopener\">重构 改善既有代码的设计 Java语言版</a><h3 id=\"扩展书单（自己想要的）\"><a href=\"#扩展书单（自己想要的）\" class=\"headerlink\" title=\"扩展书单（自己想要的）\"></a>扩展书单（自己想要的）</h3></li>\n<li><a href=\"https://item.jd.com/12437624.html?cu=true&utm_source=book.douban.com&utm_medium=tuiguang&utm_campaign=t_15055_&utm_term=b5147d1ea7b041c594a5d60d2fc94684\" target=\"_blank\" rel=\"noopener\">数据密集型应用系统设计 [Designing Data-Intensive Applications]</a></li>\n<li><a href=\"https://item.jd.com/12711102.html\" target=\"_blank\" rel=\"noopener\">分布式系统应用设计 [Designing Distributed Systems]</a></li>\n</ul>\n<h2 id=\"后端同事A\"><a href=\"#后端同事A\" class=\"headerlink\" title=\"后端同事A\"></a>后端同事A</h2><ul>\n<li><a href=\"https://item.jd.com/11886254.html\" target=\"_blank\" rel=\"noopener\">数据结构与算法分析–java语言描述</a></li>\n<li><a href=\"https://item.jd.com/12006637.html\" target=\"_blank\" rel=\"noopener\">深入理解计算机系统(CSAPP)</a></li>\n</ul>\n<h2 id=\"前端同事\"><a href=\"#前端同事\" class=\"headerlink\" title=\"前端同事\"></a>前端同事</h2><ul>\n<li>前端同事B <a href=\"https://item.jd.com/12172449.html#none\" target=\"_blank\" rel=\"noopener\">ES6标准入门（第3版）</a></li>\n<li>前端同事C <a href=\"https://item.jd.com/12213616.html\" target=\"_blank\" rel=\"noopener\">深入理解ES6</a></li>\n<li>前端同事D <a href=\"https://item.jd.com/12958580.html\" target=\"_blank\" rel=\"noopener\">JavaScript高级程序设计 第4版(图灵出品）</a></li>\n<li>前端同事E <a href=\"https://item.jd.com/12945908.html\" target=\"_blank\" rel=\"noopener\">TypeScript项目开发实战 [Advanced TypeScript Programming Projects]</a></li>\n</ul>"}],"PostAsset":[{"_id":"source/_posts/[MXCHIP-1]开发板到手/1_s.jpg","slug":"1_s.jpg","post":"cktp91zkg00074cow5ox9bgp7","modified":1,"renderable":0},{"_id":"source/_posts/[MXCHIP-1]开发板到手/5_s.jpg","slug":"5_s.jpg","post":"cktp91zkg00074cow5ox9bgp7","modified":1,"renderable":0},{"_id":"source/_posts/[MXCHIP-2]真机调试/SWD接口定义.png","slug":"SWD接口定义.png","post":"cktp91zkk00084cow6xas615i","modified":1,"renderable":0},{"_id":"source/_posts/[ESP8266]01_刷写测试AT固件/title_s.jpg","post":"cktp91zkv000n4cowgwtl9465","slug":"title_s.jpg","modified":1,"renderable":1},{"_id":"source/_posts/java8函数设计[1]-在filter中根据Key去重的函数/title.jpg","post":"cktp91zky000w4cow4iqe1yjd","slug":"title.jpg","modified":1,"renderable":1},{"_id":"source/_posts/好用常用人人都要会的最基本的Maven插件收集/title.jpg","post":"cktp91zl600194cowa4fb9gat","slug":"title.jpg","modified":1,"renderable":1},{"_id":"source/_posts/计划任务的Spring实现与手动实现/title.jpg","post":"cktp91zl8001c4cowbeym5yzz","slug":"title.jpg","modified":1,"renderable":1},{"_id":"source/_posts/[ESP8266]02_Lua基础/title_s.jpg","post":"cktp91zlg001l4cow7mr14mzb","slug":"title_s.jpg","modified":1,"renderable":1},{"_id":"source/_posts/发码平台结构设计/发码平台交互图.jpg","slug":"发码平台交互图.jpg","post":"cktp91zl000104cowb1rdaxos","modified":1,"renderable":0},{"_id":"source/_posts/发码平台结构设计/发码平台交互图.vsdx","post":"cktp91zl000104cowb1rdaxos","slug":"发码平台交互图.vsdx","modified":1,"renderable":1},{"_id":"source/_posts/改造Spring-data-redis/MyRedisCacheManage.java","post":"cktp91zlb001i4cow0m308f7t","slug":"MyRedisCacheManage.java","modified":1,"renderable":1},{"_id":"source/_posts/改造Spring-data-redis/TTLRedisCache.java","post":"cktp91zlb001i4cow0m308f7t","slug":"TTLRedisCache.java","modified":1,"renderable":1},{"_id":"source/_posts/Death_Standing/IMG_20200319_004053.jpg","post":"cktp91zkn000c4cow28aobtb1","slug":"IMG_20200319_004053.jpg","modified":1,"renderable":1},{"_id":"source/_posts/Death_Standing/psc.jpg","post":"cktp91zkn000c4cow28aobtb1","slug":"psc.jpg","modified":1,"renderable":1},{"_id":"source/_posts/Death_Standing/v2-e0a965a2365bdadda41dedcb9fe5ec58_r.jpg","slug":"v2-e0a965a2365bdadda41dedcb9fe5ec58_r.jpg","post":"cktp91zkn000c4cow28aobtb1","modified":1,"renderable":0},{"_id":"source/_posts/[DEBUG日记]Swagger扫不到类-Jdk代理导致的反射类型故障/ApiListingReferenceScanner.png","slug":"ApiListingReferenceScanner.png","post":"cktp91zkw000q4cow1ga53fhe","modified":1,"renderable":0},{"_id":"source/_posts/[DEBUG日记]Swagger扫不到类-Jdk代理导致的反射类型故障/RequestHandlerSelectors#1.png","post":"cktp91zkw000q4cow1ga53fhe","slug":"RequestHandlerSelectors#1.png","modified":1,"renderable":1},{"_id":"source/_posts/[DEBUG日记]Swagger扫不到类-Jdk代理导致的反射类型故障/RequestHandlerSelectors#2.png","post":"cktp91zkw000q4cow1ga53fhe","slug":"RequestHandlerSelectors#2.png","modified":1,"renderable":1},{"_id":"source/_posts/[DEBUG日记]Swagger扫不到类-Jdk代理导致的反射类型故障/RequestHandlerSelectors#3.png","post":"cktp91zkw000q4cow1ga53fhe","slug":"RequestHandlerSelectors#3.png","modified":1,"renderable":1},{"_id":"source/_posts/[MXCHIP-2]真机调试/DS0021CN_EMW3031_V1.4.pdf","slug":"DS0021CN_EMW3031_V1.4.pdf","post":"cktp91zkk00084cow6xas615i","modified":1,"renderable":0},{"_id":"source/_posts/[MXCHIP-2]真机调试/SWD接口定义.jpg","post":"cktp91zkk00084cow6xas615i","slug":"SWD接口定义.jpg","modified":1,"renderable":1},{"_id":"source/_posts/[MXCHIP-2]真机调试/UART接口定义.jpg","post":"cktp91zkk00084cow6xas615i","slug":"UART接口定义.jpg","modified":1,"renderable":1},{"_id":"source/_posts/[MXCHIP-2]真机调试/title.jpg","slug":"title.jpg","post":"cktp91zkk00084cow6xas615i","modified":1,"renderable":0},{"_id":"source/_posts/[MXCHIP-1]开发板到手/1.jpg","slug":"1.jpg","post":"cktp91zkg00074cow5ox9bgp7","modified":1,"renderable":0},{"_id":"source/_posts/[MXCHIP-1]开发板到手/3.jpg","post":"cktp91zkg00074cow5ox9bgp7","slug":"3.jpg","modified":1,"renderable":1},{"_id":"source/_posts/[MXCHIP-1]开发板到手/4.jpg","slug":"4.jpg","post":"cktp91zkg00074cow5ox9bgp7","modified":1,"renderable":0},{"_id":"source/_posts/[MXCHIP-1]开发板到手/4_s.jpg","post":"cktp91zkg00074cow5ox9bgp7","slug":"4_s.jpg","modified":1,"renderable":1},{"_id":"source/_posts/[MXCHIP-1]开发板到手/5.jpg","slug":"5.jpg","post":"cktp91zkg00074cow5ox9bgp7","modified":1,"renderable":0},{"_id":"source/_posts/[MXCHIP-1]开发板到手/6.jpg","post":"cktp91zkg00074cow5ox9bgp7","slug":"6.jpg","modified":1,"renderable":1},{"_id":"source/_posts/[MXCHIP-1]开发板到手/title.jpg","slug":"title.jpg","post":"cktp91zkg00074cow5ox9bgp7","modified":1,"renderable":0},{"_id":"source/_posts/[MXCHIP-1]开发板到手/title_s.jpg","post":"cktp91zkg00074cow5ox9bgp7","slug":"title_s.jpg","modified":1,"renderable":1}],"PostCategory":[{"post_id":"cktp91zk800024cowevf39arf","category_id":"cktp91zke00064cow76nkdl01","_id":"cktp91zks000h4cow40jpbg3s"},{"post_id":"cktp91zkn000c4cow28aobtb1","category_id":"cktp91zke00064cow76nkdl01","_id":"cktp91zkv000o4cow8c94cwlg"},{"post_id":"cktp91zka00034cowh9agbhqf","category_id":"cktp91zkl000a4cow7sk573il","_id":"cktp91zkw000r4cowffz8hx8o"},{"post_id":"cktp91zko000d4cowe9hjba1z","category_id":"cktp91zkl000a4cow7sk573il","_id":"cktp91zky000v4cowbh5h8k71"},{"post_id":"cktp91zke00054cow31paan0u","category_id":"cktp91zkl000a4cow7sk573il","_id":"cktp91zkz000x4cow7pgmbd9o"},{"post_id":"cktp91zkv000n4cowgwtl9465","category_id":"cktp91zku000m4cow3cgqb3fx","_id":"cktp91zl000114cowgcd7ds4y"},{"post_id":"cktp91zkg00074cow5ox9bgp7","category_id":"cktp91zku000m4cow3cgqb3fx","_id":"cktp91zl200134cowd7lc59yv"},{"post_id":"cktp91zkw000q4cow1ga53fhe","category_id":"cktp91zku000m4cow3cgqb3fx","_id":"cktp91zl500164cow9ppw2y5h"},{"post_id":"cktp91zkx000u4cow6zhthd3w","category_id":"cktp91zku000m4cow3cgqb3fx","_id":"cktp91zl8001a4cowbvnacsoa"},{"post_id":"cktp91zkk00084cow6xas615i","category_id":"cktp91zku000m4cow3cgqb3fx","_id":"cktp91zl9001d4cow9s8w10v4"},{"post_id":"cktp91zky000w4cow4iqe1yjd","category_id":"cktp91zku000m4cow3cgqb3fx","_id":"cktp91zla001h4cow71wjdv1r"},{"post_id":"cktp91zks000g4cow2sz95gc4","category_id":"cktp91zku000m4cow3cgqb3fx","_id":"cktp91zlb001j4cow4o1s87dr"},{"post_id":"cktp91zl100124cowfz851fdx","category_id":"cktp91zku000m4cow3cgqb3fx","_id":"cktp91zlg001m4cowah1z0avd"},{"post_id":"cktp91zl400154cowhhj4htrn","category_id":"cktp91zku000m4cow3cgqb3fx","_id":"cktp91zli001o4cow1y3y6x4x"},{"post_id":"cktp91zkt000j4cowfuy258xe","category_id":"cktp91zku000m4cow3cgqb3fx","_id":"cktp91zlj001r4cowbft1dj3u"},{"post_id":"cktp91zl600194cowa4fb9gat","category_id":"cktp91zku000m4cow3cgqb3fx","_id":"cktp91zlk001t4cowai1nfbjb"},{"post_id":"cktp91zl8001c4cowbeym5yzz","category_id":"cktp91zku000m4cow3cgqb3fx","_id":"cktp91zlk001w4cowb9rhfo6c"},{"post_id":"cktp91zla001g4cow2mcv2rqv","category_id":"cktp91zku000m4cow3cgqb3fx","_id":"cktp91zll001y4cowau2b6js8"},{"post_id":"cktp91zlb001i4cow0m308f7t","category_id":"cktp91zku000m4cow3cgqb3fx","_id":"cktp91zll00204cow8o0a8j6z"},{"post_id":"cktp91zlg001l4cow7mr14mzb","category_id":"cktp91zku000m4cow3cgqb3fx","_id":"cktp91zll00224cowaoas4jmo"},{"post_id":"cktp91zlh001n4cow4qyna28u","category_id":"cktp91zku000m4cow3cgqb3fx","_id":"cktp91zlm00244cow4gw8hq5q"}],"PostTag":[{"post_id":"cktp91zk800024cowevf39arf","tag_id":"cktp91zkc00044cow4j8ihkfz","_id":"cktp91zkm000b4cowf4nj012e"},{"post_id":"cktp91zka00034cowh9agbhqf","tag_id":"cktp91zkk00094cow3x4x049y","_id":"cktp91zks000i4cowcvrtgjaf"},{"post_id":"cktp91zko000d4cowe9hjba1z","tag_id":"cktp91zkk00094cow3x4x049y","_id":"cktp91zkt000k4cowcdsr1956"},{"post_id":"cktp91zke00054cow31paan0u","tag_id":"cktp91zkc00044cow4j8ihkfz","_id":"cktp91zkv000p4cowhhtie4vh"},{"post_id":"cktp91zkg00074cow5ox9bgp7","tag_id":"cktp91zku000l4cow0hz2atng","_id":"cktp91zl500184cow9ory7ooi"},{"post_id":"cktp91zkg00074cow5ox9bgp7","tag_id":"cktp91zkw000s4cowc01wgj7i","_id":"cktp91zl8001b4cow8d31es53"},{"post_id":"cktp91zkg00074cow5ox9bgp7","tag_id":"cktp91zkz000z4coweyv782he","_id":"cktp91zla001f4cow8z0156i6"},{"post_id":"cktp91zkk00084cow6xas615i","tag_id":"cktp91zku000l4cow0hz2atng","_id":"cktp91zlj001q4cowgbvy3j7g"},{"post_id":"cktp91zkk00084cow6xas615i","tag_id":"cktp91zkw000s4cowc01wgj7i","_id":"cktp91zlk001s4cow6psgbfz9"},{"post_id":"cktp91zkk00084cow6xas615i","tag_id":"cktp91zkz000z4coweyv782he","_id":"cktp91zlk001v4cow4mrj66m9"},{"post_id":"cktp91zkn000c4cow28aobtb1","tag_id":"cktp91zli001p4cowbrtp2pnw","_id":"cktp91zlk001x4cowh1h067lm"},{"post_id":"cktp91zks000g4cow2sz95gc4","tag_id":"cktp91zlk001u4cow166f1wnz","_id":"cktp91zll00214cow05c02hl4"},{"post_id":"cktp91zkt000j4cowfuy258xe","tag_id":"cktp91zll001z4cowhp3z1kmf","_id":"cktp91zln00274cow8df58aeh"},{"post_id":"cktp91zkt000j4cowfuy258xe","tag_id":"cktp91zlm00234cow0xwuclha","_id":"cktp91zln00284cow68pt7gmr"},{"post_id":"cktp91zkt000j4cowfuy258xe","tag_id":"cktp91zlm00254cowfhhwan74","_id":"cktp91zln002a4cow07io7b7s"},{"post_id":"cktp91zkv000n4cowgwtl9465","tag_id":"cktp91zku000l4cow0hz2atng","_id":"cktp91zln002b4cowbv9257z0"},{"post_id":"cktp91zkv000n4cowgwtl9465","tag_id":"cktp91zkw000s4cowc01wgj7i","_id":"cktp91zln002d4cow02ys4ys2"},{"post_id":"cktp91zkw000q4cow1ga53fhe","tag_id":"cktp91zlm00254cowfhhwan74","_id":"cktp91zlo002e4cow62gwfodx"},{"post_id":"cktp91zkx000u4cow6zhthd3w","tag_id":"cktp91zlm00234cow0xwuclha","_id":"cktp91zlo002h4cowapcxgz8g"},{"post_id":"cktp91zkx000u4cow6zhthd3w","tag_id":"cktp91zlo002f4cow1o6b8wc9","_id":"cktp91zlo002i4cowcdsi9m6m"},{"post_id":"cktp91zky000w4cow4iqe1yjd","tag_id":"cktp91zlo002g4cow7sx364h8","_id":"cktp91zlp002l4cow05kjeii3"},{"post_id":"cktp91zky000w4cow4iqe1yjd","tag_id":"cktp91zlm00234cow0xwuclha","_id":"cktp91zlp002m4cow4or05w0t"},{"post_id":"cktp91zl100124cowfz851fdx","tag_id":"cktp91zlm00234cow0xwuclha","_id":"cktp91zlp002o4cow5mci9h6a"},{"post_id":"cktp91zl400154cowhhj4htrn","tag_id":"cktp91zlm00234cow0xwuclha","_id":"cktp91zlq002r4cowd3zxbci5"},{"post_id":"cktp91zl400154cowhhj4htrn","tag_id":"cktp91zlo002f4cow1o6b8wc9","_id":"cktp91zlq002s4cowep2ecf7x"},{"post_id":"cktp91zl600194cowa4fb9gat","tag_id":"cktp91zlm00234cow0xwuclha","_id":"cktp91zlr002v4cow0qn0447w"},{"post_id":"cktp91zl600194cowa4fb9gat","tag_id":"cktp91zlq002t4cow0iwwb9tl","_id":"cktp91zlr002w4cow4ffmhtcf"},{"post_id":"cktp91zl8001c4cowbeym5yzz","tag_id":"cktp91zlm00234cow0xwuclha","_id":"cktp91zlr002z4cowfgsf8yzr"},{"post_id":"cktp91zl8001c4cowbeym5yzz","tag_id":"cktp91zll001z4cowhp3z1kmf","_id":"cktp91zlr00304cowad9canq8"},{"post_id":"cktp91zla001g4cow2mcv2rqv","tag_id":"cktp91zll001z4cowhp3z1kmf","_id":"cktp91zls00344cowb2fseljp"},{"post_id":"cktp91zla001g4cow2mcv2rqv","tag_id":"cktp91zlm00234cow0xwuclha","_id":"cktp91zls00354cow1yw0hohc"},{"post_id":"cktp91zla001g4cow2mcv2rqv","tag_id":"cktp91zlm00254cowfhhwan74","_id":"cktp91zlt00374cow22tv57co"},{"post_id":"cktp91zlb001i4cow0m308f7t","tag_id":"cktp91zlm00234cow0xwuclha","_id":"cktp91zlt00384cowdpxd7u01"},{"post_id":"cktp91zlg001l4cow7mr14mzb","tag_id":"cktp91zku000l4cow0hz2atng","_id":"cktp91zlt003a4cow8bf05jwz"},{"post_id":"cktp91zlg001l4cow7mr14mzb","tag_id":"cktp91zkw000s4cowc01wgj7i","_id":"cktp91zlt003b4cow7thpcnbm"},{"post_id":"cktp91zlg001l4cow7mr14mzb","tag_id":"cktp91zlt00364cow0pe956kb","_id":"cktp91zlt003c4cow7fa884vf"},{"post_id":"cktp91zlh001n4cow4qyna28u","tag_id":"cktp91zlm00234cow0xwuclha","_id":"cktp91zlt003d4cow1r766j8u"},{"post_id":"cktp91zlh001n4cow4qyna28u","tag_id":"cktp91zkc00044cow4j8ihkfz","_id":"cktp91zlt003e4cowfxcf4vaz"}],"Tag":[{"name":"blog","_id":"cktp91zkc00044cow4j8ihkfz"},{"name":"linux","_id":"cktp91zkk00094cow3x4x049y"},{"name":"单片机","_id":"cktp91zku000l4cow0hz2atng"},{"name":"IOT","_id":"cktp91zkw000s4cowc01wgj7i"},{"name":"C","_id":"cktp91zkz000z4coweyv782he"},{"name":"Games","_id":"cktp91zli001p4cowbrtp2pnw"},{"name":"pdf","_id":"cktp91zlk001u4cow166f1wnz"},{"name":"spring","_id":"cktp91zll001z4cowhp3z1kmf"},{"name":"java","_id":"cktp91zlm00234cow0xwuclha"},{"name":"debug","_id":"cktp91zlm00254cowfhhwan74"},{"name":"zookeeper","_id":"cktp91zlo002f4cow1o6b8wc9"},{"name":"lambda","_id":"cktp91zlo002g4cow7sx364h8"},{"name":"maven","_id":"cktp91zlq002t4cow0iwwb9tl"},{"name":"Lua","_id":"cktp91zlt00364cow0pe956kb"}]}}